!function(){"use strict";var e;Event.prototype.getCoordinates=function(){var e=this.touches&&this.touches.length?this.touches:[this],t=this.changedTouches&&this.changedTouches[0]||e[0];return{x:t.clientX,y:t.clientY}},window.getScrollY=function(){return window.scrollY||window.pageYOffset},Element.prototype.matches||((e=Element.prototype).matches=e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1}),Element.prototype.closest||(Element.prototype.closest=function(e){for(var t=this;t&&!t.matches(e);)t=t.parentElement;return t}),DOMTokenList.prototype.replace&&!/iPad(.*)AppleWebKit(.*)10.0 Mobile/.test(navigator.userAgent)||(DOMTokenList.prototype.replace=function(e,t){this.remove(e),this.add(t)}),"baseURI"in Node.prototype||Object.defineProperty(Node.prototype,"baseURI",{get:function(){return((this.ownerDocument||this).querySelector("base")||window.location).href},configurable:!0,enumerable:!0}),"Map"in window||(window.Map=window.Object),"Set"in window||(window.Set=window.Object),"WeakMap"in window||(window.WeakMap=window.Object),window.i18n=function(e){if(Array.isArray(e)){for(var t=e.length-1,n="",o=0;o<t;o++)n+=e[o]+(o+1<1||arguments.length<=o+1?void 0:arguments[o+1]);return n+e[t]}return e},Raven.config("https://b0afa098ef574589a68db1157c1baba4@sentry.io/89595",{environment:"production",release:"8.0.86",ignoreErrors:[/^No error$/,/__show__deepen/,/AbortError: The operation was aborted/,/Access is denied/,/anonymous function: captureException/,/Blocked a frame with origin/,/console is not defined/,/DataCloneError/,/Error: AccessDeny/,/event is not defined/,/feedConf/,/MyIPhoneApp/,/ServiceWorker/,/snapchat.com/,/vid_mate_check is not defined/,/win\.document\.body/,/window\._sharedData\.entry_data/,/ztePageScrollModule/],whitelistUrls:[/bandlab\.com/]}).addPlugin(Raven.Plugins.Angular).install(),angular.module("bandlab.account",[]),angular.module("bandlab.account.routes",["bandlab.account.login.routes","bandlab.account.settings.routes","bandlab.account.signUp.routes"]),angular.module("bandlab.account").controller("AuthCtrl",["$scope",function(e){e.$on("auth:start",function(){e.waitingForAuth=!0}),e.$on("auth:error",function(){e.waitingForAuth=!1})}]),angular.module("bandlab.account").controller("SnsConnectCtrl",["$scope","$stateParams","authService","Facebook","Google",function(e,t,n,o,a){var i={accessToken:"",provider:"",referral:t.referral,rememberMe:!0};e.facebookConnect=function(){return e.$emit("auth:start"),e.error="",i.provider="facebook",o.login().then(function(e){return i.accessToken=e.authResponse.accessToken,n.snsConnect(i)}).catch(function(){e.$emit("auth:error"),e.error="permissions",e.$applyAsync()})},e.googleConnect=function(){return e.$emit("auth:start"),e.error="",i.provider="google",a.signIn().then(function(e){return i.accessToken=e.id_token,n.snsConnect(i)}).catch(function(){e.$emit("auth:error"),e.error="permissions"})}}]),angular.module("bandlab.account.login",["bandlab.account"]),angular.module("bandlab.account.login").controller("FormLoginCtrl",["$scope","$timeout","authService",function(e,t,n){e.credentials={login:"",password:"",provider:"password",rememberMe:!0},e.login=function(){var o=angular.copy(e.credentials);o.login=o.login||e.loginForm.username.$$element[0].value,o.password=o.password||e.loginForm.password.$$element[0].value,e.$emit("auth:start"),e.error="",e.errorMessage="",o.login&&-1!==o.login.indexOf("@")?o.email=o.login:o.username=o.login,delete o.login,n.login(o).then(function(){n.redirectAfterAuth()}).catch(function(n){t(function(){e.loginForm.$setPristine(),e.$emit("auth:error"),400===n.status||401===n.status?e.error="credentials":403===n.status&&477===n.data.errorCode?(e.error="education",e.errorMessage=n.data.message):e.error="server"},1e3)})}}]),angular.module("bandlab.account.login").controller("FormPhoneLoginCtrl",["$rootScope","$scope","$timeout","authService","Identity",function(e,t,n,o,a){var i;function r(){return t.isValidating=!0,clearTimeout(i),a.sendSmsCode({phone:s()}).$promise.then(function(e){t.isCodeSent=!0,t.isValidating=!1,t.countdown=e.retryAfter,t.phoneLoginForm.$setPristine(),function e(){i=n(function(){t.countdown-=1,t.countdown&&e()},1e3)}()}).catch(function(e){t.error=429===e.data.errorCode||11===e.data.errorCode?"too-many-requests":"server"})}function s(){return"".concat(t.credentials.countryCode).concat(t.credentials.phone).replace(/[+-\s]/g,"")}t.isCodeSent=!1,t.isAuth=!0,t.credentials={name:"",phone:"",phoneVerificationCode:"",countryCode:"",provider:"phone"},t.init=function(e){t.isAuth=e.isAuth},t.sendSmsCode=function(){if(t.isValidating=!0,t.error="",t.isAvailable)return r();a.validatePhoneNumber({phone:s()}).$promise.then(function(e){if(t.isValidating=!1,t.isAvailable=e.isAvailable,t.phoneLoginForm.$setPristine(),e.isValid){if(e.isAvailable||t.isAuth)return!e.isAvailable||e.isAvailable&&t.credentials.name?r():e.isAvailable&&!t.isAuth?r():void 0;t.error="not-available"}else t.error="phonenumber"}).catch(function(e){t.phoneLoginForm.$setPristine(),t.error="server"})},t.login=function(){var e=angular.copy(t.credentials);e.phone=s(),e.register=t.isAvailable,t.$emit("auth:start"),t.error="",o.login(e).then(function(){o.redirectAfterAuth()}).catch(function(e){t.phoneLoginForm.$setPristine(),t.credentials.phoneVerificationCode="",t.$emit("auth:error"),t.error=400===e.status||401===e.status?"credentials":"server",t.error=429===e.data.errorCode||11===e.data.errorCode?"too-many-requests":t.error})},t.updatePhone=function(){var n=angular.copy(t.credentials);n.phone=s(),t.isValidating=!0,t.error="",a.update({phone:n.phone,phoneVerificationCode:n.phoneVerificationCode}).$promise.then(function(n){o.setMe(n),t.isValidating=!1,e.$broadcast("$account:phoneUpdated")}).catch(function(e){t.isValidating=!1,t.phoneLoginForm.$setPristine(),t.credentials.phoneVerificationCode="",t.error=400===e.status||401===e.status?"credentials":"server",t.error=429===e.data.errorCode||11===e.data.errorCode?"too-many-requests":t.error})}}]);var t=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,a=!1,i=void 0;try{for(var r,s=e[Symbol.iterator]();!(o=(r=s.next()).done)&&(n.push(r.value),!t||n.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()};function o(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}angular.module("bandlab.account.login.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("authenticate",{url:"/authenticate?key&redirectTo",template:"<loader-wave></loader-wave>",controller:["$state","$stateParams",function(e,t){e.go("authenticate.resolve",t,{location:"replace"})}]}).state("authenticate.resolve",{url:"/resolve?key&redirectTo",resolve:{login:["$q","$stateParams","authService",function(e,t,n){if(!t.key)return e.reject({status:404});var o={key:t.key,provider:"key"};return n.login(o).then(function(){if(!_.includes(t.redirectTo,"/v1/activity_event"))return t.redirectTo?e.reject({status:301,location:{redirectTo:t.redirectTo}}):e.reject({status:440});window.location=t.redirectTo}).catch(function(t){return 301===t.status||440===t.status?e.reject(t):e.reject({status:403})})}]}}).state("login",{url:"/login",templateUrl:"https://www.bandlab.com/web-app/account/login/views/login-872d915b.html"}).state("logout",{url:"/logout?redirectTo",templateUrl:"https://www.bandlab.com/web-app/account/login/views/logout-4309f87a.html",controller:["$stateParams","$timeout","authService",function(e,t,n){t(function(){n.logout(e.redirectTo)},2e3)}]}).state("GoogleSigninCallback",{url:"/oauth2callback",templateUrl:"https://www.bandlab.com/web-app/account/login/views/login-872d915b.html",controller:["$location","$scope","authService",function(e,a,i){var r=_.reduce(e.hash().split("&"),function(e,a){var i=a.split("="),r=n(i,2),s=r[0],c=r[1];return function(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(a,!0).forEach(function(n){t(e,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},e,t({},s,c))},{});return a.$emit("auth:start"),a.waitingForAuth=!0,i.snsConnect({provider:"google",accessToken:r.id_token})}]})}]);var a={name:"None",slug:"none",effects:[],picture:"https://static.bandlab.com/effects/v5.0/covers/default.png"},i=[{hex:"#F4605F",name:"Red"},{hex:"#56A7DB",name:"Blue"},{hex:"#7E89D7",name:"Violet"},{hex:"#C963C4",name:"Pink"},{hex:"#AECA59",name:"Green"},{hex:"#E4BF39",name:"Yellow"}],r="audioinput",s="bandlab-instrument",c="drum-machine",l="guitar-bass",u="guitar-electric",d="looper",p="voice",m=["B major","B♭ major","A major","A♭ major","G major","G♭ major","F♯ major","F major","E major","E♭ major","D major","D♭ major","C♯ major","C major","C♭ major"],f=["B minor","B♭ minor","A♯ minor","A minor","A♭ minor","G♯ minor","G minor","F♯ minor","F minor","E minor","E♭ minor","D♯ minor","D minor","C♯ minor","C minor"],h="grand-piano",g="audioFilesDB",v="audioFilesStore";function b(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function y(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?b(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):b(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}angular.module("bandlab.account").factory("authService",["$analytics","$cookies","$q","$rootScope","$state","$window","AppNotifications","appStates","ChatHub","Identity","Me","MessageModal","Modal","Page","sessionService",function(e,t,n,o,a,i,r,s,c,l,u,d,p,m,f){var h,v,b;return o.$on("$request:unauthorized",_.debounce(function(e,t){u.isAnonymous()||(v||"bandlab"!==t.api?(c.stop(),c.start()):(c.stop(),T()))},3e4,{leading:!0})),o.$on("$request:forbidden",function(e,t){u.isAnonymous()||(203!==t.errorCode?function(e){switch(t.errorCode){case 201:w();break;case 202:r.addNotification({title:"Account suspended",content:"Your account has been suspended",image:"https://www.bandlab.com/web-app/images/zero-case/zero-case-warning-7378c77ac4.png",action:'<a href="https://help.bandlab.com/hc/en-us/articles/360026519473" target="_blank" rel="noopener">'.concat("Learn More","</a>"),classList:"light"});break;case 205:r.addNotification({content:"You have been blocked from following and interacting with this user.",classList:"alert",autoclose:1e4});break;case 207:r.addNotification({content:"Unblock this user to view his/her profile.",classList:"alert",autoclose:1e4})}}():a.go("error203"))}),{displayAuthModal:function(){(b=new p({id:"authModal",templateUrl:"https://www.bandlab.com/web-app/account/signUp/partials/_sign-up-modal-618836a3.html"})).show()},displayConfirmationEmailError:w,initSession:function(e){return function(e){return l.counters({id:e.id}).$promise.then(function(t){return y({},e,{counters:y({},e.counters,{},t)})}).catch(function(){return e})}(e).then(function(e){return k(new l(e))}).then(function(e){return E(e),c.start(),m.update(),e})},isAuth:C,login:function(t){if(v)return n.reject("Login already in progress");var o=(new Date).getTime();return t.clientId="BandLab-Web",v=!0,l.authorize(t).$promise.then(f.create).then(function(n){return e.eventTrack("Login",{category:"Authentication",label:t.provider}),ga("send","timing","Authentication","Login",(new Date).getTime()-o),n}).then(S).then(function(e){return E(e),c.start(),e}).finally(function(){v=!1})},logout:$,redirectAfterAuth:A,redirectAfterSignUp:R,refreshMe:function(){return S().catch(P)},renewSession:T,setAfterAuthState:function(e){-1===s.ANONYMOUS_ONLY.indexOf(e.toState)&&(h=e)},setMe:k,signUp:M,snsConnect:function(e){return M(e).then(function(){A()}).catch(function(e){o.$broadcast("auth:error"),new d({contentScope:I(e)}).show()})}};function w(){r.addNotification({title:"Confirm Your Email",content:"".concat("and unlock all features in your account:"," ").concat(u.email),image:"https://www.bandlab.com/web-app/images/zero-case/zero-case-email-d2c77eaa0a.png",action:'\n          <div ng-controller="EmailConfirmationCtrl" ng-click="$event.stopPropagation()">\n            <span ng-show="emailConfirmationRequestSent"><span class="icon-checkmark text-scs"></span> '.concat("An email has been sent.",'</span>\n            <a ng-show="!emailConfirmationRequestSent" ng-click="resendEmailConfirmation()">').concat("Resend Email","</a>\n          </div>\n        "),classList:"light"})}function k(e){return n(function(t){_.assign(u,e),u.isOnboarded=u.ftue.createdBand||u.ftue.createdSong||u.ftue.setCustomUsername||u.ftue.setGenres||u.ftue.setSkills,t(u)})}function S(){return l.info().$promise.then(k).then(function(e){return m.update(),e})}function P(e){if(e.status){if(500===e.status||503===e.status)return $("500");if(0===e.status)return a.go("0")}return $()}function E(t){i.Raven.setUserContext({id:t.id,username:t.username}),e.setUsername(t.id),e.setUserProperties({$created:t.createdOn,$email:t.email,$last_login:new Date,$name:t.name,$username:t.username,birthday:new Date(t.birthday),gender:t.gender})}function T(){if(v)return n.reject("Renewing session already in progress");if(!C())return n.reject("Session does not exists");var e=(new Date).getTime(),t={clientId:"BandLab-Web",provider:"token",refreshToken:f.getRefreshToken(),rememberMe:!0};return t.refreshToken?(v=!0,l.authorize(t).$promise.then(f.create).then(function(t){return ga("send","timing","Authentication","Renew Session",(new Date).getTime()-e),t}).then(S).then(function(e){return E(e),c.start(),e}).catch(P).finally(function(){v=!1})):n.reject("No refresh token available")}function M(n){var o=!1;return n.clientId="BandLab-Web",n.register=!0,t.get("invitationKey")&&(n.accessKey=t.get("invitationKey")),v=!0,l.authorize(n).$promise.then(function(n){return(o=n.wasRegistered)?(e.eventTrack("Register",{category:"Authentication",label:n.provider}),t.remove("invitationKey"),n):n}).then(f.create).then(S).then(function(t){return t.wasRegistered=o,o&&e.setAlias(t.id),E(t),c.start(),t}).finally(function(){v=!1})}function $(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e.eventTrack("Logout",{category:"Authentication"}),c.stop(),f.destroy(),Modernizr.localstorage&&localStorage.clear(),"indexedDB"in window&&indexedDB.deleteDatabase(g),i.location.href="".concat(document.baseURI).concat(t)}function C(){return f.sessionExists()}function A(){JSON.parse(t.get("classroomInvitation")||null),JSON.parse(t.get("schoolInvitation")||null),t.get("joinCode"),u.isOnboarded?h?(a.go(h.toState,h.toParams,{location:"replace"}),h=null):a.go(s.AFTER_LOGIN,{username:u.username},{location:"replace"}):R(),b&&b.destroy()}function R(){a.go(s.AFTER_SIGN_UP,{},{location:"replace",reload:!0}),b&&b.destroy()}function I(e){switch(e.status){case 400:case 401:return{title:"Unable to connect",message:26===_.get(e,"data.errorCode")?"<p>".concat("This email is already linked to a different account type.",'</p><p><a ui-sref="passwordReset">').concat("Forgot your password?","</a></p>"):"<p>".concat("Incorrect credentials","</p>")};default:return{title:"Unable to connect",message:"<p>".concat("Something went wrong. Please try again later.","</p>")}}}}]),angular.module("bandlab.user",[]),angular.module("bandlab.user").factory("completeProfile",["$analytics","$q","authService","Identity","Me","Modal","Tag",function(e,t,o,a,i,r,s){var c,l={current:1,total:4};return{start:function(){return _.map(new Array(4),function(e,t){var n=Math.min(t+1,3),o=new Image;return o.src="https://static.bandlab.com/image/misc-web-original/bg-complete-profile-".concat(n,"/bg-complete-profile-").concat(n,".jpg"),o}),t.all([s.getSkills(),s.getGenres()]).then(function(s){var u=n(s,2),d=u[0],p=u[1];return p=_.map(p,function(e){return e.isSelected=_.some(i.genres,{id:e.id}),e}),function(n){var s,u,d=n.genres,p=n.skills,m=n.goals,f=t.defer();return(c=new r({id:"completeProfileModal",templateUrl:"https://www.bandlab.com/web-app/account/partials/_complete-profile-d8713073.html",overlayClose:!1,contentScope:{steps:l,me:i,genres:d,skills:p,goals:m,user:{username:i.username},submitProfile:function(){var t=Object.keys(m).reduce(function(e,t){return m[t]?e.concat(t):e},[]),n=3===t.length?"All":0===t.length?"None":t.map(function(e){return{Create:"Artist",Connect:"Social Musician",Listen:"#1 Fan"}[e]||e}).sort().join(", ");e.eventTrack(n,{category:"Onboarding"}),ga("send","timing","Onboarding","Complete Profile",(new Date).getTime()-u,"Step ".concat(l.total)),new a({genres:_.filter(d,{isSelected:!0}),skills:_.filter(p,{isSelected:!0}),username:i.username,goals:t}).$update().then(function(e){o.setMe(e),f.resolve()})},nextStep:function(){ga("send","timing","Onboarding","Complete Profile",(new Date).getTime()-u,"Step ".concat(l.current)),s.classList.add("step-".concat(++l.current)),s.scrollTop=0,u=(new Date).getTime()},hasSelectedTags:function(e){return _.some(e,{isSelected:!0})},clickPictureUpload:function(){document.querySelectorAll(".picture-upload-drop-placeholder")[1].click()}},onCreate:function(e){u=(new Date).getTime(),s=e[0]}})).show(),f.promise}({skills:d=_.map(d,function(e){return e.isSelected=_.some(i.skills,{id:e.id}),e}),genres:p,goals:(i.goals||[]).reduce(function(e,t){return e[t]=!0,e},{})})})},stop:function(){c.destroy()}}}]),angular.module("bandlab.account").factory("Identity",["$resource",function(e){var t="https://www.bandlab.com/api/v1.3/";return e(t,{},{authorize:{method:"POST",url:"".concat(t,"authorizations")},confirmEmail:{method:"PUT",url:"".concat(t,"emails/confirmations")},info:{cache:!1,method:"GET",url:"".concat(t,"me?include=ftue")},counters:{cache:!1,method:"GET",params:{id:"@id"},url:"".concat(t,"users/:id/counters")},resendEmailConfirmation:{method:"POST",url:"".concat(t,"emails/confirmations")},sendSmsCode:{cache:!1,method:"POST",params:{phone:"@phone"},url:"".concat(t,"phones/:phone/codes")},validatePhoneNumber:{cache:!1,method:"GET",params:{phone:"@phone"},url:"".concat(t,"validation/user")},update:{method:"PATCH",url:"".concat(t,"me"),transformRequest:[function(e){return _.get(e,"place.name")&&!_.get(e,"place.id")&&delete(e=angular.copy(e)).place,e},angular.toJson]},delete:{method:"DELETE",url:"".concat(t,"me")}})}]),angular.module("bandlab.account").factory("Login",["$resource",function(e){var t="https://www.bandlab.com/api/v1.3/logins";return e(t,{},{delete:{method:"DELETE",params:{provider:"@provider"},url:"".concat(t,"/:provider")}})}]);var w="00000000-0000-0000-0000-000000000000";function k(){return e()+e(!0)+e(!0)+e();function e(e){var t="".concat(Math.random().toString(16),"000000000").substr(2,8);return e?"-".concat(t.substr(0,4),"-").concat(t.substr(4,4)):t}}angular.module("bandlab.account").factory("Me",["$analytics","$cookies",function(e,t){var n,o,a,i=(a=t.get("auid")||k(),n=parseInt(a.substr(0,5),16)/Math.pow(16,5),{max:16,current:o=Math.floor(16*n)+1,label:"group ".concat(o," of ").concat(16)});return e.setUserProperties({dimension1:i.label}),{testGroup:i.current,testGroupIs:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return _.includes(t,i.current)},testGroupMax:i.max,testGroupLabel:i.label,isAnonymous:function(){return this.isSet()&&angular.isUndefined(this.username)},isSet:function(){return angular.isDefined(this.id)},isUser:function(){return angular.isDefined(this.username)}}}]),angular.module("bandlab.account").factory("Password",["$resource",function(e){var t="https://www.bandlab.com/api/v1.3/passwords";return e(t,{},{reset:{method:"POST",url:"".concat(t,"/reset")},update:{method:"PUT"}})}]),angular.module("bandlab.account").factory("sessionService",["$cookies","$q",function(e,t){return this.create=function(n){return t(function(t){var o=new Date((new Date).setFullYear((new Date).getFullYear()+1));e.put("refreshToken",n.refreshToken,{expires:o}),e.put("sessionKey",n.sessionKey,{expires:o}),t(n)})},this.destroy=function(){return t(function(t){e.remove("refreshToken"),e.remove("sessionKey"),e.remove("mixEditorTheme"),t()})},this.getRefreshToken=function(){return e.get("refreshToken")},this.sessionExists=function(){return angular.isDefined(e.get("sessionKey"))},this}]),angular.module("bandlab.account").factory("Settings",["$resource",function(e){var t="https://www.bandlab.com/api/v1.3/settings";return e(t,{},{getNotificationsSettings:{url:"".concat(t,"/notifications/:field"),method:"GET"},saveNotificationsSettings:{method:"PATCH",url:"".concat(t,"/notifications/:field")}})}]),angular.module("bandlab.account.settings",["bandlab.account"]),angular.module("bandlab.account.settings").controller("AccountDeleteCtrl",["$analytics","$scope","$state","Contact","Identity",function(e,t,n,o,a){t.deactivateAccount=function(i){return(r=Object.keys(t.checkbox||{}).filter(function(e){return t.checkbox[e]}).sort().join(" ").split(" ").join("-"),e.eventTrack("Deactivate account",{category:"Settings",label:r}),t.contact=new o({reason:r,description:t.feedback,subject:"Delete Account"}),t.contact.$save()).then(function(){return a.delete().$promise}).then(function(){n.go("logout")}).catch(function(e){30===e.data.errorCode?t.wrongPassword=!0:t.error=!0,i.$setPristine()});var r}}]),angular.module("bandlab.account.settings").controller("AccountEditCtrl",["$scope","authService","ConfirmModal","Identity","Me","Modal",function(e,t,n,o,a,i){e.changeSuccess={username:!1,email:!1},e.changeError={username:!1,email:!1},e.hasEmail=!!a.email,e.user=new o,e.user.username=a.username,e.user.email=a.email,e.user.phone=a.phone,e.editMe=function(n){e.changeError[n]=!1,e.user.$update().then(function(o){t.setMe(o),e.changeSuccess[n]=!0,e.hasEmail=!!o.email}).catch(function(){e.changeError[n]=!0})},e.setupEmail=function(){var t=new i({id:"setupEmail",templateUrl:"https://www.bandlab.com/web-app/account/settings/partials/_setup-email-form-6ad1e4be.html"});t.show(),e.$on("$account:emailSetup",function(n,o){e.user.email=o.email,e.hasEmail=!0,t.destroy()})},e.changePhone=function(){var t=new i({id:"changePhone",templateUrl:"https://www.bandlab.com/web-app/account/login/partials/_edit-phone-form-11008bcf.html"});t.show(),e.$on("$account:phoneUpdated",function(){t.destroy(),e.user.phone=a.phone})},e.removePhone=function(){return e.hasEmail?new n({confirmLabel:"Remove",contentScope:{title:"Remove phone number?",message:"<p>".concat("You will not be able to log in using this phone number.","</p>")},onConfirm:function(){o.update({phone:""}).$promise.then(function(n){t.setMe(n),e.user.phone=a.phone}).catch(function(){e.changeError=!0})}}).show():new n({id:"setupEmailModal",confirmLabel:"Set Email",contentScope:{title:"Remove Phone Number",message:"<p>".concat("You need to setup an email address to remove this phone number","</p>")},onConfirm:function(){e.setupEmail()}}).show()}}]),angular.module("bandlab.account.settings").controller("BlockedAccountsCtrl",["$q","$scope","Me","User",function(e,t,n,o){var a,i=20,r=0,s=!1;function c(){return s?e.resolve([]):((a=o.blocked({id:n.id,offset:r,limit:i}).$promise).then(function(e){s=0===e.length||e.length<i,r+=e.length}),a)}t.loadMore=function(){return t.infiniteScrollEnded?e.reject("No more results"):a=a.then(function(e){return t.infiniteScrollEnded=s,t.users=t.users||[],t.users=t.users.concat(e),c()})},c().then(t.loadMore)}]),angular.module("bandlab.account.settings").controller("CreatorConnectEditCtrl",["$q","$scope","authService","FileHelper","Identity","Me","Tag",function(e,t,n,o,a,i,r){t.changeSuccess=!1,t.changeError=!1,t.user=new a,t.user.location={},t.user.location.country=_.get(i,"location.country"),t.user.about=i.about,t.user.introVideo=i.introVideo||(i.introVideoId?{status:"Processing",picture:{url:"https://bandlab-test-images.azureedge.net/v1.0/videos/default/640x640/blur"}}:null),t.user.introVideoId=i.introVideoId,t.user.collaborationStatus=i.collaborationStatus,t.user.place=i.place,t.user.inspiredBy=i.inspiredBy,r.getSkills().then(function(e){t.skills=_.map(e,function(e){return e.isSelected=_.some(i.skills,{id:e.id}),e})}),r.getGenres().then(function(e){t.genres=_.map(e,function(e){return e.isSelected=_.some(i.genres,{id:e.id}),e})}),t.$watchCollection("user.inspiredBy",function(e,n){n!==e&&t.profileForm.$setDirty()}),t.editMe=function(){t.changeError=!1,t.user.genres=_.filter(t.genres,{isSelected:!0}),t.user.skills=_.filter(t.skills,{isSelected:!0}),t.user.location.country=null,e.resolve(!t.videoFile||o.upload(t.videoFile,"https://storage.bandlab.com/v1.3/videos",{},{}).then(function(e){var n=e.data;t.user.introVideoId=n.id})).then(function(){return t.user.$update()}).then(function(e){n.setMe(e),t.changeSuccess=!0}).catch(function(){t.profileForm.$setPristine(),t.changeError=!0})}}]),angular.module("bandlab.account.settings").controller("EmailConfirmationCtrl",["$scope","Identity",function(e,t){e.resendEmailConfirmation=function(){t.resendEmailConfirmation().$promise.then(function(){e.emailConfirmationRequestSent=!0})}}]),angular.module("bandlab.account.settings").controller("EmailSetupCtrl",["$rootScope","$scope","authService","Identity","Password",function(e,t,n,o,a){t.user=new o,t.password=new a,t.setupEmailPassword=function(){t.wrongPassword=!1,t.user.$update().then(function(o){t.password.$update().then(function(){o.hasPassword=!0,n.setMe(o),e.$broadcast("$account:emailSetup",{email:o.email})}).catch(function(){t.wrongPassword=!0,t.accountForm.$setPristine()})}).catch(function(){t.accountForm.$setPristine()})}}]),angular.module("bandlab.account.settings").controller("LanguageEditCtrl",["$cookies","$scope","$stateParams","$window",function(e,t,n,o){"true"===n.changed&&(t.changeSuccess=!0),t.user={language:document.documentElement.lang},t.editMe=function(){e.put("language",t.user.language),o.location.href="".concat(o.location.href,"?changed=true")}}]),angular.module("bandlab.account.settings").controller("LinkedAccountsEditCtrl",["$q","$scope","Facebook","Google","Login","Me",function(e,t,n,o,a,i){function r(){a.query().$promise.then(function(e){t.linkedAccounts=e,angular.forEach(e,function(e){e.isLinked=!0,e.title=_.startCase(e.provider)}),_.find(t.linkedAccounts,{provider:"google"})||t.linkedAccounts.push({provider:"google",title:"Google",isLinked:!1}),_.find(t.linkedAccounts,{provider:"facebook"})||t.linkedAccounts.push({provider:"facebook",title:"Facebook",isLinked:!1})})}function s(e,n){t.errorConflict=!1,new a({provider:e,accessToken:n}).$save().then(function(){r()}).catch(function(e){409===e.status&&(t.errorConflict=!0)})}return t.toggleLinkAccount=function(c,l){c.preventDefault(),l.isLinked?function(e){t.linkedAccounts[0].isLinked&&t.linkedAccounts[1].isLinked||i.phone||i.email&&i.hasPassword?a.delete({provider:e.provider}).$promise.then(function(){r()}).catch(function(e){403===e.status?alert("Unable to unlink account. Please try again."):alert("Something went wrong. Please try again later.")}):window.alert("You are trying to unlink your only login method. Please create a password for your email to unlink this account.")}(l):function(t){"facebook"===t.provider?n.login().then(function(e){return e.authResponse.accessToken}).catch(function(t){return e.reject(t.status)}).then(function(e){s(t.provider,e)}):"google"===t.provider&&o.popupSignIn().then(function(e){return e.id_token}).then(function(e){s(t.provider,e)})}(l)},r()}]),angular.module("bandlab.account.settings").controller("NotificationsEditCtrl",["$scope","authService","Settings",function(e,t,n){function o(){e.notificationsEnabled=!1,angular.forEach(e.notifications,function(t,n){-1===n.indexOf("$")&&(e.notificationsEnabled=e.notificationsEnabled||e.notifications[n])})}n.getNotificationsSettings({field:"email"}).$promise.then(function(t){e.notifications=t,o()}),e.toggleEmailNotifications=function(t){angular.forEach(e.notifications,function(n,o){-1===o.indexOf("$")&&(e.notifications[o]=t)}),e.notificationsEditForm.$setDirty(),o()},e.saveNotificationsSettings=function(){e.changeError=!1,e.changeSuccess=!1,e.notifications.$saveNotificationsSettings({field:"email"}).then(function(){t.refreshMe(),e.changeSuccess=!0,e.notificationsEditForm.$setPristine(),o()}).catch(function(){e.changeError=!0,e.notificationsEditForm.$setPristine(),e.notificationsEditForm.$setDirty()})}}]),angular.module("bandlab.account.settings").controller("PasswordChangeCtrl",["$scope","AppNotifications","Me","Password",function(e,t,n,o){e.password=new o,e.changeSuccess=!1,e.samePassword=!1,e.wrongPassword=!1,e.doChangePassword=function(){e.samePassword=!1,e.wrongPassword=!1,e.password.$update().then(function(){e.changeSuccess=!0}).catch(function(t){30===t.data.errorCode?e.wrongPassword=!0:31===t.data.errorCode?e.samePassword=!0:e.wrongPassword=!0,e.changePasswordForm.$setPristine()})},e.resetPassword=function(){new o({email:n.email}).$reset().then(function(){t.addNotification({title:"An email has been sent.",content:"An email has been sent to ".concat(n.email," for you to set a new password."),autoclose:8e3})}).catch(function(){e.requestFailed=!0})}}]),angular.module("bandlab.account.settings").controller("PasswordRenewCtrl",["$scope","$state","$stateParams","$timeout","Password",function(e,t,n,o,a){e.password=new a,n.userid&&n.code&&(e.password.userId=n.userid,e.password.code=n.code),e.changeSuccess=!1,e.changeFailed=!1,e.doChangePassword=function(){e.changeFailed=!1,e.password.$save().then(function(){e.changeSuccess=!0,o(function(){t.go("logout"),t.go("login")},3e3)}).catch(function(t){e.errorCode=_.get(t,"data.errorCode"),e.changeFailed=!0})}}]),angular.module("bandlab.account.settings").controller("PasswordResetCtrl",["$scope","Password",function(e,t){e.password=new t,e.requestSent=!1,e.requestFailed=!1,e.resetPassword=function(){e.requestSent=!1,e.requestFailed=!1,e.password.$reset().then(function(){e.requestSent=!0,e.resetPasswordForm.$setPristine()}).catch(function(t){e.errorCode=_.get(t,"data.errorCode"),e.requestFailed=!0,e.resetPasswordForm.$setPristine()})}}]),angular.module("bandlab.account.settings").controller("PictureEditCtrl",["$scope","$stateParams","$window",function(e,t,n){e.changeSuccess=!1,e.changeError=!1,"true"===t.changed&&(e.changeSuccess=!0),e.$on("pictureUploadSuccess",function(){n.location.href="".concat(n.location.href,"?changed=true")}),e.$on("$file:uploadFailed",function(){e.changeError=!0})}]),angular.module("bandlab.account.settings").controller("ProfileEditCtrl",["$scope","authService","Identity","Me","Tag",function(e,t,n,o,a){e.changeSuccess=!1,e.changeError=!1,e.user=new n,e.user.name=o.name,e.user.location={},e.user.location.country=_.get(o,"location.country"),e.user.gender=o.gender||"Other",e.user.birthday=o.birthday,e.user.about=o.about,e.user.place=o.place,a.getSkills().then(function(t){e.skills=_.map(t,function(e){return e.isSelected=_.some(o.skills,{id:e.id}),e})}),a.getGenres().then(function(t){e.genres=_.map(t,function(e){return e.isSelected=_.some(o.genres,{id:e.id}),e})}),e.editMe=function(){e.changeError=!1,e.user.genres=_.filter(e.genres,{isSelected:!0}),e.user.skills=_.filter(e.skills,{isSelected:!0}),e.user.location.country=null,e.user.$update().then(function(n){t.setMe(n),e.changeSuccess=!0}).catch(function(){e.profileForm.$setPristine(),e.changeError=!0})}}]),angular.module("bandlab.account.settings").controller("ProjectsRestoreCtrl",["$scope","Loader","Me","Song",function(e,t,n,o){var a=!1,i=t.create(o.fromUser,{id:n.id,limit:20,sort:"Recent",status:"deleted"});e.loadMore=function(){return i.get().then(function(t){t.length<20&&(a=!0),e.infiniteScrollEnded=a,e.projects=e.projects||[],e.projects=e.projects.concat(t)})},e.$on("$song:changed",function(t,n){if("restore"===n.action&&_.remove(e.projects,{id:n.song.id}),_.includes(["mark-deleted","unmark-deleted"],n.action)){var o=_.find(e.projects,{id:n.song.id});o&&(o.isDeleting="mark-deleted"===n.action||null)}}),e.loadMore()}]),angular.module("bandlab.user").component("completeProfileCard",{templateUrl:"https://www.bandlab.com/web-app/account/settings/partials/_complete-profile-card-d9c939e6.html",controller:["Identity","Me",function(e,t){var n=this;n.achievementsCount=0,n.me=t,n.me.ftue.confirmedEmail&&n.achievementsCount++,n.me.ftue.setCustomUsername&&n.achievementsCount++,n.me.ftue.setPicture&&n.achievementsCount++,n.profileComplete=3===n.achievementsCount,n.me.ftue.confirmedEmail||(n.resendEmailConfirmation=function(){e.resendEmailConfirmation().$promise.then(function(){n.emailConfirmationRequestSent=!0})})}],controllerAs:"vm"}),angular.module("bandlab.account.settings.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("settings",{url:"/settings",redirectTo:"settings.account",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/settings-layout-032311c2.html",controller:["$scope","ClientDevice","Me",function(e,t,n){e.me=n,e.isMobile=t.isMobile}]}).state("settings.deactivate",{url:"/account/deactivate",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/deactivate-e15a6946.html",resolve:{isBetaUser:["$q","Me",function(e,t){return t.isBetaUser?e.resolve():e.reject({status:301,location:{name:"settings.profile"}})}]}}).state("settings.account",{url:"/account",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/account-edit-cd59d30c.html",controller:"AccountEditCtrl"}).state("settings.blockedAccounts",{url:"/blocked",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/blocked-accounts-edit-e60e1536.html",controller:"BlockedAccountsCtrl"}).state("settings.language",{url:"/language?changed",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/language-edit-400ed0f4.html",controller:"LanguageEditCtrl"}).state("settings.linkedAccounts",{url:"/linked-accounts",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/linked-accounts-edit-3628855c.html",controller:"LinkedAccountsEditCtrl"}).state("settings.profile",{url:"/profile?focus",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/profile-edit-c77e1aa8.html",controller:"ProfileEditCtrl"}).state("settings.picture",{url:"/picture?changed",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/picture-edit-9af8b94e.html",controller:"PictureEditCtrl"}).state("settings.creatorConnect",{url:"/creator-connect",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/creator-connect-edit-38eef912.html",controller:"CreatorConnectEditCtrl"}).state("passwordReset",{url:"/reset-password",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/password-reset-ea53cb3b.html",controller:"PasswordResetCtrl"}).state("passwordRenew",{url:"/renew-password?userid&code",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/password-renew-b7e91a1e.html",controller:"PasswordRenewCtrl"}).state("settings.notifications",{url:"/notifications",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/notifications-edit-e112c224.html",controller:"NotificationsEditCtrl"}).state("settings.tipJar",{url:"/tip-jar",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/tip-jar-edit-881e8b41.html",controller:"TipJarEditCtrl",resolve:{paymentDetails:["Payment",function(e){return e.getUserDetails()}],tipJarSettings:["TipJar",function(e){return e.getSettings()}]}}).state("settings.payments",{url:"/payments",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/payments-edit-ae8052e6.html",resolve:{paymentDetails:["Payment",function(e){return e.getUserDetails()}]},controller:["$scope","Payment","paymentDetails",function(e,t,n){e.stripeAccount=n.stripeAccount,e.stripeCard=n.stripeCard,t.getTransactions().then(function(t){var n=t.receivedTransactions,o=t.sentTransactions;e.transactions=_.chain(o).concat(n).uniqBy("id").map(function(e){return e.timestamp=+e.timestamp,e}).orderBy("timestamp","desc").value()}).catch(function(){e.transactions=null})}]}).state("settings.deletedProjects",{url:"/deleted-projects",templateUrl:"https://www.bandlab.com/web-app/account/settings/views/deleted-projects-edit-283838be.html",controller:"ProjectsRestoreCtrl"})}]),angular.module("bandlab.account.signUp",["bandlab.account"]),angular.module("bandlab.account.signUp").controller("FormSignUpCtrl",["$scope","$stateParams","authService",function(e,t,n){e.credentials={email:t.email||"",name:t.name||"",password:"",provider:"password",referral:t.referral,rememberMe:!0},e.signUp=function(){e.$emit("auth:start"),e.error="",n.signUp(e.credentials).then(function(e){e.wasRegistered?n.redirectAfterSignUp():n.redirectAfterAuth()}).catch(function(t){e.$emit("auth:error"),e.signUpForm.$setPristine(),e.signUpForm.$setDirty(),401===t.status||400===t.status?e.error="credentials":alert("Something went wrong. Please try again later.")})}}]);var S=function(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))};function P(){var e=S(["Your invitation key is not valid."]);return P=function(){return e},e}function E(){var e=S(["Invalid Invitation"]);return E=function(){return e},e}function T(e,t){return e(t={exports:{}},t.exports),t.exports}angular.module("bandlab.account.signUp.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("invitation",{url:"/invitation?referral&classroomId&schoolId&invitationCode&joinCode",templateUrl:"https://www.bandlab.com/web-app/account/signUp/views/invitation-layout-31ce2576.html",onEnter:["$cookies","$state","$stateParams",function(e,t,n){}],resolve:{theReferral:["$stateParams","User",function(e,t){var n=(new Date).getTime();if(e.referral)return t.get({id:e.referral}).$promise.then(function(e){return ga("send","timing","User","Get User",(new Date).getTime()-n),e}).catch(function(){return null})}]},controller:["$scope","theReferral",function(e,t){e.referral=t}]}).state("signUp",{url:"/sign-up?invitation&email&name&sender-id",templateUrl:"https://www.bandlab.com/web-app/account/signUp/views/sign-up-fafe76cf.html",reloadOnChange:!1,onEnter:["$cookies","$state","$stateParams","AppNotifications",function(e,t,n,o){if(n.invitation)return n.invitation.match(/[a-zA-Z0-9-_]+/)?e.put("invitationKey",n.invitation):o.addNotification({title:i18n(E()),content:i18n(P()),classList:"alert",autoclose:5e3}),t.target("signUp",{},{inherit:!1})}]}).state("email-confirm",{url:"/email-confirm?userId&code",templateUrl:"https://www.bandlab.com/web-app/account/signUp/views/email-confirm-7cbab837.html",controller:["$scope","isEmailConfirmed",function(e,t){e.isEmailConfirmed=t}],resolve:{isEmailConfirmed:["$state","$stateParams","Identity",function(e,t,n){return t.userId&&t.code?n.confirmEmail({userId:t.userId,code:t.code}).$promise.then(function(){return!0}).catch(function(){return!1}):(e.go("404"),!1)}]}})}]),function(e,t){var n=window.angulartics||(window.angulartics={});function o(e){var t=e.slice(9);return null!=t&&t.length>0?t.substring(0,1).toLowerCase()+t.substring(1):t}n.waitForVendorCount=0,n.waitForVendorApi=function(e,t,o,a,i){i||n.waitForVendorCount++,a||(a=o,o=void 0),!Object.prototype.hasOwnProperty.call(window,e)||void 0!==o&&void 0===window[e][o]?setTimeout(function(){n.waitForVendorApi(e,t,o,a,!0)},t):(n.waitForVendorCount--,a(window[e]))},e.module("angulartics",[]).provider("$analytics",function(){var t=this,o={pageTracking:{autoTrackFirstPage:!0,autoTrackVirtualPages:!0,trackRelativePath:!1,trackRoutes:!0,trackStates:!0,autoBasePath:!1,basePath:"",excludedRoutes:[],queryKeysWhitelisted:[],queryKeysBlacklisted:[],filterUrlSegments:[]},eventTracking:{},bufferFlushDelay:1e3,trackExceptions:!1,optOut:!1,developerMode:!1},a=["pageTrack","eventTrack","exceptionTrack","transactionTrack","setAlias","setUsername","setUserProperties","setUserPropertiesOnce","setSuperProperties","setSuperPropertiesOnce","incrementProperty","userTimings","clearCookies"],i={},r={},s={};function c(t,n,o){return r[t]||(r[t]=[]),r[t].push(n),s[n]=o,function(){if(!this.settings.optOut){var n=Array.prototype.slice.apply(arguments);return this.$inject(["$q",e.bind(this,function(o){return o.all(r[t].map(function(t){if((s[t]||{}).async){var a=o.defer(),i=e.copy(n);return i.unshift(a.resolve),t.apply(this,i),a.promise}return o.when(t.apply(this,n))},this))})])}}}var l={settings:o,setOptOut:function(e){this.settings.optOut=e,f()},getOptOut:function(){return this.settings.optOut}},u={$get:["$injector",function(e){return d(e)}],api:l,settings:o,virtualPageviews:function(e){this.settings.pageTracking.autoTrackVirtualPages=e},trackStates:function(e){this.settings.pageTracking.trackStates=e},trackRoutes:function(e){this.settings.pageTracking.trackRoutes=e},excludeRoutes:function(e){this.settings.pageTracking.excludedRoutes=e},queryKeysWhitelist:function(e){this.settings.pageTracking.queryKeysWhitelisted=e},queryKeysBlacklist:function(e){this.settings.pageTracking.queryKeysBlacklisted=e},filterUrlSegments:function(e){this.settings.pageTracking.filterUrlSegments=e},firstPageview:function(e){this.settings.pageTracking.autoTrackFirstPage=e},withBase:function(t){this.settings.pageTracking.basePath=t?e.element(document).find("base").attr("href"):""},withAutoBase:function(e){this.settings.pageTracking.autoBasePath=e},trackExceptions:function(e){this.settings.trackExceptions=e},developerMode:function(e){this.settings.developerMode=e}};var d=function(t){return e.extend(l,{$inject:t.invoke})};function p(t){var a="register"+t.replace(/^./,function(e){return e.toUpperCase()});u[a]=function(n,a){!function(t,n,a){if(!o.developerMode){l[t]=c(t,n,a);var r=o[t],s=r?r.bufferFlushDelay:null,u=null!==s?s:o.bufferFlushDelay;e.forEach(i[t],function(e,t){!function(e,t){t?setTimeout(e,t):e()}(function(){n.apply(this,e)},t*u)})}}(t,n,a)},l[t]=c(t,function(e){return function(){n.waitForVendorCount&&(i[e]||(i[e]=[]),i[e].push(arguments))}}(t))}function m(n,o,a){for(var i in e.forEach(o,a),n)t[i]=n[i]}var f=function(){m(u,a,p)};m(u,a,p)}).run(["$rootScope","$window","$analytics","$injector",function(t,n,o,a){function i(e,t,n){if(/\?/.test(e)&&t.length>0){for(var o=e.split("?"),a=o[0],i=o[1].split("&"),r=[],s=0;s<t.length;s++)for(var c=t[s],l=0;l<i.length;l++)(c instanceof RegExp&&c.test(i[l])||i[l].indexOf(c)>-1)&&r.push(i[l]);var u="white"==n?r:function(e,t){for(var n=[],o=0;o<e.length;o++)-1===t.indexOf(e[o])&&n.push(e[o]);return n}(i,r);return u.length>0?a+"?"+u.join("&"):a}return e}function r(e,t){(function(e){for(var t=0;t<o.settings.pageTracking.excludedRoutes.length;t++){var n=o.settings.pageTracking.excludedRoutes[t];if(n instanceof RegExp&&n.test(e)||e.indexOf(n)>-1)return!0}return!1})(e)||(e=function(e){var t=o.settings.pageTracking.filterUrlSegments;if(t.length>0){for(var n=e.split("?")[0].split("/"),a=0;a<t.length;a++)for(var i=t[a],r=1;r<n.length;r++)(i instanceof RegExp&&i.test(n[r])||n[r].indexOf(i)>-1)&&(n[r]="FILTERED");return n.join("/")}return e}(e=function(e){return i(e,o.settings.pageTracking.queryKeysBlacklisted,"black")}(e=function(e){return i(e,o.settings.pageTracking.queryKeysWhitelisted,"white")}(e))),o.pageTrack(e,t))}if(o.settings.pageTracking.autoTrackFirstPage){var s=!0;if(a.has("$route"))if(l=a.get("$route"))for(var c in l.routes){s=!1;break}else null===l&&(s=!1);else if(a.has("$state")){a.get("$state").get().length>1&&(s=!1)}s&&(o.settings.pageTracking.autoBasePath&&(o.settings.pageTracking.basePath=n.location.pathname),a.invoke(["$location",function(e){o.settings.pageTracking.trackRelativePath?r(o.settings.pageTracking.basePath+e.url(),e):r(e.absUrl(),e)}]))}if(o.settings.pageTracking.autoTrackVirtualPages){o.settings.pageTracking.autoBasePath&&(o.settings.pageTracking.basePath=n.location.pathname+"#");s=!0;if(o.settings.pageTracking.trackRoutes&&a.has("$route")){var l;if(l=a.get("$route"))for(var c in l.routes){s=!1;break}else null===l&&(s=!1);t.$on("$routeChangeSuccess",function(e,t){t&&(t.$$route||t).redirectTo||a.invoke(["$location",function(e){r(o.settings.pageTracking.basePath+e.url(),e)}])})}o.settings.pageTracking.trackStates&&(a.has("$state")&&!a.has("$transitions")&&(s=!1,t.$on("$stateChangeSuccess",function(e,t){a.invoke(["$location",function(e){r(o.settings.pageTracking.basePath+e.url(),e)}])})),a.has("$state")&&a.has("$transitions")&&(s=!1,a.invoke(["$transitions",function(e){e.onSuccess({},function(e){e.options().notify&&a.invoke(["$location",function(e){r(o.settings.pageTracking.basePath+e.url(),e)}])})}]))),s&&t.$on("$locationChangeSuccess",function(e,t){t&&(t.$$route||t).redirectTo||a.invoke(["$location",function(e){o.settings.pageTracking.trackRelativePath?r(o.settings.pageTracking.basePath+e.url(),e):r(e.absUrl(),e)}])})}o.settings.developerMode&&e.forEach(o,function(e,t){"function"==typeof e&&(o[t]=function(){})})}]).directive("analyticsOn",["$analytics",function(t){return{restrict:"A",link:function(n,a,i){var r=i.analyticsOn||"click",s={};e.forEach(i.$attr,function(e,t){(function(e){return"analytics"===e.substr(0,9)&&-1===["On","Event","If","Properties","EventType"].indexOf(e.substr(9))})(t)&&(s[o(t)]=i[t],i.$observe(t,function(e){s[o(t)]=e}))}),e.element(a[0]).on(r,function(o){var r,c=i.analyticsEvent||(function(e){return["a:","button:","button:button","button:submit","input:button","input:submit"].indexOf(e.tagName.toLowerCase()+":"+(e.type||""))>=0}(r=a[0])?r.innerText||r.value:r.id||r.name||r.tagName);s.eventType=o.type,i.analyticsIf&&!n.$eval(i.analyticsIf)||(i.analyticsProperties&&e.extend(s,n.$eval(i.analyticsProperties)),t.eventTrack(c,s))})}}}]).config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate","$injector",function(e,t){return function(n,o){var a=e(n,o),i=t.get("$analytics");return i.settings.trackExceptions&&i.exceptionTrack(n,o),a}}])}])}(angular);var M=T(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(o){return"function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?e.exports=n=function(e){return t(e)}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)},n(o)}e.exports=n});function $(e,t,n,o,a,i,r,s,c,l,u,d){s.resourceUrlWhitelist(["self","https://www.bandlab.com/web-app/**"]),o.defaults.path="/",c.decorator("parent",function(e,t){return e.self.$$state=function(){return e},t(e)}),t.classNameFilter(/animate|creator-connect-dropdown-menu|dropdown-container|modal-overlay/),e.firstPageview(!1),e.virtualPageviews(!1),e.registerEventTrack(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="Register",o=window.fbq||angular.noop,a=window.gtag||angular.noop;e===n&&(o("trackCustom",e,t),a("event","conversion",{send_to:"AW-876226372/5MRUCN7pvZ0BEMTO6KED"}))}),n.debugInfoEnabled(!1),r.errorOnUnhandledRejections(!1),d.latencyThreshold=300,d.includeSpinner=!1,d.loadingBarTemplate='<div class="loading-bar animate"><div class="bar"><div class="peg"></div></div></div>',l.strictMode(!1),l.caseInsensitive(!0),u.otherwise("/404"),a.interceptors.push(C),a.useApplyAsync(!0),i.html5Mode(!0).hashPrefix("!")}function C(e,t,n,o,a,i,r,s){return{request:function(e){return!/bandlab\.com|execute-api|bandlab-web/.test(e.url)||"arraybuffer"===e.responseType||/samples\.bandlab\.com/.test(e.url)?e:(e.headers.Authorization="Bearer ".concat(t.get("sessionKey")),e.headers["X-Client-Id"]="BandLab-Web",e.headers["X-Client-Version"]=s,localStorage.superchat&/bandlab\.com\/api\/v1\.3/.test(e.url)&&(e.headers["X-NewChatEnabled"]=!0),e)},response:function(t){return!0!==t.config.preservePagination&&angular.isObject(t.data)&&t.data.paging&&t.data.data&&(t.data=t.data.data),t.config.retryNumber&&e.eventTrack("Successful retry request",{category:"Retry",label:t.config.url,value:t.config.retryNumber}),t},responseError:function(t){return _.includes([-1,500,501,502,503,504],t.status)&&_.includes(["GET","HEAD"],t.config.method)&&(!t.config.retryNumber||t.config.retryNumber<3)?(t.config.retryNumber=t.config.retryNumber||0,t.config.retryNumber++,r(function(){return a.get("$http")(t.config)},500*t.config.retryNumber)):(3===t.config.retryNumber&&e.eventTrack("Failed retry request",{category:"Retry",label:t.config.url,value:t.config.retryNumber}),401===t.status&&i.$broadcast("$request:unauthorized",{api:t.config.url.match(/bandlab\.com/g)?"bandlab":"other"}),!t.config.silent&&403===t.status&&t.data&&i.$broadcast("$request:forbidden",t.data),-1===[303,401,403,404,422,429].indexOf(t.status)&&(t.data&&n.debug(JSON.stringify(t.data)),t.config&&(n.debug(JSON.stringify(t.config.headers)),n.debug(JSON.stringify(t.config.data)))),o.reject(t))}}}function A(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function R(e,o,a,i,r,s,c,l,u,d,p,m,f){a.put("language",document.documentElement.lang),window.cancelAnimationFrame=window.cancelAnimationFrame||angular.noop,window.Promise=window.Promise||r,window.requestAnimationFrame=window.requestAnimationFrame||e,p.listenForUpdates();var h=Math.ceil(3*Math.random());document.querySelector("main").classList.add("main-landing-".concat(h)),s.state=c;var g=0,v=_.throttle(function(){document.body.classList.toggle("scrolled",!!window.pageYOffset);var e=Math.floor(window.pageYOffset/100);e<=g||(g=e)},250,{leading:!1,trailing:!0});window.addEventListener("scroll",v);var b=!1;l.onExit({},function(){b||(b=!0,o.eventTrack("Pixel Depth",{category:"Scroll Depth",label:100*g}))}),l.onSuccess({},function(e){var t=e.from(),n=e.to();"experience"===t.name&&"experience"===n.name||(document.body.scrollTop=document.documentElement.scrollTop=0)}),l.onStart({},function(e){var n=e.to(),o=function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?A(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):A(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},e.params()),a=u.checkStateCompatibility(n);if(o.username&&(o.username=o.username.toLowerCase()),o.slug&&(o.slug=o.slug.toLowerCase()),"desktop"===a)return c.target("unavailable",{url:encodeURIComponent(c.href(n.name,o,{absolute:!0}))});if("chrome"===a)return c.target("useChrome");if("update-browser"===a)return c.target("updateBrowser");if(!m.isAuth())return f.isSet()||(f.id=w),-1!==d.AUTH_MODULES.indexOf(n.name.split(".")[0])?(m.setAfterAuthState({toState:n.name,toParams:o}),c.target(d.LOGIN)):void 0;var i=_.get(window,"fromAPI.me.id")&&_.get(window,"fromAPI.me.username")?function(){return m.initSession(window.fromAPI.me)}:function(){return m.renewSession()};return-1!==d.ANONYMOUS_ONLY.indexOf(n.name)?i().then(function(){return c.target(d.AFTER_LOGIN,{username:f.username},{location:"replace"})}):f.isSet()?void 0:i().then(function(){return c.target(n.name,o,{location:"replace"})})}),l.onSuccess({},function(e){b=!1,g=0;var t=e.options(),n=e.params();if(t.notify)if(n.rewriteTracking){var a=n.rewriteTracking(o.settings.pageTracking.basePath+i.url());o.pageTrack(a,i)}else if(n.rewriteTrackingAsync)n.rewriteTrackingAsync(o.settings.pageTracking.basePath+i.url()).then(function(e){o.pageTrack(e,i)});else{var r=o.settings.pageTracking.basePath+i.url();o.pageTrack(r,i)}}),c.defaultErrorHandler(function(e){if(!/supersed/.test(_.get(e,"message"))){switch(_.get(e,"detail.status")){case 301:return e.detail.location?function(e,t){if(t.name)return e.go(t.name,t.params,{inherit:!1});if(t.redirectTo){var o=function(e){var o=t.redirectTo.split("?"),a=n(o,2),i=a[0],r=a[1],s={};if(window.URLSearchParams&&r){var c=new URLSearchParams(r),l=!0,u=!1,d=void 0;try{for(var p,m=c[Symbol.iterator]();!(l=(p=m.next()).done);l=!0){var f=p.value;s[f[0]]=f[1]}}catch(e){u=!0,d=e}finally{try{l||null==m.return||m.return()}finally{if(u)throw d}}}return{pathname:i,params:s}}(),a=e.get().find(function(e){return!e.abstract&&e.$$state&&e.$$state().url.exec(o.pathname,o.params)});return a?e.go(a.name,a.$$state().url.exec(o.pathname,o.params),{inherit:!1}):e.go("404",{},{location:"replace"})}return e.go("404",{},{location:"replace"})}(c,e.detail.location):c.go("404",{},{location:"replace"});case 401:case 440:return void m.renewSession().then(function(){m.redirectAfterAuth()});case 404:return c.go("404",{},{location:"replace"});case 403:case 500:return e.detail.data&&201===e.detail.data.errorCode?c.go("error201"):c.go("".concat(e.detail.status))}return c.go("0")}})}function I(e){if(!e.get("auid")){var t=new Date((new Date).setFullYear((new Date).getFullYear()+1));e.put("auid",k(),{expires:t})}}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.head;return document.querySelector('script[src="'.concat(e,'"]'))?Promise.resolve():new Promise(function(n,o){var a=document.createElement("script");a.src=e,a.onload=n,a.onerror=o,t.appendChild(a)})}function x(){return O("//platform-api.sharethis.com/js/sharethis.js#property=5a8fb51ad57467001383cf13&product=sticky-share-buttons").catch(function(){})}!function(e,t,n){t.module("angulartics.google.analytics",["angulartics"]).config(["$analyticsProvider","$windowProvider",function(n,o){var a,i=o.$get();n.settings.pageTracking.trackRelativePath=!0,n.settings.ga={additionalAccountNames:void 0,additionalAccountHitTypes:{pageview:!0,event:!0,exception:!1,ecommerce:!1,userTiming:!1,setUserProperties:!1,userId:!1},disableEventTracking:null,disablePageTracking:null,enhancedEcommerce:!1,transport:null,userId:null},n.registerPageTrack(function(e,o){a=e,o=o||{},n.settings.ga.disablePageTracking||r("pageview","send",t.extend(t.copy(o),{hitType:"pageview",page:e}))}),n.registerEventTrack(function(e,o){if(!n.settings.ga.disableEventTracking&&(e||e+""=="0")){if((o=o||{}).category=o.category||"Event",o.value){var a=parseInt(o.value,10);o.value=isNaN(a)?0:a}t.isFunction(o.hitCallback)||(o.hitCallback=null),o.nonInteraction=o.nonInteraction||o.noninteraction,r("event","send",t.extend(t.copy(o),{hitType:"event",eventCategory:o.category,eventAction:e,eventLabel:o.label,eventValue:o.value,nonInteraction:o.nonInteraction,page:u(o),hitCallback:o.hitCallback}))}}),n.registerExceptionTrack(function(e,t){r("exception","send",{hitType:"event",eventCategory:"Exceptions",eventAction:e.toString(),eventLabel:e.stack,nonInteraction:!0,page:u({}),isException:!0})}),n.registerSetUsername(function(e){n.settings.ga.userId=e}),n.registerSetUserProperties(function(e){e&&r("setUserProperties","set",function(e){var t,n={};for(t in e)t.indexOf("dimension")&&t.indexOf("metric")||(n[t]=e[t]);return n}(e))}),n.registerUserTimings(function(e){t.isObject(e)&&!t.isArray(e)&&(t.forEach(["timingCategory","timingVar","timingValue"],function(n){t.isUndefined(e[n])}),r("userTiming","send",{hitType:"timing",timingCategory:e.timingCategory,timingVar:e.timingVar,timingValue:e.timingValue,timingLabel:e.timingLabel,optSampleRate:e.optSampleRate,page:u(e)}))}),n.registerTransactionTrack(function(e){var n,o;if(r("ecommerce","require","ecommerce"),r("ecommerce","ecommerce:addTransaction",e),e.products)for(o=0;o<e.products.length;o++)(n=e.products[o]).sku=n.id,n.id=e.id,r("ecommerce","ecommerce:addItem",e.products[o]);e.currencyCode&&r("ecommerce","_set",e.currencyCode),r("ecommerce","ecommerce:send",t.copy(e))});var r=function(e,o,a){var r,c;t.isUndefined(i._gaq)||(r=l),(c=i.GoogleAnalyticsObject)&&i[c]&&(r=s),r&&r(o,a,n.settings.ga.additionalAccountHitTypes[e])};function s(e,o,a){var i,r=n.settings.ga.userId;if("require"===e&&"ecommerce"===o)return i=o,n.settings.ga.enhancedEcommerce&&(i="ec"),c([e,i],a);if(r&&t.isObject(o)&&(o.userId=r),n.settings.ga.transport&&(o.transport=n.settings.ga.transport),e.indexOf("ecommerce:")>-1&&n.settings.ga.enhancedEcommerce)switch(e){case"ecommerce:addTransaction":e=["ec:setAction","purchase"];break;case"ecommerce:addItem":e="ec:addProduct",o.id=o.sku;break;case"ecommerce:send":e="send",o.hitType="event",o.eventCategory="Angulartics Enhanced Ecommerce",o.eventAction="Purchase",o.nonInteraction=!0}c(e instanceof Array?e.concat(o):[e,o],a)}function c(e,o){var a,r=n.settings.ga.userId,s=i.GoogleAnalyticsObject;i[s].apply(this,e),o&&(a=t.copy(e),r&&!n.settings.ga.additionalAccountHitTypes.userId&&a[2]&&"object"===M(a[2])&&delete a[2].userId,t.forEach(n.settings.ga.additionalAccountNames,function(t){a[0]=t+"."+e[0],i[s].apply(this,a)}))}function l(e,o,a){if("set"!==e){var r;if("send"===e)switch(o.hitType){case"pageview":r=["_trackPageview",o.page];break;case"event":r=["_trackEvent",o.eventCategory,o.eventAction,o.eventLabel,o.eventValue,o.nonInteraction];break;case"timing":r=["_trackTiming",o.timingCategory,o.timingVar,o.timingValue,o.timingLabel,o.optSampleRate]}"ecommerce:addTransaction"===e&&(r=["_addTrans",o.id,o.affiliation,o.revenue,o.tax,o.shipping,o.billingCity,o.billingRegion,o.billingCountry]),"ecommerce:addItem"===e&&(r=["_addItem",o.id,o.sku,o.name,o.category,o.price,o.quantity]),"_set"===e&&(r=["_set","currencyCode",o]),"ecommerce:send"===e&&(r=["_trackTrans"]),r&&(i._gaq.push(r),a&&t.forEach(n.settings.ga.additionalAccountNames,function(e){var t=[].slice.call(r);t[0]=e+"."+t[0],i._gaq.push(t)}))}}function u(t){return t.page||a||i.location.hash.substring(1)||e.location.pathname}}])}(window,window.angular),C.$inject=["$analytics","$cookies","$log","$q","$injector","$rootScope","$timeout","appVersion"],$.$inject=["$analyticsProvider","$animateProvider","$compileProvider","$cookiesProvider","$httpProvider","$locationProvider","$qProvider","$sceDelegateProvider","$stateProvider","$urlMatcherFactoryProvider","$urlRouterProvider","cfpLoadingBarProvider"],R.$inject=["$$rAF","$analytics","$cookies","$location","$q","$rootScope","$state","$transitions","appActions","appStates","AppVersionChecker","authService","Me"],I.$inject=["$cookies"],angular.module("bandlab.web",["ui.router","ngAnimate","ngCookies","ngRaven","ngResource","ngSanitize","ngTouch","monospaced.elastic","virtualRepeat","angulartics","angulartics.google.analytics","angular-loading-bar","bandlab.config","bandlab.account","bandlab.account.login","bandlab.account.settings","bandlab.account.signUp","bandlab.audio","bandlab.band","bandlab.banner","bandlab.chat","bandlab.collection","bandlab.comment","bandlab.common","bandlab.common.notification","bandlab.community","bandlab.editor","bandlab.explore","bandlab.global","bandlab.notification","bandlab.player","bandlab.post","bandlab.project","bandlab.search","bandlab.song","bandlab.shout","bandlab.payment","bandlab.user","bandlab.global.redirects","bandlab.account.routes","bandlab.show.routes","bandlab.audio.routes","bandlab.chat.routes","bandlab.collection.routes","bandlab.connect.routes","bandlab.editor.routes","bandlab.error.routes","bandlab.explore.routes","bandlab.global.routes","bandlab.payment.routes","bandlab.product.routes","bandlab.library.routes","bandlab.post.routes","bandlab.report.routes","bandlab.search.routes","bandlab.user.routes","bandlab.band.routes","bandlab.community.routes","bandlab.song.routes"]).run(I).run(R),angular.module("bandlab.config",[]).config($),angular.module("bandlab.audio",[]);var D="Action canceled",L="Cycle is too short!",N="Select a cycle duration longer than ".concat("{$1}"," seconds."),U="Please retry. If the problem persists, use the Help function at the bottom left of the Mix Editor.",j="Unable to import file due to corrupted file or missing metadata.",B="Internet connection lost",F="Some regions cannot be played.",q="Unable to create Mixdown",V="Mixdown doesn’t contain any sounds!",H="Mixdown has no duration!",G="No input source is selected.",z="Connect your device and select it as an input source.",W="Record function is not available.",K="Add a pattern from your drum machine track or record on a different type of track.",Y="Record duration is too short!",X="Duration of record should be more than ".concat("{$1}"," sec."),J="Microphone access is not allowed.",Q="This revision is already open in another tab.\nYou can’t open same revision in multiple tabs.",Z="Something went wrong while saving.",ee="Track couldn’t be added.",te="Track could not be added.\nYou’ve reached the maximum number of tracks (".concat("{$1}",")."),ne="Unable to freeze track";angular.module("bandlab.audio.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("mastering",{url:"/mastering",templateUrl:"https://www.bandlab.com/web-app/audio/views/mastering-layout-aa45b2cc.html",controller:["$rootScope","$scope","$state","authService","EditorLoader","Facebook","Me","RevisionImporter",function(e,t,n,o,a,i,r,s){t.isAnonymous=r.isAnonymous(),t.state={step:0},t.createProjectWithFacebookLogin=function(){e.$broadcast("masteringPreview:pause"),i.login().then(function(e){return o.signUp({accessToken:e.authResponse.accessToken,provider:"facebook"})}).then(t.createProject)},t.createProject=function(){var o=a.pushTask("uploadMeta");e.$broadcast("masteringPreview:pause"),s.createRevisionFromMastering(t.state).then(function(e){n.go("songId",{id:e.song.id})}).finally(function(){a.finishTask(o)})}}]}).state("experience",{url:"/audio?source&soundbank",params:{source:{dynamic:!0},soundbank:{dynamic:!0}},templateUrl:"https://www.bandlab.com/web-app/audio/views/experience-layout-c324b00c.html",onEnter:function(){x()}}).state("upload",{url:"/upload?force",templateUrl:"https://www.bandlab.com/web-app/audio/views/upload-layout-ad0b81c4.html",resolve:{redirectMobileUser:["$q","$stateParams","ClientDevice",function(e,t,n){if(n.isMobile&&!t.force)return e.reject({status:301,location:{name:"quickUpload"}})}]},controller:["$scope",function(e){e.state={step:0}}]}).state("quickUpload",{url:"/quick-upload?remote",templateUrl:"https://www.bandlab.com/web-app/audio/views/quick-upload-layout-36cc6ced.html",resolve:{templates:["$templateCache","$templateRequest","$q",function(e,t,n){return n.all([t("https://www.bandlab.com/web-app/audio/partials/_quick-upload-cover-d3f41c1d.html"),t("https://www.bandlab.com/web-app/audio/partials/_quick-upload-dropzone-749cce5e.html")]).then(function(t){t.forEach(e.put)}).catch(function(){})}]},controller:["$scope","QuickUpload",function(e,t){t.state={step:0,isForkable:!0},e.state=t.state}]}).state("quickUpload2",{url:"/quick-upload/2",templateUrl:"https://www.bandlab.com/web-app/audio/views/quick-upload-layout-36cc6ced.html",resolve:{redirect:["$q","QuickUpload",function(e,t){if(!t.state.audioFile)return e.reject({status:301,location:{name:"quickUpload"}});t.state.step=1}]},controller:["$analytics","$q","$scope","$state","AppNotifications","ClientDevice","EditorLoader","EditorModel","FileHelper","QuickUpload","Revision","Sample",function(e,t,n,o,a,i,r,s,c,l,u,d){function p(){if(n.state.imageFile){var e=Math.min(n.state.imageWidth,n.state.imageHeight),t=(n.state.imageWidth-e)/2,o=(n.state.imageHeight-e)/2;return c.upload(n.state.imageFile,"https://storage.bandlab.com/v1.3/images",{params:{x:t,y:o,width:e,height:e}}).then(function(e){var t=e.data;n.state.pictureId=t.id})}}n.isMobile=i.isMobile,n.state=l.state,n.state.revision=null,n.submit=function(i){var c=r.pushTask("uploadMeta");return i.$setSubmitted(),t.all([p(),d.upload({blob:n.state.audioFile,sampleId:n.state.sampleId,sampleType:"samples"})]).then(function(){var e=function(e){var t=e.audioFile,n=e.duration,o=e.genres,a=e.description,i=e.name,r=e.pictureId,c=e.sampleId,l=e.isForkable,u=s.createTrack({name:t.name}),d=s.createRegion({endPosition:n,name:t.name,sampleId:c,trackId:u.id});return u.regions=[d],s.createRevision({description:a,genres:o,mastering:null,post:{state:"Public"},song:{isForkable:l,name:i||"New Project",pictureId:r},tracks:[u]})}(n.state);return u.save({revision:e}).$promise}).then(function(t){n.state.audioFile=null,n.state.revision=t,o.go("quickUpload3"),e.eventTrack("Create Project",{category:"Quick Upload",label:n.state.pictureId?"Upload cover image":"Ignore cover image"})}).catch(function(){i.$setPristine(),r.flushQueue(),a.addNotification({title:Z,content:U,classList:"alert"})}).finally(function(){r.finishTask(c)})}}]}).state("quickUpload3",{url:"/quick-upload/3",templateUrl:"https://www.bandlab.com/web-app/audio/views/quick-upload-layout-36cc6ced.html",resolve:{redirect:["$q","QuickUpload",function(e,t){if(!t.state.revision)return e.reject({status:301,location:{name:"quickUpload"}});t.state.step=2}]},controller:["$scope","QuickUpload",function(e,t){e.state=t.state}]})}]);var oe="C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B".split(" "),ae=function(e){return"string"!=typeof e?oe.slice():oe.filter(function(t){var n=t[1]||" ";return-1!==e.indexOf(n)})},ie=(ae(" #"),ae(" b"),/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/);function re(e){"string"!=typeof e&&(e="");var t=ie.exec(e);return[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]}var se=Object.freeze({pc:null,name:null,step:null,alt:null,oct:null,octStr:null,chroma:null,midi:null,freq:null}),ce=[0,2,4,5,7,9,11],le=function(e,t){return void 0===t&&(t={}),function(e){return t[e]||(t[e]=function(e){var t=re(e);if(""===t[0]||""!==t[3])return se;var n=t[0],o=t[1],a=t[2],i={letter:n,acc:o,octStr:a,pc:n+o,name:n+o+a,step:(n.charCodeAt(0)+3)%7,alt:"b"===o[0]?-o.length:o.length,oct:a.length?+a:null,chroma:0,midi:null,freq:null};return i.chroma=(ce[i.step]+i.alt+120)%12,i.midi=null!==i.oct?ce[i.step]+i.alt+12*(i.oct+1):null,i.freq=me(i.midi),Object.freeze(i)}(e))}}(),ue=function(e){return le(e).name},de=function(e){return le(e).pc},pe=function(e){if("number"!=typeof e&&"string"!=typeof e)return null;var t=le(e).midi,n=t||0===t?t:+e;return n>=0&&n<=127?n:null},me=function(e,t){return void 0===t&&(t=440),"number"==typeof e?Math.pow(2,(e-69)/12)*t:null},fe=function(e){return le(e).oct},he=function(e,t){return Array(t+1).join(e)},ge=function(e,t){void 0===e&&(e={}),void 0===t&&(t=null);var n=t?Object.assign({},le(t),e):e,o=n.step,a=n.alt,i=n.oct;if("number"!=typeof o)return null;var r=function(e){return"CDEFGAB"[e]}(o);if(!r)return null;var s=r+function(e){return"number"!=typeof(t=e)?"":function(e){return e<0?he("b",-e):he("#",e)}(t);var t}(a);return i||0===i?s+i:s},ve=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$"),be=[0,2,4,5,7,9,11],ye=Object.freeze({name:null,num:null,q:null,step:null,alt:null,dir:null,type:null,simple:null,semitones:null,chroma:null,oct:null}),we=function(e){var t=function(e){var t=ve.exec(""+e);return null===t?null:t[1]?[t[1],t[2]]:[t[4],t[3]]}(e);if(null===t)return ye;var n,o,a,i={num:0,q:"d",name:"",type:"M",step:0,dir:-1,simple:1,alt:0,oct:0,semitones:0,chroma:0,ic:0};return i.num=+t[0],i.q=t[1],i.step=(n=i.num,(Math.abs(n)-1)%7),i.type="PMMPPMM"[i.step],"M"===i.type&&"P"===i.q?ye:(i.name=""+i.num+i.q,i.dir=i.num<0?-1:1,i.simple=8===i.num||-8===i.num?i.num:i.dir*(i.step+1),i.alt=(o=i.type,"M"===(a=i.q)&&"M"===o?0:"P"===a&&"P"===o?0:"m"===a&&"M"===o?-1:/^A+$/.test(a)?a.length:/^d+$/.test(a)?"P"===o?-a.length:-a.length-1:null),i.oct=Math.floor((Math.abs(i.num)-1)/7),i.semitones=i.dir*(be[i.step]+i.alt+12*i.oct),i.chroma=(i.dir*(be[i.step]+i.alt)%12+12)%12,Object.freeze(i))},ke={};function Se(e){return"string"!=typeof e?ye:ke[e]||(ke[e]=we(e))}var Pe=[0,2,4,-1,1,3,5],Ee=Pe.map(function(e){return Math.floor(7*e/12)}),Te=[3,0,4,1,5,2,6],Me=function(e,t,n){var o=Te[function(e){var t=(e+1)%7;return t<0?7+t:t}(e)],a=Math.floor((e+1)/7);return void 0===t?{step:o,alt:a,dir:n}:{step:o,alt:a,oct:t+4*a+Ee[o],dir:n}},$e=function(e){return function(t,n){return void 0===n&&(n={}),function(t){return n[t]||(n[t]=function(t){var n=e(t);return null===n.name?null:function(e){var t=e.step,n=e.alt,o=e.oct,a=e.dir;void 0===a&&(a=1);var i=Pe[t]+7*n;return null===o?[a*i]:[a*i,a*(o-Ee[t]-4*n)]}(n)}(t))}}()},Ce=$e(le),_e=$e(Se);function Ae(e,t){if(1===arguments.length)return function(t){return Ae(e,t)};var n=Ce(e),o=_e(t);if(null===n||null===o)return null;var a=1===n.length?[n[0]+o[0]]:[n[0]+o[0],n[1]+o[1]];return ge(Me(a[0],a[1]))}var Re=function(e){return function(e){return le(e).chroma}(e)||function(e){return Se(e).chroma}(e)||0};function Ie(e){if(function(e){return Oe.test(e)}(e))return e;if(!Array.isArray(e))return"";var t=[0,0,0,0,0,0,0,0,0,0,0,0];return e.map(Re).forEach(function(e){t[e]=1}),t.join("")}var Oe=/^[01]{12}$/,xe=function(e){var t=Object.keys(e).sort(),n=[],o=[],a=function(e,t,a){n[e]=t,o[a]=o[a]||[],o[a].push(e)};t.forEach(function(t){var n=e[t][0].split(" "),o=e[t][1],i=Ie(n);a(t,n,i),o&&o.forEach(function(e){return a(e,n,i)})});var i=Object.keys(n).sort(),r=function(e){return n[e]};return r.names=function(e){return"string"==typeof e?(o[e]||[]).slice():(!0===e?i:t).slice()},r},De=xe({chromatic:["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M"],lydian:["1P 2M 3M 4A 5P 6M 7M"],major:["1P 2M 3M 4P 5P 6M 7M",["ionian"]],mixolydian:["1P 2M 3M 4P 5P 6M 7m",["dominant"]],dorian:["1P 2M 3m 4P 5P 6M 7m"],aeolian:["1P 2M 3m 4P 5P 6m 7m",["minor"]],phrygian:["1P 2m 3m 4P 5P 6m 7m"],locrian:["1P 2m 3m 4P 5d 6m 7m"],"melodic minor":["1P 2M 3m 4P 5P 6M 7M"],"melodic minor second mode":["1P 2m 3m 4P 5P 6M 7m"],"lydian augmented":["1P 2M 3M 4A 5A 6M 7M"],"lydian dominant":["1P 2M 3M 4A 5P 6M 7m",["lydian b7"]],"melodic minor fifth mode":["1P 2M 3M 4P 5P 6m 7m",["hindu","mixolydian b6M"]],"locrian #2":["1P 2M 3m 4P 5d 6m 7m",["half-diminished"]],altered:["1P 2m 3m 3M 5d 6m 7m",["super locrian","diminished whole tone","pomeroy"]],"harmonic minor":["1P 2M 3m 4P 5P 6m 7M"],"phrygian dominant":["1P 2m 3M 4P 5P 6m 7m",["spanish","phrygian major"]],"half-whole diminished":["1P 2m 3m 3M 4A 5P 6M 7m",["dominant diminished"]],diminished:["1P 2M 3m 4P 5d 6m 6M 7M",["whole-half diminished"]],"major pentatonic":["1P 2M 3M 5P 6M",["pentatonic"]],"lydian pentatonic":["1P 3M 4A 5P 7M",["chinese"]],"mixolydian pentatonic":["1P 3M 4P 5P 7m",["indian"]],"locrian pentatonic":["1P 3m 4P 5d 7m",["minor seven flat five pentatonic"]],"minor pentatonic":["1P 3m 4P 5P 7m"],"minor six pentatonic":["1P 3m 4P 5P 6M"],"minor hexatonic":["1P 2M 3m 4P 5P 7M"],"flat three pentatonic":["1P 2M 3m 5P 6M",["kumoi"]],"flat six pentatonic":["1P 2M 3M 5P 6m"],"major flat two pentatonic":["1P 2m 3M 5P 6M"],"whole tone pentatonic":["1P 3M 5d 6m 7m"],"ionian pentatonic":["1P 3M 4P 5P 7M"],"lydian #5P pentatonic":["1P 3M 4A 5A 7M"],"lydian dominant pentatonic":["1P 3M 4A 5P 7m"],"minor #7M pentatonic":["1P 3m 4P 5P 7M"],"super locrian pentatonic":["1P 3m 4d 5d 7m"],"in-sen":["1P 2m 4P 5P 7m"],iwato:["1P 2m 4P 5d 7m"],hirajoshi:["1P 2M 3m 5P 6m"],kumoijoshi:["1P 2m 4P 5P 6m"],pelog:["1P 2m 3m 5P 6m"],"vietnamese 1":["1P 3m 4P 5P 6m"],"vietnamese 2":["1P 3m 4P 5P 7m"],prometheus:["1P 2M 3M 4A 6M 7m"],"prometheus neopolitan":["1P 2m 3M 4A 6M 7m"],ritusen:["1P 2M 4P 5P 6M"],scriabin:["1P 2m 3M 5P 6M"],piongio:["1P 2M 4P 5P 6M 7m"],"major blues":["1P 2M 3m 3M 5P 6M"],"minor blues":["1P 3m 4P 5d 5P 7m",["blues"]],"composite blues":["1P 2M 3m 3M 4P 5d 5P 6M 7m"],augmented:["1P 2A 3M 5P 5A 7M"],"augmented heptatonic":["1P 2A 3M 4P 5P 5A 7M"],"dorian #4":["1P 2M 3m 4A 5P 6M 7m"],"lydian diminished":["1P 2M 3m 4A 5P 6M 7M"],"whole tone":["1P 2M 3M 4A 5A 7m"],"leading whole tone":["1P 2M 3M 4A 5A 7m 7M"],"lydian minor":["1P 2M 3M 4A 5P 6m 7m"],"locrian major":["1P 2M 3M 4P 5d 6m 7m",["arabian"]],neopolitan:["1P 2m 3m 4P 5P 6m 7M"],"neopolitan minor":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan major":["1P 2m 3m 4P 5P 6M 7M",["dorian b2"]],"neopolitan major pentatonic":["1P 3M 4P 5d 7m"],"romanian minor":["1P 2M 3m 5d 5P 6M 7m"],"double harmonic lydian":["1P 2m 3M 4A 5P 6m 7M"],"harmonic major":["1P 2M 3M 4P 5P 6m 7M"],"double harmonic major":["1P 2m 3M 4P 5P 6m 7M",["gypsy"]],egyptian:["1P 2M 4P 5P 7m"],"hungarian minor":["1P 2M 3m 4A 5P 6m 7M"],"hungarian major":["1P 2A 3M 4A 5P 6M 7m"],oriental:["1P 2m 3M 4P 5d 6M 7m"],"spanish heptatonic":["1P 2m 3m 3M 4P 5P 6m 7m"],flamenco:["1P 2m 3m 3M 4A 5P 7m"],balinese:["1P 2m 3m 4P 5P 6m 7M"],"todi raga":["1P 2m 3m 4A 5P 6m 7M"],"malkos raga":["1P 3m 4P 6m 7m"],"kafi raga":["1P 3m 3M 4P 5P 6M 7m 7M"],"purvi raga":["1P 2m 3M 4P 4A 5P 6m 7M"],persian:["1P 2m 3M 4P 5d 6m 7M"],bebop:["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop dominant":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop minor":["1P 2M 3m 3M 4P 5P 6M 7m"],"bebop major":["1P 2M 3M 4P 5P 5A 6M 7M"],"bebop locrian":["1P 2m 3m 4P 5d 5P 6m 7m"],"minor bebop":["1P 2M 3m 4P 5P 6m 7m 7M"],"mystery #1":["1P 2m 3M 5d 6m 7m"],enigmatic:["1P 2m 3M 5d 6m 7m 7M"],"minor six diminished":["1P 2M 3m 4P 5P 6m 6M 7M"],"ionian augmented":["1P 2M 3M 4P 5A 6M 7M"],"lydian #9":["1P 2m 3M 4A 5P 6M 7M"],ichikosucho:["1P 2M 3M 4P 5d 5P 6M 7M"],"six tone symmetric":["1P 2m 3M 4P 5A 6M"]}),Le=xe({4:["1P 4P 7m 10m",["quartal"]],5:["1P 5P"],7:["1P 3M 5P 7m",["Dominant","Dom"]],9:["1P 3M 5P 7m 9M",["79"]],11:["1P 5P 7m 9M 11P"],13:["1P 3M 5P 7m 9M 13M",["13_"]],64:["5P 8P 10M"],M:["1P 3M 5P",["Major",""]],"M#5":["1P 3M 5A",["augmented","maj#5","Maj#5","+","aug"]],"M#5add9":["1P 3M 5A 9M",["+add9"]],M13:["1P 3M 5P 7M 9M 13M",["maj13","Maj13"]],"M13#11":["1P 3M 5P 7M 9M 11A 13M",["maj13#11","Maj13#11","M13+4","M13#4"]],M6:["1P 3M 5P 13M",["6"]],"M6#11":["1P 3M 5P 6M 11A",["M6b5","6#11","6b5"]],M69:["1P 3M 5P 6M 9M",["69"]],"M69#11":["1P 3M 5P 6M 9M 11A"],"M7#11":["1P 3M 5P 7M 11A",["maj7#11","Maj7#11","M7+4","M7#4"]],"M7#5":["1P 3M 5A 7M",["maj7#5","Maj7#5","maj9#5","M7+"]],"M7#5sus4":["1P 4P 5A 7M"],"M7#9#11":["1P 3M 5P 7M 9A 11A"],M7add13:["1P 3M 5P 6M 7M 9M"],M7b5:["1P 3M 5d 7M"],M7b6:["1P 3M 6m 7M"],M7b9:["1P 3M 5P 7M 9m"],M7sus4:["1P 4P 5P 7M"],M9:["1P 3M 5P 7M 9M",["maj9","Maj9"]],"M9#11":["1P 3M 5P 7M 9M 11A",["maj9#11","Maj9#11","M9+4","M9#4"]],"M9#5":["1P 3M 5A 7M 9M",["Maj9#5"]],"M9#5sus4":["1P 4P 5A 7M 9M"],M9b5:["1P 3M 5d 7M 9M"],M9sus4:["1P 4P 5P 7M 9M"],Madd9:["1P 3M 5P 9M",["2","add9","add2"]],Maj7:["1P 3M 5P 7M",["maj7","M7"]],Mb5:["1P 3M 5d"],Mb6:["1P 3M 13m"],Msus2:["1P 2M 5P",["add9no3","sus2"]],Msus4:["1P 4P 5P",["sus","sus4"]],Maddb9:["1P 3M 5P 9m"],"11b9":["1P 5P 7m 9m 11P"],"13#11":["1P 3M 5P 7m 9M 11A 13M",["13+4","13#4"]],"13#9":["1P 3M 5P 7m 9A 13M",["13#9_"]],"13#9#11":["1P 3M 5P 7m 9A 11A 13M"],"13b5":["1P 3M 5d 6M 7m 9M"],"13b9":["1P 3M 5P 7m 9m 13M"],"13b9#11":["1P 3M 5P 7m 9m 11A 13M"],"13no5":["1P 3M 7m 9M 13M"],"13sus4":["1P 4P 5P 7m 9M 13M",["13sus"]],"69#11":["1P 3M 5P 6M 9M 11A"],"7#11":["1P 3M 5P 7m 11A",["7+4","7#4","7#11_","7#4_"]],"7#11b13":["1P 3M 5P 7m 11A 13m",["7b5b13"]],"7#5":["1P 3M 5A 7m",["+7","7aug","aug7"]],"7#5#9":["1P 3M 5A 7m 9A",["7alt","7#5#9_","7#9b13_"]],"7#5b9":["1P 3M 5A 7m 9m"],"7#5b9#11":["1P 3M 5A 7m 9m 11A"],"7#5sus4":["1P 4P 5A 7m"],"7#9":["1P 3M 5P 7m 9A",["7#9_"]],"7#9#11":["1P 3M 5P 7m 9A 11A",["7b5#9"]],"7#9#11b13":["1P 3M 5P 7m 9A 11A 13m"],"7#9b13":["1P 3M 5P 7m 9A 13m"],"7add6":["1P 3M 5P 7m 13M",["67","7add13"]],"7b13":["1P 3M 7m 13m"],"7b5":["1P 3M 5d 7m"],"7b6":["1P 3M 5P 6m 7m"],"7b9":["1P 3M 5P 7m 9m"],"7b9#11":["1P 3M 5P 7m 9m 11A",["7b5b9"]],"7b9#9":["1P 3M 5P 7m 9m 9A"],"7b9b13":["1P 3M 5P 7m 9m 13m"],"7b9b13#11":["1P 3M 5P 7m 9m 11A 13m",["7b9#11b13","7b5b9b13"]],"7no5":["1P 3M 7m"],"7sus4":["1P 4P 5P 7m",["7sus"]],"7sus4b9":["1P 4P 5P 7m 9m",["susb9","7susb9","7b9sus","7b9sus4","phryg"]],"7sus4b9b13":["1P 4P 5P 7m 9m 13m",["7b9b13sus4"]],"9#11":["1P 3M 5P 7m 9M 11A",["9+4","9#4","9#11_","9#4_"]],"9#11b13":["1P 3M 5P 7m 9M 11A 13m",["9b5b13"]],"9#5":["1P 3M 5A 7m 9M",["9+"]],"9#5#11":["1P 3M 5A 7m 9M 11A"],"9b13":["1P 3M 7m 9M 13m"],"9b5":["1P 3M 5d 7m 9M"],"9no5":["1P 3M 7m 9M"],"9sus4":["1P 4P 5P 7m 9M",["9sus"]],m:["1P 3m 5P"],"m#5":["1P 3m 5A",["m+","mb6"]],m11:["1P 3m 5P 7m 9M 11P",["_11"]],"m11A 5":["1P 3m 6m 7m 9M 11P"],m11b5:["1P 3m 7m 12d 2M 4P",["h11","_11b5"]],m13:["1P 3m 5P 7m 9M 11P 13M",["_13"]],m6:["1P 3m 4P 5P 13M",["_6"]],m69:["1P 3m 5P 6M 9M",["_69"]],m7:["1P 3m 5P 7m",["minor7","_","_7"]],"m7#5":["1P 3m 6m 7m"],m7add11:["1P 3m 5P 7m 11P",["m7add4"]],m7b5:["1P 3m 5d 7m",["half-diminished","h7","_7b5"]],m9:["1P 3m 5P 7m 9M",["_9"]],"m9#5":["1P 3m 6m 7m 9M"],m9b5:["1P 3m 7m 12d 2M",["h9","-9b5"]],mMaj7:["1P 3m 5P 7M",["mM7","_M7"]],mMaj7b6:["1P 3m 5P 6m 7M",["mM7b6"]],mM9:["1P 3m 5P 7M 9M",["mMaj9","-M9"]],mM9b6:["1P 3m 5P 6m 7M 9M",["mMaj9b6"]],mb6M7:["1P 3m 6m 7M"],mb6b9:["1P 3m 6m 9m"],o:["1P 3m 5d",["mb5","dim"]],o7:["1P 3m 5d 13M",["diminished","m6b5","dim7"]],o7M7:["1P 3m 5d 6M 7M"],oM7:["1P 3m 5d 7M"],sus24:["1P 2M 4P 5P",["sus4add9"]],"+add#9":["1P 3M 5A 9A"],madd4:["1P 3m 4P 5P"],madd9:["1P 3m 5P 9M"]}),Ne=Object.freeze({name:null,intervals:[],names:[],chroma:null,setnum:null}),Ue=function(e,t){return function(e){return t[e]||(t[e]=function(e){var t=De(e);if(!t)return Ne;var n={intervals:t,name:e};return n.chroma=Ie(t),n.setnum=parseInt(n.chroma,2),n.names=De.names(n.chroma),Object.freeze(n)}(e))}}(0,{}),je=function(e){var t=Be(e);return Ue(t[1]).intervals};function Be(e){if("string"!=typeof e)return["",""];var t=e.indexOf(" "),n=ue(e.substring(0,t))||ue(e)||"",o=""!==n?e.substring(n.length+1):e;return[n,o.length?o:""]}var Fe=Object.freeze({name:null,names:[],intervals:[],chroma:null,setnum:null}),qe=function(e,t){return void 0===t&&(t={}),function(e){return t[e]||(t[e]=function(e){var t=Le(e);if(!t)return Fe;var n={intervals:t,name:e};return n.chroma=Ie(t),n.setnum=parseInt(n.chroma,2),n.names=Le.names(n.chroma),n}(e))}}();var Ve=/^(6|64|7|9|11|13)$/;angular.module("bandlab.audio").controller("VirtualInstrumentCtrl",["$scope","EditorState","InputsCollection","MidiKeyboardHandler","MidiKeyMapping","SharedMidiSynth",function(e,t,n,o,a,i){t.isAudioInputActive&&o.enable(),i.setSoundbank(e.current.soundbank),e.$on("MidiMessage:noteEvent",function(){e.$digest()}),e.$on("$destroy",function(){o.disable()}),e.press=function(e){o.press(e)},e.release=function(e){o.release(e)},e.isActive=function(){var e=Array.prototype.slice.call(arguments);return _.some(e,function(e){return!!i.current[n.getNoteWithOctave(e)]})},e.isMapped=function(e){return i.isNoteMapped(n.getNoteWithOctave(e))};var r=[{label:"Off"},{label:"Major Scale",type:"scale",tonal:"major"},{label:"Minor Scale",type:"scale",tonal:"minor"},{label:"Harmonic major",type:"scale",tonal:"harmonic major"},{label:"Harmonic minor",type:"scale",tonal:"harmonic minor"},{label:"Major pentatonic",type:"scale",tonal:"major pentatonic"},{label:"Minor pentatonic",type:"scale",tonal:"minor pentatonic"},{label:"Major triad",type:"triad",tonal:"M"},{label:"Minor triad",type:"triad",tonal:"m"},{label:"Diminished triad",type:"triad",tonal:"dim"},{label:"Perfect unison",type:"interval",tonal:"P1"},{label:"Minor second",type:"interval",tonal:"m2"},{label:"Major second",type:"interval",tonal:"M2"},{label:"Minor third",type:"interval",tonal:"m3"},{label:"Major third",type:"interval",tonal:"M3"},{label:"Perfect fourth",type:"interval",tonal:"P4"},{label:"Augmented fourth",type:"interval",tonal:"A4"},{label:"Diminished fifth",type:"interval",tonal:"d5"},{label:"Perfect fifth",type:"interval",tonal:"P5"},{label:"Minor sixth",type:"interval",tonal:"m6"},{label:"Major sixth",type:"interval",tonal:"M6"},{label:"Minor seventh",type:"interval",tonal:"m7"},{label:"Major seventh",type:"interval",tonal:"M7"},{label:"Perfect octave",type:"interval",tonal:"P8"}],s=[{label:"C"},{label:"C♯",tonal:"C#"},{label:"D♭",tonal:"Db"},{label:"D"},{label:"D♯",tonal:"D#"},{label:"E♭",tonal:"Eb"},{label:"E"},{label:"F"},{label:"F♯",tonal:"F#"},{label:"G♭",tonal:"Gb"},{label:"G"},{label:"A♭",tonal:"Ab"},{label:"A"},{label:"B♭",tonal:"Bb"},{label:"B"}];function c(t,n){var o=(t.tonal||t.label)+e.current.octave,a=n.tonal||n.label;switch(n.type){case"interval":return[o,Ae(o,a)];case"scale":return function(e,t){var n=Be(o);return t=t||n[1],je(t).map(Ae(n[0]))}(0,a);case"triad":return function(e,t){if(t)return qe(t).intervals.map(Ae(e));var n=function(e){var t=re(e);return""===t[0]?["",e]:"A"===t[0]&&"ug"===t[3]?["","aug"]:Ve.test(t[2])?[t[0]+t[1],t[2]+t[3]]:[t[0]+t[1]+t[2],t[3]]}(e),o=n[0],a=n[1];return qe(a).intervals.map(Ae(o))}(o,a)}}e.keys=s,e.current.key=e.current.key||s[0],e.views=r,e.current.view=e.current.view||r[0],e.$watch("current.octave",function(){e.current.notes=_.uniq(c(e.current.key,e.current.view))}),e.updateKey=function(t){e.current.key=t,e.current.notes=_.uniq(c(e.current.key,e.current.view))},e.updateView=function(t){e.current.view=t,e.current.notes=_.uniq(c(e.current.key,e.current.view)),"Off"!==t.label&&(e.current.map=!0,e.displayMusicalNotes=!0)},e.getMidis=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.map(function(e){return de(e)+(fe(e)+t)})},e.isActiveOnMinimap=function(e){return!!i.current[e]},e.getMidiFromPitchClass=function(t){return pe(t)-12*(e.current.octave-1)},e.getShortcut=function(t){var n=pe(t);return a.getShortcutMap("piano",e.current.octave)[n]},e.octaveUp=function(e){e.stopPropagation(),o.octaveUp()},e.octaveDown=function(e){e.stopPropagation(),o.octaveDown()},e.isSustaining=function(){return i.isSustaining()},e.getMusicalNote=function(e){return[["C".concat(Math.floor(n.getNoteWithOctave(e)/12)+1)],["C♯","D♭"],["D"],["D♯","E♭"],["E"],["F"],["F♯","G♭"],["G"],["G♯","A♭"],["A"],["A♯","B♭"],["B"]][e%12]||[]}}]).filter("beautifyPitch",function(){return function(e){return e.replace(/#/g,"♯").replace(/b/g,"♭")}}),angular.module("bandlab.audio").directive("audioInput",["$analytics","audioEvents","AudioMonitoring","AudioState","EditorRevision","EditorState","EditorTrack","EffectsPreset","InputsCollection","SharedMidiSynth","Soundbank",function(e,t,n,o,a,i,r,s,c,l,u){return{restrict:"E",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_audio-input-09000775.html",replace:!0,scope:{canChangeInput:"=?",getTrack:"="},controller:["$rootScope","$scope","Me",function(d,p,m){p.audioState=o,p.current=c.getCurrent(),p.getList=c.getList,p.getLoadingProgress=u.getLoadingProgress,p.getPresets=s.getByInput,p.getSoundbanks=c.getSoundbanks,p.isDeprecatedPreset=s.isDeprecatedPreset,p.isNewerPreset=s.isNewerPreset,p.selectPreset=r.selectPreset,p.state=i,p.user=m,p.canChangeInput||(p.canChangeInput=function(){return!0}),p.toggleMonitoring=function(){var t=!a.trackMonitoring.get(a.selectedTrack);a.trackMonitoring.set(a.selectedTrack,t),a.lastTrack[p.current.input.slug]=a.selectedTrack,n.switchTrackChain(),e.eventTrack("Toggle Monitoring",{category:"Mix Editor",label:t,value:0})},p.notifyInputChanged=function(){var e=s.getByInput(p.current.input);!(_.chain(e).map("presets").flatten().find({slug:a.selectedTrack.preset}).value()||_.find(e,{slug:a.selectedTrack.preset}))&&e[0]&&"custom"!==a.selectedTrack.preset&&p.selectPreset(e[0]),c.setDefaultSoundbank(p.current.input),setTimeout(function(){d.$broadcast(t.INPUT_CHANGED)})},p.isMonitoring=function(){return a.trackMonitoring.get(a.selectedTrack)},u.getList().then(function(){p.$watch("current.soundbank",function(t){t&&t.slug&&(u.getBank(t).then(function(e){p.current.octave=Math.ceil(e.defaultOctave/12)-1,l.setSoundbank(e),l.stopNotes()}),e.eventTrack("Select Sound Bank",{category:"Audio Input",label:t.name}))})})}]}}]);var He=function(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()};function Ge(e){var t=e.ClientDevice;return t.isMobile||t.isiOs?"desktop":ze()?void 0:"Chrome"!==t.ua.browser.name?"chrome":"update-browser"}function ze(){return"AudioContext"in window&&"AudioWorklet"in window&&"indexedDB"in window&&"IntersectionObserver"in window&&"mediaDevices"in navigator&&"requestMIDIAccess"in navigator}angular.module("bandlab.audio").directive("audioInputExtended",["editorEvents","EditorRevision","EditorTrack","EffectsPreset","InputsCollection",function(e,t,n,o,a){return{restrict:"E",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_audio-input-extended-b73e83b6.html",replace:!0,scope:{getTrack:"="},link:function(n,i){n.$on(e.changePreset,function(e,r){var s=[].concat(He("custom"===t.selectedTrack.preset?[{slug:"custom"}]:[]),He(o.getByInput(a.getCurrent().input))),c=_.findIndex(s,{slug:t.selectedTrack.preset}),l="ArrowLeft"===r.code?Math.max(c-1,0):Math.min(c+1,s.length-1),u=s[l];"custom"!==u.slug&&(n.selectPreset(u),i[0].querySelectorAll("div")[l].scrollIntoView())})},controller:["$scope",function(e){e.current=a.getCurrent(),e.getPresets=o.getByInput,e.selectPreset=n.selectPreset}]}}]),angular.module("bandlab.audio").directive("audioInputPresetSettings",["$rootScope","audioEvents","EditorHistory","EditorRevision","Katnip",function(e,t,n,o,a){return{replace:!0,restrict:"E",scope:{preset:"="},templateUrl:"https://www.bandlab.com/web-app/audio/partials/_audio-input-preset-settings-3afe4e12.html",link:function(e,t){t.on("wheel",function(e){t[0].scrollLeft+=e.deltaX,e.preventDefault()})},controller:["$scope",function(i){function r(n,o){e.$broadcast(t.EFFECTS_CHANGED,{effects:n,preset:o})}i.katnipEffects=a.metadata,i.sortedKatnipEffects=_.chain(a.metadata).omitBy({visible:!1}).sortBy(function(e){return e.name.toLowerCase()}).sortBy(function(e){return e.type}).groupBy(function(e){return e.type}).value(),i.toggleEffectBypass=function(n){n.bypass=!n.bypass,e.$broadcast(t.EFFECT_PARAMETER_CHANGED,{effectOrder:i.preset.effects.indexOf(n),paramSlug:"bypass",value:n.bypass})},i.addEffect=function(e){var t=i.preset.effects.concat({bypass:!1,params:_.mapValues(e.params,function(e){return e.default}),slug:e.slug});"genericAmp"===e.slug&&t.push({bypass:!1,params:{respire:1,hpf:0,lpf:0,level:0,phase:0,micModel:"shureSM57",cabModel:"2x12Jenson",micPosition:"onAxis"},slug:"guitarCab"}),r(t,null)},i.removeEffect=function(e){r(_.filter(i.preset.effects,function(t){return t!==e}),null)},i.stopPushUndo=function(){n.pushUndo(o.current),n.startToIgnorePushUndo()},i.resumePushUndo=function(){n.stopToIgnorePushUndo()},i.updateParams=function(n){e.$broadcast(t.EFFECT_PARAMETER_CHANGED,{effectOrder:i.preset.effects.indexOf(n.effect),paramSlug:n.property,value:n.effect.params[n.property]})}}]}}]),angular.module("bandlab.audio").directive("audioInputSharedReverb",["audioSettings","EditorAutomation","EditorHelper","EditorState",function(e,t,n,o){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_audio-input-shared-reverb-eaa436c2.html",link:function(o,a){var i=a[0].querySelector(".audio-input-aux-channel-volume-bar");function r(){o.$digest()}function s(){var a=t.getMomentValue("volume",o.getTrack()),r=100*n.scaleLinToLog(a/e.AUDIO_PARAMETERS.volume.range,1);i.style.height="".concat(r,"%")}t.on("playing",s),t.on("syncVolume",s),t.on("playing",r),t.on("syncVolume",r),o.$on("$destroy",function(){t.off("playing",s),t.off("syncVolume",s),t.off("playing",r),t.off("syncVolume",r)})},controller:["$document","$scope","audioSettings","EditorHelper","EditorPlayer",function(e,n,a,i,r){var s={};n.panMetadata={name:"Pan",type:"float",displayStep:1,min:-1,max:1,default:0,displayUnit:"",displayMax:50,displayMin:-50},n.auxMetadata={default:.15,max:1,min:0,name:"Reverb",step:.01,type:"float",unit:"%"},n.getTrackParam=function(){return s.pan=t.getMomentValue("pan",n.getTrack()),_.get(n.getTrack(),"automation.pan.length")?s:n.getTrack()},n.getTrackAuxSendsParam=function(){return _.get(n.getTrack(),"auxSends[0]")||s},n.setTrackPan=function(){var e=n.getTrack();t.syncVolume(),r.current.setTrackParameter(e.id,"pan",e.pan),o.hasRevisionChanges=!0},n.setTrackVolume=function(s){var c=n.getTrack(),l=a.AUDIO_PARAMETERS.volume.range,u=parseFloat(i.scaleLogToLin(s*l,l).toFixed(4));(u<0||u>2)&&(u=Math.min(2,Math.max(u,0))),c.volume=u,r.current.setTrackParameter(c.id,"volume",u),t.syncVolume(),o.hasRevisionChanges=!0,e[0].body.style.cursor="ns-resize"},n.setAuxMix=function(){var e=n.getTrack();r.current.setTrackParameter(e.id,"sendLevel",e.auxSends[0].sendLevel),o.hasRevisionChanges=!0},n.updateUI=function(){e[0].body.style.cursor="",n.$applyAsync()},n.scaleLinToLog=i.scaleLinToLog,n.toDiffDecibels=i.toDiffDecibels}]}}]),angular.module("bandlab.audio").directive("audioInputVolumeMeter",["AudioMeterDisplay",function(e){return{replace:!0,restrict:"E",scope:!0,template:'\n        <div class="volume-meter audio-input-volume-meter">\n          <div class="volume-meter-background"></div>\n          <div class="volume-meter-mask"></div>\n          <div class="volume-meter-clip-indicator"></div>\n        </div>\n      ',link:function(t,n){var o,a=e.getMeterDisplay("in",n[0]);setTimeout(a.init),function e(){a.update(),o=requestAnimationFrame(e)}(),t.$on("$destroy",function(){a.stop(),cancelAnimationFrame(o)})}}}]),angular.module("bandlab.audio").directive("creatorsKit",["MidiKeyboardHandler","MidiKeyMapping",function(e,t){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_creators-kit-1a7a48ae.html",compile:function(n){var o=angular.element(n[0].querySelector(".creators-kit")),a=_.map(t.getcreatorsKitMapping(),function(e){return'\n            <div class="creators-kit-pad"\n                data-midi-code="'.concat(e.midi,'"\n                ng-class="{ active: isActive(').concat(e.midi,"), 'not-mapped': !isMapped(").concat(e.midi,') }">\n              <span class="virtual-drum-pad-shortcut">').concat(e.shortcut,"</span>\n            </div>\n          ")}).join("");return o.append(a),{post:function(){e.changeKeymap("creators-kit")}}},controller:"VirtualInstrumentCtrl"}}]),angular.module("bandlab.audio").controller("DemoAudioInputCtrl",["$scope",function(e){e.supportAudioInput=ze()}]).directive("demoAudioInput",["EditorState",function(e){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_demo-audio-input-3a37e9b2.html",scope:{},link:function(t,n){n.on("mousedown",function(){e.isAudioInputActive=!0,t.$applyAsync()})},controller:["$q","$scope","$state","AudioCore","AudioCtx","audioEvents","AudioMonitoring","AudioReset","DrumMachine","DrumMachineState","EditorHelper","EditorModel","EditorPlayer","EditorRevision","InputDevice","InputsCollection","Katnip","Me","Metronome","MidiDevice","SharedMidiSynth","Soundbank",function(e,t,n,o,a,i,d,m,f,h,g,v,b,y,w,k,S,P,E,T,M,$){var C=v.createRevision({tracks:[v.createTrack()]}),A=[{label:"Instrument",slug:"drum-kit",soundbank:"dry-kit"},{label:"Drum Machine",slug:c,soundbank:"808-kit"},{label:"Voice/Mic",slug:p},{label:"Guitar",slug:u},{label:"Bass",slug:l}];function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dry-kit";b.current.setTrackEffects(y.selectedTrack.id,[]),y.trackMonitoring.set(y.armedTracks[1],!1),d.switchTrackChain(),M.outputNode.disconnect(),e===c?(k.setDrumMachine({soundbank:t,type:c}),M.outputNode.connect(b.current.getTrack(C.tracks[0].id).input)):g.isAudioTrack({type:e})?(k.setFromAudioType(e),w.getCurrent().device.kind!==r&&w.getAudioDevices().then(function(e){e.length&&w.switchTo(e[0])})):(k.setFromSoundbank(t),M.outputNode.connect(b.current.getTrack(C.tracks[0].id).input)),y.selectedTrack.preset="none",y.selectedTrack.effects=[]}g.displayInstrument({toggle:!1}),g.extendAudioInput({toggle:!1}),y.selectedTrack=C.tracks[0],y.armedTracks[1]=y.selectedTrack,h.patterns=f.createDefaultPatterns(),f.selectPattern(h.patterns[0]),t.me=P,t.current=k.getCurrent(),t.getTrack=function(){return y.selectedTrack},e.all([S,E.init(),$.getList()]).then(function(){return o.getPlayer(a.get(),C)}).then(function(e){var o=n.params["user-interface"],r=n.params.soundbank,s=n.params.source;switch(t.withInputSelection=!o,o){case"guitar-bass":case"guitar-electric":case"voice":s=o;break;case"drum-kit":r="dry-kit",s="drum-kit";break;case"drum-pads":r="808-kit",s="drum-pads";break;case"piano":r="grand-piano",s="piano";break;case"drum-machine":r="808-kit",s="drum-machine";break;default:t.withInputSelection=!0}b.current=e,e.connect(a.get().destination),R(s,r),t.$watch("current",function(e){n.go(".",{source:e.input.slug,soundbank:e.soundbank?e.soundbank.slug:null},{location:"replace"})},!0),t.$on(i.EFFECTS_CHANGED,function(t,n){y.selectedTrack.preset=n.preset||"custom",y.selectedTrack.effects=n.effects,e.setTrackEffects(y.selectedTrack.id,n.effects),y.selectedTrack.effects.length||(y.selectedTrack.preset="none")}),t.$on(i.EFFECT_PARAMETER_CHANGED,function(n,o){y.selectedTrack.preset="custom",t.$applyAsync(),e.setTrackEffectParameter(y.selectedTrack.id,o.effectOrder,o.paramSlug,o.value)})}),t.getSelectedInputKindInCarousel=function(){return t.current.input.kind===s?A[0]:_.find(A,{slug:t.current.input.slug})},t.setNextInputKind=function(){var e=t.getSelectedInputKindInCarousel(),n=A[A.indexOf(e)+1]||A[0];R(n.slug,n.soundbank)},t.setPreviousInputKind=function(){var e=t.getSelectedInputKindInCarousel(),n=A[A.indexOf(e)-1]||A[A.length-1];R(n.slug,n.soundbank)},t.$on("$destroy",function(){m.reset(),y.selectedTrack={},T.unplug()})}]}}]),angular.module("bandlab.audio").directive("demoMasteringPreview",["RevisionImporter",function(e){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_demo-mastering-preview-b54965ed.html",controller:["$scope",function(t){var n=[{sampleId:"cd-master",url:"https://www.bandlab.com/web-app/common/static/cd-master-8aed611321.mp3"},{sampleId:"bass-boost",url:"https://www.bandlab.com/web-app/common/static/bass-boost-004698287a.mp3"},{sampleId:"enhance-clarity",url:"https://www.bandlab.com/web-app/common/static/enhance-clarity-49f4d03e02.mp3"},{sampleId:"original",slug:"dry",url:"https://www.bandlab.com/web-app/common/static/original-370214f1dc.mp3"}];e.loadPreview(n).then(function(){t.state={presets:n,selectedPreset:n[0]}})}]}}]),angular.module("bandlab.audio").directive("drumMachine",["$document","DrumMachine","EditorState","MidiKeyMapping",function(e,t,n,o){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_drum-machine-f966d5a7.html",link:function(a,i){function r(e){var r=o.getKeymap("drums"),s=o.getMidiDrums(),c=r[e.code];if(n.isAudioInputActive){if("Space"===e.code)return e.preventDefault(),a.isLive=!1,t.toggle(),void a.$digest();if("KeyL"===e.code)return a.isLive=!a.isLive,t.isActive()||t.toggle(),void a.$digest();"SELECT"===e.target.nodeName&&e.preventDefault(),c&&"INPUT"!==e.target.nodeName&&_.find(t.getCurrentKit(),{midi:c})&&(t.previewNote(s[c]),a.isPressed[s[c].slug]=!0,a.isLive&&t.set(s[c],i[0].getAttribute("drum-machine-beat"),1),a.$digest())}}function s(e){var t=o.getKeymap("drums"),n=o.getMidiDrums(),i=t[e.code];i&&(a.isPressed[n[i].slug]=!1,a.$digest())}a.isPressed={},e.on("keydown",r),e.on("keyup",s),i[0].setAttribute("drum-machine-note-value",4),a.$on("DrumMachine:beat",function(e,t){i[0].setAttribute("drum-machine-beat",t)}),a.$on("$destroy",function(){e.off("keydown",r),e.off("keyup",s)})},controller:"DrumMachineCtrl"}}]).controller("DrumMachineCtrl",["$rootScope","$scope","AnimationFrame","AudioMonitoring","audioSettings","ContextMenu","DrumMachine","DrumMachineState","editorEvents","EditorHelper","EditorHistory","EditorRevision","EditorState","MetronomeState","SharedMidiSynth",function(e,t,n,o,a,i,r,s,c,l,u,d,p,m,f){var h,g=!1;function v(){var n,o=_.find(d.selectedTrack.regions,function(e){return p.crTime>e.startPosition&&p.crTime<e.endPosition}),a=o&&_.find(d.selectedTrack.patterns,{sampleId:o.sampleId}),i=l.getMeasureDuration({bpm:m.settings.bpm,signature:{notesCount:4,noteValue:4}});o?(n=(p.crTime-o.startPosition)%(o.loopLength||i)+o.sampleOffset,n=Math.floor(n/i*16),e.$broadcast("DrumMachine:beat",n)):e.$broadcast("DrumMachine:beat",-1),a&&a!==s.selectedPattern&&(r.selectPattern(a),t.$applyAsync())}t.drumMachineState=s,t.getAvailableKit=r.getAvailableKit,t.getCurrentKit=r.getCurrentKit,t.isActive=r.isActive,t.isNoteMapped=f.isNoteMapped,t.state=p,t.swapDrum=r.swapDrum,t.mouseenterPreviewNote=function(e){r.isActive()||r.previewNote(e)},t.clearPattern=function(){u.pushUndo(d.current),r.clearPattern()},t.usePattern=function(e){r.selectPattern(e),d.selectedRegions=new Set(_.chain(d.current.tracks).map("regions").flatten().filter({sampleId:e.sampleId}).value())},t.toggleNote=function(e,t,n){i.currentMenu||(g=n,r.set(e,t,n))},t.setNote=function(e,n,o){e.buttons<1||1!==e.which||t.isChangingBPM||p.isAudioInputDragged||r.set(n,o,g)},t.isActive=r.isActive,t.toggle=function(){t.isLive=!1,r.toggle()},t.settings=m.settings,t.backupBPM=function(){t.isChangingBPM=!0,h=t.settings.bpm},t.setBPM=function(e,n){var o=h+parseInt(.3*n);o=Math.min(a.METRONOME_TEMPO_MAX,Math.max(o,a.METRONOME_TEMPO_MIN)),m.settings.bpm=o,t.$applyAsync()},t.releaseBPM=function(){t.isChangingBPM=!1},t.getCurrentPresetLetter=function(){return String.fromCharCode(97+r.getCurrentPresetIndex()).toUpperCase()},t.$on(c.startPlay,r.stop),t.$on("$destroy",function(){n.remove("playing",v),o.switchTrackChain(),r.stop()}),n.add("playing",v)}]).directive("drumMachineNote",["$rootScope","EditorHistory","EditorRevision",function(e,t,n){return{restrict:"A",link:function(o,a){a.on(Modernizr.touchevents?"click":"mousedown",function(a){3!==a.which&&(t.pushUndo(n.current),o.toggleNote(o.drum,o.$index,!o.value),e.$digest())}),a.on("mouseenter",function(t){o.setNote(t,o.drum,o.$index),e.$digest()})}}}]).directive("drumMachineStartButton",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_drum-machine-start-button-41dbee97.html"}}).directive("drumMachineExportButton",["$rootScope","$state","AppNotifications","EditorDraggedItem","editorEvents","EditorRevision","EditorState",function(e,t,n,o,a,i,r){return{restrict:"A",link:function(s,l){t.includes("mixEditor")||l.remove(),l[0].draggable=!0,l[0].addEventListener("dragstart",function(){o.value={trackId:i.selectedTrack.id,type:c}}),l[0].addEventListener("dragend",function(){o.value={}}),l.on("click",function(){e.$broadcast(a.importFile,{time:r.crTime,type:c})}),s.$on(a.abortRecord,function(){n.addNotification({title:"No input source",content:"Create or select a track with a different input source to start recording",autoclose:5e3})})}}}]).directive("drumMachineBpmInput",["$state",function(e){return{replace:!0,restrict:"E",link:function(t,n){e.includes("mixEditor")&&n.remove()},templateUrl:"https://www.bandlab.com/web-app/audio/partials/_drum-machine-bpm-input-9cbaa347.html"}}]),angular.module("bandlab.audio").component("guitar",{bindings:{input:"<"},controller:["EditorState","Modal",function(e,t){this.openTuner=function(){new t({template:"<audio-tuner><audio-tuner>",onCreate:function(){e.isInBackground=!0},onDestroy:function(){e.isInBackground=!1}}).show()}}],controllerAs:"vm",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_guitar-eb91fca2.html"}),angular.module("bandlab.audio").directive("knob",["$document","EditorHelper",function(e,t){return{restrict:"E",replace:!0,scope:{automation:"=",disabled:"=",metadata:"=",onChange:"&",onChangeEnd:"&",onChangeStart:"&",params:"=",property:"@"},templateUrl:"https://www.bandlab.com/web-app/audio/partials/_knob-10609604.html",compile:function(n,o){return o.onChange=o.onChange||"updateParams({ effect: effect, property: '".concat(o.property,"' })"),o.onChangeStart=o.onChangeStart||"stopPushUndo()",o.onChangeEnd=o.onChangeEnd||"resumePushUndo()",function(n,o){var a=n.metadata,i=o[0].querySelector(".knob-cursor"),r=o[0].querySelector(".knob-fill");function s(){e[0].body.style.cursor=null,e.off("mouseup",s)}function c(){var e=(("log"===n.metadata.scale?t.logToLin(n.params[n.property],a.min,a.max):n.params[n.property])-n.metadata.min)/(a.max-a.min)*240;if(i.style.transform="rotate(".concat(e-120,"deg)"),!(o.hasClass("knob-dotted")||o.hasClass("knob-panning")||o.hasClass("knob-panning-dotted"))){var s=Math.max(e-120,0),c=Math.min(360,240+e),l=Math.min(240,c);r.style.setProperty("--first-stop","".concat(s,"deg")),r.style.setProperty("--second-stop","".concat(l,"deg")),r.style.setProperty("--third-stop","".concat(c,"deg"))}}c(),n.$watch("params.".concat(n.property),c),o.on("mousedown",function(t){t.preventDefault(),e[0].body.style.cursor="ns-resize",e.on("mouseup",s)})}},controller:["$scope",function(e){var n,o,a,i=e.metadata,r=(i.max-i.min)/300;e.start=function(){a="log"===i.scale?t.logToLin(e.params[e.property],i.min,i.max):e.params[e.property],n=_.once(e.onChangeStart),o=angular.noop},e.move=function(s,c){var l=a+c*r;"log"===i.scale?e.params[e.property]=t.linToLog(l,i.min,i.max):e.params[e.property]=l,n(),o=e.onChangeEnd,e.params[e.property]=Math.max(Math.min(function(e,t){return t?Math.round(Math.ceil(e/t)*t*1e3)/1e3:e}(e.params[e.property],i.step),i.max),i.min),e.onChange()},e.end=function(){o()}}]}}]);var We={colorProgressSoFar:"#DC3710",colorProgressBackward:"#E35E3F",colorProgressForward:"rgba(255, 255, 255, 0.7)",colorNotPlayedYet:"rgba(255, 255, 255, 0.5)"};function Ke(e){return e*window.devicePixelRatio}function Ye(e,t,n,o,a){var i=Ke(2),r=Math.min(n,o),s=Math.max(n,o),c=e.canvas.width/Ke(1)/3,l=angular.extend({},{heightRatio:e.canvas.height/_.max(t)},We,a);function u(t,n){e.fillRect(Ke(3*t),e.canvas.height,i,-l.heightRatio*Math.max(n,1))}requestAnimationFrame(function(){var a;for(function(e){e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height)}(e),e.fillStyle=l.colorProgressSoFar,a=0;a<Math.floor(c*r);a++)u(a,t[a]);for(e.fillStyle=null===o?l.colorProgressSoFar:o<n?l.colorProgressBackward:l.colorProgressForward,a=Math.floor(c*r);a<Math.floor(c*s);a++)u(a,t[a]);for(e.fillStyle=l.colorNotPlayedYet,a=Math.floor(c*s);a<c-1;a++)u(a,t[a])})}function Xe(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Je(e){return new Promise(function(t,n){var o=new FileReader;o.onload=function(e){t(e.target.result)},o.onerror=n,o.readAsArrayBuffer(e)})}function Qe(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Ze(e,t,o,a,i,r,s,c,l,u){var d,p,m=5,f=null,h=!1,g=e.url();function v(){return h?t.resolve([]):d=c.fromBand({after:f,bandId:u.id,limit:m}).$promise.then(function(e){return h=e.data.length<m,f=_.get(e,"paging.cursors.after",0),e.data})}function b(){return o.infiniteScrollEnded?t.reject("No more results"):d=d.then(function(e){return o.infiniteScrollEnded=h,o.posts=o.posts||[],o.posts=o.posts.concat(e.filter(function(e){return!e.isPinned})),o.pinned=o.pinned||e.filter(function(e){return e.isPinned}),s.pushQueueSongs(o.posts,g),v()})}o.band=u,o.loadMore=b,o.me=r,o.createShoutPost=function(){return l.createShoutPost({type:"photo",band:u})},o.onPostCreate=function(e){o.posts.unshift(e)},o.onShoutUploaded=function e(a,r){var s=c.fromBand({bandId:u.id,offset:0,limit:10,excludePinned:!0}).$promise;return i.cancel(p),p=i(angular.noop,2e3),t.all([s,p]).then(function(t){var s=n(t,1)[0].data,c=_.find(s,a);c?(r.remove(),o.posts.unshift(c),i.cancel(p)):e(a,r)})},s.setState({loader:b,url:g}),o.$on("$post:delete",function(e,t){_.remove(o.posts,function(e){return e.id===t.post.id}),o.pinned.length&&(_.remove(o.pinned,function(e){return e.id===t.post.id}),(document.scrollingElement||document.body).scrollTop=0)}),o.$on("$post:pin",function(e,t){var n=t.post;_.find(o.posts,{id:n.id})&&i(function(){return a.reload("band.feed")},1e3)}),o.$on("$post:unpin",function(e,t){var n=t.post;_.find(o.pinned,{id:n.id})&&i(function(){return a.reload("band.feed")},1e3)}),v().then(o.loadMore)}function et(){var e=S(["Your message has been sent."]);return et=function(){return e},e}function tt(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function nt(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?tt(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):tt(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function ot(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function at(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?ot(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ot(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function it(){var e=S(["You are not permitted to post comments"]);return it=function(){return e},e}function rt(){var e=S(["You are not permitted to create posts"]);return rt=function(){return e},e}function st(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function ct(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?st(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):st(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}angular.module("bandlab.audio").directive("latencyTest",["$interval","$rootScope","LatencyMeter","LatencyProgress",function(e,t,n,o){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_latency-test-ed7fe4ad.html",link:function(a,i){var r=i[0].querySelector(".latency-test-waveform-canvas"),s=r.getContext("2d");function c(e){var t=0===e?angular.element(document.querySelector(".latency-test-animation .icon-volume-on")):angular.element(document.querySelector(".latency-test-animation .icon-micro"));t.toggleClass("active"),setTimeout(function(){t.toggleClass("active")},100)}r.width=Ke(r.width),r.height=Ke(r.height),o.draw(s,0),a.status="",a.state="default",a.startTest=function(){var i,r=0,l=o.getStepsAmount(),u=n.getFullTestDuration();a.state="default",a.isLatencyTestRunning=!0,i=e(function(){o.draw(s,r/l),++r===l&&(e.cancel(i),r=0)},u/l),n.startTest(c).then(function(e){a.status=e,a.state="success",t.$broadcast("$latencyTest:result",{result:e})}).catch(function(e){a.status=e,a.state="fail"}).finally(function(){a.isLatencyTestRunning=!1,n.resetTest()})},a.$on("$destroy",function(){n.resetTest()})}}}]),angular.module("bandlab.audio").directive("masteringDropzone",["$timeout","RevisionImporter",function(e,t){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_mastering-dropzone-eefc9425.html",link:function(n,o){function a(o){o&&t.requestPreviewsForFile(o).then(function(t){return n.state.file=o,n.state.name=o.name,n.state.presets=t,e(function(){n.state.step=1},500)}).catch(function(){n.state.step=0})}o.on("click",function(){o[0].querySelector("input").click()}),o.on("drop",function(e){e.preventDefault(),e.stopPropagation(),o.removeClass("dropping"),a(_.get(e,"dataTransfer.files[0]",!1)),_.get(e,"dataTransfer.files.length",0)>1&&t.displayMultipleFilesWarning()}),o.on("dragover",function(e){e.preventDefault(),e.stopPropagation(),o.addClass("dropping")}),o.on("dragleave",function(){o.removeClass("dropping")}),n.$watch("masterFile",function(e){a(_.get(e,"[0]",!1))}),setTimeout(function(){o.addClass("animate")})}}}]),angular.module("bandlab.audio").component("masteringPreview",{restrict:"E",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_mastering-preview-e2f74425.html",bindings:{autoplay:"<",onChange:"&",state:"="},controller:["$rootScope","$filter","Player",function(e,t,n){var o,a=this,i=t("duration");function r(){e.$applyAsync()}function s(){_.forEach(a.state.presets,function(e){e.audio.pause()})}function c(){_.forEach(a.state.presets,function(e){e.audio.muted=!0})}a.$onInit=function(){a.state.presets[0]&&(n.pause(),o=e.$on("masteringPreview:pause",s),a.selectPreset(a.state.defaultPreset),a.state.presets[0].audio.ondurationchange=r,a.state.presets[0].audio.ontimeupdate=r,a.state.presets[0].audio.onended=r,a.autoplay&&a.togglePlay())},a.$onDestroy=function(){s(),o()},a.getCurrentTime=function(){return i(a.state.presets[0].audio.currentTime)},a.getProgression=function(){return a.state.presets[0].audio.currentTime/a.state.presets[0].audio.duration*100},a.getTotalTime=function(){return i(a.state.presets[0].audio.duration)},a.isPlaying=function(){return!a.state.presets[0].audio.paused},a.isPresetSelected=function(e){return a.state.selectedPreset===e},a.selectPreset=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.state.presets[0];a.state.selectedPreset=e,c(),a.state.selectedPreset.audio.muted=!1,angular.isFunction(a.onChange)&&a.onChange({selectedPreset:a.state.selectedPreset})},a.setCurrentTime=function(e){var t;t=e*a.state.presets[0].audio.duration,_.forEach(a.state.presets,function(e){e.audio.currentTime=t})},a.togglePlay=function(){a.isPlaying()?s():(c(),_.forEach(a.state.presets,function(e){Promise.resolve(e.audio.play()).catch(function(e){return"NotAllowedError"===e.name?Promise.resolve():Promise.reject(e)})}),a.state.selectedPreset.audio.muted=!1)}}]}),angular.module("bandlab.audio").directive("midiCode",function(){return{restrict:"A",link:function(e,t,n){var o="mouseup mouseout touchend touchleave touchcancel";t.on("mousedown mouseenter touchstart",function(a){var i=parseInt(n.midiCode);a.preventDefault(),"touchstart"!==a.type&&(a.buttons<1||1!==a.which)||(e.press(i),t.on(o,function n(a){a.preventDefault(),e.release(i),t.off(o,n)}))})}}}),angular.module("bandlab.audio").directive("draggablePedal",["$rootScope","audioEvents",function(e,t){var n=null;return{restrict:"A",link:function(o,a){function i(e){e.preventDefault()}a[0].draggable=!0,a.on("dragstart",function(e){e.stopPropagation(),n=o.effect,a[0].parentElement.addEventListener("dragover",i)}),a.on("dragend",function(){n=null,e.$broadcast(t.EFFECTS_CHANGED,{effects:o.preset.effects}),o.$applyAsync(),a[0].parentElement.removeEventListener("dragover",i)}),a.on("dragenter",function(e){if(null!==n&&n!==o.effect){var t=o.preset.effects.indexOf(n),a=o.preset.effects.indexOf(o.effect);(t<a&&e.offsetX>this.clientWidth/2||t>a&&e.offsetX<this.clientWidth/2)&&(o.preset.effects.splice(t,1),o.preset.effects.splice(a,0,n),o.$applyAsync())}}),o.isDragged=function(){return o.effect===n}}}}]).directive("pedalControls",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-controls-7e89d7d8.html"}}).directive("pedalAutoWah",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-auto-wah-84ad0aa6.html"}}).directive("pedalBackCompr",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-back-compr-8330ab3f.html"}}).directive("pedalBossCe5",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-boss-ce5-582455f3.html"}}).directive("pedalCabinet",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-cabinet-8848ea3f.html"}}).directive("pedalChorus",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-chorus-0ee26521.html"}}).directive("pedalCompressor",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-compressor-dfe9e333.html"}}).directive("pedalDdelay",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-ddelay-e0a84494.html"}}).directive("pedalDelay",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-delay-65af9dcc.html"}}).directive("pedalEqualizer",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-equalizer-feb31da9.html"}}).directive("pedalExpGate",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-exp-gate-1e7e9a49.html"}}).directive("pedalFilter",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-filter-94ddbdfb.html",controller:["$scope",function(e){e.isEnabled=function(t){return _.find(e.katnipEffects.filter.params.filterType.values,{slug:e.effect.params.filterType}).activeParams[t]}}]}}).directive("pedalGain",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-gain-5653b810.html"}}).directive("pedalGenericAmp",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-generic-amp-f179a519.html"}}).directive("pedalGuitarAmp",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-guitar-amp-ca88967a.html"}}).directive("pedalGuitarAmp2",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-guitar-amp2-adff2289.html"}}).directive("pedalGuitarCab",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-guitar-cab-0c34e5df.html"}}).directive("pedalOctaver",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-octaver-0bf8c8a7.html"}}).directive("pedalOverdrive",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-overdrive-da80010a.html"}}).directive("pedalBossGe7",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-boss-ge7-a8e9a1f9.html"}}).directive("pedalRossCompressor",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-ross-compressor-ec753f99.html"}}).directive("pedalLa2aCompressor",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-la2a-compressor-7ae6d2f4.html"}}).directive("pedalCompressor1176",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-compressor-1176-1b7db734.html"}}).directive("pedalMxrPhase90",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-mxr-phase-90-6054c0b2.html"}}).directive("pedalMxrUnivibe",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-mxr-univibe-68a0fbef.html"}}).directive("pedalDimensionD",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-dimension-d-e984891b.html"}}).directive("pedalEhSmallStone",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-eh-small-stone-81f5efcb.html"}}).directive("pedalBossVb2",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-boss-vb2-c298bc63.html"}}).directive("pedalBigMuffPi",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-big-muff-pi-e8a92c76.html"}}).directive("pedalBossMt2",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-boss-mt2-4de4718d.html"}}).directive("pedalProCoRat",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-pro-co-rat-2f1e21ea.html"}}).directive("pedalMxrDistortion",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-mxr-distortion-5dea86ea.html"}}).directive("pedalFuzzFace",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-fuzz-face-af0fb614.html"}}).directive("pedalBossBd2",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-boss-bd2-285bb997.html"}}).directive("pedalTubeScreamer2",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-tube-screamer2-0d3395ff.html"}}).directive("pedalParamEq",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-param-eq-f47f3581.html"}}).directive("pedalPhaser",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-phaser-be1f6d54.html"}}).directive("pedalReverb",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-reverb-9ba1377e.html"}}).directive("pedalAcSimulator",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-ac-simulator-cabb007f.html"}}).directive("pedalReverbHybrid",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-reverb-hybrid-32e4a437.html"}}).directive("pedalSerafiniPreset",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-serafini-preset-be756c39.html"}}).directive("pedalDeEsser",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-de-esser-361683ca.html"}}).directive("pedalSpringReverb",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-spring-reverb-4b960f6a.html"}}).directive("pedalSpringReverb2",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-spring-reverb2-dd034c8d.html"}}).directive("pedalStudioReverb",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-studio-reverb-5640284d.html"}}).directive("pedalSimpleStudioReverb",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-simple-studio-reverb-25a6a63f.html"}}).directive("pedalTubeScreamer",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-tube-screamer-68120fda.html"}}).directive("pedalTremolo",function(){return{replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_pedal-tremolo-761af9a4.html"}}),angular.module("bandlab.audio").directive("previewSoundbank",["$q","AudioState",function(e,t){return{restrict:"A",controller:["$scope",function(n){t.previewPlayer.onended=function(){t.previewPlayer.pause(),n.$applyAsync()},n.previewSoundbank=function(n,o){n.stopPropagation(),t.previewSoundbank=o;var a=o.preview.m4a;a!==t.previewPlayer.src||t.previewPlayer.paused?(t.previewPlayer.src=a,e.resolve(t.previewPlayer.play()).catch(angular.noop)):t.previewPlayer.pause()},n.isPreviewing=function(e){return e===t.previewSoundbank&&!t.previewPlayer.paused},n.$on("$destroy",function(){t.previewPlayer.pause(),t.previewPlayer.onended=null,t.previewSoundbank=null})}]}}]),angular.module("bandlab.audio").directive("projectDropzone",["$state","$timeout","appActions","RevisionImporter",function(e,t,n,o){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_project-dropzone-69c8be95.html",link:function(a,i){function r(a){if(a&&n.checkAllowed("upload"))return o.createRevisionFromFile(a).then(function(n){return t(function(){return e.go("userSong",{username:n.creator.username,slug:n.song.slug,revId:n.id})},1e3)})}i.on("click",function(){n.checkAllowed("upload")&&i[0].querySelector("input").click()}),i.on("drop",function(e){e.preventDefault(),e.stopPropagation(),i.removeClass("dropping"),r(_.get(e,"dataTransfer.files[0]",!1)),_.get(e,"dataTransfer.files.length",0)>1&&o.displayMultipleFilesWarning()}),i.on("dragover",function(e){e.preventDefault(),e.stopPropagation(),i.addClass("dropping")}),i.on("dragleave",function(){i.removeClass("dropping")}),a.$watch("masterFile",function(e){r(_.get(e,"[0]",!1))}),setTimeout(function(){i.addClass("animate")})}}}]),angular.module("bandlab.audio").constant("QuickUpload",{state:{}}).directive("quickUploadDropzone",["$state","$stateParams","$timeout","appActions","AppNotifications","EditorLoader","FileHelper","RevisionImporter",function(e,t,o,a,i,r,s,c){return{replace:!0,restrict:"A",link:function(l,u){if(u.on("click",function(){a.checkAllowed("upload")&&u[0].querySelector("input").click()}),u.on("drop",function(e){e.preventDefault(),e.stopPropagation(),u.removeClass("dropping"),p(_.get(e,"dataTransfer.files[0]",!1))}),u.on("dragover",function(e){e.preventDefault(),e.stopPropagation(),u.addClass("dropping")}),u.on("dragleave",function(){u.removeClass("dropping")}),l.$watch("importedAudio",function(e){p(_.get(e,"[0]",!1))}),setTimeout(function(){u.addClass("animate")}),t.remote){var d=t.remote;e.go(".",{remote:null}),s.download(t.remote).then(function(e){return e.name=d.split("/").pop(),e}).then(p)}function p(t){t&&a.checkAllowed("upload")&&c.isAudioFileValid(t).then(function(t){var a=n(t,2),i=a[0],r=a[1];l.state.audioFile=i,l.state.duration=r,l.state.name=i.name,l.state.sampleId=k(),o(function(){e.go("quickUpload2")})}).catch(function(e){r.flushQueue(),i.addNotification({title:j,content:e.message,classList:"alert",autoclose:8e3})})}}}}]).directive("quickUploadCover",["AppNotifications","FileHelper",function(e,t){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_quick-upload-cover-d3f41c1d.html",link:function(n,o){function a(o){o&&t.checkType(o).then(function(e){return t.createImageElement(e)}).then(function(e){var t=e.file,o=e.image;n.state.imageFile=t,n.state.revisionCover=o.src,n.state.imageWidth=o.width,n.state.imageHeight=o.height}).catch(function(t){e.addNotification({title:j,content:t.message,classList:"alert",autoclose:8e3})})}n.state.imageFile=null,n.state.revisionCover=null,n.state.imageWidth=null,n.state.imageHeight=null,o.on("click",function(){o[0].querySelector("input").click()}),o.on("drop",function(e){e.preventDefault(),e.stopPropagation(),o.removeClass("dropping"),a(_.get(e,"dataTransfer.files[0]",!1))}),o.on("dragover",function(e){e.preventDefault(),e.stopPropagation(),o.addClass("dropping")}),o.on("dragleave",function(){o.removeClass("dropping")}),n.$watch("importedImage",function(e){a(_.get(e,"[0]",!1))}),setTimeout(function(){o.addClass("animate")})}}}]),angular.module("bandlab.audio").directive("selectAudioDevice",["AppNotifications","audioEvents","InputDevice",function(e,t,n){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_select-audio-device-c08efafd.html",controller:["$analytics","$scope",function(o,a){function i(t){n.switchTo(t).then(function(){a.notifyInputChanged(),o.eventTrack("Select Source",{category:"Audio Input",label:t&&t.name||"undefined device"})}).catch(function(n){e.addNotification({title:"Cannot connect ".concat(t&&t.name||"undefined device"),content:n.message,autoclose:5e3})})}return a.selectedAudioDevice=n.getCurrent(),a.getAudioDevices=function(){return n.getAudioDevices().then(function(e){return a.audioDevices=e,a.$applyAsync(),e})},a.selectAudioDevice=i,a.$on(t.INPUT_DISCONNECTED,function(){a.getAudioDevices().then(function(e){return i(e[0])})}),a.getAudioDevices()}]}}]),angular.module("bandlab.audio").directive("selectDeviceChannel",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_select-device-channel-3bb4b7bc.html",controller:["$scope","$rootScope","AudioMonitoring","audioEvents","InputDevice",function(e,t,n,o,a){e.selectDeviceChannel=function(i){e.getTrack().channel=i,n.switchTrackChain(),a.selectChannel({channel:i}),t.$broadcast(o.INPUT_CHANGED)}}]}}),angular.module("bandlab.audio").directive("selectImpulseResponse",function(){return{restrict:"E",replace:!0,scope:{metadata:"=",onChange:"&",params:"=",property:"@"},templateUrl:"https://www.bandlab.com/web-app/audio/partials/_select-impulse-response-ff520941.html",compile:function(e,t){t.onChange="updateParams({ effect: effect, property: '".concat(t.property,"' })")},controller:["$scope",function(e){e.displayIR=function(){return _.find(e.metadata.values,{slug:e.params[e.property]}).name},e.selectIR=function(t){e.params[e.property]=t,e.onChange()}}]}}),angular.module("bandlab.audio").directive("selectMidiDevice",["audioEvents","InputDevice","MidiDevice",function(e,t,n){var o={};return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_select-midi-device-a94291e5.html",controller:["$analytics","$scope",function(a,i){function r(e){return 0===e.length?[{id:-1,name:"No MIDI Device"}]:e}i.midiDevice=o,i.midiDevicesList=r([]),i.selectMidiDevice=function(e){o=i.midiDevice=e,i.notifyInputChanged()},t.getMidiDevices().catch(function(){return[{id:-1,name:"MIDI interface not supported"}]}).then(function(t){i.midiDevicesList=r(t),o=i.midiDevice=_.find(i.midiDevicesList,{id:o.id})||i.midiDevicesList[0],n.plug(i.midiDevice),i.$watch("midiDevice",function(e){o=e,-1!==e.id?(n.plug(_.find(i.midiDevicesList,{id:e.id})),a.eventTrack("Select Source",{category:"Audio Input",label:e.name})):n.unplug()}),i.$on(e.MIDI_DEVICES_CHANGED,function(e,t){i.midiDevicesList=r(t),_.find(t,{id:i.midiDevice.id})||(o=i.midiDevice=i.midiDevicesList[0])})})}]}}]),angular.module("bandlab.audio").directive("slideSwitch",function(){return{restrict:"E",replace:!0,scope:{disabled:"=",metadata:"=",onChange:"&",onChangeEnd:"&",onChangeStart:"&",params:"=",property:"@"},templateUrl:"https://www.bandlab.com/web-app/audio/partials/_slide-switch-23796e25.html",compile:function(e,t){t.onChange=t.onChange||"updateParams({ effect: effect, property: '".concat(t.property,"' })"),t.onChangeStart=t.onChangeStart||"stopPushUndo()",t.onChangeEnd=t.onChangeEnd||"resumePushUndo()"},controller:["$scope",function(e){var t;function n(t){var n=Math.floor(t*e.metadata.values.length);return Math.max(Math.min(n,e.metadata.values.length-1),0)}e.value=_.find(e.metadata.values,{slug:e.params[e.property]}),e.setValue=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{stopPropagation:angular.noop,preventDefault:angular.noop};n.stopPropagation(),n.preventDefault(),e.value=t,e.params[e.property]=t.slug},e.start=function(o){e.setValue(e.metadata.values[n(o)]),e.onChangeStart(),e.onChange(),t=angular.noop},e.move=function(t){e.setValue(e.metadata.values[n(t)]),e.onChange()},e.end=function(){t()}}]}}),angular.module("bandlab.audio").directive("virtualDrumPads",["MidiKeyboardHandler","MidiKeyMapping",function(e,t){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_virtual-drum-pads-7f1d0eb1.html",compile:function(n){var o,a;return o=angular.element(n[0].querySelector(".virtual-drum-pads")),a=_.map(t.getPadsMapping(),function(e){return'\n            <div class="virtual-drum-pad"\n                title="'.concat(e.name,'"\n                data-midi-code="').concat(e.midi,'"\n                ng-class="{ active: isActive(').concat(e.midi,"), 'not-mapped': !isMapped(").concat(e.midi,') }">\n              <span class="virtual-drum-pad-shortcut">').concat(e.shortcut,'</span>\n              <span class ="virtual-drum-pad-icon icon-drum-').concat(e.slug,'"></span>\n            </div>\n          ')}).join(""),o.append(a),{post:function(){e.changeKeymap("pads")}}},controller:"VirtualInstrumentCtrl"}}]),angular.module("bandlab.audio").directive("virtualDrums",["MidiKeyboardHandler","MidiKeyMapping",function(e,t){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_virtual-drums-27eff8da.html",link:function(n){e.changeKeymap("drums"),n.drumsMapping=t.getShortcutKeys("drums")},controller:"VirtualInstrumentCtrl"}}]),angular.module("bandlab.audio").directive("virtualPiano",["MidiKeyboardHandler","MidiKeyMapping",function(e,t){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/audio/partials/_virtual-piano-05b3e4fe.html",compile:function(n){var o;return o=_.map(t.getShortcutKeys("piano"),function(e,n){var o,a;return o=_.includes([1,3,6,8,10],n%12)?"black":"white",a=n+24,'\n            <div class="virtual-piano-'.concat(o,'"\n                data-midi-code="').concat(a,'"\n                ng-class="{ active: isActive(').concat(a,"), 'not-mapped': !isMapped(").concat(a,') }">\n              <div class="virtual-piano-musical-note">\n                <span ng-repeat="pitch in getMusicalNote(').concat(a-24,')">{{ pitch }}</span>\n              </div>\n              <span class="virtual-piano-shortcut">').concat(t.beautifyEventCode(e),"</span>\n            </div>\n          ")}).join(""),angular.element(n[0].querySelector(".virtual-piano")).append(o),{post:function(){e.changeKeymap("piano")}}},controller:"VirtualInstrumentCtrl"}}]).directive("virtualPianoMinimap",function(){return{replace:!0,restrict:"E",scope:!0,templateUrl:"https://www.bandlab.com/web-app/audio/partials/_virtual-piano-minimap-4d6a2902.html",link:function(e,t){function n(e){return"octave-".concat(e)}e.$watch("current.octave",function(e,o){var a={1:[1,2,3],2:[2,3,4],3:[3,4,5],4:[4,5,6],5:[5,6,7],6:[5,6,7]};t[0].classList.remove(n(a[o][0]),n(a[o][1]),n(a[o][2])),t[0].classList.add(n(a[e][0]),n(a[e][1]),n(a[e][2]))})}}}),angular.module("bandlab.audio").component("voiceMicrophone",{templateUrl:"https://www.bandlab.com/web-app/audio/partials/_voice-microphone-5039a5ad.html",controllerAs:"vm"}),angular.module("bandlab.audio").filter("displayInstrument",["audioSettings",function(e){return function(t,n){return _.find(e.INSTRUMENTS,{slug:t.type})[n?"icon":"name"]}}]),angular.module("bandlab.audio").filter("displayUnit",function(){return function(e,t){var n=t.min<0&&e>=0?"+":"";return angular.isDefined(t.displayMin)&&angular.isDefined(t.displayMax)&&(e=(t.displayMax-t.displayMin)/(t.max-t.min)*e-(t.displayMax-t.displayMin)/(t.max-t.min)*t.min+t.displayMin),angular.isUndefined(t.displayUnit)&&"%"===t.unit?e=(e*=100).toFixed(0):"ms"===t.displayUnit?e=(e*=1e3).toFixed(0):1===t.displayStep?e=e.toFixed(0):.1===t.displayStep?e=e.toFixed(1):.01===t.displayStep?e=e.toFixed(2):.001===t.displayStep?e=e.toFixed(3):1===t.step?e=e.toFixed(0):.1===t.step?e=e.toFixed(1):.01===t.step?e=e.toFixed(2):.001===t.step&&(e=e.toFixed(3)),"".concat(n+e," ").concat(angular.isDefined(t.displayUnit)?t.displayUnit:t.unit)}}),angular.module("bandlab.audio").filter("formatKey",function(){return function(e,t){if(!e)return"";var n=e.replace(/(♯|♭)/,"<span>$1</span>");return"short"===t?n=n.replace(" major","").replace("minor","min"):"semi"===t&&(n=n.replace("or","")),n}}),angular.module("bandlab.audio").filter("formatQuantization",function(){return function(e){return{1:"1/1".concat(" Note"),2:"1/2".concat(" Note"),4:"1/4".concat(" Note"),8:"1/8".concat(" Note"),16:"1/16".concat(" Note"),3:"1/2".concat(" Triplet"),6:"1/4".concat(" Triplet"),12:"1/8".concat(" Triplet"),24:"1/16".concat(" Triplet")}[e]||e}}),angular.module("bandlab.audio").filter("presetName",["EffectsPreset",function(e){return function(t){return t?{custom:"Custom",none:"None"}[t]||e.getBySlug(t).name:""}}]),angular.module("bandlab.audio").filter("soundTime",function(){function e(e){return e<10?"0".concat(e):e}return function(t,n){var o,a,i,r,s=t>=0;return t=Math.abs(t),o=Math.round(t%1*10),a=Math.floor(t%60),i=Math.floor(t/60),10===o&&(a++,o=0),60===a&&(i++,a=0),r="".concat(e(i),":").concat(e(a)),r=n?"".concat(r,".").concat(o):r,s?r:"-".concat(r)}}),angular.module("bandlab.audio").factory("AudioCtx",["$q",function(e){var t,n=window.AudioContext||window.webkitAudioContext;return{decodeAudioData:function(n){var o=e.defer();return t.decodeAudioData(n,function(e){var n;1===e.numberOfChannels?((n=t.createBuffer(2,e.length,t.sampleRate)).getChannelData(0).set(e.getChannelData(0)),n.getChannelData(1).set(e.getChannelData(0))):e.numberOfChannels>2?((n=t.createBuffer(2,e.length,t.sampleRate)).getChannelData(0).set(e.getChannelData(0)),n.getChannelData(1).set(e.getChannelData(1))):n=e,o.resolve(n)},function(){o.reject(new Error("Error while decoding audio data."))}),o.promise},get:_.once(function(){try{return t=new n,window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("touchdown",o),t}catch(e){}})};function o(){t.resume(),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("touchdown",o)}}]),angular.module("bandlab.audio").constant("audioEvents",{EFFECT_PARAMETER_CHANGED:"Audio:effectParameterChanged",EFFECTS_CHANGED:"Audio:effectsChanged",INPUT_CHANGED:"Audio:audioInputChanged",INPUT_DISCONNECTED:"Audio:audioInputDisconnected",MIDI_DEVICES_CHANGED:"Audio:midiDeviceChanged"}),angular.module("bandlab.audio").factory("AudioMeter",["AudioCtx","EditorHelper","InputDevice",function(e,t,n){var o=512,a={};return{getMeter:function(i,r){var s=a[i];return s?(s.init(),s):(s=function(a,i){var r,s=0;return c(),{getVolumeLevel:function(){return s},init:c,shutdown:l,source:i};function c(){r&&l(),r=e.get().createScriptProcessor(o,1,1),"in"===a?(r.name="inputMeter",n.connect(r)):i&&(i.connect(r),r.name="outputMeter"),r.connect(e.get().destination),r.onaudioprocess=function(e){s=t.calcAbsMax(e.inputBuffer.getChannelData(0))}}function l(){r&&(r.disconnect(),r.onaudioprocess=null,r=null),i&&r&&i.disconnect(r)}}(i,r),a[i]=s,s)}}}]),angular.module("bandlab.audio").factory("AudioMeterDisplay",["AudioMeter","EditorPlayer",function(e,t){return{getMeterDisplay:function(n,o){var a,i,r,s,c=o.querySelector(".volume-meter-mask"),l=(s=getComputedStyle(o),{height:parseInt(s.getPropertyValue("height")),width:parseInt(s.getPropertyValue("width"))}),u=l.width>l.height?"translateX":"translateY",d=Math.max(l.width,l.height),p=1;return{init:function(){r=e.getMeter(n,t.current.output),c.classList.remove("smooth")},stop:function(){r&&(r.shutdown(),c.style.transform=m(0),c.classList.add("smooth"))},update:function(){r&&(a=r.getVolumeLevel()>=.95,i=1-Math.sqrt(r.getVolumeLevel()),(p=i>p?p+(i-p)/15:i)<.99&&(a?o.classList.add("clipping"):o.classList.remove("clipping"),c.style.transform=m(d-p*d)))}};function m(e){return"".concat(u,"(").concat(e,"px)")}}}}]),angular.module("bandlab.audio").factory("AudioMonitoring",["AudioCtx","EditorHelper","EditorPlayer","EditorRevision","InputDevice",function(e,t,n,o,a){var i=e.get().createChannelSplitter(2),r=e.get().createChannelMerger(2),s=e.get().createChannelMerger(2);return a.connectDry(i),{switchTrackChain:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.current;if(i.disconnect(),r.disconnect(),s.disconnect(),t.isAudioTrack(o.armedTracks[1])&&o.trackMonitoring.get(o.armedTracks[1])){var a=e.getTrack(o.armedTracks[1].id);1===o.armedTracks[1].channel&&(i.connect(r,0,0),i.connect(r,0,1),r.connect(a.input)),2===o.armedTracks[1].channel&&(i.connect(r,1,0),i.connect(r,1,1),r.connect(a.input)),3===o.armedTracks[1].channel&&(i.connect(r,0,0),i.connect(r,1,1),r.connect(a.input))}if(t.isAudioTrack(o.armedTracks[2])&&o.trackMonitoring.get(o.armedTracks[2])){var c=e.getTrack(o.armedTracks[2].id);1===o.armedTracks[2].channel&&(i.connect(s,0,0),i.connect(s,0,1),s.connect(c.input)),2===o.armedTracks[2].channel&&(i.connect(s,1,0),i.connect(s,1,1),s.connect(c.input)),3===o.armedTracks[2].channel&&(i.connect(s,0,0),i.connect(s,1,1),s.connect(c.input))}}}}]),angular.module("bandlab.audio").factory("AudioReset",["AudioMonitoring","AudioState","InputDevice","InputsCollection","Metronome",function(e,t,n,o,a){return{reset:function(){e.switchTrackChain(),a.stop(),n.reset(),o.reset(),t.reset()}}}]),angular.module("bandlab.audio").constant("audioSettings",{AUDIO_PARAMETERS:{volume:{name:"volume",default:1,max:2,min:0,base:0,range:2,scale:"log"},pan:{name:"pan",default:0,max:1,min:-1,base:0,range:2,scale:"lin"}},INSTRUMENTS:[{name:"Bass",icon:"bass",kind:"audioinput",slug:"guitar-bass"},{name:"Guitar",icon:"electric-guitar",kind:"audioinput",slug:"guitar-electric"},{name:"Looper",icon:"drum-machine",kind:"audioinput",slug:"looper"},{name:"Voice/Mic",icon:"micro",kind:"audioinput",slug:"voice"},{name:"Bass",icon:"bass",kind:"bandlab-instrument",defaultOctave:1,slug:"bass"},{name:"Brass",icon:"trumpet",kind:"bandlab-instrument",defaultOctave:1,slug:"brass"},{name:"Creator Kits",icon:"origami",kind:"bandlab-instrument",slug:"creators-kit"},{name:"Drum Kits",icon:"drum",kind:"bandlab-instrument",slug:"drum-kit"},{name:"Drum Machine",icon:"drum-machine",kind:"drum-machine",slug:"drum-machine"},{name:"Drum Pads",icon:"pads",kind:"bandlab-instrument",slug:"drum-pads"},{name:"Guitars",icon:"acoustic-guitar",kind:"bandlab-instrument",defaultOctave:2,slug:"guitars"},{name:"Mallets",icon:"xylophone",kind:"bandlab-instrument",defaultOctave:2,slug:"mallets"},{name:"Percussion",icon:"bongos",kind:"bandlab-instrument",defaultOctave:2,slug:"percussion"},{name:"Piano",icon:"piano",kind:"bandlab-instrument",defaultOctave:2,slug:"piano"},{name:"Special Effects",icon:"sfx",kind:"bandlab-instrument",slug:"special-effects"},{name:"Strings",icon:"violin",kind:"bandlab-instrument",defaultOctave:2,slug:"strings"},{name:"Synth Bass",icon:"synth-bass",kind:"bandlab-instrument",defaultOctave:1,slug:"synth-bass"},{name:"Synth Keys",icon:"piano-keyboard",kind:"bandlab-instrument",defaultOctave:2,slug:"synth-keys"},{name:"Synth Leads",icon:"piano-keyboard",kind:"bandlab-instrument",defaultOctave:2,slug:"synth-leads"},{name:"Synth Pads",icon:"piano-keyboard",kind:"bandlab-instrument",defaultOctave:2,slug:"synth-pads"},{name:"Synth Piano",icon:"piano-keyboard",kind:"bandlab-instrument",defaultOctave:2,slug:"synth-piano"},{name:"Voices",icon:"sound-wave",kind:"bandlab-instrument",defaultOctave:2,slug:"voices"},{name:"Winds",icon:"saxophone",kind:"bandlab-instrument",defaultOctave:2,slug:"wind"}],METRONOME_TEMPO_MIN:40,METRONOME_TEMPO_MAX:240,METRONOME_SOUND:"Default",METRONOME_VOLUME:1,SIGNATURE_NOTES_COUNT:function(){var e,t=[];for(e=1;e<=6;e++)t.push({value:e});return t}(),SIGNATURE_NOTE_VALUE:function(){var e,t=[];for(e=1;e<=8;e*=2)t.push({value:e});return t}()}),angular.module("bandlab.audio").factory("AudioState",function(){return{isMetronomeEnabled:!1,isMidiActive:!1,previewPlayer:new Audio,previewSoundbank:null,reset:function(){_.forOwn(this,function(e,t){"boolean"==typeof e&&(this[t]=!1)}.bind(this))}}}),angular.module("bandlab.audio").factory("EffectsPreset",["$http","audioSettings",function(e,t){var n=e.get("https://www.bandlab.com/api/v7.0/effects",{cache:!0}).then(function(e){return t.INSTRUMENTS.reduce(function(t,n){var o;return t[n.slug]=(o=n.slug,_.chain(e.data.types[o]).map(function(t){return e.data.presets[t]}).unshift(a).value()),t},{all:_.map(e.data.presets,angular.identity)})}).then(function(e){return n=e});return{getAll:function(){return n.all},getByInput:function(e){var t=e.slug;return n[t]||[]},getBySlug:o,getPresets:function(){return n},isDeprecatedPreset:function(e){return"none"!==e&&"custom"!==e&&0===_.get(o(e),"packs",[]).length},isNewerPreset:function(e,t){return"".concat(e,"_v2")===t}};function o(e){return _.find(n.all||[a],{slug:e})}}]),angular.module("bandlab.audio").factory("Impresario",["$http","Modal",function(e,t){return{displayAnalyzerModal:function(e,n){var o={id:"soundAnalyzerModal",templateUrl:"",contentScope:n};switch(e){case"tempo":o.templateUrl="https://www.bandlab.com/web-app/audio/partials/_audio-analyzer-tempo-dee63117.html"}return new t(o).show(),o.id},requestAnalyze:function(t,n){return e({url:"https://www.bandlab.com/api/v2.0/analyzer/".concat(n),method:"POST",data:{sampleId:t,sampleType:"analyzed"}}).then(function(e){return e.data})}}}]),angular.module("bandlab.audio").factory("InputDevice",["$q","$rootScope","AppNotifications","AudioCtx","audioEvents","Modal",function(e,t,n,o,a,i){var s,c,l={label:"no device",name:"No Device",kind:"none"},u={audio:{mandatory:{echoCancellation:!1,googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googTypingNoiseDetection:!1},optional:[]}},d=1,p={device:navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?l:{deviceId:-1,name:"Unsupported",kind:"none"}},m=o.get().createGain(),f=o.get().createChannelSplitter(),h=o.get().createChannelMerger(),g="requestMIDIAccess"in navigator?navigator.requestMIDIAccess().then(function(e){return e.onstatechange=w,e}):e.reject(new Error("This browser does not support Web MIDI.")),v=_.once(function(){new i({templateUrl:"https://www.bandlab.com/web-app/common/partials/_microphone-error-a2f28186.html"}).show()});return m.connect(f),E(),{connect:function(e){h.connect(e)},connectDry:function(e){m.connect(e)},disconnectDry:function(e){m.disconnect(e)},getAudioDevices:y,getCurrent:function(){return p},getMidiDevices:k,reset:E,selectChannel:b,switchTo:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l;return p.device=i,function(i){return"none"===i.kind?e.resolve(o.get().createGain()):i.kind===r?y().then(function(r){return _.find(r,{deviceId:i.deviceId})?function(i){return(r=i,u.audio.optional=r.id?[{sourceId:r.id}]:[],navigator.mediaDevices.getUserMedia(u).then(function(o){return P(),s=o,o.oninactive=function(){o.normalStop||(n.addNotification({title:"Active audio device disconnected",content:"".concat(o.getAudioTracks()[0].label," has been disconnected. Please reconnect it or choose a different input device."),autoclose:5e3}),t.$broadcast(a.INPUT_DISCONNECTED))},e.resolve(o)}).catch(function(t){return e.reject(J)})).then(function(e){return o.get().createMediaStreamSource(e)});var r}(i):e.reject("Audio device not connected")}):(P(),e.resolve())}(i).then(function(e){return c&&c.disconnect(),(c=e).connect(m),b({channel:p.channel})}).catch(function(e){e===J&&v(),p.device=l,t.$applyAsync()})},testSampleRate:_.once(function(){o.get().sampleRate>48e3&&n.addNotification({title:"High sample rate detected",content:"For best performance, adjust your hardware to 44.1kHz and refresh the page.",classList:"alert"})})};function b(e){var t=e.channel,n=void 0===t?d:t;return f.disconnect(),1===n?(f.connect(h,0,0),f.connect(h,0,1)):2===n?(f.connect(h,1,0),f.connect(h,1,1)):(f.connect(h,0,0),f.connect(h,1,1)),h}function y(){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(e){return _.chain(e).filter({kind:r}).map(function(e,t){return _.assignIn(e,{id:e.deviceId,name:"Default"===e.label?"Default":e.label||"".concat("Audio Device"," #").concat(t+1)})}).sortBy(function(t){return t.name.toLowerCase().includes("bandlab")?0:"Default"===t.name?1:e.indexOf(t)+e.length}).value()}):e.reject(new Error("This browser does not support WebRTC"))}function w(e){e.port.constructor!==window.MIDIOutput&&(n.addNotification({title:"".concat(e.port.name," (").concat(e.port.manufacturer,")"),content:"Status: ".concat(e.port.state),autoclose:5e3}),k().then(function(e){t.$broadcast(a.MIDI_DEVICES_CHANGED,e)}))}function k(){return e.when(g).then(S)}function S(e){var t=e.inputs,n=[];return(void 0===t?[]:t).forEach(function(e){n.push(_.assignIn(e,{kind:"midi"}))}),n}function P(){s&&s.active&&(s.getTracks().forEach(function(e){e.stop()}),s.normalStop=!0)}function E(){P(),s={},c=null}}]),angular.module("bandlab.audio").factory("InputsCollection",["audioSettings","Soundbank",function(e,n){var o=[{name:"Select soundbank",instrumentSlug:"none"}],a={audio:_.filter(e.INSTRUMENTS,{kind:r}),"drum-machine":_.filter(e.INSTRUMENTS,{kind:c}),midi:_.filter(e.INSTRUMENTS,{kind:s})},i={},l={};return m(),n.getList().then(function(e){i=function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?Xe(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Xe(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},_.groupBy(e,"instrumentSlug"),{"drum-machine":[{name:"Drum Kits",soundbanks:_.filter(e,{instrumentSlug:"drum-kit"})},{name:"Pad Kits",soundbanks:_.filter(e,{instrumentSlug:"drum-pads"})}]}),a.midi=_.filter(a.midi,function(e){var t=e.slug;return i[t]&&i[t].length})}),{getCurrent:function(){return l},getList:u,getNoteWithOctave:function(e){return l.input.defaultOctave?e+12*(l.octave-1):e},getSoundbanks:d,reset:m,setDefaultSoundbank:function(e){var t=d(e,{excludeDeprecated:!0});e.slug===c&&(t=[].concat(He(t[0].soundbanks),He(t[1].soundbanks))),l.soundbank=t.indexOf(l.soundbank)>=0?l.soundbank:t[0]},setDrumMachine:function(e){p(e.soundbank),l.input=_.find(u("drum-machine"),{slug:e.type})},setFromAudioType:function(e){l.input=_.find(u("audio"),{slug:e}),l.soundbank=null},setFromSoundbank:p};function u(e){return a[e]||a.audio.concat(a.midi,a[c])}function d(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).excludeDeprecated;return(void 0!==t&&t?_.reject(i[e.slug],{isDeprecated:!0}):i[e.slug])||o}function p(e){var t=_.findKey(i,function(t){return _.find(t,{slug:e})})||"piano";l.input=_.find(u("midi"),{slug:t}),l.soundbank=_.find(d(l.input),{slug:e})||d(l.input)[0]}function m(){l.input={},l.octave=2,l.soundbank=o[0]}}]),angular.module("bandlab.audio").factory("Katnip",["$http","AudioCtx","Sample",function(e,t,o){if(!ze())return{};var a=Promise.all([e.get("https://www.bandlab.com/api/v7.0/effects",{cache:!0}),O("https://www.bandlab.com/web-app/common/workers/katnip-b9dc62b8c5.js"),t.get().audioWorklet.addModule("https://www.bandlab.com/web-app/common/workers/libsfaw-31388d2e8a.js"),t.get().audioWorklet.addModule("https://www.bandlab.com/web-app/common/workers/libvasynthaw-5438bc1063.js")]).then(function(e){var t,a;return t=n(e,1)[0].data,a={},_.map(t.impulseResponses,function(e,t){a[t]=function(){return o.getBuffer(e)}}),new Katnip({irFileBuffers:a,metadata:t.effects})}).then(function(e){Object.assign(a,e)});return a}]),angular.module("bandlab.audio").factory("LatencyMeter",["$q","AudioCtx","InputDevice",function(e,t,n){var o,a,i=3,r=16384;return{getFullTestDuration:c,resetTest:s,startTest:function(l){var u,d,p=4*i,m=0,f=function(){var e,n=Math.round(.003*t.get().sampleRate),o=Math.PI/(t.get().sampleRate/3e3),a=new Array(n),i=0;for(e=0;e<a.length;e++)a[e]=Math.sin(i),i+=o;return a}(),h=[],g=[],v=e.defer();return a=setTimeout(function(){s()},c()+1e3),(o=t.get().createScriptProcessor(r,1,1)).componentName="LatencyMeter",o.connect(t.get().destination),n.connect(o),o.onaudioprocess=function(e){var n=e.inputBuffer.getChannelData(0),o=e.outputBuffer.getChannelData(0);if(m>=p)clearTimeout(a),function(e,n,o){var a;angular.isUndefined(n)&&e.reject("unknown"),(a=function(e,n){var o,a,i=[],r=[],s=0;if(e.length===n.length){for(o=0;o<e.length;o++)i[o]=n[o]-e[o],r[o]=1e3*i[o]/t.get().sampleRate;_.max(r)-_.min(r)>.002*t.get().sampleRate?a={error:"unstable"}:(r.forEach(function(e){s+=e/r.length}),a=s<0?{error:"negative"}:{latency:Math.round(s)})}else 0===n.length?a={error:"silence"}:e.length<n.length?a={error:"noise"}:e.length>n.length&&(a={error:"low"});return a}(n,o)).latency?e.resolve(a.latency):a.error&&e.reject(a.error),s()}(v,g,h);else if(m%4==0){for(u=0;u<f.length;u++)o[u]=f[u];g.push((m+2)*r),l(0)}else for(u=0;u<f.length;u++)o[u]=0;for(d=0;d<n.length;d++)if(Math.abs(n[d])>.12){h.push(m*r+d),l(1);break}m++},v.promise}};function s(){clearTimeout(a),o&&(o.disconnect(),o=null)}function c(){return r/t.get().sampleRate*4e3*i}}]),angular.module("bandlab.audio").factory("LatencyProgress",function(){var e;return{draw:function(t,n){var o,a,i=Math.round(21*n);for(e=e||function(e,t,n,o){var a,i,r,s=1,c=[],l=0;Math.PI;for(a=2*(n=n||120)/5,r=function(e,t){var n,o=[];for(n=0;n<5;n++)o[n]=10*(Math.random()-.5);return o}(),c[0]=10*Math.random(),i=1;i<=18;i++)l>=n?s=-1:l<=1&&(s=1),l+=s*a,l=Math.abs(l),c.push(l);for(i=0;i<c.length;i++)c[i]+=r[i%5],c[i]=Math.min(Math.max(c[i],10*Math.random()),n);return c}(0,0,t.canvas.height),o=(t.canvas.width-2*e.length)/e.length,t.clearRect(0,0,t.canvas.width,t.canvas.height),a=0;a<e.length;a++)t.fillStyle=a<i?"rgb(220, 55, 16)":"rgb(35, 52, 71)",t.fillRect((o+2)*a,(t.canvas.height-e[a])/2,o,e[a])},getStepsAmount:function(){return 21}}}),angular.module("bandlab.audio").factory("Loop",["$filter","$http","$q","audioSettings","EditorHelper","EditorLoopsState","Me","Soundbank",function(e,t,o,a,i,r,s,c){var l=e("orderBy");return{getPayload:function(e){return{bars:e.bars,bpm:e.bpm,duration:e.duration,key:e.key,name:e.name+(e.part?" - ".concat(e.part):""),soundbank:e.soundbank,src:m(e),type:e.fileType}},getSrc:m,init:_.once(function(){return o.all([t.get(d("genres"),{cache:!0,preservePagination:!0}).then(function(e){return l(e.data.data,"name")}),t.get(d("instruments"),{cache:!0,preservePagination:!0}).then(function(e){return l(e.data.data,"name")}),p().then(u),t.get(d("packs"),{cache:!0,preservePagination:!0}).then(function(e){return _.filter(e.data.data,function(e){return e.preview=(e.preview||"").replace(/\.mp3$/,".m4a"),!e.isMobileOptimized&&(s.isBetaUser&&e.isBeta||!e.isBeta)})}).then(u),c.getList()]).then(function(e){var t=n(e,5),o=t[0],i=t[1],s=t[2],c=t[3],l=t[4];s.forEach(function(e){var t=_.find(l,{slug:e.soundbank});t&&(e.icon=_.find(a.INSTRUMENTS,{slug:t.instrumentSlug}).icon,e.soundbankName=t.name),e.fullName=e.name+(e.part?" - ".concat(e.part):"")}),r.loops=s,r.instruments=_.reject(i,function(e){return!_.find(s,function(t){return-1!==t.instrumentIds.toString().indexOf(e.id)})}),r.genres=_.reject(o,function(e){return!_.find(s,function(t){return-1!==t.genreIds.toString().indexOf(e.id)})}),r.packs=c,r.selectedType=r.selectedType||r.types[0]})})};function u(e){return i.hasMagicKeyword()&&s.isBetaUser?e:e.filter(function(e){return!e.isBeta})}function d(e){return"https://www.bandlab.com/api/v2.0/loops/".concat(e)}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.after,o=e.genres,a=void 0===o?[]:o,i=e.instruments,r=void 0===i?[]:i,c=e.loops,l=void 0===c?[]:c;return t.get(d("loops"),{cache:!0,params:{after:n,genres:a.length?a.join(","):null,instruments:r.length?r.join(","):null,limit:3e3,sortType:"name"},preservePagination:!0}).then(function(e){var t=_.filter(e.data.data,function(e){return!e.isMobileOptimized&&(s.isBetaUser&&e.isBeta||!e.isBeta)}),n=l.concat(t),o=e.data.paging.cursors.after;return o?p({after:o,genres:a,loops:n}):n})}function m(e){var t="midi"===e.fileType?"mid":"m4a";return"https://static.bandlab.com/loops-formatted/".concat(e.id,"/").concat(e.id,".").concat(t)}}]),angular.module("bandlab.audio").factory("MetronomeState",["CrossOriginWorker",function(e){return{SCHEDULE_AHEAD:.75,gainNode:{},nextDivision:0,nextDivisionTime:0,settings:{bpm:120,signature:{notesCount:4,noteValue:4}},sound:{name:""},worker:new e("https://www.bandlab.com/web-app/common/workers/metronomeworker-90b903fd2f.js")}}]).factory("Metronome",["$http","$q","AudioCtx","audioSettings","EditorHelper","MetronomeState","Sample",function(e,t,n,o,a,i,r){var s,c=[],l=0;return i.gainNode=n.get().createGain(),i.gainNode.gain.value=o.METRONOME_VOLUME,{init:function(){return e.get("https://www.bandlab.com/api/v3.0/metronome",{cache:!0}).then(function(e){c=_.sortBy(e.data.data.audioSprite,function(e){return"Default"===e.name?"1".concat(e.name):"2".concat(e.name)}),i.sound=_.find(c,{name:o.METRONOME_SOUND})||c[0],r.getBuffer(e.data.urls[r.getOptimizedAudioExtension()]).then(n.decodeAudioData).then(function(e){s=e}),t.resolve(i.worker).then(function(e){e.postMessage("start")})})},getSpriteMap:function(){return c},playWavTickAt:u,start:function(e){return i.gainNode.connect(n.get().destination),d(e),p(),t.resolve(i.worker).then(function(e){e.addEventListener("message",p)})},sync:d,stop:function(){return i.gainNode.disconnect(),t.resolve(i.worker).then(function(e){e.removeEventListener("message",p)})}};function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.get().currentTime;if(!(t<l+m())){var o=n.get().createBufferSource(),a=_.find(c,{name:i.sound.name,pitch:0===e?"Hi":"Low"});o.buffer=s,o.connect(i.gainNode),o.start(t,a.startTime),o.stop(t+a.duration),l=t}}function d(e){var t=e/a.getMeasureDuration(i.settings)+1,o=(t-Math.ceil(t))*i.settings.signature.notesCount*i.settings.signature.noteValue;i.nextDivision=Math.ceil(o),i.nextDivisionTime=n.get().currentTime+(i.nextDivision-o)*m()}function p(){for(;i.nextDivisionTime<n.get().currentTime+i.SCHEDULE_AHEAD;)e=i.nextDivision,t=i.nextDivisionTime,e%i.settings.signature.noteValue||u(e,t),i.nextDivisionTime+=m(),i.nextDivision++,i.nextDivision>=i.settings.signature.notesCount*i.settings.signature.noteValue&&(i.nextDivision=0);var e,t}function m(){return a.getNoteDuration(i.settings)/4/i.settings.signature.noteValue*4}}]),angular.module("bandlab.audio").factory("Sample",["$http","$q","AudioCtx","EditorEncoder","Me",function(e,n,o,a,i){var r={aac:["audio/x-aac","audio/aac"],flac:["audio/flac"],m4a:["audio/m4a","audio/x-m4a","audio/mp4"],mid:["audio/midi"],mp3:["audio/mpeg","audio/mp3"],mp4:["audio/mp4","video/mp4"],ogg:["audio/ogg","video/ogg"],wav:["audio/wav","audio/wave","audio/x-wav","audio/s-wav"],webm:["audio/webm"]};return{extractAudio:s,getBuffer:function(t){return e({url:t,ignoreLoadingBar:!0,responseType:"arraybuffer"}).then(function(e){return e.data})},getDownloadUrl:function(t){var n=t.type,o=t.sampleId,a=t.format,r=t.res;return e({url:"https://www.bandlab.com/api/v2.0/on-demand/".concat(n,"s/").concat(o,"?format=").concat(a,"&res=").concat(r),method:"GET",headers:{"X-Amz-Meta-User-Id":i.id,"X-Amz-Meta-Device":"","X-Amz-Meta-Source":""}}).then(function(e){return e.data.value})},getExtensionByFilename:l,getExtensionByMime:c,getJSON:function(t){return e({url:"https://www.bandlab.com/api/v2.0/uploads/".concat(t),ignoreLoadingBar:!0,data:"",headers:{"Content-Type":"application/json"}}).then(function(e){return e.data})},getOptimizedAudioExtension:function(){return""!==Modernizr.audio.ogg?"ogg":""!==Modernizr.audio.m4a?"m4a":"wav"},master:function(t){return e({url:"https://www.bandlab.com/api/v2.0/mastering",method:"POST",data:t,headers:{"X-User-Id":i.id}}).then(function(e){return _.forEach(e.data.presets,function(e){e.url="https://static.bandlab.com/mastered-formatted/".concat(e.sampleId,"/").concat(e.sampleId,".mp3")}),e.data.presets=e.data.presets.concat({sampleId:t.id,slug:"dry",name:"Unmastered",url:"revisions"===t.type?"https://static.bandlab.com/revisions-formatted/".concat(t.id,"/").concat(t.id,".mp3"):"https://static.bandlab.com/mastered-formatted/".concat(t.id,"/").concat(t.id,".mp3")}),e.data})},upload:function o(a){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:angular.noop;if(_.get(a,"blob.type","").startsWith("video/"))return s(a.blob).then(function(e){return o(function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?Qe(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Qe(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},a,{blob:e}))});var p=c(a.blob.type)||l(a.blob.name),m=n.defer();return p?_.assign(function(t,n,o,a){return e({url:"https://www.bandlab.com/api/v2.0/uploads/".concat(t,"/").concat(n,"?format=").concat(o),method:"PUT",headers:{"X-Amz-Meta-User-Id":i.id,"X-Amz-Meta-Device":"","X-Amz-Meta-Source":""},timeout:a}).then(function(e){return e.data.value})}(a.sampleType,a.sampleId,p,m.promise).then(function(t){return Object.assign(e({url:t,method:"PUT",data:a.buffer||a.blob,headers:{"Content-Type":r[p][0]},uploadEventHandlers:{progress:d},timeout:m.promise,transformRequest:[]}),{})}).catch(function(e){if(409!==e.status)return 1===e.config.timeout.$$state.status?n.reject("Cancelled"):u<=3?o(a,++u):n.reject(e)}),{cancel:function(){return m.resolve()}}):n.reject("File type not supported")}};function s(e){return Je(e).then(o.decodeAudioData).then(a.createWav)}function c(e){var t="";return _.forEach(r,function(n,o){_.includes(n,e)&&(t=o)}),t}function l(e){var t=e.split(".").pop(),n=_.keys(r);if(_.includes(n,t))return t}}]),angular.module("bandlab.audio").value("SoundbankSamples",{}).factory("Soundbank",["$http","$q","AudioCtx","EditorRevision","Sample","SoundbankSamples",function(e,t,n,o,a,i){var r=[[46,44,42],[38,37],[51,53]],s=0,c=0,l=[];return{getBank:function(e){return(e=_.find(l,{slug:e.slug})).promise?t.resolve(e.promise):"VASynth"===e.synth?(e.promise=d(e).then(function(t){return _.assignIn(e,t),e}),e.promise):(e.promise=d(e).then(function(u){return e.category=u.category,e.release=u.release,e.mutexSets=u.mutexSets||("kit"===e.category?r:[]),e.mutexSets=u.samples.reduce(function(e,t){return e.concat([[t.midiNumber]])},e.mutexSets),function(e){var r,u,d=(new Date).getTime(),p=0;return u=_.chain(o.current.tracks).map(function(e){return e.soundbank}).compact().value(),_.forEach(i,function(e,t){u.includes(t)||(_.find(l,{slug:t}).promise=null,delete i[t])}),r=e.samples.map(function(e){var t=e.urls[a.getOptimizedAudioExtension()];return p++,s++,a.getBuffer(t).then(n.decodeAudioData).then(function(t){return e.buffer=t,e.playbackRate=1,e}).catch(function(e){return null}).finally(function(){c++})}),t.all(r).finally(function(){c-=p,s-=p,ga("send","timing","Soundbank","Download Samples",(new Date).getTime()-d,e.name)})}(u)}).then(function(t){var n,o,a,r=u(t),s=r.min,c=r.max,l={};function d(e){return angular.isNumber(e.minRange)&&angular.isNumber(e.maxRange)&&o>=e.minRange&&o<=e.maxRange}function p(e){return e.midiNumber-o}for(o=s;o<=c;o++)(n=_.find(t,{midiNumber:o}))?l[o]=n:(l[o]=_.chain(t).filter(d).minBy(p).clone().value(),l[o]&&(l[o].playbackRate=(a=o-l[o].midiNumber,Math.pow(2,a/12))));return i[e.slug]=l,e}),e.promise)},getBanks:function(){return l},getJSON:d,getList:_.memoize(function(){return e.get("https://www.bandlab.com/api/v4.1/soundbanks",{cache:!0}).then(function(e){return l=e.data.soundbanks})}),getLoadingProgress:function(){return s?c/s:1},getPropertyValue:function(e,t){var n=_.find(l,{slug:e});return n?n[t]:null},getSamplesRange:u};function u(e){var t=_.minBy(e,"minRange"),n=_.minBy(e,"midiNumber"),o=_.maxBy(e,"maxRange"),a=_.maxBy(e,"midiNumber");return{min:t?Math.min(t.minRange,n.midiNumber):n.midiNumber,max:o?Math.max(o.maxRange,a.midiNumber):a.midiNumber}}function d(t){return e.get("https://www.bandlab.com/api/v4.1/soundbanks/".concat(t.slug),{cache:!0}).then(function(e){return e.data})}}]),angular.module("bandlab.band",[]),Ze.$inject=["$location","$q","$scope","$state","$timeout","Me","PlayerHistory","Post","Shout","theBand"],angular.module("bandlab.band.routes",[]).config(["$stateProvider",function(e){e.state("band",{url:"/band/{username:[a-z][0-9a-z_]{1,19}}",params:{rewriteTrackingAsync:["$stateParams","Band",function(e,t){return function(n){return t.get({id:e.username}).$promise.then(function(e){return"None"===e.role?n.replace(/^\/band\/[a-z][0-9a-z_]{1,19}(($|\/).*)/g,"/band$1"):n.replace(/^\/band\/[a-z][0-9a-z_]{1,19}(($|\/).*)/g,"/band-".concat(e.role.toLowerCase(),"$1"))})}}]},abstract:!0,template:'\n          <div class="grid-block shrink profile-header" ui-view="header"></div>\n          <div class="grid-block" ui-view="content"></div>',resolve:{theBand:["$stateParams","Band",function(e,t){return t.get({id:e.username}).$promise}]},onEnter:["Page","theBand",function(e,t){e.setMetadata({title:"".concat(t.name," | BandLab"),description:"".concat(t.about?"".concat(t.about," | "):"","Listen to music from ").concat(t.name," and follow their creative process on BandLab."),image:t.picture.s,imageHeight:"360",imageWidth:"640",objectPath:"/bands/".concat(t.id)})}],onExit:["Page",function(e){e.clearMetadata()}],controller:["$scope","$state","$stateParams","Me","theBand",function(e,t,n,o,a){e.band=a,e.$on("$invite:changed",function(){e.band.$get({id:e.band.id}).then(function(t){t.conversationId||setTimeout(function(){e.band.$get({id:e.band.id})},2e3)})}),e.$on("$band:changed",function(o,a){"update"===a.action&&n.username!==e.band.username&&t.go(t.current.name,_.assignIn(t.params,{username:e.band.username,changed:!0}),{reload:!0})}),e.$on("$band:left",function(n,a){"band.edit.members"===t.current.name?t.go("user.feed",{username:o.username}):e.band===a.band&&setTimeout(function(){t.go(".",t.params,{reload:!0})},1e3)})}]}).state("band.feed",{url:"",views:{header:{templateUrl:"https://www.bandlab.com/web-app/band/views/band-header-b16596a3.html"},content:{templateUrl:"https://www.bandlab.com/web-app/band/views/band-feed-951faaea.html",controller:Ze}}}).state("band.members",{url:"/members",views:{header:{templateUrl:"https://www.bandlab.com/web-app/band/views/band-header-b16596a3.html"},content:{templateUrl:"https://www.bandlab.com/web-app/band/views/band-members-2219118a.html",controller:["$q","$scope","theBand","Me","User",function(e,t,n,o,a){var i,r=20,s=0,c=!1;function l(){return c?e.resolve([]):((i=a.fromBand({bandId:n.id,limit:r,offset:s,accepted:!0}).$promise).then(function(e){c=0===e.length||e.length<r,s+=e.length}),i)}t.me=o,t.loadMore=function(){return t.infiniteScrollEnded?e.reject("No more results"):i=i.then(function(e){return t.infiniteScrollEnded=c,t.members=t.members||[],t.members=t.members.concat(e),l()})},l().then(t.loadMore)}]}}}).state("band.edit",{url:"/edit",params:{rewriteTracking:function(){return function(e){return e.replace(/^\/band\/[a-z][0-9a-z_]{1,19}(($|\/).*)/g,"/band$1")}}},redirectTo:function(e){return{state:"band.edit.profile",params:{username:e.params().username}}},resolve:{canEdit:["$q","theBand",function(e,t){return"Admin"===t.role||"Owner"===t.role?e.resolve(!0):e.reject({status:403})}]},views:{header:{templateUrl:"https://www.bandlab.com/web-app/band/views/band-edit-header-c9030b19.html"},content:{templateUrl:"https://www.bandlab.com/web-app/band/views/manage/band-manage-layout-f506c0a0.html",controller:["$scope","Me",function(e,t){e.me=t,e.userRole=e.band.role,e.setUserRole=function(t){e.userRole=t,e.band.role=t}}]}}}).state("band.edit.profile",{url:"/profile?changed",templateUrl:"https://www.bandlab.com/web-app/band/views/manage/band-edit-1b7df4fb.html",controller:"BandEditCtrl"}).state("band.edit.picture",{url:"/picture?changed",templateUrl:"https://www.bandlab.com/web-app/band/views/manage/band-picture-c1b9c405.html",controller:"PictureEditCtrl"}).state("band.edit.members",{url:"/members",templateUrl:"https://www.bandlab.com/web-app/band/views/manage/band-members-f24493de.html"}).state("band.edit.privacy",{url:"/privacy",templateUrl:"https://www.bandlab.com/web-app/band/views/manage/band-privacy-274d881f.html",controller:"BandEditCtrl"})}]),angular.module("bandlab.band").controller("BandCreateCtrl",["$analytics","$rootScope","$scope","$state","AppNotifications","Band",function(e,t,n,o,a,i){n.band=new i,n.$on("$file:uploadSuccess",function(e,t){n.displayPictureUpload=!1,n.band.pictureId=t.id,n.band.picture=t,n.bandForm.$setDirty()}),n.displayPictureUpload=!1,n.$on("$ngFile:fileChanged",function(){n.displayPictureUpload=!0}),n.addBand=function(){delete n.errorMessage,n.band.$save().then(function(i){t.$broadcast("createBandModal","close"),t.$broadcast("$band:changed",{action:"create",band:i}),n.createSuccess=!0,e.eventTrack("Create Band",{category:"Band"}),a.addNotification({title:"Band created",content:"Invite new members and start making music!",image:i.picture.xs,action:'\n              <div ng-click="hide()">\n                <a href="'.concat(o.href("band.edit.members",{username:i.username}),'">').concat("Manage Members","</a>\n              </div>\n            "),classList:"project",autoclose:8e3})}).catch(function(e){n.errorMessage=e.data.message})}}]),angular.module("bandlab.band").controller("BandEditCtrl",["$analytics","$rootScope","$scope","$stateParams","$timeout","Band","Me","Tag","theBand",function(e,t,n,o,a,i,r,s,c){n.changeSuccess="true"===o.changed,n.changeError=!1,n.band=angular.copy(c),s.getGenres().then(function(e){n.genres=_.map(e,function(e){return e.isSelected=_.some(c.genres,{id:e.id}),e})}),n.updateBand=function(){n.changeError=!1,n.band.location&&n.band.location.country&&"000"!==n.band.location.country.toString()?n.band.location.country="00".concat(n.band.location.country).slice(-3):n.band.location={country:null},i.update({id:c.id,name:n.band.name,username:n.band.username,about:n.band.about,isOpen:n.band.isOpen,commentCreateGroup:n.band.commentCreateGroup,genres:_.filter(n.genres,{isSelected:!0}),location:n.band.location}).$promise.then(function(o){a(function(){_.assignIn(c,o),n.changeSuccess=!0,t.$broadcast("$band:changed",{action:"update",band:c})},1e3),e.eventTrack("Update Band",{category:"Band",label:c.id})}).catch(function(){n.bandForm.$setPristine(),n.changeError=!0})}}]),angular.module("bandlab.band").controller("BandInviteCtrl",["$q","$rootScope","$scope","Band","Invite","Me","Modal",function(e,t,o,a,i,r,s){o.invite=new i,o.invite.userIds=[o.user.id],e.all([a.fromUser({userId:r.id,limit:40,role:"owner"}).$promise,a.fromUser({userId:r.id,limit:40,role:"admin"}).$promise]).then(function(e){var t=n(e,2),a=t[0],i=t[1],r=a.concat(i);return o.bands=r,r}),o.$watch("invite.bandId",function(e){e&&(o.formInviteUser.bandId.$setValidity("forbidden",!0),o.formInviteUser.bandId.$setValidity("unavailable",!0))}),o.sendInvite=function(){delete o.inviteSent,o.invite.$save({rel:"bands",id:o.invite.bandId}).then(function(){t.$broadcast("$invite:changed",{invite:o.invite}),o.inviteSent=!0,o.band=a.get({id:o.invite.bandId}),delete o.invite}).catch(function(e){403===e.status?o.formInviteUser.bandId.$setValidity("forbidden",!1):409===e.status&&o.formInviteUser.bandId.$setValidity("unavailable",!1),o.inviteSent=!1,o.formInviteUser.$setPristine()})},o.openModalCreateBand=function(){var e=o.$on("$band:changed",function(n,a){var i=a.action,r=a.band;"create"===i&&(o.bands=[r].concat(o.bands),o.invite.bandId=r.id,o.formInviteUser.$setDirty()),e(),t.destroy()}),t=new s({id:"createBandModal",templateUrl:"https://www.bandlab.com/web-app/band/partials/_band-new-39b910b2.html"});t.show()}}]),angular.module("bandlab.band").controller("BandJoinCtrl",["$rootScope","$scope","Band","Invite","Me",function(e,t,n,o,a){t.band||(t.band=n.get({id:t.bandId})),t.invite=new o,t.invite.userIds=[a.id],t.sendRequestToJoinBand=function(){delete t.errorMessage,t.invite.$save({rel:"bands",id:t.band.id}).then(function(){e.$broadcast("$band:changed",{action:"update",band:t.band}),t.requestSent=!0}).catch(function(e){t.errorMessage={201:"The user is not confirmed.",206:"You are blocked from joining this band"}[e.data.errorCode]||e.data.message,t.requestSent=!1}).finally(function(){t.band.$get&&t.band.$get({id:t.band.id})})},t.cancelRequestToJoinBand=function(n,a){delete t.errorMessage;var i=new o;i.bandId=n,i.$remove({id:a}).then(function(){e.$broadcast("$band:changed",{action:"update",band:t.band}),t.requestSent=!0}).catch(function(e){t.errorMessage=e.data.message,t.requestSent=!1}).finally(function(){t.band.$get({id:t.band.id})})}}]),angular.module("bandlab.band").controller("BandLeaveCtrl",["$analytics","$scope","$state","AppNotifications","BandActions","Me","MessageModal",function(e,t,n,o,a,i,r){function s(){var o=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).isLeaving;return a.deleteBand(t.band,o).then(function(){e.eventTrack("Delete Band",{category:"Band"}),"library.bands"!==n.current.name&&n.go("user.feed",{username:i.username})}).catch(function(e){return c(e,"Cannot delete band")})}function c(e,t){"Cancelled"!==e&&o.addNotification({title:t,content:_.get(e,"data.message")||_.get(e,"message","Unknown error"),autoclose:5e3,classList:"alert"})}t.deleteBand=s,t.leaveBand=function(){return 1===t.band.counters.members?s({isLeaving:!0}):"Owner"===t.userRole?new r({contentScope:{title:"Leave Band",message:"<p>".concat("As the owner, you’ll need to transfer ownership if you want to leave.","</p>")}}).show():a.leaveBand(t.band).then(function(){e.eventTrack("Leave Band",{category:"Band",label:t.band.id})}).catch(function(e){return c(e,"Unable to leave the band. Please try again.")})},t.userRole=t.band.role}]),angular.module("bandlab.band").controller("BandManageCtrl",["$scope","Invite","User",function(e,t,n){function o(){t.query({id:e.band.id,entity:"bands",accepted:!1,limit:50}).$promise.then(function(t){e.pendingInvitedUser=[],e.pendingInvitedExternalUser=[],t.forEach(function(t){var o;t.user?((o=new n(t.user)).invite=t,e.pendingInvitedUser.push(o)):((o=new n({email:t.email})).invite=t,e.pendingInvitedExternalUser.push(o))})})}e.$on("$invite:changed",function(){o()}),o()}]),angular.module("bandlab.band").controller("BandMembersCtrl",["$scope","BandActions","Role","User",function(e,t,n,o){function a(){o.fromBand({bandId:e.band.id,limit:40,accepted:!0}).$promise.then(function(t){e.members=i(t)})}function i(e){return _.sortBy(e,function(e){return"Owner"===e.role?"1".concat(e.name):"Admin"===e.role?"2".concat(e.name):"3".concat(e.name)})}e.removeMember=function(n){t.removeMember(e.band,n).then(function(){_.remove(e.members,function(e){return e.id===n.id}),e.band.counters.members-=1}).catch(a)},e.updateRole=function(o,r){if("Owner"===r)return t.assignOwnership(e.band,o).then(function(){_.find(e.members,{role:"Owner"}).role="Admin","Owner"===e.band.role&&e.setUserRole("Admin"),e.members=i(e.members)}).catch(a);n.setUserRole({bandId:e.band.id,userId:o.id,role:r}).then(function(){o.role=r}).catch(function(e){a()})},e.$on("$invite:changed",a),a()}]),angular.module("bandlab.band").component("bandCard",{bindings:{band:"="},templateUrl:"https://www.bandlab.com/web-app/band/partials/_band-card-e5a0f75d.html",controllerAs:"vm"}),angular.module("bandlab.band").component("bandProfilePopover",{bindings:{band:"<"},template:'\n      <div class="popover-content">\n        <band-tile band="vm.band" class="collapse"></band-tile>\n      </div>\n    ',controllerAs:"vm"}),angular.module("bandlab.band").component("bandTile",{bindings:{band:"="},transclude:{actions:"?bandTileActions"},templateUrl:"https://www.bandlab.com/web-app/band/partials/_band-tile-e359107b.html",controllerAs:"vm",controller:["$scope",function(e){var t=this;e.$on("$band:changed",function(e,n){var o=n.action,a=n.band;"update"===o&&t.band&&a.id===t.band.id&&_.assignIn(t.band,a)})}]}),angular.module("bandlab.band").component("bandTileMembers",{bindings:{band:"="},templateUrl:"https://www.bandlab.com/web-app/band/partials/_band-tile-members-f1de4a78.html",controller:["User",function(e){var t=this;t.getMembers=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fromBand(_.assign({bandId:t.band.id,limit:50,accepted:!0},n)).$promise}}],controllerAs:"vm"}),angular.module("bandlab.band").component("bandTileSmall",{bindings:{band:"="},templateUrl:"https://www.bandlab.com/web-app/band/partials/_band-tile-small-f3041a85.html",controllerAs:"vm"}),angular.module("bandlab.band").factory("Band",["$resource",function(e){var t="https://www.bandlab.com/api/v1.3/".concat("bands");return e(t,{},{delete:{method:"DELETE",params:{id:"@id"},url:"".concat(t,"/:id")},fromUser:{method:"GET",isArray:!0,params:{userId:"",limit:10,offset:0},url:"https://www.bandlab.com/api/v1.3/users/:userId/".concat("bands")},get:{method:"GET",params:{id:"@id"},url:"".concat(t,"/:id"),transformResponse:function(e){return localStorage.superchat?((e=JSON.parse(e)).conversationId=e.id,e):JSON.parse(e)}},query:{method:"GET",cache:!0,isArray:!0,params:{limit:10,offset:0}},save:{method:"POST",url:t},saveToSchool:{method:"POST",params:{schoolId:"@schoolId"},url:"https://www.bandlab.com/api/v1.3/schools/:schoolId/classrooms"},update:{method:"PATCH",params:{id:"@id"},url:"".concat(t,"/:id")}})}]),angular.module("bandlab.band").factory("BandActions",["$q","$rootScope","authService","ConfirmModal","Me","Role",function(e,t,n,o,a,i){return{assignOwnership:function(t,n){return e(function(e,a){return new o({confirmLabel:"Assign",contentScope:{title:"Transfer Ownership",message:"<p>".concat("Assign ownership to ".concat(n.name,"?"),"</p>")},onCancel:a,onConfirm:function(){i.setUserRole({bandId:t.id,userId:n.id,role:"Owner"}).then(function(t){n.role=t.role,e(n)}).catch(a)}}).show()})},deleteBand:function(a,i){return e(function(e,r){return new o({confirmLabel:"Delete",contentScope:{title:i?"Leave Band":"Delete Band",message:'\n            <div class="text-left">\n              '.concat(i?"<p>".concat("You’re the only member of this band. If you leave, this band will be deleted.","</p>"):"","\n              <p>").concat("Deleting a band cannot be undone. By doing so:","</p>\n              <ul>\n                <li>").concat("You will lose access to any project saved by the band.","</li>\n                <li>").concat("All band members will no longer be in the band.","</li>\n                <li>").concat("All band members will lose access to any existing projects owned by the band.","</li>\n              </ul>\n              <p>").concat("Are you sure you want to delete ".concat("<strong>".concat(a.name,"</strong>"),"?"),"</p>\n            </div>\n          ")},onCancel:function(){return r("Cancelled")},onConfirm:function(){t.$broadcast("$band:changed",{action:"mark-deleted",band:a}),a.$delete().then(n.refreshMe).then(function(){t.$broadcast("$band:changed",{action:"delete",band:a}),e(a)}).catch(function(e){t.$broadcast("$band:changed",{action:"unmark-deleted",band:a}),r(e)})}}).show()})},leaveBand:function(n){return e(function(e,r){return new o({confirmLabel:"Leave",contentScope:{title:"Leave Band",message:"<p>".concat("Leave this band?","</p>")},onCancel:function(){return r("Cancelled")},onConfirm:function(){t.$broadcast("$band:changed",{action:"mark-deleted",band:n}),i.removeUserRole({bandId:n.id,userId:a.id}).then(function(){t.$broadcast("$band:left",{band:n}),e(n)}).catch(function(e){t.$broadcast("$band:changed",{action:"unmark-deleted",band:n}),r(e)})}}).show()})},removeMember:function(t,n){return e(function(e,a){return new o({confirmLabel:"Remove",contentScope:{title:"Remove Member",message:"<p>".concat("Remove this member from your band?","</p>")},onCancel:a,onConfirm:function(){i.removeUserRole({bandId:t.id,userId:n.id}).then(e).catch(a)}}).show()})}}}]),angular.module("bandlab.banner",[]),angular.module("bandlab.banner").directive("banner",["$compile","$templateRequest","Banner",function(e,t,n){return{restrict:"E",compile:function(){return{pre:function(o,a,i){var r=n.getBanner(i.bannerId);r&&t(r.partialUrl).then(function(t){a.append(e(t)(o))})},post:angular.noop}}}}]),angular.module("bandlab.banner").directive("bannerRandom",function(){return{restrict:"E",compile:function(e){var t=Math.floor(Math.random()*e.find("banner").length+1);e.find("banner:not(:nth-child(".concat(t,"))")).remove()}}}),angular.module("bandlab.banner").directive("modalDownloadApps",["$cookies","$transitions","ClientDevice","Modal",function(e,t,n,o){return{restrict:"E",link:function(a,i,r){function s(){new o({id:"modalDownloadApps",templateUrl:"https://www.bandlab.com/web-app/banner/partials/_promote-apps-3ea1803e.html",onDestroy:function(){var t=new Date;t.setDate(t.getDate()+1),e.put("modalDownloadAppsSeen","true",{expires:t}),i.remove()}}).show()}if("true"===r.force&&(n.isAndroid||n.isiOs))return a.mobileOS=n.isAndroid?"Android":"iOS",void s();var c,l=new Date;if(l.setDate(l.getDate()+1),!e.get("hadFirstVisit"))return e.put("hadFirstVisit","true",{expires:l}),i.remove();c=t.onSuccess({},function(t){var o=t.to();if(c(),"landing"!==o.name)return i.remove();!n.isAndroid&&!n.isiOs||e.get("modalDownloadAppsSeen")?i.remove():(a.mobileOS=n.isAndroid?"Android":"iOS",s())})}}}]),angular.module("bandlab.banner").directive("modalDownloadAppsSmall",["$cookies","$state","$timeout","ClientDevice",function(e,t,n,o){return{restrict:"E",templateUrl:"https://www.bandlab.com/web-app/banner/partials/_mobile-apps-small-3a41e2d8.html",link:function(a){o.isMobile&&(a.closeModal=function(){var t=new Date;t.setHours(t.getHours()+1),e.put("modalDownloadAppsSeen","true",{expires:t}),a.isShown=!1},a.checkCurrentState=function(){t.current.name.match(/user\./)&&!e.get("modalDownloadAppsSeen")&&(a.isShown=!0,o.isAndroid?a.downloadUrl="https://play.google.com/store/apps/details?id=com.bandlab.bandlab&referrer=utm_campaign%3Dpopup_banner%26utm_source%3Duser_page":a.downloadUrl="https://itunes.apple.com/app/apple-store/id968585775?pt=117214159&ct=popu_banner_user&mt=8"),!t.current.name.match(/post/)&&!t.current.name.match(/userSong/)||e.get("modalDownloadAppsSeen")||(a.isShown=!0,o.isAndroid?a.downloadUrl="https://play.google.com/store/apps/details?id=com.bandlab.bandlab&referrer=utm_campaign%3Dpopup_banner%26utm_source%3Dpost_page":a.downloadUrl="https://itunes.apple.com/app/apple-store/id968585775?pt=117214159&ct=popup_banner_post&mt=8")},n(function(){a.checkCurrentState()},1e3),a.$on("$locationChangeStart",a.checkCurrentState))}}}]),angular.module("bandlab.banner").factory("Banner",function(){var e={"mobile-apps":{startDate:new Date("2015-08-01"),endDate:"",partialUrl:"https://www.bandlab.com/web-app/banner/partials/_mobile-apps-4c91af32.html"},store:{startDate:new Date("2019-01-22"),endDate:"",partialUrl:"https://www.bandlab.com/web-app/banner/partials/_store-ec18cc5d.html"}};return{getBanner:function(t){var n=e[t],o=new Date;if((""===n.startDate||n.startDate<=o)&&(""===n.endDate||n.endDate>=o))return n},getList:function(){return e}}}),angular.module("bandlab.chat",[]),angular.module("bandlab.chat.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("chat",{url:"/chat",templateUrl:"https://www.bandlab.com/web-app/chat/views/chat-layout-87dc7741.html",resolve:{templates:["$templateCache","$templateRequest","$q",function(e,t,n){return n.all([t("https://www.bandlab.com/web-app/chat/partials/_conversation-8360026d.html"),t("https://www.bandlab.com/web-app/chat/partials/_conversation-contacts-62cddf8f.html"),t("https://www.bandlab.com/web-app/chat/partials/_conversation-input-a145afb2.html"),t("https://www.bandlab.com/web-app/chat/partials/_conversation-new-b21d9ac2.html")]).then(function(t){t.forEach(e.put)}).catch(function(){})}],lastConversation:["Chat",function(e){return e.authenticate().then(function(){return e.getConversations(1)}).then(function(e){return n(e,1)[0]})}]},controller:["$filter","$q","$scope","$state","Chat","ChatCache","ChatHelper","lastConversation",function(e,t,n,o,a,i,r,s){var c,l=t.resolve();n.contactsDisplayed=!1,n.isLeftColVisibleForSmallScreens=!1,n.chatCache=i,n.loadMore=function(){if(n.infiniteScrollEnded)return t.resolve([]);i.conversations.length&&(c=localStorage.superchat?i.after:i.conversations[i.conversations.length-1].uuid),l=l.then(function(){return a.getConversations(50,c)});var e=i.conversations.length;return l.then(function(t){n.infiniteScrollEnded=t.length<48||e===t.length}),l},n.loadMore(),"chat"===o.current.name&&(s?o.go("chat.conversation",{id:s.uuid}):o.go("chat.new")),n.$on("$conversation:create",function(e,t){_.find(i.conversations,{id:t.id})||i.conversations.unshift(t),o.go("^.conversation",{id:t.uuid})}),n.$on("$conversation:leave",function(){d()});var u=_.debounce(function(e){a.getOneConversation(e.conversation.uuid).then(function(t){var n=_.find(i.conversations,{id:e.conversation.id});n?(n.lastMessage=angular.copy(t.lastMessage),-1===document.location.pathname.indexOf(n.uuid)&&(n.unreadMessageCount=t.unreadMessageCount)):i.conversations.unshift(t)})},5e3,{trailing:!0,maxWait:5e3});function d(){i.conversations[0]?o.go("chat.conversation",{id:i.conversations[0].uuid},{location:"replace"}):o.go("chat.new",{},{location:"replace"})}n.$on("$message:new",function(e,t){if(!localStorage.superchat)return u(t);var n=_.find(i.conversations,{id:t.conversation.id});n?(n.lastMessage=t,n.date=t.sentAt,-1===document.location.pathname.indexOf(n.uuid)&&n.unreadMessageCount++):u(t)}),n.$on("$band:left",function(e,t){var n=t.band;_.remove(i.conversations,function(e){return e.uuid===n.conversationId}),_.remove(i.conversations,function(e){return e.metadata.id===n.id}),d()}),n.$watch("searchConversation",function(t){!n.infiniteScrollEnded&&t&&function t(){e("filter")(i.conversations,{keywords:n.searchConversation}).length>50||n.infiniteScrollEnded||l.then(function(){return n.loadMore()}).then(function(){return t()})}()})}]}).state("chat.new",{url:"/new",templateUrl:"https://www.bandlab.com/web-app/chat/partials/_conversation-new-b21d9ac2.html",controller:["$scope",function(e){e.$parent.contactsDisplayed=!0}]}).state("chat.conversation",{url:"/{id:[a-zA-Z0-9-_]+}",params:{rewriteTracking:function(){return function(){return"/chat/conversation"}}},template:'<conversation conversation-id="conversationId"></conversation>',controller:["$scope","$stateParams",function(e,t){e.conversationId=t.id,e.$parent.contactsDisplayed=!1,e.$parent.isLeftColVisibleForSmallScreens=!1}]})}]),angular.module("bandlab.chat").run(["$rootScope","Chat","ChatCache","FloatingChat",function(e,t,n,o){var a=_.debounce(function(){t.getUnreadMessageCount()},5e3,{leading:!0,trailing:!0,maxWait:5e3});e.$on("$chat:authenticated",a),e.$on("$message:new",t.updateUnreadMessageCount),e.$on("$message:read",t.updateUnreadMessageCount),e.$on("$conversation:messagesRead",function(e,o){_.find(n.conversations,{id:o.id}).unreadMessageCount=o.unreadMessageCount,t.updateUnreadMessageCount()}),e.$on("$conversation:leave",function(e,t){var a=_.findIndex(n.conversations,{id:t.id});a>=0&&n.conversations.splice(a,1),o.activeConversations[0]&&o.activeConversations[0].id===t.id&&(o.activeConversations=[])})}]),angular.module("bandlab.chat").controller("ConversationListCtrl",["$scope","Chat","ChatCache",function(e,t,n){return n.conversations&&n.conversations.length>1&&(e.chatCache=n),t.authenticate().then(function(){return t.getConversations(15)}).then(function(){e.chatCache=n})}]),angular.module("bandlab.chat").directive("conversation",function(){return{restrict:"E",templateUrl:"https://www.bandlab.com/web-app/chat/partials/_conversation-8360026d.html",scope:{conversationId:"=conversationId"},link:function(e,t){var n,o,a=t[0].querySelector(".conversation-body"),i=t[0].querySelector(".conversation-message-list");function r(){e.oldestMessageReached&&a.removeEventListener("scroll",r),a.clientHeight>i.clientHeight&&e.loadOlderMessages(),!e.isLoadingMoreMessages&&n>a.scrollTop&&0===a.scrollTop&&(o=t[0].querySelector(".conversation-message-container"),e.loadOlderMessages().then(function(){setTimeout(function(){requestAnimationFrame(function(){a.scrollTop=o.getBoundingClientRect().top-a.getBoundingClientRect().top})},32)})),n=a.scrollTop}function s(){var e=a.scrollHeight-a.offsetHeight-a.scrollTop;Math.abs(e)<20&&(a.scrollTop=a.scrollHeight)}e.scrollToBottom=function(){a.scrollTop=a.scrollHeight},e.initBodyLayout=function(){a&&requestAnimationFrame(function(){a.style.overflowY="scroll",a.style.visibility="visible",a.scrollTop=a.scrollHeight,r(),a.addEventListener("scroll",r)})},e.$on("elastic:resize",function(){setTimeout(s,32)})},controller:["$injector","$q","$scope","$timeout","ConfirmModal","Chat","ChatCache","ChatHelper","Me",function(e,t,n,o,a,i,r,s,c){var l,u,d,p=localStorage.superchat?50:16;n.oldestMessageReached=!1,l=(new Date).getTime(),i.getOneConversation(n.conversationId).then(function(e){return s.addOneConversationData(e),n.conversation=e,ga("send","timing","Chat","Get Conversation",(new Date).getTime()-l),n.conversation}).then(function(e){return i.getMessages(e,null,p)}).then(function(e){var t,a;e.length<p&&(n.oldestMessageReached=!0),n.messages=e,a=o(function(){n.initBodyLayout(),i.markAllAsRead(n.conversation).then(function(){n.conversation.unreadMessageCount=0,n.$emit("$conversation:messagesRead",n.conversation)})},300),n.$on("$message:new",function(e,a){a.sentAt=a.sentAt||a.createdOn,a.conversation.id!==n.conversation.id||_.find(n.messages,{id:a.id})||(n.messages[0]&&(new Date(n.messages[0].sentAt).getDate()!==new Date(a.sentAt).getDate()&&(a.isNewDate=!0),a.isNewDate||n.messages[0].sender.userId!==a.sender.userId||new Date(a.sentAt).getTime()-new Date(n.messages[0].sentAt).getTime()<9e5&&(a.isNested=!0)),i.setOneMessageAttachments(a),n.conversation.hasBand||(_.forEach(n.messages,function(e){e.status&&(e.status="")}),a.sender.userId===c.id&&(a.status="Sent")),n.messages=_.orderBy([].concat(He(n.messages),[a]),function(e){return new Date(e.sentAt).getTime()},["desc"]),o(n.scrollToBottom,50,!1),t&&(o.cancel(t),delete n.userTyping),a.isUnread&&i.markAsRead(a,n.conversation).then(function(){n.conversation.unreadMessageCount=0,n.$emit("$message:read",n.conversation)}))}),n.$on("$message:typing",function(e,a){a.conversationId===n.conversation.id&&(t&&o.cancel(t),n.userTyping=a.user.name,t=o(function(){delete n.userTyping},2e3))}),n.conversation.hasBand||n.$on("$message:status",function(e,t){var o=_.find(n.messages,{id:t.messageId});o&&o.sender.userId===c.id&&(o.status=t.status,n.$digest())}),n.$on("$message:delete",function(e,t){var o=_.findIndex(n.messages,{id:t.messageId});o<0||(!n.messages[o].isNested&&n.messages[o-1]&&(n.messages[o-1].isNested=!1),n.messages.splice(o,1),n.$applyAsync())}),n.$on("$destroy",function(){o.cancel(t),o.cancel(a)}),n.messages.length>0&&(u=i.getMessages(n.conversation,n.messages[n.messages.length-1].uuid,p))}).catch(function(e){!e||404!==e.status&&400!==e.status||_.remove(r.conversations,function(e){return e.uuid===n.conversationId})}),n.loadOlderMessages=function(){return n.oldestMessageReached?t.reject("No more results"):(n.isLoadingMoreMessages=!0,u=u.then(function(e){return n.oldestMessageReached=d,e.length<p&&(d=!0),n.messages=n.messages.concat(e),i.getMessages(n.conversation,n.messages[n.messages.length-1].uuid,p)}).finally(function(){n.isLoadingMoreMessages=!1}))},n.deleteMessage=function(e){return new a({confirmLabel:"Delete",contentScope:{title:"Delete Message?",message:"<p>".concat("You won’t be able to undo this action.","</p>")},onConfirm:function(){i.deleteMessage(n.conversation,e)}}).show()},n.canDelete=function(e){return e.sender.userId===c.id}}]}}),angular.module("bandlab.chat").directive("conversationContacts",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/chat/partials/_conversation-contacts-62cddf8f.html",link:function(e,t){var n=t[0].querySelector(".conversation-search-input");function o(o){if(27===o.keyCode)o.target!==n?(e.contactsDisplayed=!1,e.$apply()):n.blur();else if(38===o.keyCode)a("previous");else if(40===o.keyCode)a("next");else if(13===o.keyCode){var i=t[0].querySelector(".conversation-tile.active");i&&i.click()}}function a(e){var n=t[0].querySelector(".conversation-tile.active"),o=t[0].querySelectorAll(".conversation-tile-container");if(o.length)if(n){var a=Array.from(o).indexOf(n.parentNode);n.classList.remove("active"),"next"===e?a+1===o.length?o[0].querySelector(".conversation-tile").classList.add("active"):o[a+1].querySelector(".conversation-tile").classList.add("active"):"previous"===e&&(a-1<0?o[o.length-1].querySelector(".conversation-tile").classList.add("active"):o[a-1].querySelector(".conversation-tile").classList.add("active"))}else"next"===e?o[0].querySelector(".conversation-tile").classList.add("active"):"previous"===e&&o[o.length-1].querySelector(".conversation-tile").classList.add("active")}n.addEventListener("keydown",function(e){[27,38,40,13].indexOf(e.keyCode)>-1&&e.preventDefault()}),e.$watch("contactsDisplayed",function(e){!0===e?(t[0].querySelector(".conversation-contacts-list").scrollTop=0,setTimeout(function(){n.focus()},100),window.addEventListener("keyup",o)):(setTimeout(function(){n.blur()},100),angular.element(t[0].querySelector(".conversation-tile.active")).removeClass("active"),window.removeEventListener("keyup",o))}),e.$on("$destroy",function(){window.removeEventListener("keyup",o)})},controller:["$analytics","$scope","Chat","ChatCache","ChatHelper",function(e,t,n,o,a){t.startConversation=function(o){t.contactsDisplayed=!1,n.startConversation(o.id).then(function(n){a.addOneConversationData(n),t.$emit("$conversation:create",n),e.eventTrack("Start Conversation",{category:"Chat",label:"text/plain"})}).catch(angular.noop)},o.getContacts().then(function(e){t.contacts=e})}]}}),angular.module("bandlab.chat").directive("conversationInput",["$timeout","ChatHelper",function(e,t){return{restrict:"E",templateUrl:"https://www.bandlab.com/web-app/chat/partials/_conversation-input-a145afb2.html",link:function(n,o){var a=angular.element(o[0].querySelector(".conversation-input-textarea"));t.resetMessageAttachmentsCache(),a.on("keydown",function(e){13===e.which&&(e.shiftKey||!n.messageForm.$valid||n.messageForm.$submitted||(e.preventDefault(),n.messageForm.$setSubmitted(),n.submitMessageForm()))}),a.on("keyup",function(e){13===e.which&&a.prop("selectionStart")===a.val().length&&setTimeout(function(){a[0].scrollTop=1e4},10),a.val().length&&n.messageBody?t.getMessageAttachments(n.messageBody).then(function(e){n.messageAttachments=e}):27===e.which&&(n.messageAttachments=[],n.$digest())}),n.focusInput=function(){return e(function(){a[0].focus()},100)},n.$on("$chat:fillConversationInput",function(e,t){n.messageBody=t.message,n.focusInput().then(function(){return a[0].select()})}),n.$on("$destroy",function(){t.resetMessageAttachmentsCache()})},controller:["$analytics","$scope","AppNotifications","Chat","ChatHelper","Me",function(e,t,n,o,a,i){t.getAttachmentPreview=function(e){switch(e.type){case"Band":case"Collection":case"Community":case"User":return e.object.picture.s;case"Post":return _.get(e,"object.image.picture.s")||_.get(e,"object.video.picture.url")||_.get(e,"object.link.image");case"Revision":return e.object.song.picture.s}},t.hasAttachments=function(){return _.find(t.messageAttachments,function(e){return"hide"!==e.type})},t.messageAttachments=[],t.removeAttachment=function(e){t.messageAttachments[e].type="hide"},t.submitMessageForm=function(){var r=[{body:t.messageBody,mimeType:"text/plain"}];return t.messageAttachments.length&&t.messageAttachments.forEach(function(e){if("hide"!==e.type)try{var t=a.getSharableAttachment(e);t&&r.push({body:JSON.stringify(t),mimeType:"application/json"})}catch(e){}}),t.messageBody="",t.messageAttachments=[],t.messageForm.$setPristine(),t.focusInput(),o.sendMessage(i.name,t.conversation,r).then(function(n){return t.$broadcast("elastic:adjust"),e.eventTrack("Send Message",{category:"Chat",label:"text/plain"}),n}).catch(function(e){n.addNotification({title:"Unable to send message",content:404===_.get(e,"status")?"Unable to load conversation.":"Something went wrong. Please try again later.",classList:"alert",autoclose:5e3})})}}]}}]),angular.module("bandlab.chat").directive("conversationList",["$state",function(e){return{restrict:"C",link:function(t,n){var o=n[0];function a(e){var t=n[0].querySelector(".conversation-tile.active")||Array.from(n[0].querySelectorAll(".conversation-tile")).shift();!function(e){var t=e&&e.querySelector(".conversation-tile");if(e&&t){var n=e.getBoundingClientRect(),a=o.getBoundingClientRect();n.top<a.top?o.scrollTop-=a.top-n.top:n.bottom>a.bottom&&(o.scrollTop+=n.bottom-a.bottom),t.click()}}("next"===e?t.parentElement.nextElementSibling:t.parentElement.previousElementSibling)}function i(e){t.contactsDisplayed||-1!==["INPUT","TEXTAREA"].indexOf(e.target.nodeName)&&""!==e.target.value||(38===e.keyCode?a("previous"):40===e.keyCode&&a("next"))}t.openConversation=function(t){e.go("chat.conversation",{id:t.uuid})},window.addEventListener("keyup",i),t.$on("$destroy",function(){window.removeEventListener("keyup",i)})}}}]),angular.module("bandlab.chat").component("conversationTile",{bindings:{conversation:"=",onClick:"&"},templateUrl:"https://www.bandlab.com/web-app/chat/partials/_conversation-tile-6e4353be.html",controller:["$rootScope","Chat","ConfirmModal",function(e,t,n){var o=this;o.deleteConversation=function(){return new n({confirmLabel:"Delete",contentScope:{title:"Delete Conversation",message:"<p>".concat("You won’t be able to undo this action.","</p>")},onConfirm:function(){if(localStorage.superchat)return t._deleteConversation(o.conversation);t.deleteResource(o.conversation.url,{mode:"my_devices",leave:!1}).then(function(){e.$broadcast("$conversation:leave",o.conversation)})}}).show()},o.state=e.state}],controllerAs:"vm"}),angular.module("bandlab.chat").value("FloatingChat",{activeConversations:[]}).directive("floatingChat",["ClientDevice","FloatingChat",function(e,t){return{restrict:"A",scope:!0,link:function(n,o){if(e.isMobile)return o.remove();n.floatingChat=t,n.$on("$band:left",function(e,n){var o=n.band;_.remove(t.activeConversations,function(e){return e.uuid===o.conversationId}),_.remove(t.activeConversations,function(e){return e.metadata.id===o.id})})}}}]).directive("floatingConversation",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/chat/partials/_floating-conversation-2a55f01d.html",controller:["$scope","FloatingChat",function(e,t){e.closeConversation=function(){t.activeConversations=[]}}]}}),angular.module("bandlab.chat").directive("projectConversation",["$timeout",function(e){return{restrict:"E",templateUrl:"https://www.bandlab.com/web-app/chat/partials/_project-conversation-230d4a5e.html",scope:{conversation:"=",status:"="},link:function(t,n){var o=n[0].querySelector(".conversation-body");o.style.visibility="hidden",t.$watch("conversation.messages.length",function(){e(function(){o.style.visibility="",o.scrollTop=999999})})}}}]).directive("projectConversationInput",["$timeout",function(e){return{restrict:"E",templateUrl:"https://www.bandlab.com/web-app/chat/partials/_conversation-input-a145afb2.html",link:function(t,n){var o=angular.element(n[0].querySelector(".conversation-input-textarea"));o.on("keydown",function(e){13===e.which&&(e.shiftKey||!t.messageForm.$valid||t.messageForm.$submitted||(e.preventDefault(),t.messageForm.$setSubmitted(),t.submitMessageForm()))}),t.focusInput=function(){return e(function(){o[0].focus()},100)},t.$on("$chat:fillConversationInput",function(e,n){t.messageBody=n.message,t.focusInput().then(function(){return o[0].select()})})},controller:["$scope","EditorRevision","SignalChat",function(e,t,n){e.submitMessageForm=function(){return n.sendMessage({content:e.messageBody,projectId:t.current.song.id}).then(function(t){return e.messageBody="",e.messageForm.$setPristine(),e.focusInput(),e.$broadcast("elastic:adjust"),t})}}]}}]),angular.module("bandlab.chat").component("shareAsMessage",{bindings:{suggestedUsers:"<",message:"<",attachment:"="},template:'\n      <form name="formSendMessage" novalidate ng-submit="formSendMessage.$valid && vm.submitForm(formSendMessage)">\n        <div class="form-field">\n          <label>'.concat("To:",'</label>\n          <select-multiple-users allow-emails="false" users="vm.users" suggested-users="vm.suggestedUsers"></select-multiple-users>\n        </div>\n        <div class="form-field">\n          <div class="textarea-emoji-wrapper conversation-input-textarea-wrapper">\n            <textarea\n              class="conversation-input-textarea no-validate"\n              name="messageBody"\n              autofocus\n              style="margin-bottom: 16px"\n              msd-elastic\n              ng-disabled="formSendMessage.$submitted"\n              ng-maxlength="2048"\n              ng-model="vm.messageBody"\n              placeholder="').concat("Type a message",'"\n              spellcheck="true"\n              role="textbox"\n              aria-multiline="true"\n              aria-label="').concat("Type a message",'">\n            </textarea>\n\n            <emoji-picker></emoji-picker>\n          </div>\n\n          <div class="field-error" ng-show="formSendMessage.messageBody.$error.maxlength">\n            ').concat("Please use maximum ".concat("2048"," characters."),'\n          </div>\n        </div>\n        <div class="post-card-attachment-wrapper">\n          <post-attachment post="{ attachment: vm.attachment }"></post-attachment>\n        </div>\n        <div class="form-field-submit">\n          <button type="submit" class="scs ctrd" ng-disabled="formSendMessage.$submitted || !vm.users.length">\n            ').concat("Send","\n          </button>\n        </div>\n      </form>\n    "),controller:["$q","$rootScope","$timeout","AppNotifications","Chat","ChatHelper","Me",function(e,t,n,o,a,i,r){var s=this;s.submitForm=function(n){a.authenticate().then(function(){var t=_.chain(s.users).map(function(e){return a.createConversation(e.id).then(function(e){return t={conversation:e,messageBody:s.messageBody||"",attachment:s.attachment},n=[{body:t.messageBody,mimeType:"text/plain"}],(o=t.attachment?i.getSharableAttachment(t.attachment):null)&&n.push({body:JSON.stringify(o),mimeType:"application/json"}),a.sendMessage(r.name,t.conversation,n);var t,n,o})}).value();return e.all(t)}).then(function(){o.addNotification({content:i18n(et()),autoclose:3e3}),t.$broadcast("messageModal","close")}).catch(function(e){n.$setPristine();var t=_.get(e,"data.message")||e.message,a=_.get(e,"data.code");o.addNotification({title:"Unable to send message",content:105===a?"Your email has <strong>not</strong> been confirmed.":t,classList:"alert",autoclose:5e3})})},s.users=[],s.$onInit=function(){s.messageBody=s.message||"",n(function(){return t.$broadcast("elastic:adjust")},100)}}],controllerAs:"vm"}),angular.module("bandlab.chat").directive("talkTo",["$rootScope","appActions","authService","Chat","Me",function(e,t,n,o,a){return{restrict:"A",link:function(e,i,r){i[0].addEventListener("click",function(e){if(t.checkAllowed("talkTo"))return _.get(a,"permissions.canCreateConversations")?void o.startConversation(r.talkTo,r.talkToType):(n.displayConfirmationEmailError(),void e.preventDefault());e.preventDefault()})}}}]),angular.module("bandlab.chat").factory("Chat",["$cookies","$http","$injector","$q","$rootScope","$state","AppNotifications","Band","ChatCache","ChatHelper","ClientDevice","FloatingChat","Me","User",function(e,t,o,a,i,r,s,c,l,u,d,p,m,f){var h={},g=["Image","Video"],v=["Band","Collection","Community","Post","Revision","User"],b={config:{serverUrl:"https://api.layer.com",appId:"e281bcaa-6687-11e5-98ef-8f2e830272e8"},headers:{Accept:"application/vnd.layer+json; version=2.0",Authorization:"","Content-Type":"application/json"},transformResponse:[].concat(He(t.defaults.transformResponse),[u.camelifyLayerResponse])};return{authenticate:y,createConversation:S,deleteResource:O,deleteMessage:function(e,t){return localStorage.superchat?x(e,t):O("".concat(e.url,"/messages/").concat(t.uuid),{mode:"all_participants"})},destroySession:function(){e.get("layerSessionToken")&&e.remove("layerSessionToken")},getConversations:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"last_message";return localStorage.superchat?P(e,n):t({url:"".concat(b.config.serverUrl,"/conversations"),method:"GET",headers:b.headers,params:{from_id:n,page_size:e,sort_by:o},transformResponse:b.transformResponse}).then(function(e){var t=_.chain(e.data).map("lastMessage").compact().map(u.downloadMessage).value();return a.all(t).then(function(){return e})}).then(function(e){var t=_.chain(e.data).map(function(e){return _.map(e.participants,"userId")}).flatten().uniq().value();return l.populateUsers(t).then(function(){var t=u.tidyConversations([].concat(He(e.data),He(l.conversations)));return u.addConversationsData(t),l.conversations=t,t})})},getMessages:function(e,n,o){if(localStorage.superchat)return M(e,0,o);var i=e.url;return t({url:"".concat(i,"/messages"),params:{from_id:n,page_size:o},method:"GET",headers:b.headers,transformResponse:b.transformResponse}).then(function(e){var t=_.map(e.data,u.downloadMessage);return a.all(t).then(function(){return e})}).then(function(e){return u.addMessagesData(e.data),e.data}).then($)},getOneConversation:E,getUnreadMessageCount:function(){return localStorage.superchat?P().then(function(){A()}):t({url:"".concat(b.config.serverUrl,"/conversations?sort_by=last_message"),method:"GET",headers:b.headers,transformResponse:b.transformResponse}).then(function(e){var t=u.tidyConversations(e.data);return _.reduce(t,function(e,t){return e+t.unreadMessageCount},0)})},markAllAsRead:function(e,n){return localStorage.superchat?I(e):0===e.unreadMessageCount?a.resolve():t({method:"POST",url:"".concat(e.url,"/mark_all_read"),headers:b.headers,data:{position:n}})},markAsRead:function(e,n){if(localStorage.superchat)return function(e,n){return t({method:"POST",url:"https://www.bandlab.com/api/v1.3/users/".concat(m.id,"/conversations/").concat(n.id,"/messages/").concat(e.id,"/receipts/read")})}(e,n);var o=e.url;return t({url:"".concat(o,"/receipts"),method:"POST",headers:b.headers,data:{type:"read"}}).then(function(e){return e.data})},sendMessage:function(e,n,o){if(localStorage.superchat)return R(n,o[0].body);var a=n.url,i={text:e,sound:"layerbell.caf"};return o[0].body&&"text/plain"===o[0].mimeType&&(i.text+=": ",i.text+=o[0].body.length>256?"".concat(o[0].body.substr(0,256),"..."):o[0].body),_.forEach(o,function(e){e.mime_type=e.mimeType,delete e.mimeType}),t({url:"".concat(a,"/messages"),method:"POST",headers:b.headers,data:{parts:o,notification:i},transformResponse:b.transformResponse}).then(function(e){return u.addOneMessageData(e.data),e.data})},setOneMessageAttachments:C,startConversation:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user";return localStorage.superchat?D(e,t):"user"===t?y().then(function(){return S(e)}).then(L).catch(angular.noop):a.all([c.get({id:e}).$promise,y()]).then(function(e){return E(n(e,1)[0].conversationId)}).then(L)},updateUnreadMessageCount:A,_deleteConversation:function(e){return t({method:"DELETE",url:"https://www.bandlab.com/api/v1.3/users/".concat(m.id,"/conversations/").concat(e.id)}).then(function(){_.remove(l.conversations,{id:e.id}),i.$broadcast("$conversation:leave",e)})},_deleteMessage:x,_getConversations:P,_getMessages:M,_getOneConversation:T,_markAllAsRead:I,_sendMessage:R,_startConversation:D};function y(n){return!n&&e.get("layerSessionToken")?(b.headers.Authorization='Layer session-token="'.concat(e.get("layerSessionToken"),'"'),t({url:"".concat(b.config.serverUrl,"/"),method:"GET",headers:b.headers}).then(function(){return!0}).catch(function(){return y(!0)})):t({url:"".concat(b.config.serverUrl,"/nonces"),method:"POST",headers:b.headers}).then(function(e){return e.data.nonce}).then(w).then(k).then(function(e){return b.headers.Authorization='Layer session-token="'.concat(e,'"'),!0})}function w(e){return t({url:"https://www.bandlab.com/api/v1.3/layer/tokens",method:"POST",headers:b.headers,data:{nonce:e}}).then(function(e){return e.data.token})}function k(n){return t({url:"".concat(b.config.serverUrl,"/sessions"),method:"POST",headers:b.headers,data:{identity_token:n,app_id:b.config.appId}}).then(function(t){var n=new Date((new Date).setFullYear((new Date).getFullYear()+1));return e.put("layerSessionToken",t.data.session_token,{expires:n}),t.data.session_token})}function S(e){return localStorage.superchat?T(e,[]):f.get({id:e}).$promise.then(function(e){return e.canChat?e:a.reject("You can’t join the conversation due to this chat’s privacy settings. Sorry ¯\\(ツ)/¯")}).then(function(e){return t({url:"".concat(b.config.serverUrl,"/conversations"),method:"POST",headers:b.headers,data:{participants:[m.id,e.id],distinct:!0},transformResponse:b.transformResponse})}).then(function(e){return(e.data.lastMessage?u.downloadMessage(e.data.lastMessage):a.resolve()).then(function(){return e})}).then(function(e){var t=e.data;return u.addOneConversationData(t),t}).catch(function(e){var t=_.get(e,"data.message")||e.message||e;return s.addNotification({title:"Failed to start conversation",content:t,classList:"alert",autoclose:5e3}),a.reject(e)})}function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,n=arguments.length>1?arguments[1]:void 0;return t({url:"https://www.bandlab.com/api/v1.3/users/".concat(m.id,"/conversations"),params:{limit:e,after:n},preservePagination:!0}).then(function(e){l.after=e.data.paging.cursors.after;var n=_.map(e.data.data,function(e){return t({url:"https://www.bandlab.com/api/v1.3/conversations/".concat(e.id,"/members"),cache:!0}).then(function(t){var n=t.data;e.metadata={type:e.type.toLowerCase()},e.participants=n,_.forEach(n,function(e){e.userId=e.id}),e.hasBand&&(e.band={name:e.name})})});return Promise.all(n).then(function(){return e})}).then(function(e){var t=u.tidyConversations(He(e.data.data));return u.addConversationsData(t),l.conversations=u.tidyConversations([].concat(He(t),He(l.conversations))),t})}function E(e){return localStorage.superchat?T(e,[]):t({url:"".concat(b.config.serverUrl,"/conversations/").concat(e),method:"GET",headers:b.headers,transformResponse:b.transformResponse}).then(function(e){var t=e.data.lastMessage&&u.downloadMessage(e.data.lastMessage);return a.resolve(t).then(function(){return e})}).then(function(e){var t=e.data;return u.addOneConversationData(t),l.conversations=u.tidyConversations([t].concat(He(l.conversations))),t})}function T(e,o){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Promise.all([t({url:"https://www.bandlab.com/api/v1.3/users/".concat(m.id,"/conversations/").concat(e,"/messages")}),t({url:"https://www.bandlab.com/api/v1.3/conversations/".concat(e,"/members"),cache:!0}),t({url:"https://www.bandlab.com/api/v1.3/users/".concat(m.id,"/conversations/").concat(e)})]).then(function(e){var t=n(e,3),i=t[0].data,r=t[1].data,s=t[2].data;return s=nt({metadata:nt({type:s.type},s.group)},s,{hasBand:"Band"===s.type||!!a,band:a,participants:_.uniqBy([s.user].concat(He(o),He(r)),"id").filter(Boolean),messages:i}),_.forEach(s.participants,function(e){e.userId=e.id}),u.addOneConversationData(s),l.conversations=u.tidyConversations([s].concat(He(l.conversations))),s})}function M(e,n,o){return t({url:"https://www.bandlab.com/api/v1.3/users/".concat(m.id,"/conversations/").concat(e.id,"/messages"),params:{limit:o,after:e.after},preservePagination:!0}).then(function(t){var n=t.data,o=n.data,a=n.paging;return e.after=a.cursors.after,_.forEach(o,function(t){t.conversation=e,t.sentAt=t.createdOn,t.parts=[],t.user=t.sender,t.user.userId=t.user.id}),u.addMessagesData(o),o})}function $(e){var t=e.map(function(e){return C(e).catch(angular.noop)});return a.all(t).then(function(){return e})}function C(e){var t=[];return _.filter(e.parts,{mimeType:"application/json"}).forEach(function(n){var i,r=JSON.parse(n.body);if(-1!==v.indexOf(r.type))h[r.id]?i=h[r.id]:(i=function(e,t){return o.get(e).get({id:t}).$promise}(r.type,r.id),h[r.id]=i);else{if(-1===g.indexOf(r.type))return;i=a.resolve(r)}i.then(function(t){var n="".concat(r.type.toLowerCase(),"s");e.attachments||(e.attachments={}),e.attachments[n]||(e.attachments[n]=[]),_.find(e.attachments[n],{id:t.id})||e.attachments[n].push(t)}),t.push(i)}),a.all(t)}function A(){l.unreadMessageCount=_.reduce(l.conversations,function(e,t){return e+t.unreadMessageCount},0)}function R(e,n){return t.post("https://www.bandlab.com/api/v1.3/users/".concat(m.id,"/conversations/").concat(e.id,"/messages"),{content:n}).then(function(t){var n=t.data;return n.conversation=e,n.sentAt=n.sentAt||n.createdOn,n.sender=nt({},m,{userId:m.id}),n.parts=[],u.addOneMessageData(n),i.$broadcast("$message:new",n),n})}function I(e){return e.messages.length?t({method:"POST",url:"https://www.bandlab.com/api/v1.3/users/".concat(m.id,"/conversations/").concat(e.id,"/messages/").concat(e.messages[0].id,"/receipts/read")}):a.resolve()}function O(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t({url:e,method:"DELETE",headers:b.headers,params:n})}function x(e,n){return t({method:"DELETE",url:"https://www.bandlab.com/api/v1.3/users/".concat(m.id,"/conversations/").concat(e.id,"/messages/").concat(n.id)}).then(function(){_.remove(e.messages,{id:n}),i.$broadcast("$message:delete",{messageId:n.id})})}function D(e,t){return"user"===t?f.get({id:e}).$promise.then(function(e){return T(e.conversationId,[m,e])}).then(L):c.get({id:e}).$promise.then(function(e){return T(e.conversationId,e.members,e)}).then(L)}function L(e){return d.isMobile?r.go("chat.conversation",{id:e.uuid}):(p.activeConversations=[e],e)}}]).factory("SignalChat",["$http","$q","$rootScope","EditorCollaboratorsState","Me","User",function(e,t,o,a,i,r){var s=new Map;return{connect:_.memoize(function(){return t.all([e.post("https://www.bandlab.com/api/v1.3/chat/authorizations",{}),O("https://unpkg.com/@aspnet/signalr@1.1.0/dist/browser/signalr.min.js")]).then(function(e){var t=n(e,1)[0].data,i=t.accessToken,c=t.url,l=(new signalR.HubConnectionBuilder).withUrl(c,{accessTokenFactory:function(){return i}}).build();l.on("MessageReceived",function(e){if(e.uuid=k(),e.sentAt=+new Date,a.projectChat.messages=a.projectChat.messages||[],a.projectChat.messages.unshift(e),s.has(e.sender.id))e.user=s.get(e.sender.id);else{var t=new r;s.set(e.sender.id,t),t.$get({id:e.sender.id}),e.user=t}o.$applyAsync()}),l.onclose(function(){return console.log}),l.start().catch(function(){return console.log})})}),getMessages:function(t){var n=t.projectId,o=t.limit,a=void 0===o?1e4:o,c=t.after;return e({url:"https://www.bandlab.com/api/v1.3/users/".concat(i.id,"/conversations/").concat(n,"/messages"),method:"GET",params:{limit:a,after:c},preservePagination:!0}).then(function(e){var t=e.data,n=t.data;return n.forEach(function(e,t){if(s.has(e.sender.id))e.user=s.get(e.sender.id);else{var o=new r;s.set(e.sender.id,o),o.$get({id:e.sender.id}),e.user=o}t>1&&new Date(e.createdOn).getDate()!==new Date(n[t-1].createdOn).getDate()&&(n[t-1].isNewDate=!0,n[t-1].isNested=!1),t<n.length-1&&!n[t+1].isNewDate&&n[t+1].sender.id===e.sender.id&&new Date(e.createdOn).getTime()-new Date(n[t+1].createdOn).getTime()<9e5&&(e.isNested=!0)}),t})},sendMessage:function(t){var n=t.content,o=t.projectId;return e.post("https://www.bandlab.com/api/v1.3/users/".concat(i.id,"/conversations/").concat(o,"/messages"),{content:n})}}}]),angular.module("bandlab.chat").factory("ChatCache",["$q","Band","Me","User",function(e,t,n,o){var a={},i={},r=[];return{conversations:[],getBand:function(n){var o=a[n];return o?e.resolve(o):(o=new t({id:n}),a[n]=o,o.$get({id:n}))},getContacts:function(){return r.length?e.resolve(r):(t=Math.ceil(n.counters.following/50),a=_.map(new Array(t),function(e,t){return o.relation({id:n.id,rel:"following",limit:50,offset:50*t}).$promise}),e.all(a)).then(function(e){return r=_.chain(e).flatten().uniqBy("id").sortBy(function(e){return e.name.toLowerCase()}).value()});var t,a},getUser:function(t){var a=i[t];return t===n.id?a=new o(n):a||(a=new o({id:t}),i[t]=a),a.id&&!a.username?a.$get({id:t}):e.resolve(a)},populateUsers:function(t){var n=_.chain(t).filter(function(e){return!i[e]}).chunk(25).value(),a=_.map(n,function(e){return o.query({ids:e.join(";"),limit:25}).$promise.then(function(e){return e.forEach(function(e){i[e.id]=e}),i})});return e.all(a)},unreadMessageCount:0}}]),angular.module("bandlab.chat").factory("ChatHelper",["$filter","$http","$q","$sce","Band","ChatCache","Collection","Community","FileHelper","Me","Post","Revision","User",function(e,t,o,a,i,r,s,c,l,u,d,p,m){var f=_.memoize(function(e){return i.get({id:e}).$promise.then(function(e){return{object:e,type:"Band"}}).catch(function(){})}),h=_.memoize(function(e){return s.get({id:e}).$promise.then(function(e){return{object:e,type:"Collection"}}).catch(function(){})}),g=_.memoize(function(e){return c.get({id:e}).$promise.then(function(e){return{object:e,type:"Community"}}).catch(function(){})}),v=_.memoize(function(e){return d.get({id:e}).$promise.then(function(e){return{object:e,type:"Post"}}).catch(function(){})}),b=_.memoize(function(e){return p.get({id:e}).$promise.then(function(e){return{object:e,type:"Revision"}}).catch(function(){})}),y=_.memoize(function(e){return m.get({id:e}).$promise.then(function(e){return{object:e,type:"User"}}).catch(function(){})}),w=_.memoize(function(n){return t.get("https://www.bandlab.com/api/v1.3/preview?url=".concat(encodeURIComponent(n)),{cache:!0}).then(function(t){var n=t.data;return n.description=e("textTruncate")({content:n.description},200,40,3),[{object:n,type:"Link"}]}).catch(function(){return[{object:{url:n},type:"Link"}]})});return{addConversationsData:function(e){_.forEach(e,function(e){P(e)})},addMessagesData:function(e){_.forEach(e,function(t,n){E(t),n>1&&new Date(t.sentAt).getDate()!==new Date(e[n-1].sentAt).getDate()&&(e[n-1].isNewDate=!0,e[n-1].isNested=!1),n<e.length-1&&!e[n+1].isNewDate&&e[n+1].sender.userId===t.sender.userId&&new Date(t.sentAt).getTime()-new Date(e[n+1].sentAt).getTime()<9e5&&(t.isNested=!0)})},addOneConversationData:P,addOneMessageData:E,camelifyLayerResponse:function(e){return JSON.parse(JSON.stringify(e).replace(/"[a-z]*_[a-z_]*":/gi,function(e){return'"'.concat(_.camelCase(e),'":')}))},downloadMessage:function(e){var t=_.map(e.parts,function(e){var t=_.get(e,"content.downloadUrl");if(!e.body&&t)return l.download(t).then(k).then(function(t){e.body=t}).catch(function(){e.body="(Unsupported message format)"})});return o.all(t).then(function(){return e})},getLinkPreview:function(e){var t=$(e).pop();return t?w(t):o.resolve([])},getMessageAbstract:S,getMessageAttachments:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return o.all([].concat(He(C(e)),He(function(e){return _.chain(T(/https?:\/\/(([a-z]*\.)*bandlab\.com|localhost:[0-9]{4})\/band\/([a-z][0-9a-z_]{1,19})\/?(\s|\n|$|members)/g,e)).map(function(e){return n(e,4)[3]}).uniq().map(f).value()}(e)),He(function(e){return _.chain(T(/https?:\/\/(?:(?:[a-z]*\.)*bandlab\.com|localhost:[0-9]{4})\/(?:[^\s\\]*collections\/)([a-zA-Z0-9-_]+)\/?(?:\s|\n|$)/g,e)).map(function(e){return n(e,2)[1]}).uniq().map(h).value()}(e)),He(function(e){return _.chain(T(/https?:\/\/(([a-z]*\.)*bandlab\.com|localhost:[0-9]{4})\/community\/([a-z][0-9a-z_]{1,19})\/?(\s|\n|$)/g,e)).map(function(e){return n(e,4)[3]}).uniq().map(g).value()}(e)),He(function(e){return _.chain(T(/https?:\/\/(?:(?:[a-z]*\.)*bandlab\.com|localhost:[0-9]{4})\/posts?\/([a-zA-Z0-9-_]+)\/?(?:\s|\n|$)/g,e)).map(function(e){return n(e,2)[1]}).uniq().map(v).value()}(e)),He(function(e){return _.chain(T(/https?:\/\/(?:(?:[a-z]*\.)*bandlab\.com|localhost:[0-9]{4})\/(?:[^\s\\]*\?revId=|revisions\/)([a-zA-Z0-9-_]+)\/?(?:\s|\n|$)/g,e)).map(function(e){return n(e,2)[1]}).uniq().map(b).value()}(e)),He(function(e){return _.chain(T(/https?:\/\/(([a-z]*\.)*bandlab\.com|localhost:[0-9]{4})\/(?!band\/|song\/)([a-z0-9][a-z0-9_]{3,19})\/?(\s|\n|$|bands)/g,e)).map(function(e){return n(e,4)[3]}).uniq().map(y).value()}(e)))).then(function(e){return e.filter(function(e){return e})})},getSharableAttachment:function(e){var t=e.object,n=e.type;if(-1===["Band","Collection","Community","Image","Post","Revision","User","Video"].indexOf(n))throw new Error("Invalid attachment type: ".concat(n));return at({type:n,id:t.id},function(){switch(n){case"Band":return{title:t.name,description:"".concat(t.counters.members," members"),image:t.picture.m};case"Collection":return{title:t.name,description:t.description,image:t.picture.m};case"Community":return{title:t.name,description:t.about,image:t.picture.m};case"Image":return{image:t.image.picture.m};case"Revision":return{title:t.song.name,creator:{id:t.creator.id,name:t.creator.name},description:t.song.description,image:t.song.picture.m,sampleId:t.mixdown.id};case"Post":return(a=(e=t).image||e.video||e.revision)&&(o=a.song?a.song.picture.m:a.picture.m),{creator:{id:e.creator.id,name:e.creator.name,picture:e.creator.picture.m},caption:e.caption,image:o,postType:e.type};case"User":return{title:t.name,description:t.username,image:t.picture.m};case"Video":return{image:t.video.picture.m,duration:t.video.duration}}var e,o,a}())},getVideoUrls:C,getUrls:$,getUUID:function(e){return e.replace("layer:///conversations/","").replace("layer:///messages/","")},isUrl:function(e){return/^https?:\/\/(([a-z]*\.)*bandlab\.com|localhost:[0-9]{4})\/.+$/gi.test(e.trim())},resetMessageAttachmentsCache:function(){[b,v,y,f].forEach(function(e){e.cache=new _.memoize.Cache})},tidyConversations:function(e){return _.chain(e).filter(function(e){return localStorage.superchat||e.participants&&e.participants.length>0&&!0}).uniqBy("id").map(function(e){return at({date:_.get(e,"lastMessage.createdOn",(new Date).toISOString())},e)}).sortBy(function(e){return-new Date(e.date).getTime()}).value()}};function k(e){if(!_.includes(["application/json","text/plain"],e.type))return o.reject(e.type);var t=o.defer(),n=new FileReader;return n.onload=function(e){t.resolve(e.target.result)},n.onerror=t.reject,n.readAsText(e),t.promise}function S(e){var t=e.parts[0].body;return e.sender.userId===u.id&&(t="You: ".concat(t)),e.parts.forEach(function(e){e.body.indexOf('"type":"Image"')>0?t='<i class="icon-camera-photo"></i> Picture':e.body.indexOf('"type":"Video"')>0?t='<i class="icon-camera-video"></i> Video':e.body.indexOf('"type":"Revision"')>0?t='<i class="icon-headphones"></i> Revision':e.body.indexOf('"type":"Post"')>0&&(t='<i class="icon-speaker"></i> Post')}),t}function P(e){e.uuid=e.id.replace("layer:///conversations/",""),e.date=e.lastMessage&&(e.lastMessage.sentAt||e.lastMessage.createdOn)||e.createdAt||(new Date).toISOString(),e.lastMessage&&(e.lastMessage.abstract=e.lastMessage.content||S(e.lastMessage)),e.metadata.type&&"band"===e.metadata.type.toLowerCase()?(e.hasBand=!0,e.keywords=" ",r.getBand(e.metadata.id).then(function(t){e.band=t,e.keywords+="".concat(e.band.name," "),e.members=[],_.forEach(e.participants,function(t){r.getUser(t.userId).then(function(t){e.members.push(t),e.keywords+="".concat(t.name," ").concat(t.username," ")})})})):(e.hasBand=!1,e.keywords=" ",_.forEach(e.participants,function(t){r.getUser(t.userId).then(function(t){u.id===t.id&&1!==e.participants.length||(e.partner=t),e.keywords+="".concat(t.name," ").concat(t.username," ")})}))}function E(t){t.uuid=t.id.replace("layer:///messages/",""),t.conversation.uuid=t.conversation.id.replace("layer:///conversations/",""),t.isNewDate=!1,t.isNested=!1,t.content=t.content||"",t.parts.forEach(function(e,n){"text/plain"===e.mimeType&&(t.content+=(n>0?"\n":"")+e.body)}),t.content=e("link")(t.content,"_blank"),t.content=e("userMention")(t.content),t.content=e("tag")(t.content),t.content=t.content.replace(/\[(Image|Video)\]/g,""),r.getUser(t.sender.userId).then(function(e){t.user=e})}function T(e,t){for(var n,o=[];null!==(n=e.exec(t));)o.push(n);return o}function M(e){try{new URL(e)}catch(e){return!1}return/https?:\/\//i.test(e)}function $(e){var t=/^www\.(\S{2}[:?\d]*)\S*$/i;return e.split(/\s/).map(function(e){return e.replace(/[.,;!?]*$/,"")}).filter(function(e){return M(e)||t.test(e)})}function C(e){var t=/(youtube\.com\/watch[?]v=|youtube\.com\/embed|youtu\.be)(\/)?([A-Za-z0-9._%-]+).*$/i,n=/vimeo\.com\/[a-z_\/]*([0-9]{6,10})\/?/i;return e.split(/\s/).map(function(e){return e.replace(/[.,;!?]*$/,"")}).map(function(e){if(M(e)){var o=e.match(t);if(o)return{type:"youtube",id:o[3],url:a.trustAsResourceUrl("//www.youtube.com/embed/".concat(o[3]))};var i=e.replace(/#.+/,"").replace(/\?.+/,"").match(n);return i?{type:"vimeo",id:i[1],url:a.trustAsResourceUrl("//player.vimeo.com/video/".concat(i[1]))}:void 0}}).filter(Boolean)}}]),angular.module("bandlab.chat").factory("ChatHub",["$rootScope","Chat","ChatNotifications","Me",function(e,t,n,o){var a=angular.noop;return{start:i,stop:r};function i(){!1!==o.permissions.canCreateConversations&&t.authenticate().then(n.addListeners).then(n.enable).then(function(){e.$broadcast("$chat:authenticated"),a=e.$on("$chat:error",s)}).catch(function(){r()})}function r(){t.destroySession(),n.removeListeners()}function s(){a(),r(),i()}}]),angular.module("bandlab.chat").factory("ChatNotifications",["$cookies","$http","$q","$rootScope","$state","$stateParams","AppNotifications","Chat","ChatCache","ChatHelper","FloatingChat","Me",function(e,t,o,a,i,r,s,c,l,u,d,p){var m,f=!1;return{addListeners:function(){if(localStorage.superchat)return function(){return o.all([t.post("https://www.bandlab.com/api/v1.3/chat/authorizations",{}),O("https://unpkg.com/@aspnet/signalr@1.1.0/dist/browser/signalr.min.js")]).then(function(t){var o=n(t,1)[0].data,a=o.accessToken,s=o.url,c=(new signalR.HubConnectionBuilder).withUrl(s,{accessTokenFactory:function(){return a}}).build();c.on("MessageReceived",e),c.on("MessageDeleted",i),c.onclose(r),c.start().catch(r),m=c});function e(e){if(e.conversation=_.find(l.conversations,{id:e.conversationId}),e.sender.userId=e.sender.id,!e.conversation)return c._getOneConversation(e.conversationId,[]).then(function(t){e.conversation=t,e.parts=[{body:e.content}],u.addOneMessageData(e),g(e)});e.parts=[{body:e.content}],u.addOneMessageData(e),g(e),a.$applyAsync()}function i(e){a.$broadcast("$message:delete",{messageId:e.id}),a.$applyAsync()}function r(){a.$broadcast("$chat:error")}}();try{return m||((m=new ReconnectingWebSocket("wss://websockets.layer.com/?session_token=".concat(e.get("layerSessionToken")),"layer-1.0")).addEventListener("message",h),m.addEventListener("error",function(){a.$broadcast("$chat:error")})),o.resolve(m)}catch(e){return o.reject(e)}},disable:function(){f=!1},enable:function(){return m?(f=!0,o.resolve()):o.reject("Web Socket connection do not exists.")},removeListeners:function(){m&&(m.close&&m.close(),m.stop&&m.stop()),m=null,f=!1}};function h(e){var t=JSON.parse(e.data),n=t.body;switch(t.type){case"change":!function(e){try{switch(e.operation){case"create":"Conversation"===e.object.type?c.getOneConversation(u.getUUID(e.object.url)).then(function(e){!function(e){f&&a.$broadcast("$conversation:create",e)}(e)}):"Message"===e.object.type&&a.$apply(function(){var t=u.camelifyLayerResponse(e.data);u.addOneMessageData(t),g(t)});break;case"delete":"Message"===e.object.type&&a.$broadcast("$message:delete",{messageId:e.object.id,messageUrl:e.object.url});break;case"patch":"Message"===e.object.type&&"set"===e.data[0].operation&&e.data[0].value&&a.$broadcast("$message:status",{messageId:e.object.id,messageUrl:e.object.url,status:"delivered"===e.data[0].value?"sent":e.data[0].value})}}catch(e){}}(n);break;case"request":case"response":break;case"signal":!function(e){try{switch(e.type){case"typing_indicator":"Conversation"===e.object.type&&e.object.id&&l.getUser(e.data.user_id).then(function(t){a.$broadcast("$message:typing",{conversationId:e.object.id,user:t})})}}catch(e){}}(n)}}function g(e){if(f){a.$broadcast("$message:new",e);var t=!(e.sender.userId!==p.id&&(!r.id||r.id!==e.conversation.uuid)),n=d.activeConversations[0]&&e.conversation.uuid===d.activeConversations[0].uuid;t||n&&!d.activeConversations[0].isMinimized||i.includes("mixEditor")||l.getUser(e.sender.userId).then(function(t){var o=u.getMessageAbstract(e);o.length>80&&(o="".concat(o.substr(0,80),"...")),s.addNotification({title:t.name,content:'<div class="conversation-message-abstract">'.concat(o,"</div>"),image:t.picture.m,autoclose:6e3,classList:"user"}),setTimeout(function(){var o,a=document.querySelector('.notification [src="'.concat(t.picture.m,'"]'));a&&((o=a.closest(".notification")).style.cursor="pointer",o.addEventListener("click",function(){s.clearAll(),n?d.activeConversations[0].isMinimized=!1:c.getOneConversation(e.conversation.uuid).then(function(e){d.activeConversations=[e]})}))},300)})}}}]),angular.module("bandlab.collection",[]),angular.module("bandlab.collection.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("collectionId",{url:"/collections/{id:[a-zA-Z0-9-_]+}",redirectTo:function(e){return e.injector().get("Collection").get({id:e.params().id}).$promise.then(function(e){return{state:"collection",params:{id:e.id,username:e.creator.username}}})}}).state("collection",{url:"/{username:[a-z0-9][a-z0-9_]{3,19}}/collections/{id:[a-zA-Z0-9-_]+}",params:{rewriteTracking:["Me","$stateParams",function(e,t){return function(n){return n.replace(/^\/[a-z0-9][a-z0-9_]{3,19}(($|\/).*)/g,"/".concat(t.username===e.username?"me":"user","/collection"))}}]},templateUrl:"https://www.bandlab.com/web-app/collection/views/collection-layout-4cdd4855.html",resolve:{theCollection:["$stateParams","Collection",function(e,t){return t.get({id:e.id}).$promise}]},onEnter:["$stateParams","Page","theCollection",function(e,t,n){t.setMetadata({title:"".concat(n.name," by ").concat(n.creator.name," | BandLab"),description:"".concat(n.description?"".concat(n.description," | "):"","Unlimited free listening on BandLab."),image:n.picture.s,imageHeight:"360",imageWidth:"360",objectPath:"/collections/".concat(e.id)})}],onExit:["Page",function(e){e.clearMetadata()}],controller:["$scope","$state","Me","theCollection",function(e,t,n,o){e.collection=o,e.$on("$collection:changed",function(o,a){a.collection.id===e.collection.id&&("update"===a.action?e.collection=a.collection:"delete"===a.action&&t.go("user.collections",{username:n.username}))})}]})}]),angular.module("bandlab.collection").controller("CollectionCreateCtrl",["$analytics","$rootScope","$scope","$state","AppNotifications","Collection",function(e,t,n,o,a,i){n.collection=new i,n.collection.isPublic=!0,n.$on("$file:uploadSuccess",function(e,t){n.displayPictureUpload=!1,n.collection.pictureId=t.id,n.collection.picture=t,n.collectionForm.$setDirty()}),n.displayPictureUpload=!1,n.$on("$ngFile:fileChanged",function(){n.displayPictureUpload=!0}),n.addCollection=function(){delete n.errorMessage,n.collection.$save().then(function(n){t.$broadcast("createCollectionModal","close"),t.$broadcast("$collection:changed",{action:"create",collection:n}),e.eventTrack("Create Collection",{category:"Collection"}),"user.collections"!==o.current.name&&a.addNotification({title:"Collection created",content:"Search for an artist, song, playlist or album to start a new collection.",image:n.picture.xs,action:'\n              <div ng-click="hide()">\n                <a href="'.concat(o.href("explore.home"),'">').concat("Explore BandLab","</a>\n              </div>\n            "),classList:"project",autoclose:8e3})}).catch(function(e){n.collectionForm.$setPristine(),n.errorMessage=e.data.message})}}]),angular.module("bandlab.collection").controller("CollectionEditCtrl",["$analytics","$rootScope","$scope","AppNotifications","ConfirmModal",function(e,t,n,o,a){n.deleteCollection=function(n){return new a({confirmLabel:"Delete",contentScope:{title:"Delete This Collection?",message:"<p>".concat("You’ll lose everything that’s saved inside.","</p>")},onConfirm:function(){t.$broadcast("$collection:changed",{action:"mark-deleted",collection:n}),n.$delete().then(function(){t.$broadcast("$collection:changed",{action:"delete",collection:n}),e.eventTrack("Delete Collection",{category:"Collection"})}).catch(function(e){t.$broadcast("$collection:changed",{action:"unmark-deleted",collection:n}),o.addNotification({title:"Cannot delete collection",content:_.get(e,"data.message")||_.get(e,"message","Unknown error"),autoclose:5e3,classList:"alert"})})}}).show()},n.unpublishCollection=function(e){e.isPublic=!1,e.$update().then(function(e){t.$broadcast("$collection:changed",{action:"update",collection:e})})},n.publishCollection=function(e){e.isPublic=!0,e.$update().then(function(e){t.$broadcast("$collection:changed",{action:"update",collection:e})})}}]),angular.module("bandlab.collection").controller("CollectionFormCtrl",["$analytics","$rootScope","$scope","$state","Collection",function(e,t,n,o,a){var i=n.$parent.collection;n.editCollection=function(){n.createError=!1,n.collection.$update().then(function(a){_.assignIn(i,a),t.$broadcast("editCollectionModal","close"),t.$broadcast("$collection:changed",{action:"update",collection:a}),e.eventTrack("Edit Collection",{category:"Collection"}),n.pictureHasChanged&&o.go(".",{},{reload:!0})})},n.collection=new a({id:i.id,name:i.name,description:i.description,isPublic:i.isPublic,picture:angular.copy(i.picture)}),n.$on("$file:uploadSuccess",function(e,t){n.displayPictureUpload=!1,n.collection.pictureId=t.id,n.collection.picture=t,n.collectionForm.$setDirty(),n.pictureHasChanged=!0}),n.displayPictureUpload=!1,n.$on("$ngFile:fileChanged",function(){n.displayPictureUpload=!0})}]),angular.module("bandlab.collection").controller("CollectionsManageCtrl",["$analytics","$controller","$rootScope","$scope","$state","AppNotifications","Collection","Me",function(e,t,n,o,a,i,r,s){angular.extend(this,t("UserCollectionsCtrl",{$scope:o,theUser:s})),o.addedPosts=[],o.addToCollection=function(t,s){r.addPost({id:t.id,postId:s}).$promise.then(function(r){t.counters.items+=1;var s=a.href("collection",{username:t.creator.username,id:t.id});o.addedPosts[t.id]=!0,r.revision&&i.addNotification({autoclose:8e3,classList:"project",title:r.revision.song.name,content:"Added to ".concat('<strong><a href="'.concat(s,'">').concat(t.name,"</a></strong>")),image:r.revision.song.picture.xs}),e.eventTrack("Add to Collection",{category:"Post",label:r.type}),n.$broadcast("$collection:changed",{action:"update",collection:t})}).catch(function(e){if(409===e.status){var n=_.get(e,"data.errorCode");i.addNotification({autoclose:8e3,title:"Unable to add to collection",content:81===n?"Post already exists in this collection.":e.data.message,classList:"alert"}),81===n&&(o.addedPosts[t.id]=!0)}})},o.removeFromCollection=function(e,t){r.removePost({id:e.id,postId:t}).$promise.then(function(){_.remove(e.posts,function(e){return e.id===t}),e.counters.items-=1,n.$broadcast("$collection:changed",{action:"update",collection:e})})}}]),angular.module("bandlab.collection").component("collectionCard",{bindings:{collection:"="},templateUrl:"https://www.bandlab.com/web-app/collection/partials/_collection-card-bc829d4c.html",controller:["$stateParams","User",function(e,t){var n=this;n.$onInit=function(){n.currentView="list"===e.view?"list":"feed"},n.getLikers=function(e){return _.assign(e,{entity:"collections",entityId:n.collection.id}),t.likers(e).$promise}}],controllerAs:"vm"}),angular.module("bandlab.collection").component("collectionTile",{bindings:{collection:"<"},transclude:{actions:"?collectionTileActions"},templateUrl:"https://www.bandlab.com/web-app/collection/partials/_collection-tile-46b9980d.html",controllerAs:"vm"}),angular.module("bandlab.collection").component("collectionTileEmpty",{templateUrl:"https://www.bandlab.com/web-app/collection/partials/_collection-tile-empty-5a12f9ed.html",controllerAs:"vm"}),angular.module("bandlab.collection").component("revisionListItem",{bindings:{collection:"=",navigatingHistory:"<",order:"<",post:"="},transclude:{actions:"?postTileActions"},templateUrl:"https://www.bandlab.com/web-app/collection/partials/_revision-list-item-2192fa0b.html",controller:"PostCtrl",controllerAs:"vm"}),angular.module("bandlab.collection").factory("Collection",["$http","$resource",function(e,t){var n="https://www.bandlab.com/api/v1.3/collections";return t(n,{},{addPost:{method:"POST",params:{id:"@id",postId:"@postId"},url:"".concat(n,"/:id/posts/:postId")},delete:{method:"DELETE",params:{id:"@id"},url:"".concat(n,"/:id")},fromUser:{method:"GET",isArray:!0,params:{userId:"@userId"},url:"https://www.bandlab.com/api/v1.3/users/:userId/collections"},get:{method:"GET",params:{id:"@id"},url:"".concat(n,"/:id"),transformResponse:e.defaults.transformResponse.concat(function(e,t,n){return 200===n&&e.posts.forEach(function(t){t.revision&&(t.revision.parentCollectionId=e.id,t.revision.postId=t.id)}),e})},liked:{method:"GET",isArray:!0,params:{id:"@userId"},url:"https://www.bandlab.com/api/v1.3/users/:userId/likes/collections"},removePost:{method:"DELETE",params:{id:"@id",postId:"@postId"},url:"".concat(n,"/:id/posts/:postId")},save:{method:"POST",url:n},update:{method:"PATCH",params:{id:"@id"},url:"".concat(n,"/:id")},updatePostOrder:{method:"PATCH",params:{id:"@id",postId:"@postId"},url:"".concat(n,"/:id/posts/:postId")}})}]),angular.module("bandlab.comment",[]).factory("Comment",["$resource",function(e){var t="https://www.bandlab.com/api/v1.3/";return e(t,{},{delete:{url:"".concat(t,":entity/:entityId/comments/:id"),method:"DELETE"},query:{url:"".concat(t,":entity/:id/comments"),isArray:!0,method:"GET",params:{offset:0}},save:{url:"".concat(t,":entity/:id/comments"),method:"POST",transformRequest:function(e){return e.content=e.content.replace(/(\n)\1+/,"\n"),angular.toJson(e)}}})}]),angular.module("bandlab.comment").component("comment",{bindings:{canEdit:"<",comment:"<",onDelete:"&",onReplyTo:"&",revision:"<",readonly:"<"},require:"^comments",templateUrl:"https://www.bandlab.com/web-app/comment/partials/_comment-5b9e553f.html",controllerAs:"vm",controller:["$analytics","Player","Me",function(e,t,n){var o=this;o.me=n,o.goToTimeAndPlay=function(n){t.goToTimeAndPlay(o.revision,n),e.eventTrack("Time Marker Click",{category:"Revision",label:"Comment Timestamp Link"})}}]}),angular.module("bandlab.comment").directive("commentArea",["appActions",function(e){return{require:["ngModel","^form","^comments"],link:function(t,n,o,a){var i=a[0],r=a[1],s=a[2];n.on("focus",function(t){e.checkAllowed("comment")||(t.preventDefault(),n[0].blur())}),n.bind("keydown",function(e){13!==e.which||e.shiftKey||(!i.$valid||r.$submitted||t.suggestions["0users"].length||t.suggestions["1tags"].length||(r.$setSubmitted(),s.postComment(r)),e.preventDefault())})}}}]),angular.module("bandlab.comment").component("commentPopover",{bindings:{comment:"<",revision:"<"},template:'<div ng-if="vm.comment && vm.revision" class="popover-content">\n        <comment comment="vm.comment" revision="vm.revision" readonly="true"></comment>\n      </div>',controllerAs:"vm"}),angular.module("bandlab.comment").component("comments",{bindings:{canEdit:"<",counter:"<",entity:"<",entityId:"<",loadedComments:"<",revision:"<",readonly:"<"},templateUrl:"https://www.bandlab.com/web-app/comment/partials/_comments-f2948855.html",controller:["$analytics","$q","$rootScope","$scope","$state","AppNotifications","Comment","ConfirmModal","Me","Player",function(e,t,n,o,a,i,r,s,c,l){var u=this,d=t.resolve(),p=null;u.$onInit=function(){u.me=c,u.counter=u.counter||0,u.loadedComments?(u.comments=u.loadedComments.map(function(e){return new r(e)}),u.hasMore=u.counter>u.comments.length):(u.comments=null,u.getMoreComments()),m()},u.checkPlayerSong=function(){!function(e){u.revision&&(f(),n.$broadcast("$timeMarker:addTempTimeMarker",{revisionId:u.revision.id,comment:{isTemporary:!0,createdOn:(new Date).toISOString(),creator:c,timestamp:e}}))}(p=u.revision&&l.isCurrentSong(u.revision.id)&&l.getCurrentTime())},u.removeTempTimeMarkers=f,u.deleteComment=function(t){new s({confirmLabel:"Delete",contentScope:{title:"Delete This Comment?",message:"<p>".concat("You won’t be able to undo this action.","</p>")},onConfirm:function(){var n=(new Date).getTime();return t.$delete({entity:"".concat(u.entity,"s"),entityId:u.entityId,id:t.id}).then(function(){u.comments.splice(u.comments.indexOf(t),1),u.counter--,e.eventTrack("Delete Comment",{category:_.startCase(u.entity),value:u.counter}),ga("send","timing",u.entity,"Delete Comment",(new Date).getTime()-n),m()})}}).show()},u.getMoreComments=function(){return d=d.then(function(){return r.query({entity:"".concat(u.entity,"s"),id:u.entityId,limit:10,offset:u.comments&&u.comments.length||0}).$promise}).then(function(e){u.comments=u.comments&&u.comments.concat(e)||e,u.hasMore=u.counter>u.comments.length,m()})},u.postComment=function(t){var n=new r(u.newComment),a=(new Date).getTime();return p&&(n.timestamp=p),n.$save({entity:"".concat(u.entity,"s"),id:u.entityId}).then(function(t){u.newComment.content="",h(t),setTimeout(function(){return o.$broadcast("elastic:adjust")}),ga("send","timing",u.entity,"Post Comment",(new Date).getTime()-a),n.timestamp&&e.eventTrack("Add Comment with Timestamp",{category:"Revision"})}).catch(function(e){var t=403===e.status?i18n(it()):_.get(e,"data.message");i.addNotification({title:"Unable to post comment",content:t,classList:"alert",autoclose:5e3})}).finally(function(){t.$setPristine()})},u.replyTo=function(e){var t;t="@".concat(e.creator.username," "),u.newComment&&u.newComment.content?u.newComment.content.length>1&&(u.newComment.content+=" "):u.newComment={content:""},u.newComment.content+=t,n.$broadcast("focusOn","comment-".concat(u.entityId))};var m=_.debounce(function(){u.revision&&n.$broadcast("$comments:loaded",{revision:u.revision,comments:u.comments})},1e3);function f(){n.$broadcast("$timeMarker:removeTempTimeMarkers")}function h(t){u.comments.unshift(t),u.counter++,e.eventTrack("Create Comment",{category:_.startCase(u.entity),value:u.counter}),m()}o.$on("$comment:changed",function(e,t){var n=t.action,o=t.comment;"create"===n&&h(o)})}],controllerAs:"vm"}),angular.module("bandlab.comment").filter("tag",["$state",function(e){function t(t){var n=/\w+/.exec(t)[0],o=/\s+/.exec(t),a=e.href("search.results",{q:n,filter:"posts"});return o=o&&o[0]||"","".concat(o,'<a hashtag class="comment-mention" href="').concat(a,'"><span class="at">#</span><span class="comment-tag link">').concat(n,"</span></a>")}return function(e){return e?e.replace(/(\s|^)(?!(\b[a-z0-9_@]+[.][a-z]+\b))(#\b[a-z0-9][a-z0-9_]{0,100}\b)/gi,t):e}}]),angular.module("bandlab.comment").filter("userMention",["$state",function(e){function t(t){var n=/\w+/.exec(t)[0].toLowerCase(),o=/\s+/.exec(t),a=e.href("user.feed",{username:n});return o=o&&o[0]||"","".concat(o,'<a class="comment-mention" href="').concat(a,'"><span class="at">@</span><span class="comment-username link">').concat(n,"</span></a>")}return function(e){return e?e.replace(/(\s|^)(?!(\b[a-z0-9_@]+[.][a-z]+\b))(@\b[a-z0-9][a-z0-9_]{3,19}\b)/gi,t):e}}]),angular.module("bandlab.common",[]),angular.module("bandlab.common").directive("a",function(){return{restrict:"E",compile:function(e,t){return angular.isUndefined(t.ngDisabled)?null:function(e,t,n){t.on("click",function(e){!0===n.disabled&&e.preventDefault()})}}}}),angular.module("bandlab.common").directive("searchLocation",["$filter","Place",function(e,t){var n=e("location");return{require:["^form","ngModel"],link:function(e,o,a,i){var r=i[1],s=[];r.$viewChangeListeners.push(function(){var n=r.$viewValue;t.query({query:n}).$promise.then(function(t){s=t,e.placeSuggestions={places:t}})}),r.$formatters.push(function(e){return n(e)}),r.$overrideModelOptions({allowInvalid:!0}),r.$parsers.push(function(e){for(var t=e,n=0;n<s.length;n++)if(s[n].name===e){t=s[n];break}return t}),r.$validators.validPlace=function(e){return!e||e&&e.name},e.completeLocation=function(t){e.placeSuggestions={},r.$setViewValue(t),r.$processModelValue()}}}}]),angular.module("bandlab.common").directive("asyncModal",["$parse","appActions","Modal",function(e,t,n){return{restrict:"A",link:function(o,a,i){var r;a.on("click",function(a){a.preventDefault(),i.asyncModalAction&&!t.checkAllowed(i.asyncModalAction)||function(){if(!r){var t={class:i.asyncModalClass,id:i.asyncModalId||k(),templateUrl:i.asyncModal,onDestroy:function(){r=null}};"false"===i.asyncModalOverlayClose&&(t.overlayClose=!1),i.asyncModalParse&&(t.contentScope=e(i.asyncModalParse)(o)),(r=new n(t)).show()}}()})}}}]),angular.module("bandlab.common").directive("asyncValid",["$q","$timeout","Validation",function(e,t,n){return{require:"ngModel",restrict:"A",scope:{asyncValid:"="},priority:100,link:function(o,a,i,r){if(r){var s,c,l,u,d=r.$render;r.$render=function(){angular.isString(r.$modelValue)&&angular.isUndefined(s)&&(s=r.$viewValue),d()},r.$asyncValidators.asyncValid=function(a){return c=a,function a(i,d){return l&&t.cancel(l),r.$setValidity("available",!0),r.$setValidity("valid",!0),angular.isString(s)&&c===s?e.resolve():u&&0===u.$$state.status&&!d?u:l=t(function(){return u=n.validate(o.asyncValid.entity,o.asyncValid.key,i).then(function(e){if(i!==c)return a(c,!0);o.asyncValid.testAvailability&&r.$setValidity("available",e.data.isAvailable),o.asyncValid.testValidity&&r.$setValidity("valid",e.data.isValid)})},1e3)}(a)}}}}}]),angular.module("bandlab.common").directive("autofocus",["$stateParams","ClientDevice",function(e,t){return{restrict:"A",link:function(n,o,a){if(!t.isMobile&&!t.isTablet)return e.focus||"checkParams"===a.autofocus.toString()?e.focus&&e.focus===o.attr("name")?setTimeout(function(){o[0].focus()},100):void 0:setTimeout(function(){o[0].focus()},100);o[0].removeAttribute("autofocus")}}}]),angular.module("bandlab.common").directive("backToTop",["$analytics","$transitions",function(e,t){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/common/partials/_back-to-top-5bf56e25.html",link:function(n,o){var a=document.scrollingElement||document.body,i=t.onExit({},function(){o.removeClass("up").removeClass("down"),r=0}),r=0;function s(){0===a.scrollTop&&0===r?o.removeClass("up").removeClass("down"):a.scrollTop>0&&(r=0,o.removeClass("down").addClass("up"))}window.addEventListener("scroll",s,{passive:!0}),o.on("click",function(){r=a.scrollTop||r,a.scrollTop=0===a.scrollTop?r:0,a.scrollTop>0&&(r=0),o.removeClass("up").addClass("down"),e.eventTrack(a.scrollTop?"Back to bottom":"Back to top",{category:"Navigation",value:a.scrollTop})}),n.$on("$destroy",function(){window.removeEventListener("scroll",s,{passive:!0}),i()})}}}]),angular.module("bandlab.common").component("createTextPost",{bindings:{me:"<",text:"<",entityType:"<",entity:"<",onPostCreate:"<",onShoutButtonClick:"<"},templateUrl:"https://www.bandlab.com/web-app/common/partials/_create-text-post-fa672657.html",controllerAs:"vm",controller:["$analytics","$element","$http","$rootScope","$scope","$state","AppNotifications","ChatHelper","ClientDevice","Modal","Me","Post",function(e,t,n,o,a,i,r,s,c,l,u,d){var p=this;p.isMobile=c.isMobile||c.isTablet,p.isFeed=["user.feed","feed"].includes(i.$current.name);var m={canEdit:!0,type:"Text"};function f(){var c=angular.noop,d=t[0].getBoundingClientRect().top,f=new l({id:"create-text-post",templateUrl:"https://www.bandlab.com/web-app/common/partials/_create-text-post-modal-19adf8e9.html",contentScope:{entity:p.entity,entityType:p.entityType,me:u,post:a.post,shouts:a.shouts,setTextShout:b,onTextInput:v,submitPost:function(t,n){return a.shouts.image?(t.backgroundId=a.shouts.image?a.shouts.image.id:null,h(t).$promise.then(function(t){e.eventTrack("Create Post",{category:"Post",label:"Text with custom background"}),a.shouts.image=null,a.post=ct({},m),a.shouts.isBlocked=!1,n.$setPristine(),f.destroy(),angular.isFunction(p.onPostCreate)&&p.onPostCreate(t)}).catch(y)):h(t).$promise.then(function(t){e.eventTrack("Create Post",{category:"Post",label:"Text"}),a.post=ct({},m),a.shouts.isBlocked=!1,n.$setPristine(),f.destroy(),angular.isFunction(p.onPostCreate)&&p.onPostCreate(t)}).catch(y)}},onCreate:function(e){a.textarea=e[0].querySelector("textarea"),f.element=e[0].querySelector(".modal"),f.element&&f.element.classList.remove("modal"),g(),a.shouts.images.length<=1&&n.get("https://www.bandlab.com/api/v1.3/backgrounds?isActive=true",{cache:!0}).then(function(e){var t=_.chain(e).get("data",[]).map(function(e){var t=e.id,n=e.color;return{url:e.imageUrl,preview:e.previewImageUrl,color:n,id:t}}).value();a.shouts.images=a.shouts.images.concat(t)}),setTimeout(function(){a.textarea.focus(),o.$broadcast("elastic:adjust")},0),a.shouts.isDropdownShown=!1,c=a.$watch("post.link",function(){v()})},onDestroy:function(){s.resetMessageAttachmentsCache(),c()}});function g(){f.element.style.marginTop=a.shouts.image?"".concat(0,"px"):"".concat(d,"px")}function v(){if(a.shouts.isBlocked=!1,a.shouts.isDropdownShown=!1,/(http[s]?:\/)|(www\.\S{2})/i.test(a.post.caption)||a.post.link)return b(null,null),void(a.shouts.isBlocked=!0);a.post.caption&&(a.post.caption.length>250&&(a.shouts.isBlocked=!0),a.post.caption.split(/\n/).reduce(function(e,t){return t.length>25?e+Math.ceil(t.length/25):e+1},0)>7?(a.shouts.isBlocked=!0,a.shouts.image&&(a.shouts.prev=a.shouts.image,a.shouts.image=null,g())):(a.shouts.isBlocked=!1,a.shouts.prev&&(b(null,a.shouts.prev),g(),a.shouts.prev=null)))}function b(e,t){e&&e.stopImmediatePropagation(),a.shouts.isBlocked||(t&&(t.blur="https://bandlabimages.azureedge.net/v1.3/backgrounds/".concat(t.id,"/800x800/blur")),a.shouts.image=t,g(),setTimeout(function(){a.textarea.focus(),o.$broadcast("elastic:adjust")},0))}function y(e){var t=_.get(e,"data.errorCode"),n=_.get(e,"data.message"),o=403!==t?n:i18n(rt());r.addNotification({title:"Unable to create post. Check your internet connection and try again.",content:o,classList:"alert",autoclose:5e3}),403===t&&i.go(".",i.params,{reload:!0})}f.show()}function h(e){return d.createPost({caption:e.caption,id:p.entity.id,entity:{user:"users",band:"bands",community:"communities",classroom:"classrooms"}[p.entityType],link:a.post.link,backgroundId:e.backgroundId||null})}a.createTextPost=function(){s.resetMessageAttachmentsCache(),p.entity.$get?p.entity.$get({id:p.entity.id}).then(function(){f()}):f()},a.post=ct({},m),a.shouts={image:null,images:[null],isBlocked:!1,isDropdownShown:!1,toggleShoutDropdown:function(e,t){a.shouts.isBlocked||(e&&e.stopImmediatePropagation(),t=angular.isDefined(t)?t:!a.shouts.isDropdownShown,a.shouts.isDropdownShown=t)}}}]});var lt=function(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.contain="strict",t.style.position="absolute",t.style.left="-9999px",t.style.fontSize="12pt";var n=document.getSelection(),o=!1;n.rangeCount>0&&(o=n.getRangeAt(0)),document.body.append(t),t.select(),t.selectionStart=0,t.selectionEnd=e.length;var a=!1;try{a=document.execCommand("copy")}catch(e){}return t.remove(),o&&(n.removeAllRanges(),n.addRange(o)),a},ut=lt,dt=lt;ut.default=dt,angular.module("bandlab.common").directive("clipboard",function(){return{restrict:"A",link:function(e,t,n){t.on("click",function(){ut(e.$eval(n.text))})}}}),angular.module("bandlab.common").factory("ContextMenu",function(){return{arrangeSubmenus:function(e){_.forEach(e,function(e){var t=e.parentElement.getBoundingClientRect();e.scrollWidth+t.right>window.innerWidth?e.style.right="100%":e.style.left="100%",e.scrollHeight+t.top>window.innerHeight&&(e.style.top="".concat(Math.max(window.innerHeight-e.scrollHeight-t.top,-t.top),"px"),e.style.maxHeight="".concat(window.innerHeight,"px"),e.style.overflow="auto"),e.style.display="none",e.style.visibility="hidden",setTimeout(function(){e.style.display=null})})},currentMenuOpener:null,currentMenu:null}}).directive("contextMenu",["$compile","$templateRequest","ContextMenu",function(e,t,n){return{replace:!0,restrict:"E",link:function(o,a,i){var r,s,c=angular.element(document.querySelector("main"));a.parent().on("contextmenu",function(l){function u(){n.currentMenu&&(n.currentMenu[0].style.display="none",n.currentMenuOpener.removeClass("active")),n.currentMenu=null,c.off("click",u),c.off("keydown",d),r&&(r.remove(),s.$destroy(),r=null,s=null)}function d(e){13!==e.which&&9!==e.which&&27!==e.which||u()}l.preventDefault(),l.stopPropagation(),u(),t(i.template).then(function(t){setTimeout(function(){return function(t,i){s=o.$new(),(r=e(i)(s))[0].style.display="inline-block",s.$digest(),c.append(r),n.currentMenu=r,n.currentMenuOpener=a;var l=r[0].clientWidth+t.clientX,p=r[0].clientHeight+t.clientY,m=t.clientX,f=t.clientY,h=r[0].querySelectorAll(".dropdown-cascading-item ul");l>window.innerWidth&&(m-=l-window.innerWidth),p>window.innerHeight&&(f-=p-window.innerHeight),r.css({left:"".concat(m,"px"),top:"".concat(f,"px")}),n.arrangeSubmenus(h),setTimeout(function(){c.on("click",u),c.on("keydown",d)})}(l,t)})})})}}}]),angular.module("bandlab.common").directive("cookieConsent",["$cookies",function(e){return{restrict:"E",scope:{},templateUrl:"https://www.bandlab.com/web-app/common/partials/_cookie-consent-50abb368.html",link:function(t,n){if(e.get("cookieconsent_status")||/Prerender/.test(window.navigator.userAgent))return o();function o(){n.remove(),t.$destroy()}t.dismiss=function(){e.put("cookieconsent_status","dismiss"),o()}}}}]),angular.module("bandlab.common").directive("countryCodeSelector",["$http","CountryPhoneCodes",function(e,t){return{restrict:"A",require:"ngModel",link:function(n,o,a,i){var r=[];t.countries().$promise.then(function(e){e&&(r=e.map(function(e){return e.iso2Code.toLowerCase()}))}).finally(function(){var t=window.intlTelInput(o[0],{initialCountry:"auto",geoIpLookup:function(t){var n="https://api.ipdata.co?api-key=".concat("9ba84c7617a3cfde5f03f6d16397832ae5d216871f365f259ffdf2c8");e.get(n).then(function(e){var n=_.get(e,"data.country_code","");t(n)})},onlyCountries:r,utilsScript:"https://www.bandlab.com/web-app/common/workers/utils-5afc5567f3.js"});o[0].addEventListener("countrychange",function(){i.$setViewValue(t.getNumber())}),i.$validators.invalidPhoneNumber=function(){var e=t.getNumber();return i.$setViewValue(e),/^(\+)?[0-9\s-]{4,}$/.test(e)}})}}}]);var pt=[{code:4,alpha:"AF",name:"Afghanistan"},{code:248,alpha:"AX",name:"Åland Islands"},{code:8,alpha:"AL",name:"Albania"},{code:12,alpha:"DZ",name:"Algeria"},{code:16,alpha:"AS",name:"American Samoa"},{code:20,alpha:"AD",name:"Andorra"},{code:24,alpha:"AO",name:"Angola"},{code:660,alpha:"AI",name:"Anguilla"},{code:10,alpha:"AQ",name:"Antarctica"},{code:28,alpha:"AG",name:"Antigua and Barbuda"},{code:32,alpha:"AR",name:"Argentina"},{code:51,alpha:"AM",name:"Armenia"},{code:533,alpha:"AW",name:"Aruba"},{code:36,alpha:"AU",name:"Australia"},{code:40,alpha:"AT",name:"Austria"},{code:31,alpha:"AZ",name:"Azerbaijan"},{code:44,alpha:"BS",name:"Bahamas"},{code:48,alpha:"BH",name:"Bahrain"},{code:50,alpha:"BD",name:"Bangladesh"},{code:52,alpha:"BB",name:"Barbados"},{code:112,alpha:"BY",name:"Belarus"},{code:56,alpha:"BE",name:"Belgium"},{code:84,alpha:"BZ",name:"Belize"},{code:204,alpha:"BJ",name:"Benin"},{code:60,alpha:"BM",name:"Bermuda"},{code:64,alpha:"BT",name:"Bhutan"},{code:68,alpha:"BO",name:"Bolivia"},{code:535,alpha:"BQ",name:"Bonaire, Sint Eustatius and Saba"},{code:70,alpha:"BA",name:"Bosnia and Herzegovina"},{code:72,alpha:"BW",name:"Botswana"},{code:74,alpha:"BV",name:"Bouvet Island"},{code:76,alpha:"BR",name:"Brazil"},{code:86,alpha:"IO",name:"British Indian Ocean Territory"},{code:96,alpha:"BN",name:"Brunei Darussalam"},{code:100,alpha:"BG",name:"Bulgaria"},{code:854,alpha:"BF",name:"Burkina Faso"},{code:108,alpha:"BI",name:"Burundi"},{code:116,alpha:"KH",name:"Cambodia"},{code:120,alpha:"CM",name:"Cameroon"},{code:124,alpha:"CA",name:"Canada"},{code:132,alpha:"CV",name:"Cape Verde"},{code:136,alpha:"KY",name:"Cayman Islands"},{code:140,alpha:"CF",name:"Central African Republic"},{code:148,alpha:"TD",name:"Chad"},{code:152,alpha:"CL",name:"Chile"},{code:156,alpha:"CN",name:"China"},{code:162,alpha:"CX",name:"Christmas Island"},{code:166,alpha:"CC",name:"Cocos (Keeling) Islands"},{code:170,alpha:"CO",name:"Colombia"},{code:174,alpha:"KM",name:"Comoros"},{code:178,alpha:"CG",name:"Congo"},{code:180,alpha:"CD",name:"Congo, the Democratic Republic of the"},{code:184,alpha:"CK",name:"Cook Islands"},{code:188,alpha:"CR",name:"Costa Rica"},{code:384,alpha:"CI",name:"Cote D'Ivoire"},{code:191,alpha:"HR",name:"Croatia"},{code:192,alpha:"CU",name:"Cuba"},{code:531,alpha:"CW",name:"Curaçao"},{code:196,alpha:"CY",name:"Cyprus"},{code:203,alpha:"CZ",name:"Czech Republic"},{code:208,alpha:"DK",name:"Denmark"},{code:262,alpha:"DJ",name:"Djibouti"},{code:212,alpha:"DM",name:"Dominica"},{code:214,alpha:"DO",name:"Dominican Republic"},{code:218,alpha:"EC",name:"Ecuador"},{code:818,alpha:"EG",name:"Egypt"},{code:222,alpha:"SV",name:"El Salvador"},{code:226,alpha:"GQ",name:"Equatorial Guinea"},{code:232,alpha:"ER",name:"Eritrea"},{code:233,alpha:"EE",name:"Estonia"},{code:231,alpha:"ET",name:"Ethiopia"},{code:238,alpha:"FK",name:"Falkland Islands (Malvinas)"},{code:234,alpha:"FO",name:"Faroe Islands"},{code:242,alpha:"FJ",name:"Fiji"},{code:246,alpha:"FI",name:"Finland"},{code:250,alpha:"FR",name:"France"},{code:254,alpha:"GF",name:"French Guiana"},{code:258,alpha:"PF",name:"French Polynesia"},{code:260,alpha:"TF",name:"French Southern Territories"},{code:266,alpha:"GA",name:"Gabon"},{code:270,alpha:"GM",name:"Gambia"},{code:268,alpha:"GE",name:"Georgia"},{code:276,alpha:"DE",name:"Germany"},{code:288,alpha:"GH",name:"Ghana"},{code:292,alpha:"GI",name:"Gibraltar"},{code:300,alpha:"GR",name:"Greece"},{code:304,alpha:"GL",name:"Greenland"},{code:308,alpha:"GD",name:"Grenada"},{code:312,alpha:"GP",name:"Guadeloupe"},{code:316,alpha:"GU",name:"Guam"},{code:320,alpha:"GT",name:"Guatemala"},{code:831,alpha:"GG",name:"Guernsey"},{code:324,alpha:"GN",name:"Guinea"},{code:624,alpha:"GW",name:"Guinea-Bissau"},{code:328,alpha:"GY",name:"Guyana"},{code:332,alpha:"HT",name:"Haiti"},{code:334,alpha:"HM",name:"Heard Island and Mcdonald Islands"},{code:336,alpha:"VA",name:"Holy See (Vatican City State)"},{code:340,alpha:"HN",name:"Honduras"},{code:344,alpha:"HK",name:"Hong Kong"},{code:348,alpha:"HU",name:"Hungary"},{code:352,alpha:"IS",name:"Iceland"},{code:356,alpha:"IN",name:"India"},{code:360,alpha:"ID",name:"Indonesia"},{code:364,alpha:"IR",name:"Iran, Islamic Republic of"},{code:368,alpha:"IQ",name:"Iraq"},{code:372,alpha:"IE",name:"Ireland"},{code:833,alpha:"IM",name:"Isle of Man"},{code:376,alpha:"IL",name:"Israel"},{code:380,alpha:"IT",name:"Italy"},{code:388,alpha:"JM",name:"Jamaica"},{code:392,alpha:"JP",name:"Japan"},{code:832,alpha:"JE",name:"Jersey"},{code:400,alpha:"JO",name:"Jordan"},{code:398,alpha:"KZ",name:"Kazakhstan"},{code:404,alpha:"KE",name:"Kenya"},{code:296,alpha:"KI",name:"Kiribati"},{code:414,alpha:"KW",name:"Kuwait"},{code:417,alpha:"KG",name:"Kyrgyzstan"},{code:418,alpha:"LA",name:"Lao People's Democratic Republic"},{code:428,alpha:"LV",name:"Latvia"},{code:422,alpha:"LB",name:"Lebanon"},{code:426,alpha:"LS",name:"Lesotho"},{code:430,alpha:"LR",name:"Liberia"},{code:434,alpha:"LY",name:"Libya"},{code:438,alpha:"LI",name:"Liechtenstein"},{code:440,alpha:"LT",name:"Lithuania"},{code:442,alpha:"LU",name:"Luxembourg"},{code:446,alpha:"MO",name:"Macao"},{code:807,alpha:"MK",name:"Macedonia, the Former Yugoslav Republic of"},{code:450,alpha:"MG",name:"Madagascar"},{code:454,alpha:"MW",name:"Malawi"},{code:458,alpha:"MY",name:"Malaysia"},{code:462,alpha:"MV",name:"Maldives"},{code:466,alpha:"ML",name:"Mali"},{code:470,alpha:"MT",name:"Malta"},{code:584,alpha:"MH",name:"Marshall Islands"},{code:474,alpha:"MQ",name:"Martinique"},{code:478,alpha:"MR",name:"Mauritania"},{code:480,alpha:"MU",name:"Mauritius"},{code:175,alpha:"YT",name:"Mayotte"},{code:484,alpha:"MX",name:"Mexico"},{code:583,alpha:"FM",name:"Micronesia, Federated States of"},{code:498,alpha:"MD",name:"Moldova, Republic of"},{code:492,alpha:"MC",name:"Monaco"},{code:496,alpha:"MN",name:"Mongolia"},{code:499,alpha:"ME",name:"Montenegro"},{code:500,alpha:"MS",name:"Montserrat"},{code:504,alpha:"MA",name:"Morocco"},{code:508,alpha:"MZ",name:"Mozambique"},{code:104,alpha:"MM",name:"Myanmar"},{code:516,alpha:"NA",name:"Namibia"},{code:520,alpha:"NR",name:"Nauru"},{code:524,alpha:"NP",name:"Nepal"},{code:528,alpha:"NL",name:"Netherlands"},{code:540,alpha:"NC",name:"New Caledonia"},{code:554,alpha:"NZ",name:"New Zealand"},{code:558,alpha:"NI",name:"Nicaragua"},{code:562,alpha:"NE",name:"Niger"},{code:566,alpha:"NG",name:"Nigeria"},{code:570,alpha:"NU",name:"Niue"},{code:574,alpha:"NF",name:"Norfolk Island"},{code:408,alpha:"KP",name:"North Korea"},{code:580,alpha:"MP",name:"Northern Mariana Islands"},{code:578,alpha:"NO",name:"Norway"},{code:512,alpha:"OM",name:"Oman"},{code:586,alpha:"PK",name:"Pakistan"},{code:585,alpha:"PW",name:"Palau"},{code:275,alpha:"PS",name:"Palestinian Territory, Occupied"},{code:591,alpha:"PA",name:"Panama"},{code:598,alpha:"PG",name:"Papua New Guinea"},{code:600,alpha:"PY",name:"Paraguay"},{code:604,alpha:"PE",name:"Peru"},{code:608,alpha:"PH",name:"Philippines"},{code:612,alpha:"PN",name:"Pitcairn"},{code:616,alpha:"PL",name:"Poland"},{code:620,alpha:"PT",name:"Portugal"},{code:630,alpha:"PR",name:"Puerto Rico"},{code:634,alpha:"QA",name:"Qatar"},{code:638,alpha:"RE",name:"Reunion"},{code:642,alpha:"RO",name:"Romania"},{code:643,alpha:"RU",name:"Russian Federation"},{code:646,alpha:"RW",name:"Rwanda"},{code:652,alpha:"BL",name:"Saint Barthélemy"},{code:654,alpha:"SH",name:"Saint Helena"},{code:659,alpha:"KN",name:"Saint Kitts and Nevis"},{code:662,alpha:"LC",name:"Saint Lucia"},{code:663,alpha:"MF",name:"Saint Martin (French part)"},{code:666,alpha:"PM",name:"Saint Pierre and Miquelon"},{code:670,alpha:"VC",name:"Saint Vincent and the Grenadines"},{code:882,alpha:"WS",name:"Samoa"},{code:674,alpha:"SM",name:"San Marino"},{code:678,alpha:"ST",name:"Sao Tome and Principe"},{code:682,alpha:"SA",name:"Saudi Arabia"},{code:686,alpha:"SN",name:"Senegal"},{code:688,alpha:"RS",name:"Serbia"},{code:690,alpha:"SC",name:"Seychelles"},{code:694,alpha:"SL",name:"Sierra Leone"},{code:702,alpha:"SG",name:"Singapore"},{code:534,alpha:"SX",name:"Sint Maarten (Dutch part)"},{code:703,alpha:"SK",name:"Slovakia"},{code:705,alpha:"SI",name:"Slovenia"},{code:90,alpha:"SB",name:"Solomon Islands"},{code:706,alpha:"SO",name:"Somalia"},{code:710,alpha:"ZA",name:"South Africa"},{code:239,alpha:"GS",name:"South Georgia and the South Sandwich Islands"},{code:410,alpha:"KR",name:"South Korea"},{code:728,alpha:"SS",name:"South Sudan"},{code:724,alpha:"ES",name:"Spain"},{code:144,alpha:"LK",name:"Sri Lanka"},{code:729,alpha:"SD",name:"Sudan"},{code:740,alpha:"SR",name:"Suriname"},{code:744,alpha:"SJ",name:"Svalbard and Jan Mayen"},{code:748,alpha:"SZ",name:"Swaziland"},{code:752,alpha:"SE",name:"Sweden"},{code:756,alpha:"CH",name:"Switzerland"},{code:760,alpha:"SY",name:"Syrian Arab Republic"},{code:158,alpha:"TW",name:"Taiwan"},{code:762,alpha:"TJ",name:"Tajikistan"},{code:834,alpha:"TZ",name:"Tanzania, United Republic of"},{code:764,alpha:"TH",name:"Thailand"},{code:626,alpha:"TL",name:"Timor-Leste"},{code:768,alpha:"TG",name:"Togo"},{code:772,alpha:"TK",name:"Tokelau"},{code:776,alpha:"TO",name:"Tonga"},{code:780,alpha:"TT",name:"Trinidad and Tobago"},{code:788,alpha:"TN",name:"Tunisia"},{code:792,alpha:"TR",name:"Turkey"},{code:795,alpha:"TM",name:"Turkmenistan"},{code:796,alpha:"TC",name:"Turks and Caicos Islands"},{code:798,alpha:"TV",name:"Tuvalu"},{code:800,alpha:"UG",name:"Uganda"},{code:804,alpha:"UA",name:"Ukraine"},{code:784,alpha:"AE",name:"United Arab Emirates"},{code:826,alpha:"GB",name:"United Kingdom"},{code:581,alpha:"UM",name:"United States Minor Outlying Islands"},{code:840,alpha:"US",name:"United States of America"},{code:858,alpha:"UY",name:"Uruguay"},{code:860,alpha:"UZ",name:"Uzbekistan"},{code:548,alpha:"VU",name:"Vanuatu"},{code:862,alpha:"VE",name:"Venezuela"},{code:704,alpha:"VN",name:"Viet Nam"},{code:92,alpha:"VG",name:"Virgin Islands, British"},{code:850,alpha:"VI",name:"Virgin Islands, U.S."},{code:876,alpha:"WF",name:"Wallis and Futuna"},{code:732,alpha:"EH",name:"Western Sahara"},{code:887,alpha:"YE",name:"Yemen"},{code:894,alpha:"ZM",name:"Zambia"},{code:716,alpha:"ZW",name:"Zimbabwe"}];function mt(){var e=S(["Make sure you turn on your camera and microphone when you're making a Shout!"],["Make sure you turn on your camera and microphone when you\\'re making a Shout!"]);return mt=function(){return e},e}function ft(){var e=S(["Please turn on your camera"]);return ft=function(){return e},e}angular.module("bandlab.common").directive("countrySelector",["$compile",function(e){return{restrict:"A",require:"?ngModel",link:function(t,n,o,a){if(a){var i=o.required,r=o.countrySelector;n.css("display","none"),n[0].required=!1;var s=_.reduce(pt,function(e,t){var n="alpha"===r?t.alpha:"000";return"alpha"!==r&&(n=n.substring(0,n.length-t.code.toString().length)+t.code),"".concat(e,'<option value="').concat(n,'">').concat(t.name,"</option>")},""),c=angular.element('\n          <div class="select-wrapper">\n            <select ng-model="country" '.concat(i?"required":"",'>\n              <option value="">').concat("Country","</option>\n              ").concat(s,"\n            </select>\n          </div>\n        "));n.parent().append(c),e(c)(t),a.$render=function(){angular.isDefined(a.$viewValue)&&(null!==a.$viewValue?t.country=a.$viewValue:t.country="")},t.$watch("country",function(){a.$setViewValue(t.country)},!0)}}}}]),angular.module("bandlab.common").directive("datePicker",["$compile",function(e){for(var t=[],n=[],o=[],a=(new Date).getFullYear();a>=1900;a--)t.push('<option value="'.concat(a,'">').concat(a,"</option>"));for(var i=1;i<=12;i++)n.push('<option value="'.concat(i,'">').concat(i,"</option>"));for(var r=1;r<=31;r++)o.push('<option value="'.concat(r,'">').concat(r,"</option>"));var s='<div class="select-wrapper"><select ng-model="pickDate.day"><option value="0" selected>'.concat("Day","</option>").concat(o,"</select></div>"),c='<div class="select-wrapper"><select ng-model="pickDate.month"><option value="0" selected>'.concat("Month","</option>").concat(n,"</select></div>"),l='<div class="select-wrapper"><select ng-model="pickDate.year"><option value="0" selected>'.concat("Year","</option>").concat(t,"</select></div>"),u='<div class="date-picker-wrapper">'.concat(s).concat(c).concat(l,"</div>");return{restrict:"C",require:"ngModel",link:function(t,n,o,a){if(a){var i=angular.element(u);n.attr("type","hidden"),n.parent().append(i),e(i)(t),t.pickDate={year:0,month:0,day:0},a.$render=function(){if(angular.isDefined(a.$viewValue))if(null===a.$viewValue)t.pickDate={year:"0",month:"0",day:"0"};else{var e=new Date(a.$viewValue);t.pickDate={year:"".concat(e.getUTCFullYear()),month:"".concat(parseInt(e.getUTCMonth()+1)),day:"".concat(e.getUTCDate())}}},t.$watch("pickDate",function(){"0"===t.pickDate.year||"0"===t.pickDate.month||"0"===t.pickDate.day?(a.$setViewValue(null),a.$setValidity("complete",t.pickDate.year===t.pickDate.month&&t.pickDate.month===t.pickDate.day)):(a.$setValidity("complete",!0),a.$setViewValue("".concat(t.pickDate.year,"-").concat("0".concat(t.pickDate.month).slice(-2),"-").concat("0".concat(t.pickDate.day).slice(-2))))},!0)}}}}]),angular.module("bandlab.common").directive("dropdownMenu",["$animate","$compile","$parse","$rootScope","$templateRequest","$transitions","ContextMenu","Me",function(e,t,n,o,a,i,r,s){return{restrict:"A",link:function(c,l,u){var d,p,m,f=angular.element(document.body),h="parent"===u.dropdownMenuContainer&&l[0].parentElement||l[0].closest("main")||l[0].closest(".title-bar")||l[0].closest(".view-overlay")||l[0].closest(".modal-overlay")||document.body,g=l[0].closest(".modal")||document.body,v=l[0].closest(".modal-overlay")||l[0].closest(".view-overlay")||document.body,b=angular.noop;function y(a){function y(e){e.target.classList.contains("dropdown-cascading-item")||setTimeout(function(){w()},0)}function w(){if(r.currentMenu=null,b(),g.removeEventListener("click",y),document.body.removeEventListener("keydown",k),p){var t=m;e.leave(p),l.removeClass("active"),o.$applyAsync(function(){t.$destroy()}),m=null,p=null}}function k(e){13!==e.which&&9!==e.which&&27!==e.which||w()}a.stopPropagation(),r.currentMenu&&r.currentMenu!==p&&(r.currentMenu[0].style.display="none",r.currentMenuOpener.removeClass("active")),setTimeout(function(){!function(){if(p&&"none"!==p[0].style.display)w();else{w(),(m=c.$new()).me=s,u.dropdownMenuParse&&_.assignIn(m,n(u.dropdownMenuParse)(c));var o=document.body.classList.contains("player-visible")?52:0,a=v.scrollHeight-o;p=t(d)(m),f.append(p),m.$digest(),l.addClass("active"),b=i.onStart({},w),r.currentMenu=p,r.currentMenuOpener=l;var S=l[0].getBoundingClientRect(),P=p[0].getBoundingClientRect(),E=window.getScrollY(),T="parent"===u.dropdownMenuContainer?{left:0,top:"calc(100% + 4px)"}:{left:"".concat(Math.min(S.left,v.scrollWidth-P.width),"px"),top:"".concat(S.bottom+E+4,"px")},M=p[0].querySelectorAll(".dropdown-cascading-item ul"),$=function(e,t){return _.find(e.children,function(e){return e.matches(".selected")})}(p[0])||p[0].firstElementChild;!u.dropdownDirection&&S.bottom+P.height+E>a&&(u.dropdownDirection="parent"===u.dropdownMenuContainer?"up":"auto"),"parent"===u.dropdownMenuContainer?"right"===u.dropdownMenuAlign&&(T.left="auto",T.right=0):"center"===u.dropdownMenuAlign?T.left="".concat(S.left+S.width/2-P.width/2,"px"):"right"===u.dropdownMenuAlign&&(T.left="".concat(S.right-P.width,"px")),"up"===u.dropdownDirection?"parent"===u.dropdownMenuContainer?(T.bottom="calc(100% + 4px)",T.top="auto"):T.top="".concat(S.top-P.height+E-4,"px"):"auto"===u.dropdownDirection&&$&&($=$.getBoundingClientRect(),T.top="".concat(S.top-($.top-P.top)+E,"px"),T.maxHeight="".concat(P.height,"px"),parseInt(T.top)+parseInt(T.maxHeight)>a?(T.maxHeight="".concat(Math.min(P.height,a-4),"px"),T.top="".concat(Math.max(a-P.height-4,0),"px")):parseInt(T.top)<0&&(T.maxHeight="".concat(Math.min(P.height,a-4),"px"),T.top=0),P.height>a&&(T.overflow="auto"),T.minWidth="".concat(S.width,"px")),T.transformOrigin="".concat(u.dropdownMenuAlign||"left"," ").concat("up"===u.dropdownDirection?"bottom":"top"),p.css(T),r.arrangeSubmenus(M),setTimeout(function(){g.addEventListener("click",y),document.body.addEventListener("keydown",k)}),m.$on("$dropdownMenu:close",w),e.enter(p,h),m.$digest()}}()}),c.$on("dropdownMenuClosed",function(){w()})}l[0].closest(".global-player")&&(h=l[0].parentElement,u.dropdownMenuContainer="parent"),a(u.dropdownMenu).then(function(e){d=e,l.on("click",y)})}}}]),angular.module("bandlab.common").directive("focusOn",function(){return{link:function(e,t,n){e.$on("focusOn",function(e,o){o===n.focusOn&&setTimeout(function(){t[0].focus(),t[0].selectionStart=t[0].value.length})})}}}),angular.module("bandlab.common").directive("iframeOnload",function(){return{restrict:"A",scope:{onLoadCallback:"&iframeOnload",onInitCallback:"&iframeOninit"},link:function(e,t){function n(){e.$applyAsync(e.onLoadCallback())}e.$watch(function(){return t.attr("ng-src")},function(){e.$applyAsync(e.onInitCallback()),t[0].removeEventListener("load",n),t[0].addEventListener("load",n)})}}}),angular.module("bandlab.common").directive("infiniteScroll",["$q","$window",function(e,t){return{link:function(n,o,a){var i,r=100,s=n.$eval(a.infiniteScroll),c="scrollableParent"in a?o[0].parentElement:t,l=e.resolve();function u(){i||(requestAnimationFrame(d),i=!0)}function d(){var e;((e="scrollableParent"in a?c.scrollHeight-(c.scrollTop+c.clientHeight):document.documentElement.scrollHeight-(document.documentElement.clientHeight+window.getScrollY()))<r&&1===l.$$state.status||0===e&&-1===l.$$state.status)&&!document.getElementById("create-text-post")&&(l=l.then(function(){return s().catch(angular.noop)})),i=!1}angular.isFunction(s)&&(c.addEventListener("scroll",u),n.$on("$destroy",function(){c.removeEventListener("scroll",u)}))}}}]),angular.module("bandlab.common").directive("input",function(){return{require:["?ngModel"],restrict:"E",priority:100,link:{pre:function(e,t,n,o){o[0]&&(t.on("focus",function(){o[0].$focused=!0,e.$applyAsync()}),t.on("blur",function(){o[0].$focused=!1,e.$applyAsync()}))}}}}),angular.module("bandlab.common").directive("inputNumber",function(){return{require:"ngModel",link:function(e,t,n,o){t.on("keydown",function(e){if(13===e.which||27===e.which||32===e.which)return t[0].blur();8!==e.which&&(e.which<37||e.which>40)&&(e.which<48||e.which>57)&&e.preventDefault()}),t.bind("blur",function(){""===this.value||isNaN(this.value)?(this.value=parseInt(n.min),o.$setViewValue(this.value),o.$render()):(this.value=Math.min(this.value,n.max),this.value=Math.max(this.value,n.min))}),o.$parsers.push(function(e){return e=Math.max(e,n.min),Math.min(e,n.max)})}}}),angular.module("bandlab.common").directive("like",["$analytics","$http","$rootScope","appActions",function(e,t,n,o){return{restrict:"E",require:"ngModel",link:function(a,i,r){var s;a.$on("like",function(e,t){if(t.id===r.resourceId){var n=a.$eval(r.ngModel);n.counters.likes=t.count,n.isLiked=t.isLiked}}),a.toggleLike=function(){if(o.checkAllowed("like")&&(!s||0!==s.$$state.status)){var i=a.$eval(r.ngModel),c=i.isLiked?"delete":"post",l=(new Date).getTime(),u=!i.isLiked,d=r.likeEntity.toLowerCase(),p=r.resourceId,m=u?i.counters.likes+1:i.counters.likes-1;s=t[c]("https://www.bandlab.com/api/v1.3/".concat(d,"s/").concat(p,"/likes"),{ignoreLoadingBar:!0}).then(function(){ga("send","timing",_.startCase(d),u?"Like":"Unlike",(new Date).getTime()-l)}),n.$broadcast("like",{count:m,id:p,isLiked:u}),e.eventTrack(i.isLiked?"Like":"Unlike",{category:"Media",label:_.startCase(d)})}}}}}]),angular.module("bandlab.common").directive("loaderInfiniteScroll",function(){return{restrict:"E",replace:!0,templateNamespace:"svg",template:'\n        <svg class="loader loader-infinite-scroll" width="52px" height="52px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">\n          <g><path d="M77.5,45.3c0-15.3-12.3-27.8-27.5-27.8S22.5,29.9,22.5,45.3c0,13.3,9.3,24.5,21.7,27.1L50,82.5l5.8-10.1 C68.2,69.7,77.5,58.6,77.5,45.3z M50.3,55.4c-5.4,0-9.7-4.4-9.7-9.8c0-5.4,4.3-9.8,9.7-9.8s9.7,4.4,9.7,9.8 C60,51,55.7,55.4,50.3,55.4z" fill="#E5E5E5"></path></g>\n        </svg>\n      '}}).directive("loaderNoContent",function(){return{restrict:"E",replace:!0,templateNamespace:"svg",template:'\n        <svg class="loader loader-no-content" width="26px" height="26px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">\n          <g class="rect-container" transform="translate(25 25)">\n            <rect x="-20" y="-20" width="40" height="40" fill="#E5E5E5" opacity="0.9" class="cube"></rect>\n          </g>\n          <g class="rect-container" transform="translate(75 25)">\n            <rect x="-20" y="-20" width="40" height="40" fill="#E5E5E5" opacity="0.8" class="cube"></rect>\n          </g>\n          <g class="rect-container" transform="translate(75 75)">\n            <rect x="-20" y="-20" width="40" height="40" fill="#E5E5E5" opacity="0.7" class="cube"></rect>\n          </g>\n          <g class="rect-container" transform="translate(25 75)">\n            <rect x="-20" y="-20" width="40" height="40" fill="#E5E5E5" opacity="0.6" class="cube"></rect>\n          </g>\n        </svg>\n      '}}).directive("loaderWave",function(){return{restrict:"E",replace:!0,template:'\n        <div class="loader loader-wave">\n          <div></div>\n          <div></div>\n          <div></div>\n          <div></div>\n          <div></div>\n        </div>\n      '}}),angular.module("bandlab.common").directive("lockParentScroll",function(){return{restrict:"A",link:function(e,t){t.on("wheel",function(e){e.preventDefault(),t[0].scrollTop+=e.deltaY})}}}),angular.module("bandlab.common").directive("match",function(){return{require:"ngModel",restrict:"A",scope:{match:"="},link:function(e,t,n,o){e.$watch(function(){var t=o.$modelValue||o.$$invalidModelValue;return!t||e.match===t},function(e){o.$setValidity("match",e)})}}}),angular.module("bandlab.common").controller("MegaDropdownCtrl",["$rootScope","$scope","$state","EditorLoader","Me","PlayerHistory","Search","Song",function(e,t,n,o,a,i,r,s){try{t.shouldShowList=1===cxApi.chooseVariation()}catch(e){t.shouldShowList=!0}function c(t){"Escape"===t.key&&(e.$broadcast("mega-dropdown-tracks-modal","close"),e.$broadcast("mega-dropdown-menu","close"))}window.addEventListener("keyup",c),t.$on("$destroy",function(){window.removeEventListener("keyup",c)}),t.forkRevision=function(e){var t=o.pushTask("forkRevision");return s.fork({revisionId:e}).$promise.then(function(e){return n.go("mixEditor",{id:e.revision.id})}).then(function(){o.finishTask(t)})},i.setState({loader:angular.noop,url:"MegaDropdownCtrl"}),s.fromUser({id:a.id,limit:5}).$promise.then(function(e){t.songs=e}),r.posts({types:"revision",forkable:!0,limit:4,spotlights:"hip-hop"}).then(function(e){var n=e.data;t.spotlights=n,i.pushQueueSongs(t.spotlights,"MegaDropdownCtrl")})}]).controller("MegaDropdownTracksCtrl",["$q","$scope","$state","EditorLoader","Me","PlayerHistory","Search","Song",function(e,t,n,o,a,i,r,s){var c,l=20,u=!1,d=0,p=e.resolve();function m(){return u?e.resolve([]):p=t.spotlights?r.posts({types:"revision",forkable:!0,spotlights:t.spotlights,after:c,limit:l}).then(function(e){var t=e.data,n=e.paging;return u=n.itemsCount<l,c=_.get(n,"cursors.after",0),t}):s.fromUser({id:a.id,limit:l,offset:d}).$promise.then(function(e){return u=e.length<l,d+=e.length,e})}function f(){return t.infiniteScrollEnded?e.reject("No more results"):p=p.then(function(e){return t.infiniteScrollEnded=u,t.posts=t.posts||[],t.posts=t.posts.concat(e),i.pushQueueSongs(t.posts,"MegaDropdownTracksCtrl"),m()})}t.infiniteScrollEnded=!1,t.loadMore=f,t.forkRevision=function(e){var t=o.pushTask("forkRevision");return s.fork({revisionId:e}).$promise.then(function(e){return n.go("mixEditor",{id:e.revision.id})}).then(function(){o.finishTask(t)})},i.setState({loader:f,url:"MegaDropdownTracksCtrl"}),m().then(t.loadMore)}]).directive("megaDropdownOpener",function(){return{restrict:"A",link:function(e,t){t.on("click",function(){document.querySelector(".button-create").click()})}}}),angular.module("bandlab.common").directive("mobileStoreLink",["$analytics","$state","ClientDevice","Me",function(e,t,n,o){return{restrict:"A",scope:{eventLabel:"@"},link:function(a,i){if(!n.isAndroid&&!n.isiOs)return i.remove();var r="user.feed"===t.current.name?"user_page":_.includes(["userSong","bandSong"],t.current.name)?"revision_page":t.current.name,s=o.testGroupLabel,c=encodeURIComponent(a.eventLabel.toLowerCase()),l="promo_".concat(r,"_").concat(o.testGroup),u="https://itunes.apple.com/app/apple-store/id968585775?pt=117214159&ct=".concat(l,"&mt=8"),d="https://play.google.com/store/apps/details?"+["id=com.bandlab.bandlab","referrer=".concat(encodeURIComponent("utm_campaign=mobille_web_promo&utm_source=".concat(r,"&utm_medium=").concat(s,"&utm_content=").concat(c)))].join("&");function p(){e.eventTrack("External Link",{category:n.isAndroid?"Open Play Store":"Open App Store",label:a.eventLabel})}i[0].classList.add(n.isAndroid?"google-store":"apple-store"),i[0].setAttribute("href",n.isAndroid?d:u),i[0].setAttribute("rel","noopener"),i[0].setAttribute("target","noopener"),i[0].addEventListener("mousedown",p),a.$on("$destroy",function(){i[0].removeEventListener("mousedown",p)})}}}]),angular.module("bandlab.common").directive("ngFile",["$parse","$timeout",function(e,t){return{restrict:"A",require:"?ngModel",link:function(n,o,a,i){var r=e(a.ngFile).assign;o.bind("change",function(){var e=this,a=o[0].files?_.map(o[0].files,function(e){return e}):[];a.length&&(n.$emit("$ngFile:fileChanged",a),n.$apply(function(){r(n,a),i&&i.$setViewValue(a)}),t(function(){e.value=e.defaultValue}))})}}}]),angular.module("bandlab.common").directive("ngOnload",function(){return{restrict:"A",scope:{callback:"&ngOnload"},link:function(e,t){t.on("load",function(t){e.$apply(function(){e.callback({$event:t})})})}}});angular.module("bandlab.common").directive("photoBooth",["$analytics","$q","$state","$timeout","AppNotifications","ClientDevice","FileHelper","Me",function(e,t,n,o,a,i,r,s){return{replace:!0,restrict:"E",scope:{capture:"=",cancelCallback:"&",snapshotCallback:"&",submitCallback:"&"},link:function(c,l,u){if(c.isSupported="MediaRecorder"in window,c.isSupported)i.hasWebcam().then(function(e){c.hasWebcam=e,e?y():a.addNotification({title:i18n(ft()),content:i18n(mt()),autoclose:5e3})});else if(i.isMobile||i.isTablet)return n.go("unavailable");var d,p,m,f,h=l[0].querySelector("video"),g=l[0].querySelector('input[type="file"]');function v(){w(),h.pause(),c.cancelCallback()}function b(){if(c.useCountdown)return f=o(function e(){return c.countdown<=-1?t.reject():(c.countdown--,f=0===c.countdown?o(angular.noop):o(e,1e3))},1e3);c.countdown=0}function y(){return c.isPlaying=!0,d?t.resolve(d).then(function(e){return h.src=null,h.srcObject=e,h.play(),e}):d=navigator.mediaDevices.getUserMedia({audio:!0,video:{aspectRatio:1}}).then(function(e){return h.srcObject=e,h.volume=0,h.play(),e}).catch(function(){d=null,c.hasPermission=!1,a.addNotification({title:"BandLab Would Like to Access Your Camera",content:"This allows you to create videos and share them with the BandLab community.",autoclose:5e3}),v()})}function w(){o.cancel(f),t.when(d).then(function(e){e&&(_.forEach(e.getTracks(),function(e){e.stop()}),d=null)})}c.$on("$ngFile:fileChanged",function(n,o){var i=o[0],s=document.createElement("img");h.pause(),i.type.includes("image")?(c.capture.file=i,c.capture.isSquare=!1,c.capture.src=URL.createObjectURL(i),c.capture.previewSrc=c.capture.src,c.capture.type="photo",c.capture.import=!0,w(),s.src=c.capture.src,s.onload=function(){(m=document.createElement("canvas").getContext("2d")).canvas.height=s.height,m.canvas.width=s.width,m.drawImage(s,s.width/2,s.height/2,s.width,s.height)},e.eventTrack("Import a photo",{category:"Post",label:"Image"})):i.type.includes("video")&&function(e){var n=t.defer(),o=document.createElement("video");return o.onloadedmetadata=function(){o.duration<=300?n.resolve(e):n.reject(new Error("Video length should be less than ".concat(300," seconds.")))},o.onerror=function(){n.reject()},o.src=URL.createObjectURL(e),n.promise}(i).then(function(){return r.checkSize(i,50)}).then(function(){c.capture.file=i,c.capture.src=URL.createObjectURL(i),c.capture.type="video",c.capture.import=!0,c.countdown=-1,h.volume=1,h.onloadedmetadata=function(){h.onloadedmetadata=null,c.capture.duration=h.duration,c.capture.end=Math.min(300,c.capture.duration),c.capture.start=0,c.$applyAsync()},h.srcObject=null,h.src=c.capture.src,e.eventTrack("Import a video",{category:"Post",label:"Video"})}).catch(function(e){return a.addNotification({title:"Import Error",content:_.get(e,"message","Something went wrong. Please try again later."),classList:"alert",autoclose:8e3}),c.retake()})}),c.$on("photoCropperInfo",function(e,t){p=t}),c.cropPicture=function(){var e=document.createElement("img");e.src=c.capture.src,e.onload=function(){(m=document.createElement("canvas").getContext("2d")).canvas.height=800,m.canvas.width=800,m.drawImage(e,p.x,p.y,p.width,p.height,0,0,800,800),m.canvas.toBlob(function(e){c.capture.isSquare=!0,c.capture.src=URL.createObjectURL(e),c.capture.file=e,c.capture.previewSrc=c.capture.src,c.$applyAsync()})}},c.importPicture=function(){setTimeout(function(){g.click()})},c.startRecording=function(){c.countdown=3,t.when(b()).then(y).then(function(e){var n,o,a,i;c.record=(n=new MediaRecorder(e,{mimeType:"video/webm"}),o=t.defer(),a=[],i=performance.now(),n.ondataavailable=function(e){if(a.push(e.data),c.duration=(performance.now()-i)/1e3,c.$digest(),c.duration>=14.5)return n.ondataavailable=null,c.stopRecording()},n.onstop=function(){o.resolve({duration:(performance.now()-i)/1e3,file:new Blob(a,{type:"video/webm"}),height:h.videoHeight,width:h.videoWidth})},o.promise.stop=function(){return n.stop(),o.promise},n.start(500),o.promise)})},c.stopRecording=function(){c.record&&c.record.stop().then(function(e){if(e.file.size)return c.capture.file=e.file,c.capture.src=URL.createObjectURL(e.file),c.capture.duration=e.duration,c.capture.end=e.duration,c.capture.start=0,c.capture.import=!1,w();c.retake()}).then(function(){c.countdown=-1,h.srcObject=null,h.src=c.capture.src,h.volume=1,e.eventTrack("Record a video",{category:"Post",label:"Video"})})},c.retake=function(){return o.cancel(f),c.capture={type:c.capture.type,start:0},c.countdown=-1,c.duration=0,c.record=null,c.videoStatus=null,c.resetCaption(),y()},c.me=s,c.cancel=v,c.submit=function(){return w(),h.pause(),"video"===c.capture.type?function(e){var n=document.createElement("canvas").getContext("2d"),o=document.createElement("video"),a=t.defer();return o.src=URL.createObjectURL(e.file),o.currentTime=Math.round(e.start+(e.end-e.start)/10),o.addEventListener("canplay",function(){n.canvas.width=o.videoWidth,n.canvas.height=o.videoHeight,n.drawImage(o,0,0,n.canvas.width,n.canvas.height),n.canvas.toBlob(function(e){e.name="previewPicture.jpg",a.resolve({file:e,src:URL.createObjectURL(e)})},"image/jpeg")}),a.promise}(c.capture).then(function(e){c.capture.previewSrc=e.src,c.capture.previewFile=e.file,c.submitCallback(c.capture)}):t.resolve(c.rasterizeCaption(m)).then(function(e){e.canvas.toBlob(function(e){return c.capture.src=URL.createObjectURL(e),c.capture.file=e,c.capture.previewSrc=c.capture.src,c.capture.caption=c.caption.text,c.snapshotCallback({file:e,height:h.videoHeight,src:URL.createObjectURL(e),type:c.capture.type,width:h.videoWidth}),c.submitCallback(c.capture)})})},c.snapshot=function(){c.countdown=3,t.when(b()).then(function(){(m=document.createElement("canvas").getContext("2d")).canvas.height=800,m.canvas.width=800;var e=function(e){var t=800,n=800,o=0,a=0;return e.videoWidth>e.videoHeight?(n=800,o=0,a=(800-(t=800/e.videoWidth*e.videoHeight))/2):e.videoWidth<e.videoHeight&&(t=800,o=(800-(n=800/h.videoWidth*e.videoHeight))/2,a=0),{offsetX:o,offsetY:a,resizedHeight:t,resizedWidth:n}}(h),t=e.offsetX,n=e.offsetY,o=e.resizedHeight,a=e.resizedWidth;return m.fillRect(0,0,800,800),m.save(),m.translate(m.canvas.width,0),m.scale(-1,1),m.drawImage(h,t,n,a,o),m.restore(),w(),c.capture.src=!0,c.countdown=-1,c.rasterizeCaption(m)}).then(function(){m.canvas.toBlob(function(e){c.capture.src=URL.createObjectURL(e),c.capture.file=e,c.capture.previewSrc=c.capture.src,c.capture.isSquare=!0,c.capture.import=!1,c.snapshotCallback({file:e,height:h.videoHeight,isSquare:!0,src:URL.createObjectURL(e),type:c.capture.type,width:h.videoWidth}),c.$applyAsync()})})},c.record=null,c.countdown=-1,c.duration=0,c.useCountdown=!1,c.withSwitcher="withSwitcher"in u,c.$on("$destroy",function(){setTimeout(function(){w()},350)})},templateUrl:"https://www.bandlab.com/web-app/common/partials/_photo-booth-e8848dab.html"}}]);var ht=0,gt=_.once(function(){return document.querySelector("body > main")});function vt(){if(!--ht){var e=gt(),t=Math.abs(parseFloat(e.style.top));e.classList.remove("no-scroll"),e.style.top="",window.scrollTo(0,t)}}function bt(){if(!ht++){var e=gt();e.style.top="-".concat(window.getScrollY(),"px"),e.classList.add("no-scroll")}}function yt(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function wt(){var e=S(["BandLab for iOS"]);return wt=function(){return e},e}function kt(){var e=S(["BandLab for Android"]);return kt=function(){return e},e}angular.module("bandlab.common").directive("photoCropper",function(){return{replace:!0,restrict:"E",template:'<div class="photo-cropper"><div class="photo-cropper-handle"></div></div>',link:function(e,t,n){var o,a,i,r=t.parent();function s(){var r,s;1===e.ratio?a<i?s=(r=Math.min(a,parseInt(t[0].getBoundingClientRect().height*o)))*e.ratio:r=(s=Math.min(i,parseInt(t[0].getBoundingClientRect().width*o)))*e.ratio:(r=Math.min(a,parseInt(t[0].getBoundingClientRect().height*o)),s=Math.min(i,parseInt(t[0].getBoundingClientRect().width*o))),e.$emit("photoCropperInfo",{src:n.photoSrc,x:Math.max(0,parseInt(parseInt(getComputedStyle(t[0]).left)*o)),y:Math.max(0,parseInt(parseInt(getComputedStyle(t[0]).top)*o)),height:r,width:s,zoom:o})}function c(e){return e.touches?e.touches[0]:e}n.$observe("photoSrc",function(c){if(c){var l=new Image;l.src=c,l.onload=function(){var c,u,d,p,m,f,h,g;a=l.height,i=l.width,h=Math.min(r[0].getBoundingClientRect().width,i),g=a*h/i,e.ratio=parseFloat(n.ratio),isNaN(e.ratio)&&(e.ratio=null),o=i/h,u=(c=(e.minWidth||n.minWidth)/o)/e.ratio,e.ratio<h/g?(p=g,d=g*e.ratio):e.ratio>h/g?(d=h,p=h/e.ratio):(p=Math.min(h,g),d=Math.min(h,g)),m=(h-d)/2,f=(g-p)/2,t.css("min-height","".concat(u,"px")),t.css("min-width","".concat(c,"px")),t.css("left","".concat(m,"px")),t.css("top","".concat(f,"px")),t.css("height","".concat(p,"px")),t.css("width","".concat(d,"px")),s()}}}),function(){var e,n,o,a,i,l,u,d;function p(r){var s=c(r),p=s.screenX,m=s.screenY,f=Math.min(i,Math.max(p-n,l)),h=Math.min(u,Math.max(m-e,d));t.css("left","".concat(o+f,"px")),t.css("top","".concat(a+h,"px")),r.preventDefault()}function m(){t.removeClass("moving"),angular.element(window).off("mousemove touchmove",p),angular.element(window).off("mouseup touchend",m),s(),vt()}t.on("mousedown touchstart",function(s){s.stopPropagation(),function(s){bt(),t.addClass("moving");var f=r[0].getBoundingClientRect(),h=t[0].getBoundingClientRect();l=f.left-h.left,i=f.right-h.right,u=f.bottom-h.bottom,d=f.top-h.top,o=h.left-f.left,a=h.top-f.top;var g=c(s);n=g.screenX,e=g.screenY,angular.element(window).on("mousemove touchmove",p),angular.element(window).on("mouseup touchend",m)}(s)})}(),function(){var n,o,a,i,l,u,d,p;function m(r){r.preventDefault();var s=c(r),m=s.screenX,f=s.screenY,h=m-n,g=i+(f-o),v=e.ratio?g*e.ratio:a+h;t.css("width","".concat(Math.max(p,Math.min(v,u)),"px")),t.css("height","".concat(Math.max(d,Math.min(g,l)),"px"))}function f(){t.removeClass("resizing"),angular.element(window).off("mousemove touchmove",m),angular.element(window).off("mouseup touchend",f),s(),vt()}angular.element(t[0].querySelector(".photo-cropper-handle")).on("mousedown touchstart",function(s){s.stopPropagation(),function(s){bt();var h=c(s);n=h.screenX,o=h.screenY,p=parseInt(t.css("min-width")),d=parseInt(t.css("min-height"));var g=r[0].getBoundingClientRect();l=g.height-parseInt(t.css("top")),u=g.width-parseInt(t.css("left")),1===e.ratio&&(l=Math.min(l,u),u=Math.min(l,u)),t.addClass("resizing"),t.css("max-height","".concat(l,"px")),t.css("max-width","".concat(u,"px"));var v=t[0].getBoundingClientRect();a=v.width,i=v.height,angular.element(window).on("mousemove touchmove",m),angular.element(window).on("mouseup touchend",f)}(s)})}()}}}),angular.module("bandlab.common").directive("pictureModal",["Modal",function(e){return{restrict:"A",scope:{picture:"=pictureModal"},link:function(t,n){n.on("click",function(){new e({template:'<div><img src="'.concat(t.picture,'" alt="" width="600"></div>')}).show()})}}}]),angular.module("bandlab.common").directive("pictureUpload",["$injector","$rootScope","authService","FileHelper","Identity","Me","Modal",function(e,n,o,a,i,r,s){var c;return{restrict:"C",controller:["$scope","ClientDevice",function(e,t){e.supportWebcam=!t.isMobile&&!t.isTablet,e.maxHeight=4096,e.maxWidth=4096,e.maxImageSize=10,e.$on("FileErrorFormat",function(){e.error="format-not-supported",e.$digest()}),e.$on("FileErrorLarge",function(){e.error="file-too-large",e.$digest()}),e.$on("pictureUploadErrorMany",function(){alert("Please select only one file")}),e.$on("pictureUploadTrigger",function(){e.uploadImage()})}],link:function(l,u,d){var p=window.File&&window.FileReader&&window.FileList&&window.Blob,m=angular.element(u[0].querySelector(".picture-upload-drop-area")),f=u[0].querySelector(".picture-upload-file-input");function h(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).rotate,n=void 0===t?0:t;l.isLoading=!0,l.error="",a.checkType(e).then(function(e){return a.checkSize(e,l.maxImageSize)}).then(function(e){return a.createImageElement(e,{minWidth:l.minWidth,minHeight:l.minHeight,maxWidth:l.maxWidth,maxHeight:l.maxHeight,rotate:n%360})}).then(function(e){l.setImageSrc(e.image.src),c=e.file}).catch(function(e){l.error=e.message}).finally(function(){l.isLoading=!1})}l.isPhotoBoothDisplayed=!1,l.withPhotoBooth=Modernizr.getusermedia&&d.withPhotoBooth,l.ratio=isNaN(d.ratio)?1:parseFloat(d.ratio),l.uploadButton=!1!==l.$eval(d.uploadButton),l.minWidth=isNaN(d.minWidth)?120:parseInt(d.minWidth),l.minHeight=l.minWidth&&l.ratio?Math.ceil(l.minWidth/l.ratio):120,l.selectFile=function(){setTimeout(function(){f.click()},0)},l.rotateImage=function(e){h(c,{rotate:e})},l.openPhotoBooth=function(){var e=new s({id:"photoBoothModal",templateUrl:"https://www.bandlab.com/web-app/common/partials/_picture-upload-photo-booth-modal-10df76c2.html",contentScope:{capture:{type:"photo"},removePicture:l.removePicture,setFile:function(t){l.setFile(t),e.destroy()},setImageSrc:l.setImageSrc}});e.show()},l.removePicture=function(){f.value="",l.imageSrc=""},l.setImageSrc=function(e){l.imageSrc=e},l.setFile=function(e){c=e},l.$on("photoCropperInfo",function(e,t){t.src===l.imageSrc&&(l.cropOps=t)}),l.$on("$ngFile:fileChanged",function(e,t){h(t[0])}),l.uploadImage=function(){var s="https://storage.bandlab.com/v1.3/images/".concat(d.entity);l.isLoading=!0,a.upload(c,s,{params:{x:l.cropOps.x,y:l.cropOps.y,width:l.cropOps.width,height:l.cropOps.height}}).then(function(n){var a=n.data;return d.entity&&d.id?function(n,a){var s={id:n.id,picture:a,pictureId:a.id};switch(n.entity){case"bands":case"classrooms":return e.get("Band").update(s).$promise;case"users":return new i(function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?yt(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):yt(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},s,{username:r.username})).$update().then(function(e){return o.setMe(e),r});case"songs":return e.get("Song").update(s).$promise;case"communities":return e.get("Community").update(s).$promise;case"collections":return e.get("Collection").update(s).$promise;default:return Promise.reject()}}(d,a):Promise.resolve()}).then(function(){l.removePicture(),n.$broadcast("pictureUploadSuccess")}).finally(function(){l.isLoading=!1})},p&&(m.on("dragenter",function(e){e.preventDefault(),e.stopPropagation(),m.addClass("drag-over")}),m.on("dragleave",function(e){e.preventDefault(),e.stopPropagation(),m.removeClass("drag-over")}),m.on("dragover",function(e){e.stopPropagation(),e.preventDefault(),m.addClass("drag-over")}),m.on("drop",function(e){var t=_.get(e,"dataTransfer.files",[]);if(e.preventDefault(),e.stopPropagation(),m.removeClass("drag-over"),t.length)return t.length>1?l.$broadcast("pictureUploadErrorMany"):h(t[0])}))},templateUrl:"https://www.bandlab.com/web-app/common/partials/_picture-upload-2ef55000.html"}}]),angular.module("bandlab.common").directive("profilePopover",["$animate","$compile","$injector","$q","$rootScope","$timeout","ClientDevice",function(e,t,n,o,a,i,r){return{restrict:"A",scope:{profilePopoverData:"<",profilePopoverType:"@",profilePopoverCssClass:"@"},link:function(s,c,l){if(!r.isMobile&&s.profilePopoverType&&!c[0].closest(".popover")){var u,d,p,m,f,h,g=s.profilePopoverType,v=function(e){switch(e){case"Band":return'<band-profile-popover band="::band"></band-profile-popover>';case"Revision":return'<revision-profile-popover revision="::revision"></revision-profile-popover>';case"Song":return'<project-profile-popover song="::song"></project-profile-popover>';case"User":return'<user-profile-popover user="::user"></user-profile-popover>';case"Comment":return'<comment-popover comment="::comment.comment" revision="::comment.revision"></comment-popover>';default:return}}(g),b=angular.noop,y=_.debounce(T,400),w=k();s.$on("$destroy",E),s.$on("$popover:destroy",E),d=_.debounce(function(e){p=!1,y.cancel(),"Comment"!==g?function(){if(!h||f!==l.profilePopoverId){var e=n.get(g).get({id:l.profilePopoverId}).$promise;return e.then(function(e){f=l.profilePopoverId,h=e,"User"===g&&(b(),b=s.$on("$user:relationChanged",function(e,t){t.user.id===l.profilePopoverId&&(h=null,b())}))}),e}return o.resolve(h)}().then(function(e){p||S(0,e)}):S(0,s.profilePopoverData)},400,"Comment"===g?{leading:!0,trailing:!1}:null),c.on("mouseover",d),c.on("mouseleave",P)}function S(n,o){var r;(u=document.getElementById(w))&&u.remove(),(m=a.$new())[g.toLowerCase()]=o,u=angular.element('<div class="popover popover-'.concat(g.toLowerCase()," ").concat(s.profilePopoverCssClass||"",' animate" id="').concat(w,'"><div class="popover-placeholder"></div>').concat(v,"</div>")),t(u)(m),u.on("mouseleave",P),u.on("mouseover",function(){y.cancel()}),u[0].style.visibility="hidden",window.addEventListener("scroll",E),r=function(){u&&e.enter(u,document.body,document.body.lastChild).then(function(){requestAnimationFrame(function(){var e=u&&u[0].querySelector(".popover-content");if(e){var t=c[0].getBoundingClientRect(),n=-e.offsetHeight+t.top,o=e.offsetWidth+t.right;n>0?(u[0].classList.add("above"),u[0].style.top="".concat(t.top-e.scrollHeight,"px")):(u[0].classList.add("below"),u[0].style.top="".concat(t.bottom,"px")),o>window.innerWidth?(u[0].classList.add("rtl"),u[0].style.left="".concat(t.right-e.scrollWidth+12,"px")):(u[0].classList.add("ltr"),u[0].style.left="".concat(t.left-12,"px")),u[0].style.visibility=""}})})},setTimeout(function(){setTimeout(function(){setTimeout(function(){i(r)},0)},0)},0)}function P(){d.cancel(),p=!0,y()}function E(){d.cancel(),p=!0,T()}function T(){window.removeEventListener("scroll",E),u&&(e.leave(u).then(function(){m.$destroy(),u=null}),m.$applyAsync())}}}}]),angular.module("bandlab.common").directive("progress",function(){var e=22;return{link:function(t,n,o){var a,i,r=t.$eval(o.progressOnStart),s=t.$eval(o.progressOnMove),c=t.$eval(o.progressOnEnd),l="vertical"!==o.progress,u={},d=[];function p(){u=n[0].getBoundingClientRect(),angular.isFunction(r)&&(l?(a=d[0]-u.left,r(a/u.width,a)):(a=d[1]-u.top,r(1-a/u.height)),t.$applyAsync())}function m(e,n){angular.isFunction(s)&&(l?(a=Math.max(e-u.left,0),a=Math.min(a,u.width),s(a/u.width,a,d[1]-n)):(a=Math.max(n-u.top,0),a=Math.min(a,u.height),s(1-a/u.height,d[1]-n)),t.$applyAsync())}function f(){angular.isFunction(c)&&(l?(a=Math.max(d[0]-u.left,0),a=Math.min(a,u.width),c(a/u.width,a)):c(1-a/u.height),t.$applyAsync()),d=[]}function h(e){e.preventDefault(),m(e.clientX,e.clientY)}function g(t){l&&Math.abs(t.touches[0].clientY-d[1])>e||(i>10&&t.preventDefault(),i++,m(t.touches[0].clientX,t.touches[0].clientY))}function v(){document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",v),f()}function b(){document.removeEventListener("touchmove",g),document.removeEventListener("touchend",b),f()}n[0].addEventListener("mousedown",function(e){1===e.which&&(d=[e.clientX,e.clientY],p(),document.addEventListener("mousemove",h,!1),document.addEventListener("mouseup",v,!1))},!1),n[0].addEventListener("touchstart",function(e){0!==e.which||e.touches.length>1||(i=0,d=[e.touches[0].clientX,e.touches[0].clientY],p(),document.addEventListener("touchmove",g,{passive:!1}),document.addEventListener("touchend",b,!1),document.addEventListener("touchcancel",b,!1))},!1)}}}),angular.module("bandlab.common").directive("richText",["$analytics","$filter","appActions","Player",function(e,t,n,o){return{scope:{richText:"=",revision:"="},link:function(a,i,r){function s(e){return e=(e=t("link")(e)).replace(/&#10;/gi,"\n"),e=t("userMention")(e),e=t("tag")(e),a.revision&&a.revision.id&&/revision\.description/.test(r.richText)&&(e=t("songTime")(e)),e.replace(/\n/gi,"&#10;")}i.append(s(a.richText)),i.on("click",function(t){if("TIME"===t.target.nodeName){var i=t.target.innerHTML.split(":"),r=60*i[0],s=parseInt(r,10)+parseInt(i[1],10);o.goToTimeAndPlay(a.revision,s),e.eventTrack("Time Marker Click",{category:"Revision",label:a.richText===a.revision.description?"Description Link":"Comment Body Link"})}else t.target.closest("[hashtag]")&&!n.checkAllowed("search")&&t.preventDefault()}),":"===r.richText.charAt(0)&&":"===r.richText.charAt(1)||a.$watch("richText",function(){i.empty(),i.append(s(a.richText))})}}}]),angular.module("bandlab.common").directive("sideNav",["$compile","$window",function(e,t){return{restrict:"C",link:function(n,o){var a,i;function r(e){var t=o[0].querySelector('.side-nav-item[href="'.concat(e,'"]'));t&&t.click(),setTimeout(function(){s()},200)}function s(){i.options=_.map(o[0].querySelectorAll(".side-nav-item"),function(e){var t=e.getAttribute("href"),n=e.previousElementSibling,o=n&&!n.classList.contains("side-nav-separator")?"-":"";return{value:t,label:"".concat(o).concat(e.innerText)}})}setTimeout(function(){a&&a.length&&(i.$destroy(),a.remove()),(i=n.$new(!0)).followLink=r,i.sideNavItemUrl=t.location.pathname+t.location.search,s(),a=angular.element('<div class="side-nav-select">\n              <div class="select-wrapper">\n                <select ng-model="sideNavItemUrl" ng-change="followLink(sideNavItemUrl)">\n                  <option\n                    ng-repeat="opt in options"\n                    ng-disabled="!opt.value"\n                    value="{{opt.value}}">\n                    {{opt.label}}\n                  </option>\n                </select>\n              </div>\n            </div>'),o.parent().append(a),e(a)(i)},100)}}}]),angular.module("bandlab.common").directive("slugify",function(){return{require:"ngModel",restrict:"A",link:function(e,t,n,o){o.$parsers.push(function(e){var t=e.replace(/[^a-z0-9]+/gi,"-");return t!==e&&(o.$setViewValue(t),o.$render()),t})}}}),angular.module("bandlab.common").directive("switch",function(){return{restrict:"E",replace:!0,require:"ngModel",scope:{label:"@"},template:'\n        <span class="switch-container" ng-click="toggle()">\n          <div class="switch {{ isChecked ? \'on\' : \'\' }}">\n            <input type="checkbox" class="visually-hidden" ng-model="isChecked">\n          </div>\n          <span class="switch-label">{{ ::label }}</span>\n        </span>\n      ',link:function(e,t,n,o){o.$formatters.unshift(function(t){return e.isChecked=!0===t,t}),e.toggle=function(){e.isChecked=!e.isChecked,o.$setViewValue(e.isChecked)}}}}),angular.module("bandlab.common").component("textTruncate",{bindings:{maxCharacters:"<",maxWords:"<",maxLines:"<",zeroCaseText:"@",text:"<"},transclude:!0,templateUrl:"https://www.bandlab.com/web-app/common/partials/_text-truncate-b3ebdef8.html",controllerAs:"vm",controller:["$filter",function(e){var t=this;function n(){t.truncatedText=e("textTruncate")({content:t.text},t.maxCharacters,t.maxWords,t.maxLines)}t.truncatedText="",t.isTruncated=!0,t.$onInit=n,t.$onChanges=n}]}),angular.module("bandlab.common").directive("fieldErrorUsername",function(){return{restrict:"E",scope:{form:"="},replace:!0,templateUrl:"https://www.bandlab.com/web-app/common/partials/_field-error-username-f5a66a42.html"}}),angular.module("bandlab.common").directive("usernamize",function(){return{require:"ngModel",restrict:"A",link:function(e,t,n,o){o.$parsers.push(function(e){var t=e.replace(/[^a-z0-9]+/gi,"_");return t!==e&&(o.$setViewValue(t),o.$render()),t})}}}),angular.module("bandlab.common").directive("videoModal",["Modal",function(e){return{restrict:"A",scope:{video:"=videoModal"},link:function(t,n){n.on("click",function(){new e({template:'<video-tile video="video" class="large"></video>',contentScope:{video:{autoplay:!0,id:t.video.id,picture:{s:t.video.image},status:"Ready"}}}).show()})}}}]),angular.module("bandlab.common").directive("viewOverlay",["$state","$window",function(e,t){return{restrict:"C",link:function(n,o){function a(t){-1!==["INPUT","TEXTAREA"].indexOf(t.target.nodeName)&&"file"!==t.target.type||o.hasClass("is-active")&&27===t.keyCode&&e.go("^")}n.closeOverlay=function(t){(t.target.classList.contains("view-overlay")||t.target.classList.contains("close-button"))&&o[0].classList.contains("is-active")&&e.go("^")},t.addEventListener("keyup",a),n.$on("$destroy",function(){t.removeEventListener("keyup",a)})}}}]),angular.module("bandlab.common").component("zeroCase",{bindings:{title:"@?",subtitle:"@?",type:"@?"},transclude:{actions:"?zeroCaseAction"},template:'\n      <article class="zero">\n        <div class="zero-illustration {{ ::(vm.type || \'all\') }}"></div>\n        <h2 ng-hide="::(vm.title === \'\')"\n            ng-bind="::(vm.title || \''.concat("Nothing to see here…","')\">\n        </h2>\n        <h5 ng-hide=\"::(vm.subtitle === '')\"\n            ng-bind-html=\"::(vm.subtitle || '").concat("Check back later.",'\')">\n        </h5>\n        <div ng-transclude="actions">\n          <a class="button scs single" ui-sref="explore.home">\n            <span>').concat("Explore BandLab","</span>\n          </a>\n        </div>\n      </article>\n    "),controllerAs:"vm"}),angular.module("bandlab.common").filter("bigNumber",function(){return function(e){var t;if(!angular.isUndefined(e))return e<1e3?e:e<1e6?(t=e/1e3,Math.floor(t)<10?"".concat(t.toFixed(2),"K"):Math.floor(t)<100?"".concat(t.toFixed(1),"K"):"".concat(t.toFixed(0),"K")):(t=e/1e6,Math.floor(t)<10?"".concat(t.toFixed(2),"M"):Math.floor(t)<100?"".concat(t.toFixed(1),"M"):"".concat(t.toFixed(0),"M"))}}),angular.module("bandlab.common").filter("domainName",function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{return new URL(e).hostname.replace(/^www\./,"")}catch(t){return e}}}),angular.module("bandlab.common").filter("duration",function(){return function(e){return angular.isUndefined(e)?"00:00":(o=(e=Math.round(e))-3600*(t=Math.floor(e/3600))-60*(n=Math.floor((e-3600*t)/60)),t>0?"".concat("0".concat(t).slice(-2),":").concat("0".concat(n).slice(-2)):"".concat("0".concat(n).slice(-2),":").concat("0".concat(o).slice(-2)));var t,n,o}}),angular.module("bandlab.common").filter("fromCountryCode",function(){return function(e){e=parseInt(e);var t=_.find(pt,{code:e});return t&&t.name||""}}),angular.module("bandlab.common").filter("fullDate",function(){return _.memoize(function(e){if(e)return new Date(e).toLocaleString("en",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})})}).filter("mediumDate",function(){return _.memoize(function(e){if(e)return new Date(e).toLocaleString("en",{day:"numeric",month:"short",year:"numeric"})})}),angular.module("bandlab.common").filter("link",["$sanitize","ChatHelper",function(e,t){return function(n){var o="",a=0;return _.forEach(t.getUrls(n),function(e){var t=e.includes("://")?"":"//",i=n.indexOf(e,a),r=n.substring(a,i),s="<a href=".concat(t).concat(e,' rel="noopener" target="_target">').concat(e,"</a>");o="".concat(o).concat(r).concat(s),a=i+e.length}),o="".concat(o).concat(n.substring(a,n.length)),e(o)}}]),angular.module("bandlab.common").filter("listTags",function(){return function(e){return _.map(e,function(e){return e.name}).join(", ")}}),angular.module("bandlab.common").filter("localizeRole",function(){return function(e){return{Admin:"Admin",Owner:"Owner",Member:"Member"}[e]}}),angular.module("bandlab.common").filter("location",["$filter",function(e){return function(t){if(t)return t.name?t.name:"".concat(t.city?"".concat(t.city,", "):""," ").concat(e("fromCountryCode")(t.countryCode||t.country))}}]),angular.module("bandlab.common").filter("masteringName",function(){return function(e){switch(e){case"cd-master":case"cdMaster":return"CD Quality";case"bass-boost":case"bassBoostMastering":return"Bass Boost";case"enhance-clarity":case"enhanceClarity":return"Enhance Clarity";case"custom":return"Custom";default:return"None"}}}),angular.module("bandlab.common").directive("ngPluralizeHtml",["$interpolate","$locale",function(e,t){var n=/{}/g,o=/^when(Minus)?(.+)$/;return{restrict:"EA",link:function(a,i,r){var s,c=r.count,l=r.$attr.when&&i.attr(r.$attr.when),u=r.offset||0,d=a.$eval(l)||{},p={},m=e.startSymbol(),f=e.endSymbol(),h="".concat(m).concat(c,"-").concat(u).concat(f),g=angular.noop;function v(e){i.html(e||"")}angular.forEach(r,function(e,t){var n=o.exec(t);if(n){var a="".concat(n[1]?"-":"").concat(n[2].toLowerCase());d[a]=i.attr(r.$attr[t])}}),angular.forEach(d,function(t,o){p[o]=e(t.replace(n,h))}),a.$watch(c,function(e){var n=parseFloat(e),o=isNaN(n);if(o||n in d||(n=t.pluralCat(n-u)),!(n===s||o&&isNaN(s))){g();var i=p[n];angular.isUndefined(i)?(g=angular.noop,v()):g=a.$watch(i,v),s=n}})}}}]),angular.module("bandlab.common").filter("platformIcon",["$sce",function(e){return function(t){var n=function(e){switch(t){case"Android":case"BandLab-Android":return{icon:"android",name:i18n(kt())};case"Angular":case"BandLab-Web":case"BandLabEdu-Web":case"BandLabLive-Web":case"Edu":return{icon:"laptop",name:"BandLab.com"};case"BandLab-iOS":case"iOS":case"IOS":return{icon:"apple",name:i18n(wt())}}}();return n?e.trustAsHtml('· <i class="icon-'.concat(n.icon,'" title="Created on ').concat(n.name,'"></i>')):""}}]),angular.module("bandlab.common").filter("removeTags",function(){return function(e){return e?String(e).replace(/<[a-z]*>.+<\/[a-z]*>(.*)/g,"$1"):""}}),angular.module("bandlab.common").filter("shortTime",["$filter",function(e){return function(t){var n=(new Date).setHours(0,0,0,0),o=new Date(t).setHours(0,0,0,0),a=Math.abs(new Date-new Date(t));return Math.floor(a/36e5)<24&&n===o?e("date")(t,"H:mm"):e("date")(t,"M/d/yy")}}]);var St=/\b[0-9]{1,2}:[0-5][0-9]\b/g;angular.module("bandlab.common").filter("songTime",function(){function e(e){return"<time>".concat(e,"</time>")}return function(t){return t.replace(St,e)}}),angular.module("bandlab.common").filter("startCase",function(){return function(e){return _.startCase(e)}}),angular.module("bandlab.common").filter("textTruncate",function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,a=e.content||"",i=a.split("\n"),r=a.split(" ");return r.length<=n+5&&i.length<=o&&a.length<=t+25&&(e.truncate=!1),!1===e.truncate?a:(e.truncate=!0,i=(i=(r=r.slice(0,n)).join(" ").split("\n")).slice(0,o),"".concat(i.join("\n").substring(0,t).trim(),"..."))}});var Pt="en",Et={};function Tt(){return Pt}function Mt(e){return Et[e]}function $t(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).localeMatcher||"lookup";switch(t){case"lookup":case"best fit":return function(e){if(Mt(e))return e;for(var t=e.split("-");e.length>1;)if(t.pop(),Mt(e=t.join("-")))return e}(e);default:throw new RangeError('Invalid "localeMatcher" option: '.concat(t))}}var Ct={af:function(e){return 1==e?"one":"other"},am:function(e){return e>=0&&e<=1?"one":"other"},ar:function(e){var t=String(e).split("."),n=Number(t[0])==e&&t[0].slice(-2);return 0==e?"zero":1==e?"one":2==e?"two":n>=3&&n<=10?"few":n>=11&&n<=99?"many":"other"},ast:function(e){var t=!String(e).split(".")[1];return 1==e&&t?"one":"other"},be:function(e){var t=String(e).split("."),n=Number(t[0])==e,o=n&&t[0].slice(-1),a=n&&t[0].slice(-2);return 1==o&&11!=a?"one":o>=2&&o<=4&&(a<12||a>14)?"few":n&&0==o||o>=5&&o<=9||a>=11&&a<=14?"many":"other"},br:function(e){var t=String(e).split("."),n=Number(t[0])==e,o=n&&t[0].slice(-1),a=n&&t[0].slice(-2),i=n&&t[0].slice(-6);return 1==o&&11!=a&&71!=a&&91!=a?"one":2==o&&12!=a&&72!=a&&92!=a?"two":(3==o||4==o||9==o)&&(a<10||a>19)&&(a<70||a>79)&&(a<90||a>99)?"few":0!=e&&n&&0==i?"many":"other"},bs:function(e){var t=String(e).split("."),n=t[0],o=t[1]||"",a=!t[1],i=n.slice(-1),r=n.slice(-2),s=o.slice(-1),c=o.slice(-2);return a&&1==i&&11!=r||1==s&&11!=c?"one":a&&i>=2&&i<=4&&(r<12||r>14)||s>=2&&s<=4&&(c<12||c>14)?"few":"other"},cs:function(e){var t=String(e).split("."),n=t[0],o=!t[1];return 1==e&&o?"one":n>=2&&n<=4&&o?"few":o?"other":"many"},cy:function(e){return 0==e?"zero":1==e?"one":2==e?"two":3==e?"few":6==e?"many":"other"},da:function(e){var t=String(e).split("."),n=t[0],o=Number(t[0])==e;return 1!=e&&(o||0!=n&&1!=n)?"other":"one"},dsb:function(e){var t=String(e).split("."),n=t[0],o=t[1]||"",a=!t[1],i=n.slice(-2),r=o.slice(-2);return a&&1==i||1==r?"one":a&&2==i||2==r?"two":a&&(3==i||4==i)||3==r||4==r?"few":"other"},dz:function(e){return"other"},fil:function(e){var t=String(e).split("."),n=t[0],o=t[1]||"",a=!t[1],i=n.slice(-1),r=o.slice(-1);return a&&(1==n||2==n||3==n)||a&&4!=i&&6!=i&&9!=i||!a&&4!=r&&6!=r&&9!=r?"one":"other"},fr:function(e){return e>=0&&e<2?"one":"other"},ga:function(e){var t=String(e).split("."),n=Number(t[0])==e;return 1==e?"one":2==e?"two":n&&e>=3&&e<=6?"few":n&&e>=7&&e<=10?"many":"other"},gd:function(e){var t=String(e).split("."),n=Number(t[0])==e;return 1==e||11==e?"one":2==e||12==e?"two":n&&e>=3&&e<=10||n&&e>=13&&e<=19?"few":"other"},he:function(e){var t=String(e).split("."),n=t[0],o=!t[1],a=Number(t[0])==e,i=a&&t[0].slice(-1);return 1==e&&o?"one":2==n&&o?"two":o&&(e<0||e>10)&&a&&0==i?"many":"other"},is:function(e){var t=String(e).split("."),n=t[0],o=Number(t[0])==e,a=n.slice(-1),i=n.slice(-2);return o&&1==a&&11!=i||!o?"one":"other"},ksh:function(e){return 0==e?"zero":1==e?"one":"other"},lt:function(e){var t=String(e).split("."),n=t[1]||"",o=Number(t[0])==e,a=o&&t[0].slice(-1),i=o&&t[0].slice(-2);return 1==a&&(i<11||i>19)?"one":a>=2&&a<=9&&(i<11||i>19)?"few":0!=n?"many":"other"},lv:function(e){var t=String(e).split("."),n=t[1]||"",o=n.length,a=Number(t[0])==e,i=a&&t[0].slice(-1),r=a&&t[0].slice(-2),s=n.slice(-2),c=n.slice(-1);return a&&0==i||r>=11&&r<=19||2==o&&s>=11&&s<=19?"zero":1==i&&11!=r||2==o&&1==c&&11!=s||2!=o&&1==c?"one":"other"},mk:function(e){var t=String(e).split("."),n=t[0],o=t[1]||"",a=!t[1],i=n.slice(-1),r=n.slice(-2),s=o.slice(-1),c=o.slice(-2);return a&&1==i&&11!=r||1==s&&11!=c?"one":"other"},mt:function(e){var t=String(e).split("."),n=Number(t[0])==e&&t[0].slice(-2);return 1==e?"one":0==e||n>=2&&n<=10?"few":n>=11&&n<=19?"many":"other"},pa:function(e){return 0==e||1==e?"one":"other"},pl:function(e){var t=String(e).split("."),n=t[0],o=!t[1],a=n.slice(-1),i=n.slice(-2);return 1==e&&o?"one":o&&a>=2&&a<=4&&(i<12||i>14)?"few":o&&1!=n&&(0==a||1==a)||o&&a>=5&&a<=9||o&&i>=12&&i<=14?"many":"other"},pt:function(e){var t=String(e).split(".")[0];return 0==t||1==t?"one":"other"},ro:function(e){var t=String(e).split("."),n=!t[1],o=Number(t[0])==e&&t[0].slice(-2);return 1==e&&n?"one":!n||0==e||1!=e&&o>=1&&o<=19?"few":"other"},ru:function(e){var t=String(e).split("."),n=t[0],o=!t[1],a=n.slice(-1),i=n.slice(-2);return o&&1==a&&11!=i?"one":o&&a>=2&&a<=4&&(i<12||i>14)?"few":o&&0==a||o&&a>=5&&a<=9||o&&i>=11&&i<=14?"many":"other"},se:function(e){return 1==e?"one":2==e?"two":"other"},si:function(e){var t=String(e).split("."),n=t[0],o=t[1]||"";return 0==e||1==e||0==n&&1==o?"one":"other"},sl:function(e){var t=String(e).split("."),n=t[0],o=!t[1],a=n.slice(-2);return o&&1==a?"one":o&&2==a?"two":o&&(3==a||4==a)||!o?"few":"other"}};function _t(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function At(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ct.as=Ct.am,Ct.az=Ct.af,Ct.bg=Ct.af,Ct.bn=Ct.am,Ct.ca=Ct.ast,Ct.ce=Ct.af,Ct.chr=Ct.af,Ct.de=Ct.ast,Ct.ee=Ct.af,Ct.el=Ct.af,Ct.en=Ct.ast,Ct.es=Ct.af,Ct.et=Ct.ast,Ct.eu=Ct.af,Ct.fa=Ct.am,Ct.fi=Ct.ast,Ct.fo=Ct.af,Ct.fur=Ct.af,Ct.fy=Ct.ast,Ct.gl=Ct.ast,Ct.gu=Ct.am,Ct.hi=Ct.am,Ct.hr=Ct.bs,Ct.hsb=Ct.dsb,Ct.hu=Ct.af,Ct.hy=Ct.fr,Ct.ia=Ct.ast,Ct.id=Ct.dz,Ct.it=Ct.ast,Ct.ja=Ct.dz,Ct.jgo=Ct.af,Ct.jv=Ct.dz,Ct.ka=Ct.af,Ct.kea=Ct.dz,Ct.kk=Ct.af,Ct.kl=Ct.af,Ct.km=Ct.dz,Ct.kn=Ct.am,Ct.ko=Ct.dz,Ct.ku=Ct.af,Ct.ky=Ct.af,Ct.lb=Ct.af,Ct.lkt=Ct.dz,Ct.lo=Ct.dz,Ct.ml=Ct.af,Ct.mn=Ct.af,Ct.mr=Ct.am,Ct.ms=Ct.dz,Ct.my=Ct.dz,Ct.nb=Ct.af,Ct.ne=Ct.af,Ct.nl=Ct.ast,Ct.nn=Ct.af,Ct.or=Ct.af,Ct.ps=Ct.af,Ct["pt-PT"]=Ct.ast,Ct.sah=Ct.dz,Ct.sd=Ct.af,Ct.sk=Ct.cs,Ct.so=Ct.af,Ct.sq=Ct.af,Ct.sr=Ct.bs,Ct.sv=Ct.ast,Ct.sw=Ct.ast,Ct.ta=Ct.af,Ct.te=Ct.af,Ct.th=Ct.dz,Ct.ti=Ct.pa,Ct.tk=Ct.af,Ct.to=Ct.dz,Ct.tr=Ct.af,Ct.ug=Ct.af,Ct.uk=Ct.ru,Ct.ur=Ct.ast,Ct.uz=Ct.af,Ct.vi=Ct.dz,Ct.wae=Ct.af,Ct.yi=Ct.ast,Ct.yue=Ct.dz,Ct.zh=Ct.dz,Ct.zu=Ct.am;var Rt=["second","minute","hour","day","week","month","quarter","year"],It=["auto","always"],Ot=["long","short","narrow"],xt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),At(this,"numeric","always"),At(this,"style","long"),At(this,"localeMatcher","lookup");var o=n.numeric,a=n.style,i=n.localeMatcher;if(o){if(It.indexOf(o)<0)throw new RangeError('Invalid "numeric" option: '.concat(o));this.numeric=o}if(a){if(Ot.indexOf(a)<0)throw new RangeError('Invalid "style" option: '.concat(a));this.style=a}if(i&&(this.localeMatcher=i),"string"==typeof t&&(t=[t]),t.push(Tt()),this.locale=e.supportedLocalesOf(t,{localeMatcher:this.localeMatcher})[0],!this.locale)throw new TypeError("No supported locale was found");this.locale=$t(this.locale,{localeMatcher:this.localeMatcher}),"undefined"!=typeof Intl&&Intl.NumberFormat&&(this.numberFormat=new Intl.NumberFormat(this.locale))}var t,n;return t=e,(n=[{key:"format",value:function(e,t){return this.getRule(e,t).replace("{0}",this.formatNumber(Math.abs(e)))}},{key:"formatToParts",value:function(e,t){var n=this.getRule(e,t),o=n.indexOf("{0}");if(o<0)return[{type:"literal",value:n}];var a=[];return o>0&&a.push({type:"literal",value:n.slice(0,o)}),a.push({unit:t,type:"integer",value:this.formatNumber(Math.abs(e))}),o+"{0}".length<n.length-1&&a.push({type:"literal",value:n.slice(o+"{0}".length)}),a}},{key:"getRule",value:function(e,t){if(Rt.indexOf(t)<0)throw new RangeError("Unknown time unit: ".concat(t,"."));var n=Mt(this.locale)[this.style][t];if("auto"===this.numeric)if(-2===e||-1===e){var o=n["previous".concat(-1===e?"":"-"+Math.abs(e))];if(o)return o}else if(1===e||2===e){var a=n["next".concat(1===e?"":"-"+Math.abs(e))];if(a)return a}else if(0===e&&n.current)return n.current;var i=n[e<=0?"past":"future"];if("string"==typeof i)return i;var r=Ct[function(e){return"pt-PT"===e?e:(n=(t=e).indexOf("-"))>0?t.slice(0,n):t;var t,n}(this.locale)],s=r&&r(Math.abs(e));return i[s=s||"other"]||i.other}},{key:"formatNumber",value:function(e){return this.numberFormat?this.numberFormat.format(e):String(e)}},{key:"resolvedOptions",value:function(){return{locale:this.locale,style:this.style,numeric:this.numeric}}}])&&_t(t.prototype,n),e}();xt.supportedLocalesOf=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.filter(function(e){return $t(e,t)})},xt.addLocale=function(e){if(!e)throw new Error("No locale data passed");Et[e.locale]=e},xt.setDefaultLocale=function(e){Pt=e},xt.getDefaultLocale=Tt;function Dt(e){return{restrict:"A",link:function(t,n,o){var a,i,r="";if(o.zfClose&&"allowDefault"!==o.zfClose)r=o.zfClose;else{for(a=!1,i=n.parent();!1===a;)"BODY"===i[0].nodeName&&(a=""),angular.isDefined(i.attr("zf-closable"))&&!1!==i.attr("zf-closable")&&(a=i),i=i.parent();r=a.attr("id")}n.on("click",function(t){e.$broadcast(r,"close"),"allowDefault"!==o.zfClose&&t.preventDefault()})}}}function Lt(e){return{restrict:"E",templateUrl:"https://www.bandlab.com/web-app/common/modal/modal-530c7477.html",transclude:!0,scope:!0,replace:!0,link:function(t,n,o){t.hideOverlay=function(){"overlayClose"in o&&e.$broadcast(o.id,"close")}}}}function Nt(e,t,n,o,a,i,r){return function(s){var c,l=s.id||k(),u=o.$new(),d=s.templateUrl?a(s.templateUrl):s.template,p=s.noStateChangeListeners?angular.noop:r.onEnter({},f),m=s.noStateChangeListeners?angular.noop:r.onBefore({from:"useChrome"},f);return _.assignIn(u,s.contentScope),u.cancel=function(){f(),angular.isFunction(s.onCancel)&&s.onCancel()},u.confirm=function(e){f(),angular.isFunction(s.onConfirm)&&s.onConfirm(e)},u.$on(l,function(e,t){"close"===t&&f()}),{destroy:f,show:function(){return n.when(d).then(function(n){var o;c=function(e){if(!document.getElementById(l)){var t='<zf-modal class="modal-overlay" id="'.concat(l,'">').concat(e,"</zf-modal>");return t=angular.element(t),!1!==s.overlayClose&&t.attr("overlay-close",!0),s.class&&s.class.split(" ").forEach(function(e){t.addClass(e)}),s.confirmLabel&&(t[0].querySelector(".modal-confirm").innerHTML=s.confirmLabel),s.cancelLabel&&(t[0].querySelector(".modal-cancel").innerHTML=s.cancelLabel),t}}(n),t(c)(u),o=function(){bt(),angular.isFunction(s.onCreate)&&s.onCreate(c),e.enter(c,document.body,document.body.lastChild)},setTimeout(function(){setTimeout(function(){setTimeout(function(){i(o)})})})})}};function f(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).animation,n=void 0===t||t;p(),m(),c&&i(function(){vt(),angular.isFunction(s.onDestroy)&&s.onDestroy(),u.$destroy(),n||e.enabled(c,!1),e.leave(c)})}}}function Ut(e){return function(t){return t.templateUrl="https://www.bandlab.com/web-app/common/modal/confirm-modal-bcd8b207.html",t.overlayClose=!1,new e(t)}}function jt(e){return function(t){return t.templateUrl="https://www.bandlab.com/web-app/common/modal/message-modal-3b86b943.html",new e(t)}}function Bt(e){return t.$inject=["$scope"],{restrict:"E",template:'\n      <div class="notification-container bottom-left">\n        <zf-notification\n          ng-repeat="notification in vm.notifications track by notification.id"\n          autoclose="notification.autoclose"\n          class="animate notification"\n          class-list="notification.classList"\n          action="notification.action"\n          inner-scope="notification.innerScope"\n          image="notification.image"\n          notif-id="notification.id"\n          title="notification.title">\n          <notification-content ng-bind-html="notification.content"></notification-content>\n          <notification-action bind-html-compile="notification.action"></notification-action>\n        </zf-notification>\n        <project-uploader></project-uploader>\n      </div>\n    ',replace:!0,scope:{position:"@"},controllerAs:"vm",controller:t,link:function(t,n,o,a){var i=e.$on(o.id,function(e,n){"clearall"===n?a.clearAll():(a.addNotification(n),t.$applyAsync())});t.$on("$destroy",i)}};function t(e){var t=this,n=[];e.$watchCollection("vm.notifications",function(e,o){e.length<o.length&&n.length&&t.notifications.unshift(n.shift())}),t.notifications=[],t.addNotification=function(e){e.id=k(),t.notifications.length<4?t.notifications.push(e):n.push(e)},t.removeNotification=function(e){_.remove(t.notifications,{id:e})},t.clearAll=function(){t.notifications=[]}}}function Ft(e,t){return{restrict:"E",template:'\n      <div class="notification" ng-class="classList">\n        <a href="#" class="close-button" ng-click="hide(); $event.preventDefault(); $event.stopPropagation()">&times;</a>\n        <div class="notification-image" ng-if="image"><img ng-src="{{ image }}"/></div>\n        <div class="notification-icon" ng-if="classList.indexOf(\'alert\') > -1"><i class="icon-circle-exclamation"></i></div>\n        <div class="notification-content">\n          <h1 ng-bind-html="trustedTitle" ng-if="trustedTitle"></h1>\n          <p ng-transclude="content"></p>\n        </div>\n        <div class="notification-action" ng-if="action" ng-transclude="action" ng-click="hide()">\n        </div>\n      </div>\n    ',replace:!0,transclude:{action:"notificationAction",content:"notificationContent"},require:"^zfNotificationSet",scope:{action:"=?",autoclose:"=?",classList:"=?",content:"=?",image:"=?",innerScope:"=?",notifId:"=",title:"=?"},link:function(n,o,a,i){n.hide=function(){i.removeNotification(n.notifId)},a.title&&n.$watch("title",function(t){t&&(n.trustedTitle=e.trustAsHtml(t))}),n.autoclose&&t(function(){n.hide()},parseInt(n.autoclose))}}}function qt(e,t){return function(){var n=k(),o=angular.element("<zf-notification-set></zf-notification-set>"),a=t.$new();return o.attr("id",n),e(o)(a),angular.element(document.body).append(o),{addNotification:function(e){t.$broadcast(n,e)},clearAll:i,destroy:function(){i(),setTimeout(function(){a.$destroy(),o.remove()})}};function i(){t.$broadcast(n,"clearall")}}}function Vt(){var e=S(["Your file is too big, the maximum is "," x "," pixels."]);return Vt=function(){return e},e}function Ht(){var e=S(["Your file is too small, please use at least "," x "," pixels."]);return Ht=function(){return e},e}function Gt(){var e=S(['File format not supported for "','". Please use one of these recommended formats: ',""]);return Gt=function(){return e},e}function zt(){var e=S(['File format not supported for "','". Please use one of these recommended formats: ',""]);return zt=function(){return e},e}function Wt(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Kt(){var e=S(["The post has been shared on your feed"]);return Kt=function(){return e},e}function Yt(e,t,o,a,i,r,s,c,l,u,d,p){var m,f,h=5,g=null,v=!1,b=t.url();function y(){return a.infiniteScrollEnded?o.reject("No more results"):m=m.then(function(e){return a.infiniteScrollEnded=v,a.posts=a.posts||[],a.posts=a.posts.concat(e.filter(function(e){return!e.isPinned})),a.pinned=a.pinned||e.filter(function(e){return e.isPinned}),l.pushQueueSongs(a.posts,b),w()})}function w(){return v?o.resolve([]):m=u.fromCommunity({after:g,communityId:p.id,limit:h}).$promise.then(function(e){return v=e.paging.itemsCount<e.paging.limit,g=_.get(e,"paging.cursors.after",0),e.data})}l.setState({loader:y,url:b}),a.loadMore=y,a.me=c,a.onShoutUploaded=function e(t,i){var s=u.fromCommunity({communityId:p.id,offset:0,limit:10,excludePinned:!0}).$promise;return r.cancel(f),f=r(angular.noop,2e3),o.all([s,f]).then(function(o){var s=n(o,1)[0].data,c=_.find(s,t);c?(i.remove(),a.posts.unshift(c),r.cancel(f)):e(t,i)})},a.createShoutPost=function(){return d.createShoutPost({type:"photo",community:p})},a.onPostCreate=function(e){a.posts.unshift(e)},w().then(y).then(function t(){var i=u.fromCommunity({communityId:p.id,offset:0,limit:h,excludePinned:!0}).$promise;return r.cancel(f),f=r(angular.noop,6e4),o.all([i,f]).then(function(o){var i=n(o,1)[0].data,r=new Date(_.get(a,"posts[0].createdOn",0)),c=_.chain(i).filter(function(e){return new Date(e.createdOn)>r}).differenceBy(a.posts,"id").value();if(!c.length)return t();s.addNotification({content:"New Posts Are Available",action:'<a ng-click="$parent.innerScope.prependPosts()">'.concat("Show new posts","</a>"),innerScope:{prependPosts:function(){!function(e){(document.scrollingElement||document.body).scrollTop=0,a.posts=a.posts.concat(e.filter(function(e){return!e.isPinned})),t()}(c),e.eventTrack("Show new Posts",{category:"Post",label:p.id,value:c.length})}},autoclose:!1})})}),a.$on("$post:delete",function(e,t){_.remove(a.posts,function(e){return e.id===t.post.id}),a.pinned.length&&(_.remove(a.pinned,function(e){return e.id===t.post.id}),(document.scrollingElement||document.body).scrollTop=0)}),a.$on("$destroy",function(){r.cancel(f)}),a.$on("$post:pin",function(e,t){var n=t.post;_.find(a.posts,{id:n.id})&&r(function(){return i.reload("community.feed")},1e3)}),a.$on("$post:unpin",function(e,t){var n=t.post;_.find(a.pinned,{id:n.id})&&r(function(){return i.reload("community.feed")},1e3)})}function Xt(){var e=S(["The post has been shared with ",""]);return Xt=function(){return e},e}function Jt(){var e=S(["Request has been to sent to members of the community!"]);return Jt=function(){return e},e}function Qt(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Zt(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?Qt(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Qt(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function en(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function tn(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?en(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):en(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}xt.addLocale({locale:"en",long:{year:{previous:"last year",current:"this year",next:"next year",past:{one:"{0} year ago",other:"{0} years ago"},future:{one:"in {0} year",other:"in {0} years"}},quarter:{previous:"last quarter",current:"this quarter",next:"next quarter",past:{one:"{0} quarter ago",other:"{0} quarters ago"},future:{one:"in {0} quarter",other:"in {0} quarters"}},month:{previous:"last month",current:"this month",next:"next month",past:{one:"{0} month ago",other:"{0} months ago"},future:{one:"in {0} month",other:"in {0} months"}},week:{previous:"last week",current:"this week",next:"next week",past:{one:"{0} week ago",other:"{0} weeks ago"},future:{one:"in {0} week",other:"in {0} weeks"}},day:{previous:"yesterday",current:"today",next:"tomorrow",past:{one:"{0} day ago",other:"{0} days ago"},future:{one:"in {0} day",other:"in {0} days"}},hour:{current:"this hour",past:{one:"{0} hour ago",other:"{0} hours ago"},future:{one:"in {0} hour",other:"in {0} hours"}},minute:{current:"this minute",past:{one:"{0} minute ago",other:"{0} minutes ago"},future:{one:"in {0} minute",other:"in {0} minutes"}},second:{current:"now",past:{one:"{0} second ago",other:"{0} seconds ago"},future:{one:"in {0} second",other:"in {0} seconds"}}},short:{year:{previous:"last yr.",current:"this yr.",next:"next yr.",past:"{0} yr. ago",future:"in {0} yr."},quarter:{previous:"last qtr.",current:"this qtr.",next:"next qtr.",past:{one:"{0} qtr. ago",other:"{0} qtrs. ago"},future:{one:"in {0} qtr.",other:"in {0} qtrs."}},month:{previous:"last mo.",current:"this mo.",next:"next mo.",past:"{0} mo. ago",future:"in {0} mo."},week:{previous:"last wk.",current:"this wk.",next:"next wk.",past:"{0} wk. ago",future:"in {0} wk."},day:{previous:"yesterday",current:"today",next:"tomorrow",past:{one:"{0} day ago",other:"{0} days ago"},future:{one:"in {0} day",other:"in {0} days"}},hour:{current:"this hour",past:"{0} hr. ago",future:"in {0} hr."},minute:{current:"this minute",past:"{0} min. ago",future:"in {0} min."},second:{current:"now",past:"{0} sec. ago",future:"in {0} sec."}},narrow:{year:{previous:"last yr.",current:"this yr.",next:"next yr.",past:"{0} yr. ago",future:"in {0} yr."},quarter:{previous:"last qtr.",current:"this qtr.",next:"next qtr.",past:{one:"{0} qtr. ago",other:"{0} qtrs. ago"},future:{one:"in {0} qtr.",other:"in {0} qtrs."}},month:{previous:"last mo.",current:"this mo.",next:"next mo.",past:"{0} mo. ago",future:"in {0} mo."},week:{previous:"last wk.",current:"this wk.",next:"next wk.",past:"{0} wk. ago",future:"in {0} wk."},day:{previous:"yesterday",current:"today",next:"tomorrow",past:{one:"{0} day ago",other:"{0} days ago"},future:{one:"in {0} day",other:"in {0} days"}},hour:{current:"this hour",past:"{0} hr. ago",future:"in {0} hr."},minute:{current:"this minute",past:"{0} min. ago",future:"in {0} min."},second:{current:"now",past:"{0} sec. ago",future:"in {0} sec."}}}),angular.module("bandlab.common").filter("timeAgo",function(){return _.memoize(function(e,t,n){var o,a,i,r,s,c,l=(new Date).setHours(0,0,0,0),u=new Date(e).setHours(0,0,0,0);c="short"===t?"short":"long";var d="Intl"in window&&"RelativeTimeFormat"in Intl?new Intl.RelativeTimeFormat("en",{style:c}):new xt("en",{style:c});return n||(n=0),o=Math.abs(new Date-new Date(e)),isNaN(o)?" ":0===(r=Math.floor(o/36e5))?(i=Math.floor(o/6e4))<1?(a=Math.ceil(o/1e3),_.capitalize(d.format(-a,"second"))):_.capitalize(d.format(-i,"minute")):r<24&&l===u?_.capitalize(d.format(-r,"hour")):(s=Math.round((l-u)/864e5))<365?s>n?new Date(e).toLocaleDateString("en",{day:"numeric",month:"long"}):_.capitalize(d.format(-s,"day")):new Date(e).toLocaleDateString("en",{day:"numeric",month:"long",year:"numeric"})},function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return JSON.stringify(t)})}),jt.$inject=["Modal"],Ut.$inject=["Modal"],Nt.$inject=["$animate","$compile","$q","$rootScope","$templateRequest","$timeout","$transitions"],Lt.$inject=["$rootScope"],Dt.$inject=["$rootScope"],angular.module("bandlab.common").directive("zfClose",Dt).directive("zfModal",Lt).factory("Modal",Nt).factory("ConfirmModal",Ut).factory("MessageModal",jt),T(function(e){var t;(t=window.angular.module("angular-bind-html-compile",[])).directive("bindHtmlCompile",["$compile",function(e){return{restrict:"A",link:function(t,n,o){t.$watch(function(){return t.$eval(o.bindHtmlCompile)},function(a){n.html(a&&a.toString());var i=t;o.bindHtmlScope&&(i=t.$eval(o.bindHtmlScope)),e(n.contents())(i)})}}}]),e.exports&&(e.exports=t.name)}),qt.$inject=["$compile","$rootScope"],Ft.$inject=["$sce","$timeout"],Bt.$inject=["$rootScope"],angular.module("bandlab.common.notification",["angular-bind-html-compile"]).directive("zfNotificationSet",Bt).directive("zfNotification",Ft).factory("NotificationFactory",qt).factory("AppNotifications",["NotificationFactory",function(e){return new e({})}]),angular.module("bandlab.common").factory("AnimationFrame",function(){var e={},t={},n={};return{add:function(t,n){e[t]=e[t]||[],-1===e[t].indexOf(n)&&e[t].push(n)},remove:function(t,n){e[t]=e[t]||[];var o=e[t].indexOf(n);-1!==o&&e[t].splice(o,1)},reset:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=0;n<t.length;n++)e[t[n]]=[]},start:function(o,a,i,r){var s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(!t[o]||r){var c=e[o]||[];t[o]=!0,n[o]=s?requestAnimationFrame(l):l()}function l(){for(var e=0;e<c.length;e++)c[e](i);t[o]=!1,a&&n[o]&&(n[o]=requestAnimationFrame(l))}},stop:function(e){cancelAnimationFrame(n[e]),n[e]=null,t[e]=null}}}),angular.module("bandlab.common").factory("appActions",["$state","authService","ClientDevice","Me",function(e,t,n,o){var a=["addToCollection","bandJoinRequest","bandRequestInvite","blockUser","comment","follow","fork","joinCommunity","like","reportContent","search","shareOnBandLab","talkTo","tip","upload"],i={bandInvite:function(){return _.get(o,"permissions.canInvite")}};return i.communityInvite=i.bandInvite,i.projectInvite=i.bandInvite,{checkAllowed:function(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=o.toState,s=void 0===r?e.current.name:r,c=o.toParams,l=void 0===c?_.clone(e.params):c;return-1===a.indexOf(n)||t.isAuth()?!(i[n]&&!i[n]())||(t.displayConfirmationEmailError(),!1):(t.setAfterAuthState({toState:s,toParams:l}),t.displayAuthModal(),!1)},checkStateCompatibility:function(e){if(angular.isFunction(e.isCompatible))return e.isCompatible({ClientDevice:n})}}}]),angular.module("bandlab.common").constant("appStates",{AFTER_LOGIN:"feed",AFTER_SIGN_UP:"onboarding",LOGIN:"login",ANONYMOUS_ONLY:["invitation","landing","login","passwordReset","signUp"],AUTH_MODULES:["feed","chat","classroom","classrooms","creatorConnect","library","mixEditor","notifications","report","reportEntity","reportGeneral","school","search","settings","onboarding","logout"],DO_NOT_DISTURB:["mixEditor"]}),angular.module("bandlab.common").constant("appVersion",document.querySelector('meta[name="version"]').getAttribute("content")).factory("AppVersionChecker",["$analytics","$http","$interval","$state","$transitions","AppNotifications","appStates","appVersion",function(e,t,n,o,a,i,r,s){var c=108e5;return{displayRefreshNotification:l,listenForUpdates:function e(){var i=n(function(){t.get(document.location.origin).then(function(e){var t=e.data.match(/<meta name="version" content="([0-9]+\.[0-9]+\.[0-9-]+)">/g);if(t)return t[0].match(/([0-9]+\.[0-9]+\.[0-9-]+)/g)[0]}).then(function(t){if(t&&t!==s){if(n.cancel(i),-1!==r.DO_NOT_DISTURB.indexOf(o.current.name)){var c=a.onSuccess({},function(){l(),e(),c()});return}l(),e()}})},c)}};function l(){i.addNotification({title:"We’ve Made Some Changes",content:"Refresh this page for a new and improved BandLab experience!",image:"https://www.bandlab.com/web-app/images/favicons/icon-192x192-66bd6ebcd9.png",action:'<a onmousedown="location.reload()">'.concat("Refresh","</a>"),classList:"light",autoclose:c}),e.eventTrack("Notify outdated version",{category:"Navigation"})}}]),angular.module("bandlab.common").factory("ClientDevice",["$q",function(e){var t=(new UAParser).getResult();return{hasWebcam:function(){return navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then(function(e){return _.filter(e,{kind:"videoinput"}).length>0}):e.reject(!1)},isAndroid:"Android"===t.os.name,isiOs:"iOS"===t.os.name,isMacOs:"Mac OS"===t.os.name,isMobile:"mobile"===t.device.type,isTablet:"tablet"===t.device.type,isWindows:"Windows"===t.os.name,ua:t}}]),angular.module("bandlab.account").factory("CountryPhoneCodes",["$resource",function(e){return e("https://www.bandlab.com/api/v1.3/",{},{countries:{cache:!0,method:"GET",isArray:!0,url:"".concat("https://www.bandlab.com/api/v1.3/","countries")}})}]),angular.module("bandlab.common").factory("CrossOriginWorker",["FileHelper",function(e){return function(t){return e.download(t).then(function(e){return new Worker(URL.createObjectURL(e))})}}]),angular.module("bandlab.common").factory("Facebook",["$q",function(e){var t=_.once(function(){return O("https://connect.facebook.net/en_US/sdk.js").then(function(){FB.init({appId:"260753417459194",version:"v2.12"})})});return{login:function(){return t().then(function(){var t=e.defer();return FB.login(t.resolve,{scope:"email"}),t.promise}).then(function(t){return"connected"===t.status?e.resolve(t):e.reject(t)})},ui:function(n){return t().then(function(){var t=e.defer();return FB.ui(n,t.resolve),t.promise}).then(function(t){return t&&!t.error_message?e.resolve(t):e.reject(t)})}}}]),angular.module("bandlab.common").factory("FileHelper",["$http","$q","$rootScope",function(e,t,n){var o={acceptedTypes:{formats:["image/png","image/jpeg"],readable:"JPG, PNG"},maxSize:4,imgDimensions:{minWidth:320,minHeight:320,maxWidth:4096,maxHeight:4096}};return{checkType:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.acceptedTypes;return e.type?-1===a.formats.indexOf(e.type)?(n.$broadcast("FileErrorFormat",{acceptedTypes:a.formats}),t.reject(new Error(i18n(zt(),e.name,a.readable)))):t.resolve(e):Je(e).then(function(n){var o=new Uint8Array(n),i=o.length&&a.signatures.find(function(e){return e.signature.every(function(e,t){return e===o[t]})});return i?t.resolve(new File([n],"".concat(e.name).concat(i.extension),{type:i.type})):t.reject(new Error(i18n(Gt(),e.name,a.readable)))})},checkSize:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.maxSize;return e.size>1024*a*1024?(n.$broadcast("fileUploadErrorLarge",{maxSize:a}),t.reject(new Error("Your file is too large, the maximum is ".concat(a," MB.")))):0===e.size?t.reject(new Error("".concat(e.name," is empty."))):t.resolve(e)},checkMidi:function(e){return e.type?t.resolve(e):Je(e).then(function(n){var o=new Uint8Array(n);return[77,84,104,100].every(function(e,t){return e===o[t]})?t.resolve(new File([n],"".concat(e.name),{type:"audio/midi"})):t.resolve(e)})},createImageElement:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.defer(),i=new Image,r=angular.extend({},o.imgDimensions,n);return i.onload=function(){return this.width<r.minWidth||this.height<r.minHeight?a.reject(new Error(i18n(Ht(),r.minWidth,r.minHeight))):this.width>r.maxWidth||this.height>r.maxHeight?a.reject(new Error(i18n(Vt(),r.maxWidth,r.maxHeight))):a.resolve({image:i,file:e})},i.onerror=function(){a.reject(new Error("File format is not supported."))},function(e){return Je(e).then(function(e){var t,n,o=new DataView(e),a=0,i=1;if(e.length<2||65496!==o.getUint16(a))return i;for(a+=2,t=o.byteLength;a<t-2;)switch(n=o.getUint16(a),a+=2,n){case 65505:t=o.getUint16(a)-a,a+=2;break;case 274:i=o.getUint16(a+6,!1),t=0}return i})}(e).then(function(t){var o={1:0,3:180,5:90,6:90,7:270,8:270}[t]||0;n.rotate&&(o+=n.rotate),o&&window.fetch?function(e,t){return new Promise(function(n,o){var a=new Image;a.src=URL.createObjectURL(e),a.onerror=o,a.onload=function(){var o=document.createElement("CANVAS"),i=o.getContext("2d");if(180===t){var r=[a.height,a.width];o.height=r[0],o.width=r[1]}else{var s=[a.width,a.height];o.height=s[0],o.width=s[1]}180===t?i.translate(a.width,a.height):90===t?i.translate(a.height,0):270===t&&i.translate(0,a.width),i.rotate(t*(Math.PI/180)),i.drawImage(a,0,0),o.toBlob(function(e){n(e)},e.type,1),o=null}})}(e,o).then(function(t){e=t,i.src=URL.createObjectURL(t)}):i.src=URL.createObjectURL(e)}),a.promise},download:function(t){return e({url:t,responseType:"blob"}).then(function(e){return e.data})},upload:function(t,o,a,i){var r=new FormData,s=angular.extend({transformRequest:angular.identity,headers:{"Content-Type":void 0}},a);return _.isArray(t)?_.forEach(t,function(e){r.append("file",e)}):r.append("file",t),i&&r.append("metadata",new Blob([JSON.stringify(i)],{type:"application/json"})),e.post(o,r,s).then(function(e){return n.$broadcast("$file:uploadSuccess",e.data),e}).catch(function(e){throw n.$broadcast("$file:uploadFailed"),e})}}}]),angular.module("bandlab.common").factory("Google",["$q",function(e){var n="976411153779-v0ml53o9n0p82ignpeunh96gg4c9epfd.apps.googleusercontent.com",o=_.once(function(){return O("https://apis.google.com/js/platform.js")});return{popupSignIn:function(){return a({scope:[].join(" ")}).then(function(t){var n=t.getAuthResponse();return n&&!n.error?n:e.reject("gapi.auth2.signIn error")})},signIn:function(){return a({redirect_uri:"https://www.bandlab.com/oauth2callback",ux_mode:"redirect"})}};function a(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o().then(function(){return function(o){var a=e.defer();return gapi.load("auth2",function(){gapi.auth2.init(function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?Wt(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Wt(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({client_id:n},o)).then(a.resolve)}),a.promise}(a)}).then(function(){return gapi.auth2.getAuthInstance().signIn()})}}]),angular.module("bandlab.common").factory("GraphQL",["$http","$q",function(e,t){return{mutate:function(n){return n.operationName=n.mutation.match(/mutation ([a-zA-Z0-9]*)/)[1],n.query=n.mutation,delete n.mutation,e.post("https://www.bandlab.com/graphql",n).then(function(e){return e.data.errors?t.reject(e.data.errors):e.data.data})},query:function(n){return e.post("https://www.bandlab.com/graphql",n).then(function(e){return e.data.errors?t.reject(e.data.errors):e.data.data})}}}]),angular.module("bandlab.common").factory("Loader",["$q",function(e){return{create:function(t,n){var o=0,a=null,i=e.resolve([]),r=!1;function s(){return i=i.then(function(){if(r)return e.resolve([]);var i=_.assignIn({},n,a&&{after:a}||o&&{offset:o}||{});return t(i).$promise.then(function(e){var t=e.paging,i=e.data||e;return(n.limit&&i.length<n.limit||!i.length)&&(r=!0),t?a=t.cursors.after:o+=e.length,i})})}var c=[],l=-1;return{get:function(){return c[++l]||(c[l]=s()),c[l+1]||(c[l+1]=s()),c[l]},incOffset:function(){o++},decOffset:function(){o--}}}}}]),angular.module("bandlab.common").factory("Page",["$sanitize","$state","$stateParams","$transitions","Me",function(e,t,n,o,a){var i=document.createElement("meta");i.name="twitter:player";var r=document.createElement("meta");r.name="twitter:player:width",r.content="480";var s=document.createElement("meta");s.name="twitter:player:height",s.content="202";var c={metadata:{},slug:"loading"},l={title:document.title,description:document.querySelector('meta[name="description"]').getAttribute("content"),image:document.querySelector('meta[property="og:image"]').getAttribute("content"),imageHeight:document.querySelector('meta[property="og:image:height"]').getAttribute("content"),imageWidth:document.querySelector('meta[property="og:image:width"]').getAttribute("content"),type:document.querySelector('meta[property="og:type"]').getAttribute("content")};return o.onSuccess({},function(e){u(e.to())}),{clearMetadata:function(){c.metadata={}},setMetadata:function(e){c.metadata=e},update:u};function u(o){(o=o||t.current).abstract||(function(e){var t="state-".concat(c.slug);c.slug=e.name.replace(/\./g,"-").toLowerCase(),document.body.classList.replace(t,"state-".concat(c.slug))}(o),function(o){var u,d=_.get(a,"counters.unreadInviteNotifications",0)+_.get(a,"counters.unreadYouNotifications",0),p=function(o){var a=angular.copy(l),i=o.name.split(".")[0];switch(c.metadata.objectPath?a.mobileUrl="bandlab:/".concat(c.metadata.objectPath):a.mobileUrl="bandlab:/".concat(t.href(o)),c.metadata.image&&(a.image=c.metadata.image,c.metadata.imageHeight&&c.metadata.imageWidth?(a.imageHeight=c.metadata.imageHeight,a.imageWidth=c.metadata.imageWidth):(a.imageHeight="",a.imageWidth="")),i){case"discount":a.title="BandLab Promos",a.description="Get our best deals. Save with BandLab promotions.";break;case"explore":a.title=c.metadata.title||"Explore BandLab";break;case"feed":a.title="BandLab";break;case"band":case"bandSong":case"collection":case"community":case"post":case"song":case"user":case"userSong":a.type="object",a.title=c.metadata.title,a.description=c.metadata.description?c.metadata.description:"",a.player=c.metadata.player||"";break;case"mixEditor":a.title="Mix Editor",c.metadata.title&&(a.title="".concat(c.metadata.title," - ").concat(a.title));break;case"login":a.title="Log in to BandLab";break;case"signUp":a.title="Sign up to BandLab";break;case"settings":case"notifications":a.title=i.charAt(0).toUpperCase()+i.slice(1);break;case"library":a.title="Library";break;case"search":n.q?a.title="".concat(e(n.q)," - BandLab Search"):a.title="Search in BandLab";break;case"experience":a.title="BandLab: Experience Web Audio!",a.description="Plug your microphone and MIDI devices and start making sound with BandLab instruments!",a.image="https://www.bandlab.com/web-app/images/open-graph-bandlab-instruments-7430937692.jpg";break;case"features":a.title="BandLab | FREE Online DAW & Award-Winning Features",a.image="https://www.bandlab.com/web-app/images/open-graph-bandlab-features-a8d5438e36.png";break;case"download":case"unavailable":a.title="Download BandLab for your device",a.description="Get the BandLab app on your mobile phone.";break;case"mastering":a.title="BandLab | Unlimited FREE Instant Online Audio Mastering",a.description="Unlimited Free Algorithmic Mastering by BandLab.",a.image="https://www.bandlab.com/web-app/images/open-graph-bandlab-mastering-c75ee7f936.jpg";break;case"upload":a.title="BandLab | Upload your music and share it with millions of listeners around the world",a.description="BandLab provides free and unlimited uploads with unlimited storage, easy-to-use embeddable players and convenient private sharing.",a.image="https://www.bandlab.com/web-app/images/upload/open-graph-upload-66a0f8e822.png";break;case"quickUpload2":a.title="Name Your Track";break;case"report":a.title="Send Feedback";break;case"reportEntity":case"reportGeneral":a.title="Report";break;default:!function(e,t){switch(e.name){case"products.assistant":case"products.assistantInstructions":t.title="BandLab Assistant | BandLab Products",t.description="Your central hub for your musical creative process on Windows and Mac.",t.image="https://www.bandlab.com/web-app/images/assistant/open-graph-bdfce00895.png";break;case"products.cakewalk":t.title="Cakewalk by BandLab | BandLab Products",t.description="The next generation of SONAR, the world's finest and most powerful desktop DAW - now FREE.",t.image="https://www.bandlab.com/web-app/images/cakewalk/cakewalk-open-graph-040d0fdf3f.png";break;case"products.cakewalkPledge":case"products.cakewalkInstructions":t.title="Celebrate the launch of Cakewalk by BandLab | BandLab Products",t.description="Support the launch of Cakewalk by BandLab and get some incredible swag!",t.image="https://www.bandlab.com/web-app/images/cakewalk/cakewalk-open-graph-040d0fdf3f.png";break;case"products.cakewalkWhatsNew":t.title="What's New in Cakewalk by BandLab | BandLab Products",t.description="Release notes, features, enhancements and fixes from the latest version of Cakewalk by BandLab.",t.image="https://www.bandlab.com/web-app/images/cakewalk/cakewalk-open-graph-040d0fdf3f.png"}}(o,a)}return a}(o);document.title=p.title,d>0&&(document.title="(".concat(d,") ").concat(p.title)),document.querySelector(".tab-bar-title")&&(document.querySelector(".tab-bar-title").innerHTML=p.title),document.querySelector('meta[property="og:title"]').setAttribute("content",p.title),document.querySelector('meta[name="twitter:title"]').setAttribute("content",p.title),document.querySelector('meta[property="og:description"][name="description"]').setAttribute("content",p.description),document.querySelector('meta[name="twitter:description"]').setAttribute("content",p.description),document.querySelector('meta[property="og:image"]').setAttribute("content",p.image),document.querySelector('meta[property="og:image:height"]').setAttribute("content",p.imageHeight),document.querySelector('meta[property="og:image:width"]').setAttribute("content",p.imageWidth),document.querySelector('meta[name="twitter:image"]').setAttribute("content",p.image),document.querySelector('meta[property="og:type"]').setAttribute("content",p.type),document.querySelector('meta[property="og:url"]').setAttribute("content",document.location.href),document.querySelector('meta[property="al:android:url"]').setAttribute("content",p.mobileUrl),document.querySelector('meta[property="al:ios:url"]').setAttribute("content",p.mobileUrl),p.player?(u=p.player,i.content=u,document.head.append(i),document.head.append(r),document.head.append(s),document.querySelector('meta[name="twitter:card"]').setAttribute("content","player")):(i.remove(),r.remove(),s.remove(),document.querySelector('meta[name="twitter:card"]').setAttribute("content","summary"))}(o))}}]),angular.module("bandlab.common").factory("Place",["$resource",function(e){return e("https://www.bandlab.com/api/v1.3/places",{},{post:{method:"POST"},query:{method:"GET",isArray:!0,params:{type:"cities"}}})}]),angular.module("bandlab.common").factory("Tag",["$http",function(e){return{getGenres:function(){return e({url:"https://www.bandlab.com/api/v1.3/genres",method:"GET",cache:!0,ignoreLoadingBar:!0}).then(function(e){return e.data})},getSkills:function(){return e({url:"https://www.bandlab.com/api/v1.3/skills",method:"GET",cache:!0,ignoreLoadingBar:!0}).then(function(e){return e.data})}}}]),angular.module("bandlab.common").factory("Validation",["$http",function(e){return{validate:function(t,n,o){var a={};return a[n]=o,e({url:"https://www.bandlab.com/api/v1.3/validation/".concat(t),method:"GET",params:a})}}}]),angular.module("bandlab.common").factory("Share",["$analytics","$injector","$state",function(e,t,n){return{getEmbedRevisionUrl:function(e){var t=e.id,n=e.isBackgroundBlurry;return"https://www.bandlab.com/embed/?id=".concat(t).concat(n?"":"&blur=false")},getShareUrl:function(e){if(e)switch(e.type){case"Collection":return n.href("collection",{id:e.object.id,username:e.object.creator.username},{absolute:!0});case"Community":return n.href("community",{username:e.object.username},{absolute:!0});case"Post":return n.href("post",{id:e.object.id},{absolute:!0});case"Revision":return n.href("Band"===e.object.song.author.type?"bandSong":"userSong",{username:e.object.song.author.username,slug:e.object.song.slug,revId:e.object.id},{absolute:!0})}return window.location.href},withFacebook:function(e){t.get("Facebook").ui({display:"popup",method:"share",href:e}).then(function(){return o("Facebook")}).catch(angular.noop)},withTwitter:function(e){var t="https://twitter.com/intent/tweet?";t+="url=".concat(encodeURIComponent(e)),t+="&hashtags=".concat(encodeURIComponent("BandLab")),window.open(t,"","toolbar=0, status=0, width=535, height=360"),o("Twitter")}};function o(t){e.eventTrack("Share",{category:"Social",label:t})}}]).controller("SNSShareCtrl",["$scope","Share",function(e,t){e.shareOnFacebook=function(){t.withFacebook(e.shareUrl)},e.shareOnTwitter=function(){t.withTwitter(e.shareUrl)}}]).controller("EmbedCtrl",["$sce","$scope","Share",function(e,t,n){var o={square:{small:{height:300,width:300},medium:{height:480,width:480},large:{height:640,width:640}},tile:{small:{height:202,width:300},medium:{height:202,width:480},large:{height:202,width:640}}};function a(){var o={Collection:"https://www.bandlab.com/embed/collection/?id=".concat(t.shareData.object.id),Post:"https://www.bandlab.com/embed/shout/?id=".concat(t.shareData.object.id),Revision:n.getEmbedRevisionUrl({id:t.shareData.object.id,isBackgroundBlurry:t.embedOptions.isBackgroundBlurry})}[t.shareData.type]||"";t.embedUrl=e.trustAsResourceUrl(o)}function i(e){var n=e.data,o=(n=void 0===n?{}:n).height;n.id===t.shareData.object.id&&(t.embedOptions.height="Collection"===t.shareData.type?400:o,t.setEmbedCode(),t.isIframeLoaded=!0,t.$applyAsync(),window.removeEventListener("message",i))}t.setEmbedCode=function(){a(),t.embedCode='<iframe width="'.concat(t.embedOptions.width,'" height="').concat(t.embedOptions.height,'" src="').concat(t.embedUrl,'" frameborder="0" allowfullscreen></iframe>')},t.initIframe=function(){t.isIframeLoaded=!1,window.addEventListener("message",i)},t.updateIframeDimensions=function(){t.embedOptions.width=o[t.embedOptions.format][t.embedOptions.size].width,"Revision"===t.shareData.type?(t.isIframeLoaded=!0,t.embedOptions.height=o[t.embedOptions.format][t.embedOptions.size].height,t.setEmbedCode(),window.removeEventListener("message",i)):t.embedCode="Loading..."},t.setFormat=function(e){t.embedOptions.format=e,t.updateIframeDimensions()},t.embedOptions={format:"square",isBackgroundBlurry:!1,size:"medium"},a()}]).directive("shareModal",["$analytics","Modal","Share",function(e,t,n){return{restrict:"A",scope:{shareModalObject:"=",shareModalType:"="},link:function(o,a){var i;function r(e){i||(i=new t({class:"modal-share",templateUrl:"https://www.bandlab.com/web-app/common/share/_share-modal-a356aede.html",contentScope:{tab:"share",shareData:e,shareUrl:n.getShareUrl(e)},onDestroy:function(){i=null}})).show()}a.on("click",function(){var t={object:o.shareModalObject,type:o.shareModalType};if(navigator.share)return function(t){return navigator.share({url:n.getShareUrl(t)}).then(function(){e.eventTrack("Web Share API",{category:"Share",label:t.type})}).catch(function(e){/Share canceled/.test(e.message)||r(t)})}(t);r(t)})}}}]),angular.module("bandlab.common").directive("sharePostModal",["$rootScope","appActions","AppNotifications","ChatHelper","Me","Modal","Post","Share",function(e,t,o,a,i,r,s,c){return{restrict:"A",scope:{sharePostModalObject:"=",sharePostModalType:"="},link:function(l,u){var d;function p(e,t){var r=c.getShareUrl({object:l.sharePostModalObject,type:l.sharePostModalType});return a.getLinkPreview(r).then(function(t){var o=n(t,1)[0].object;return s.createPost({caption:e,id:i.id,entity:"users",link:o}).$promise}).then(function(){t.$setPristine(),d.destroy(),o.addNotification({content:i18n(Kt()),autoclose:3e3})}).catch(function(){o.addNotification({title:"Unable to create post. Check your internet connection and try again.",classList:"alert",autoclose:5e3})})}u.on("click",function(){!d&&t.checkAllowed("shareOnBandLab")&&(d=new r({class:"share-post-modal",templateUrl:"https://www.bandlab.com/web-app/common/share/_share-post-modal-1b98f313.html",contentScope:{me:i,attachment:{object:l.sharePostModalObject,type:l.sharePostModalType},submitPost:p},onCreate:function(t){d.element=t[0].querySelector(".modal"),d.element&&d.element.classList.remove("modal"),setTimeout(function(){return e.$broadcast("elastic:adjust")},0)},onDestroy:function(){d=null}})).show()})}}}]),angular.module("bandlab.community",[]),Yt.$inject=["$analytics","$location","$q","$scope","$state","$timeout","AppNotifications","Me","PlayerHistory","Post","Shout","theCommunity"],angular.module("bandlab.community.routes",[]).config(["$stateProvider",function(e){e.state("community",{url:"/community/{username:[a-z][0-9a-z_]{1,19}}",params:{rewriteTrackingAsync:["$stateParams","Community",function(e,t){return function(n){return t.get({id:e.username}).$promise.then(function(e){return"None"===e.role?n.replace(/^\/community\/[a-z][0-9a-z_]{1,19}(($|\/).*)/g,"/community$1"):n.replace(/^\/community\/[a-z][0-9a-z_]{1,19}(($|\/).*)/g,"/community-".concat(e.role.toLowerCase(),"$1"))})}}]},abstract:!0,template:'\n          <div class="grid-block shrink" ui-view="header"></div>\n          <div class="grid-block" ui-view="content"></div>',resolve:{theCommunity:["$stateParams","Community",function(e,t){return t.get({id:e.username}).$promise}]},onEnter:["Page","theCommunity",function(e,t){e.setMetadata({title:"".concat(t.name," | Communities on BandLab"),description:"".concat(t.about?"".concat(t.about," | "):"").concat(t.name," has ").concat(t.counters.members," member").concat(t.counters.members>1?"s":""," on BandLab. Check it out today!"),image:t.picture.s,imageHeight:"360",imageWidth:"360",objectPath:"/communities/".concat(t.id)})}],onExit:["Page",function(e){e.clearMetadata()}],controller:["$scope","$state","$stateParams","Me","theCommunity",function(e,t,n,o,a){e.community=a,e.$on("$invite:changed",function(){e.community.$get({id:e.community.id})}),e.$on("$community:changed",function(o,a){"update"===a.action&&n.username!==e.community.username&&t.go(t.current.name,_.assignIn(t.params,{username:e.community.username,changed:!0}),{reload:!0})}),e.$on("$community:left",function(n,a){e.community===a.community&&(""===t.current.name?t.go("community.edit.profile",{username:o.username}):setTimeout(function(){t.go(".",t.params,{reload:!0})},1e3))})}]}).state("community.feed",{url:"",views:{content:{controller:Yt,templateUrl:"https://www.bandlab.com/web-app/community/views/community-feed-5820bf47.html"}}}).state("community.edit",{url:"/edit",params:{rewriteTracking:function(){return function(e){return e.replace(/^\/community\/[a-z][0-9a-z_]{1,19}(($|\/).*)/g,"/community$1")}}},redirectTo:function(e){return{state:"community.edit.profile",params:{username:e.params().username}}},resolve:{canEdit:["$q","theCommunity",function(e,t){return"Admin"===t.role||"Owner"===t.role?e.resolve(!0):e.reject({status:403})}]},views:{header:{templateUrl:"https://www.bandlab.com/web-app/community/views/community-edit-header-fdd0ec3e.html"},content:{templateUrl:"https://www.bandlab.com/web-app/community/views/manage/community-manage-layout-f506c0a0.html",controller:["$scope","Me",function(e,t){e.me=t,e.userRole=e.community.role,e.setUserRole=function(t){e.userRole=t,e.community.role=t}}]}}}).state("community.edit.profile",{url:"/profile?changed",templateUrl:"https://www.bandlab.com/web-app/community/views/manage/community-edit-02919107.html",controller:"CommunityEditCtrl"}).state("community.edit.picture",{url:"/picture?changed",templateUrl:"https://www.bandlab.com/web-app/community/views/manage/community-picture-20f15f65.html",controller:"PictureEditCtrl"}).state("community.edit.members",{url:"/members",templateUrl:"https://www.bandlab.com/web-app/community/views/manage/community-members-9b591975.html"}).state("community.edit.privacy",{url:"/privacy",templateUrl:"https://www.bandlab.com/web-app/community/views/manage/community-privacy-c8c067c6.html",controller:"CommunityEditCtrl"}).state("communityId",{url:"/community/{id:[a-zA-Z0-9-_]+}",redirectTo:function(e){return e.injector().get("Community").get({id:e.params().id}).$promise.then(function(e){return{state:"community.feed",params:{username:e.username}}})}})}]),angular.module("bandlab.community").controller("CommunityCreateCtrl",["$analytics","$rootScope","$scope","$state","AppNotifications","Community",function(e,t,n,o,a,i){n.community=new i,n.community.type="Public",n.$on("$file:uploadSuccess",function(e,t){n.displayPictureUpload=!1,n.community.pictureId=t.id,n.community.picture=t,n.communityForm.$setDirty()}),n.displayPictureUpload=!1,n.$on("$ngFile:fileChanged",function(){n.displayPictureUpload=!0}),n.addCommunity=function(){delete n.errorMessage,n.community.$save().then(function(n){t.$broadcast("createCommunityModal","close"),t.$broadcast("$community:changed",{action:"create",community:n}),e.eventTrack("Create Community",{category:"Community"}),a.addNotification({title:"Community created",content:"Invite new members and start sharing content with them.",image:n.picture.xs,action:'\n              <div ng-click="hide()">\n                <a href="'.concat(o.href("community.edit.members",{username:n.username}),'">').concat("Manage Members","</a>\n              </div>\n            "),classList:"project",autoclose:5e3})}).catch(function(e){n.communityForm.$setPristine(),n.errorMessage=e.data.message})}}]),angular.module("bandlab.community").controller("CommunityEditCtrl",["$analytics","$rootScope","$scope","$stateParams","$timeout","Community","theCommunity",function(e,t,n,o,a,i,r){n.changeSuccess="true"===o.changed,n.changeError=!1,n.community=angular.copy(r),n.updateCommunity=function(){n.changeError=!1,i.update({id:r.id,name:n.community.name,username:n.community.username,about:n.community.about,type:n.community.type,commentCreateGroup:n.community.commentCreateGroup,postCreateRole:n.community.postCreateRole}).$promise.then(function(o){a(function(){_.assignIn(r,o),n.changeSuccess=!0,t.$broadcast("$community:changed",{action:"update",community:r})},1e3),e.eventTrack("Update Community",{category:"Community"})}).catch(function(){n.communityForm.$setPristine(),n.changeError=!0})}}]),angular.module("bandlab.community").controller("CommunityJoinCtrl",["$scope","CommunityActions",function(e,t){e.cancelRequestToJoinCommunity=function(n,o){return t.cancelRequestToJoinCommunity(n,o).then(function(){e.requestSent=!0}).catch(function(){e.requestSent=!1})}}]),angular.module("bandlab.community").controller("CommunityLeaveCtrl",["$rootScope","$scope","$state","AppNotifications","CommunityActions","MessageModal",function(e,t,n,o,a,i){function r(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).isLastMember,o=void 0!==e&&e;return a.deleteCommunity(t.community,o).then(function(){n.go("library.communities")}).catch(function(e){return s(e,"Cannot delete community")})}function s(e,t){"Cancelled"!==e&&o.addNotification({title:t,content:_.get(e,"data.message")||_.get(e,"message","Unknown error"),autoclose:5e3,classList:"alert"})}t.deleteCommunity=r,t.leaveCommunity=function(){return"Owner"===t.userRole?new i({contentScope:{title:"Leave Community",message:"<p>".concat("As the owner, you’ll need to transfer ownership if you want to leave.","</p>")}}).show():1===t.community.counters.members?r({isLastMember:!0}):a.leaveCommunity(t.community).then(function(){e.$broadcast("$community:left",{community:t.community})}).catch(function(e){return s(e,"Cannot leave community")})},t.userRole=t.community.role}]),angular.module("bandlab.community").controller("CommunityManageCtrl",["$scope","Invite","User",function(e,t,n){function o(){t.query({id:e.community.id,entity:"communities",accepted:!1,limit:50}).$promise.then(function(t){e.pendingInvitedUser=[],e.pendingInvitedExternalUser=[],t.forEach(function(t){var o;t.user?((o=new n(t.user)).invite=t,e.pendingInvitedUser.push(o)):((o=new n({email:t.email})).invite=t,e.pendingInvitedExternalUser.push(o))})})}e.$on("$invite:changed",function(){o()}),o()}]),angular.module("bandlab.community").controller("CommunityMembersCtrl",["$q","$scope","CommunityActions","Role","User",function(e,t,n,o,a){t.removeMember=function(e){n.removeMember(t.community,e).then(function(){_.remove(t.members,function(t){return t.id===e.id}),t.community.counters.members-=1,s-=1}).catch(l)},t.updateRole=function(e,a){if("Owner"===a)return n.assignOwnership(t.community,e).then(function(){_.find(t.members,{role:"Owner"}).role="Admin",t.setUserRole("Admin"),t.members=d(t.members)});o.setUserRole({communityId:t.community.id,userId:e.id,role:a}).then(function(t){e.role=t.role})};var i,r=20,s=0,c=!1;function l(){s=0,i=null,c=!1,t.members=null,t.infiniteScrollEnded=!1,u().then(t.loadMore)}function u(){return c?e.resolve([]):((i=a.fromCommunity({communityId:t.community.id,limit:r,offset:s,accepted:!0}).$promise.then(function(e){return d(e)})).then(function(e){c=0===e.length||e.length<r,s+=e.length}),i)}function d(e){return _.sortBy(e,function(e){return"Owner"===e.role?"1".concat(e.name):"Admin"===e.role?"2".concat(e.name):"3".concat(e.name)})}t.loadMore=function(){return t.infiniteScrollEnded?e.reject("No more results"):i=i.then(function(e){return t.infiniteScrollEnded=c,t.members=t.members||[],t.members=t.members.concat(e),u()})},t.$on("$invite:changed",l),l()}]),angular.module("bandlab.community").controller("CommunityNotificationsCtrl",["$scope","Me","Role",function(e,t,n){e.setNotifications=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"All";n.setNotifications({communityId:e.community.id,userId:t.id,settings:{activityNotifications:o,pushNotifications:o}}).then(function(t){var n=t.activityNotifications,o=t.pushNotifications;e.community.activityNotifications=n,e.community.pushNotifications=o})}}]),angular.module("bandlab.community").controller("ShareWithCommunityCtrl",["$analytics","$rootScope","$scope","AppNotifications","ChatHelper","Community","Me","Post","Share",function(e,t,o,a,i,r,s,c,l){o.communities=r.fromUser({userId:s.id,limit:50}),o.link=l.getShareUrl(o.attachment),o.submitForm=function(r){return i.getLinkPreview(o.link).then(function(e){var t=n(e,1)[0].object;return c.createPost({id:o.selectedCommunity.id,entity:"communities",caption:o.caption,link:t}).$promise}).then(function(){e.eventTrack("Share with a Community",{category:"Post",label:"text"}),a.addNotification({content:i18n(Xt(),o.selectedCommunity.name),autoclose:3e3}),t.$broadcast(o.modalId,"close")}).catch(function(){r.$submitted=!1})}}]),angular.module("bandlab.community").component("communityCard",{bindings:{community:"="},templateUrl:"https://www.bandlab.com/web-app/community/partials/_community-card-38484351.html",controller:["CommunityActions","User",function(e,t){var n=this;n.getMembers=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.fromCommunity(_.assign({communityId:n.community.id,limit:50},e)).$promise},n.joinCommunity=e.joinCommunity,n.leaveCommunity=e.leaveCommunity,n.requestToJoinCommunity=e.requestToJoinCommunity}],controllerAs:"vm"}),angular.module("bandlab.community").component("communityTile",{bindings:{community:"="},transclude:{actions:"?communityTileActions"},templateUrl:"https://www.bandlab.com/web-app/community/partials/_community-tile-cd830333.html",controllerAs:"vm"}),angular.module("bandlab.community").factory("Community",["$resource",function(e){var t="https://www.bandlab.com/api/v1.3/communities";return e(t,{},{delete:{method:"DELETE",params:{id:"@id"},url:"".concat(t,"/:id")},fromUser:{method:"GET",isArray:!0,params:{userId:"",limit:10,offset:0},url:"https://www.bandlab.com/api/v1.3/users/:userId/communities"},get:{method:"GET",params:{id:"@id"},url:"".concat(t,"/:id")},query:{method:"GET",cache:!0,isArray:!0,params:{limit:10,offset:0}},save:{method:"POST",url:t},update:{method:"PATCH",params:{id:"@id"},url:"".concat(t,"/:id")}})}]),angular.module("bandlab.community").factory("CommunityActions",["$analytics","$q","$rootScope","appActions","AppNotifications","authService","ConfirmModal","Invite","Me","Role",function(e,t,n,o,a,i,r,s,c,l){return{assignOwnership:function(e,n){return t(function(t,o){return new r({confirmLabel:"Assign",contentScope:{title:"Transfer Ownership",message:"<p>".concat("Assign ownership to ".concat(n.name,"?"),"</p>")},onCancel:o,onConfirm:function(){l.setUserRole({communityId:e.id,userId:n.id,role:"Owner"}).then(function(e){n.role=e.role,t(n)}).catch(o)}}).show()})},cancelRequestToJoinCommunity:function(e,t){return s.remove({communifyId:e,id:t}).$promise},deleteCommunity:function(o,a){return t(function(t,s){return new r({confirmLabel:"Delete",contentScope:{title:"Delete Community",message:'\n            <div class="text-left">\n              '.concat(a?"<p>".concat("There’s no one else in this community. If you leave, it will be deleted.","</p>"):"","\n              <p>").concat("Deleting a community cannot be undone. By doing so:","</p>\n              <ul>\n                <li>").concat("You will lose access to the existing community posts.","</li>\n                <li>").concat("All community members will no longer be in the community.","</li>\n                <li>").concat("All community members will lose access to the existing community posts.","</li>\n              </ul>\n              <p>").concat("Are you sure you want to delete ".concat(o.name,"?"),"</p>\n            </div>\n          ")},onCancel:function(){return s("Cancelled")},onConfirm:function(){n.$broadcast("$community:changed",{action:"mark-deleted",community:o}),o.$delete().then(i.refreshMe).then(function(){n.$broadcast("$community:changed",{action:"delete",community:o}),e.eventTrack("Delete Community",{category:"Community"}),t(o)}).catch(function(e){n.$broadcast("$community:changed",{action:"unmark-deleted",community:o}),s(e)})}}).show()})},joinCommunity:function(t){if(o.checkAllowed("joinCommunity")){var n=new s;return n.userIds=[c.id],n.$save({rel:"communities",id:t.id}).then(function(){e.eventTrack("Join Community",{category:"Community"})}).finally(function(){return u(t)})}},leaveCommunity:function(o){return t(function(t,a){return new r({confirmLabel:"Leave",contentScope:{title:"Leave Community",message:"<p>".concat("Leave the community?","</p>")},onCancel:function(){return a("Cancelled")},onConfirm:function(){n.$broadcast("$community:changed",{action:"mark-deleted",community:o}),l.removeUserRole({communityId:o.id,userId:c.id}).then(function(){e.eventTrack("Leave Community",{category:"Community"}),u(o),t(o)}).catch(function(e){n.$broadcast("$community:changed",{action:"unmark-deleted",community:o}),a(e)})}}).show()})},removeMember:function(e,n){return t(function(t,o){return new r({confirmLabel:"Remove",contentScope:{title:"Remove Member",message:"<p>".concat("Remove this member from the community?","</p>")},onCancel:o,onConfirm:function(){l.removeUserRole({communityId:e.id,userId:n.id}).then(t).catch(o)}}).show()})},requestToJoinCommunity:function(t){if(o.checkAllowed("joinCommunity")){var n=new s;return n.userIds=[c.id],n.$save({rel:"communities",id:t.id}).then(function(){e.eventTrack("Request to join Community",{category:"Community"}),a.addNotification({title:"Request sent",content:i18n(Jt()),image:t.picture.xs,classList:"community",autoclose:5e3})}).finally(function(){return u(t)})}}};function u(e){e.$get&&setTimeout(function(){e.$get({id:e.id})},1e3)}}]),angular.module("bandlab.connect.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("creatorConnect",{url:"/creator-connect?category&genres&place&skills&nearby",templateUrl:"https://www.bandlab.com/web-app/connect/views/creator-connect-ee0a174b.html",resolve:{theLocation:["$http","$stateParams","Place",function(e,t,n){if(t.place)return n.query({query:t.place}).$promise.then(function(e){return e[0]})}],theQuery:["$q","$stateParams","Me","theGenres","theSkills",function(e,t,n,o,a){var i=t.genres&&t.genres.split(";").map(function(e){return o.find(function(t){return t.id===e})})||[],r=t.place,s=r?null:t.nearby,c=t.skills&&t.skills.split(";").map(function(e){return a.find(function(t){return t.id===e})})||[];return c.length||i.length||r||angular.isDefined(s)?{genres:i,place:r,skills:c,nearby:s}:e.reject({status:301,location:{name:"creatorConnect",params:function(){switch(t.category){case"beatmakers":return{genres:"hip-hop;r-n-b",nearby:!1,skills:"dj-beatmaker;vocalist"};case"guitarists":return{nearby:!1,skills:"bass-player;guitarist"};case"near-you":return{nearby:!0};default:return{nearby:!1}}}()}})}],polyfill:function(){return Promise.all([function(){var e=!1;try{document.createElement("div").scrollTo({top:0,get behavior(){return e=!0,"smooth"}})}catch(e){}return e}()||O("https://unpkg.com/smoothscroll-polyfill@0.4.3/dist/smoothscroll.js"),"IntersectionObserver"in window||O("https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js")])},theGenres:["Tag",function(e){return e.getGenres()}],theSkills:["Tag",function(e){return e.getSkills()}]},controller:["$analytics","$http","$scope","$state","$stateParams","ClientDevice","CreatorConnect","Me","Place","Player","Post","Search","theGenres","theLocation","theQuery","theSkills","VideoTile",function(e,t,n,o,a,i,r,s,c,l,u,d,p,m,f,h,g){if(n.isMobile=i.isMobile,n.isTablet=i.isTablet,!n.isMobile){var v=null;n.creatorConnect=r,n.theSkills=h,n.theGenres=p,n.me=s,n.location={search:"",places:[],theLocation:m},r.query=f,n.$watch("location.search",function(e){c.query({query:e}).$promise.then(function(e){n.location.places=e})}),b().then(function(){n.user=n.users[0]}),n.joinGenres=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(function(e){return e.name}).join(", ")},n.initGenreFilters=function(){return r.query.genres.reduce(function(e,t){return e[t.id]=!0,e},{})},n.initSkillFilters=function(){return r.query.skills.reduce(function(e,t){return e[t.id]=!0,e},{})},n.applySkills=function(e){var t=Object.keys(e).filter(function(t){return e[t]}).join(";");t!==a.skills&&o.go(".",{skills:t},{reload:!0})},n.applyGenres=function(e){var t=Object.keys(e).filter(function(t){return e[t]}).join(";");t!==a.skills&&o.go(".",{genres:t},{reload:!0})},n.applyLocation=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;JSON.stringify(e)===a&&t===a.place||o.go(".",Zt({},t?{}:{nearby:e},{place:t}),{reload:!0})},n.getSubtitle=function(){return"hip-hop,r-n-b"===a.genres&&"vocalist"===a.skills?"Rappers/Beatmakers":"bass-player,guitarists"===a.skills?"Guitarists":m?m.name:"true"===a.nearby?"Near You":"false"!==a.nearby||a.placeId?"Meet the makers from all over the world":"Worldwide"},n.hasPrevious=function(){return r.userEl&&r.userEl.previousElementSibling&&r.userEl.previousElementSibling.hasAttribute("creator-connect-carousel-user")},n.hasNext=function(){return r.userEl&&r.userEl.nextElementSibling&&r.userEl.nextElementSibling.hasAttribute("creator-connect-carousel-user")},n.next=function(){if("scrollBehavior"in document.documentElement.style)r.userEl.nextElementSibling.scrollIntoView({behavior:"smooth",inline:"center"});else{var t=r.userEl.nextElementSibling.getBoundingClientRect().width;r.userEl.parentNode.scrollTo({left:r.userEl.nextElementSibling.offsetLeft-(document.body.clientWidth-t)/2,behavior:"smooth"})}n.users.length-n.users.indexOf(r.user)<3&&b(),y(),e.eventTrack("Browse next user",{category:"Creator Connect",label:n.users.indexOf(r.user)})},n.previous=function(){if("scrollBehavior"in document.documentElement.style)r.userEl.previousElementSibling.scrollIntoView({behavior:"smooth",inline:"center"});else{var e=r.userEl.nextElementSibling.getBoundingClientRect().width;r.userEl.parentNode.scrollTo({left:r.userEl.previousElementSibling.offsetLeft-(document.body.clientWidth-e)/2,behavior:"smooth"})}y()}}function b(){return d.collaborators({after:v,nearby:m?null:r.query.nearby||null,placeId:m?m.id:null,latitude:null,longitude:null,maxDistance:null,genres:r.query.genres.map(function(e){return e.id}).sort().join(";")||null,skills:r.query.skills.map(function(e){return e.id}).sort().join(";")||null}).then(function(e){var o=e.data,a=e.paging;v=a.cursors.after,n.users=(n.users||[]).concat(o),o.map(function(e){t.get("https://www.bandlab.com/api/v1.3/users/".concat(e.id,"/posts"),{silent:!0}).then(function(t){var n=t.data;e.pinnedPost=_.find(n,{isPinned:!0,type:"Revision"}),e.pinnedPost&&(e.pinnedPost.revision.postId=e.pinnedPost.id)})})}).catch(function(e){n.users=[],n.errorCode=_.get(e,"data.errorCode")})}function y(){g.current&&g.current.pause(),l.getCurrentSong().id===_.get(r,"user.pinnedPost.revision.id")&&l.pause()}}]})}]).constant("CreatorConnect",{query:{},user:{},userEl:{}}).directive("creatorConnectKeyboard",function(){return{link:function(e){function t(t){var n=t.ctrlKey||t.metaKey;if(-1===["INPUT","TEXTAREA"].indexOf(t.target.nodeName)&&!n&&!t.shiftKey){switch(t.code){case"ArrowLeft":return t.preventDefault(),e.previous();case"ArrowRight":return t.preventDefault(),e.next()}e.$applyAsync()}}angular.element(document.body).on("keydown",t),e.$on("$destroy",function(){angular.element(document.body).off("keydown",t)})}}}).directive("creatorConnectLocationKeyboard",function(){return{link:function(e,t){t.on("keydown",function(t){if(!t.ctrlKey&&!t.metaKey&&!t.shiftKey){switch(t.code){case"Enter":var n=_.find(e.location.places,{isHovered:!0});n&&e.applyLocation(!1,n.name),t.stopPropagation(),t.preventDefault();break;case"ArrowUp":var o=_.findIndex(e.location.places,{isHovered:!0}),a=_.find(e.location.places,{isHovered:!0});a&&(a.isHovered=!1),e.location.places[Math.max(o-1,0)].isHovered=!0,t.preventDefault();break;case"ArrowDown":var i=_.findIndex(e.location.places,{isHovered:!0}),r=_.find(e.location.places,{isHovered:!0});r&&(r.isHovered=!1),e.location.places[Math.min(i+1,e.location.places.length-1)].isHovered=!0,t.preventDefault()}e.$applyAsync()}})}}}).directive("creatorConnectCarouselUser",["CreatorConnect",function(e){return{restrict:"A",link:function(t,o){new IntersectionObserver(function(a){n(a,1)[0].intersectionRatio>=.8&&(e.user=t.user,e.userEl=o[0],t.$applyAsync())},{threshold:.8}).observe(o[0])}}}]).directive("creatorConnectVideo",["$q","$timeout","AppNotifications",function(e,t,o){return{restrict:"A",require:"?ngModel",link:function(a,i,r,s){var c=i[0].querySelector("input");a.selectFile=function(){setTimeout(function(){return c.click()})},a.removeVideo=function(){a.user.introVideo=null,a.user.introVideoId=null,a.videoFile=null,s&&s.$setViewValue(null)},a.$on("$ngFile:fileChanged",function(i,r){var s=n(r,1)[0];s&&function(t){var n=e.defer(),o=document.createElement("video");return o.src=URL.createObjectURL(t),o.onloadedmetadata=function(){return o.duration>60?n.reject({message:"Video length should be less than ".concat(60," seconds.")}):o.duration<=10?n.reject({message:"Video length must be more than ".concat(10," seconds.")}):n.resolve([t,o.duration])},o.onerror=function(e){return n.reject(e)},n.promise}(s).then(function(e){var o=n(e,1)[0];a.user.introVideo=null,a.user.introVideoId=null,a.videoFile=null,a.importing=!0,t(function(){a.videoFile=o,a.importing=!1})}).catch(function(t){return o.addNotification({title:"Import Error",content:t.message,classList:"alert"}),e.reject(t)})})}}}]),angular.module("bandlab.common").controller("ArtistsCtrl",["$rootScope","$scope",function(e,t){t.updateInspiration=function(){t.user.inspiredBy=t.artists,e.$broadcast("artists","close")},t.artists=t.user.inspiredBy?He(t.user.inspiredBy):[]}]),angular.module("bandlab.user").directive("selectMultipleArtists",["$http",function(e){return{restrict:"E",templateUrl:"https://www.bandlab.com/web-app/connect/partials/_select-multiple-artists-6d652fda.html",scope:{artists:"="},link:function(t,n){var o,a,i=n[0].querySelector(".select-multiple-users-textarea");function r(){if(t.allowEmails){var e=_.chain(t.inviteUser).split(/[;,]/).map(function(e){return e.trim()}).filter(Boolean).uniq().value();if(/[;,]$/.test(t.inviteUser)||!(e.length<2)){var n=_.chain(e).map(function(e){return e.indexOf("@")>0?{type:"email",email:e}:{type:"user",username:e.replace("@","")}}).filter(function(e){return e.email?!(t.artists.find(function(t){return t.email===e.email})||t.pendingExternalUsers.find(function(t){return t.email===e.email})):!(t.artists.find(function(t){return t.username===e.username})||t.pendingUsers.find(function(t){return t.username===e.username}))}).value();t.artists=t.artists.concat(n),t.inviteUser=""}}else t.inviteUser=t.inviteUser.replace(/[,]+$/,",").replace(/[;]+$/,";")}t.inviteUser="",t.suggestions={artists:[]},n[0].closest(".modal").addEventListener("click",function(e){!e.target.closest(".select-multiple-users")&&t.inviteUser&&(t.inviteUser+=";",r(),t.$applyAsync())}),t.setUser=function(e){e.type="user",t.artists.push(e),t.inviteUser=""},t.handleKeys=function(e){8!==e.which||t.inviteUser?(9===e.which&&t.inviteUser||13===e.which)&&(e.preventDefault(),setTimeout(function(){t.inviteUser&&(t.inviteUser+=";",r())})):t.artists.pop()},t.removeUser=function(e){_.remove(t.artists,e),i.focus()},t.clearSuggestions=function(){t.suggestions={artists:[]}},t.$watch("inviteUser",function(){a=t.inviteUser,r(),o&&0===_.get(o,"$$state.status")||function n(i){angular.isUndefined(i)||0===i.length?t.suggestions={artists:[]}:(o=e.get("https://www.bandlab.com/api/v1.3/artists?query=".concat(i)).then(function(e){return e.data})).then(function(e){if(a!==i&&i)return n(a);t.suggestions.artists=e})}(a)})}}}]),angular.module("bandlab.web").controller("ContactCtrl",["$analytics","$scope","Contact","Me",function(e,t,n,o){return t.me=o,t.submitContactForm=function(){t.contact.$save().then(function(){t.messageSent=!0,e.eventTrack("Send Feedback",{category:"Contact"})}).catch(function(){t.messageNotSent=!0})},t.messageSent=!1,delete t.messageNotSent,void(t.contact=new n)}]),angular.module("bandlab.web").controller("ContactProfessionalCtrl",["$analytics","$location","$scope","$state","Contact","Me",function(e,t,n,o,a,i){var r=t.absUrl().replace(t.path(),"");n.me=i,n.contact=new a,n.submitContactForm=function(t){n.contact.revisionUrl="".concat(r).concat(function(e){return o.href("".concat(e.song.author.type.toLowerCase(),"Song"),{username:e.song.author.username,slug:e.song.slug,revId:e.id})}(t)),n.contact.description='Request to "'.concat(n.contact.studio,'" studio.\n\nSong revision url: ').concat(n.contact.revisionUrl,"\n\n").concat(n.contact.description),n.contact.$save().then(function(){n.messageSent=!0,e.eventTrack("Contact Professional",{category:"Contact"})}).catch(function(){n.messageNotSent=!0})}}]),angular.module("bandlab.web").controller("ReportCtrl",["$analytics","$q","$scope","$state","$stateParams","Contact","User",function(e,t,n,o,a,i,r){var s=t.resolve();n.toReport.creator&&r.get({id:n.toReport.creator.id}).$promise.then(function(e){n.toReport.creator=e,n.wasFollower=e.isFollower}),n.contact=new i({reason:""}),n.messageSent=!1,n.submitReason=function(e){var t=e.reason;n.submitReport({reason:t})},n.submitReport=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=t.reason,a=void 0===o?n.reason||"":o;0!==s.$$state.status&&(n.contact.objectType=n.toReport.objectType,n.contact.objectId=n.toReport.objectId,n.contact.reason=a.split(" ").join("-"),n.contact.description=n.contact.description||"".concat(n.contact.reason,"\n").concat(n.toReport.objectType,"\n").concat(n.toReport.objectId),s=n.contact.$report().then(function(){e.eventTrack("Report ".concat(a),{category:"Contact",label:n.toReport.objectType}),n.step="thanks"}))},n.submitFeedback=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.reason,o=void 0===t?n.reason:t,a=e.type,i=void 0===a?n.type:a;0!==s.$$state.status&&(n.contact.reason=o.split(" ").join("-"),n.contact.subject="bugs"===i?"Something isn't working":"",s=n.contact.$save().then(function(){n.step="thanks-feedback"}))},n.submitReportWebview=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.reason,r=void 0===i?a.reason||"":i;0!==s.$$state.status&&(n.contact.objectType=n.toReport.objectType,n.contact.objectId=n.toReport.objectId,n.contact.reason=r.split(" ").join("-"),n.contact.description=n.contact.description||"".concat(n.contact.reason,"\n").concat(n.toReport.objectType,"\n").concat(n.toReport.objectId),s=n.contact.$report().then(function(){e.eventTrack("Report Content within web view",{category:"Contact",label:n.contact.objectType}),o.go(".",{step:"thanks"})}))},n.submitFeedbackWebview=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.reason,r=void 0===i?a.reason||"":i;0!==s.$$state.status&&(n.contact.reason=r.split(" ").join("-"),n.contact.subject="bugs"===a.type?"Something isn't working":"",n.contact.description=n.contact.description||"".concat(n.contact.reason,"\n").concat(n.toReport.objectType,"\n").concat(n.toReport.objectId),s=n.contact.$save().then(function(){e.eventTrack("Send Feedback within web view",{category:"Contact",label:r}),o.go(".",{step:"thanks-feedback"})}))}}]),angular.module("bandlab.web").factory("Contact",["$resource","$window","appVersion","ClientDevice","Me",function(e,t,n,o,a){var i="https://www.bandlab.com/api/v1.3/",r=e(i,{},{save:{method:"POST",url:"".concat(i,"feedback"),transformRequest:[function(e){return tn({name:a.name||null,type:"Feedback",username:a.username||null},e)},angular.toJson]},report:{method:"POST",url:"".concat(i,"report"),transformRequest:[function(e){return tn({reportType:"Other"},e)},angular.toJson]}});return function(e){return new r(tn({appVersion:n,email:a.email||null,language:t.navigator.userLanguage||t.navigator.language,platform:o.isAndroid?"Android":o.isiOs?"iOS":"Web",userAgent:t.navigator.userAgent},e))}}]),angular.module("bandlab.web").config(["$stateProvider",function(e){o.$inject=["$stateParams"];var t=["popular","recent"];function o(e){return _.includes(t,e.sort)?e.sort:t[0]}e.state("contest",{url:"/contests",redirectTo:function(e){return e.injector().getAsync("theContests").then(function(e){return{state:"contest.posts",params:{id:n(e,1)[0].id}}})},resolve:{theContests:["$http",function(e){return e.get("https://www.bandlab.com/api/v2.0/contents/explore?types=contests",{cache:!0}).then(function(e){var t=e.data.data;return _.map(t,function(e){return e.startDateObject=new Date(e.startDate),e.now=new Date,e})}).catch(function(){return[]})}]},template:"<ui-view/>"}).state("contest.posts",{url:"/:id?sort",resolve:{theContest:["$stateParams","Contest",function(e,t){return t.get({id:e.id}).$promise.then(function(e){return e.startDateObject=new Date(e.startDate),e.now=new Date,e})}],theSort:o},views:{"":{templateUrl:"https://www.bandlab.com/web-app/contest/views/contest-posts-a7ad2dfe.html",controller:["$scope","theContest","theContests","theSort",function(e,t,n,o){e.contest=t,e.contests=_.reject(n,{id:t.id}),e.sort=o}]},"sort@contest.posts":{templateUrl:"https://www.bandlab.com/web-app/contest/partials/_sort-9738d2aa.html",controller:["$scope","$state","theSort",function(e,t,n){e.sort=n,e.applySort=function(e){t.go(".",{sort:e})}}]},"list@contest.posts":{templateUrl:"https://www.bandlab.com/web-app/explore/partials/_explore-posts-19628176.html",controller:"PostsListCtrl"}}})}]),angular.module("bandlab.web").factory("Contest",["$resource",function(e){var t="https://www.bandlab.com/api/v1.3/contests";return e(t,{},{get:{method:"GET",params:{id:"@id"},url:"".concat(t,"/:id")}})}]),angular.module("bandlab.editor",[]);var nn=function(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a};function on(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function an(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?on(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):on(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function rn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}angular.module("bandlab.editor").directive("mixEditor",["$analytics","$filter","$q","$state","$window","AnimationFrame","AppNotifications","AudioState","DrumMachine","Editor","EditorAllowActions","EditorData","EditorDB","editorEvents","EditorHelper","EditorHistory","EditorImporter","EditorPlayback","EditorReset","EditorRevision","editorSettings","EditorSocket","EditorState","EditorTrack","Me","Metronome","MetronomeState","MidiEditor","MidiEditorState","Modal","Page",function(e,t,n,o,a,r,s,l,u,d,p,m,f,h,g,v,b,y,w,k,S,P,E,T,M,$,C,A,R,I,O){return{replace:!0,restrict:"E",scope:{revision:"="},templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-2c99d6c0.html",controller:["$scope",function(x){var L=n.defer();function N(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.state,n=void 0===t?E:t,o=e.time,a=void 0===o?E.crTime:o,i=n===E?"scale:timeline":"scale:notesTimeline",s=n.scalePx;n.scalePx=4*n.scale*k.current.metronome.bpm/120,n.containerWidth=S.SONG_DURATION_MAX*n.scalePx,r.start(i,!1,{oldScalePx:s,time:a,scalePx:n.scalePx});var c=n===E?R:E;if(R.isLocked&&c.scalePx!==n.scalePx){R.isZooming=!0;var l=c===E?"scale:timeline":"scale:notesTimeline";c.scalePx=n.scalePx,c.containerWidth=n.containerWidth,r.start(l,!1,{oldScalePx:s,time:a,scalePx:n.scalePx}),setTimeout(function(){R.isZooming=!1})}}function U(){E.isSnappingDisabled=!E.isSnappingDisabled,E.isSnapping=!E.isSnapping}x.user=M,x.isCollaborating=!0,x.historyState=v.state,x.audioState=l,x.state=E,x.midiEditorState=R,E.scale=S.SCALES[4],R.scale=S.SCALES[6],x.trackColors=i,x.broadcastScale=N,x.displayAddTrack=function(){var n,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=angular.noop;function i(){n.destroy(),R.isVisible=!1}(n=new I({templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-track-new-modal-bc1a5cbe.html",onCreate:function(){E.isInBackground=!0},onDestroy:function(){E.isInBackground=!1,a()},contentScope:{addTrack:function(n,a){i(),function(n){try{var o=T.addTrack(n);x.revision.tracks.length<=1&&g.displayInstrument({toggle:!1}),e.eventTrack("Add Track",{category:"Mix Editor",label:t("displayInstrument")(o)})}catch(e){}}(o="piano"===n?angular.extend(o,{name:a,soundbank:"grand-piano",type:"piano"}):n===c?angular.extend(o,{name:a,soundbank:"808-kit",type:c}):angular.extend(o,{name:a,type:n}))},browseLoops:function(){i(),x.displayTab("Loops"),e.eventTrack("Add Track",{category:"Mix Editor",label:"Browse Loops"})},importFile:function(){document.querySelector(".mix-editor-track-placeholder input").click(),a=x.$on(h.importFile,function(){i(),e.eventTrack("Add Track",{category:"Mix Editor",label:"Import File"})})}}})).show()},x.disconnectSocket=function(){f.removeSnapshot(x.revision.id),a.location.href=o.href("mixEditor",{id:o.params.id,userId:null},{absolute:!0})},x.save=function(e){var t=e.publish,n=void 0!==t&&t,o=e.upgrade,a=void 0===o||o;return n&&(l.previewPlayer.pause(),u.stop(),y.pausePlay(),x.$broadcast(h.stopLoop)),d.startSave({publish:n,upgrade:a}).then(function(e){return O.setMetadata({title:x.revision.song.name}),O.update(),e})},x.toggleSnap=U,x.toggleArm=function(){E.isArming=!E.isArming,E.isArming||(k.armedTracks[2]=null)},x.zoomIn=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.state,o=void 0===n?E:n,a=t.scale,i=nn(t,["state","scale"]),r=o===E?"zoomIn":"midiRollZoomIn";if(p.isAllowed(r)){var s=S.SCALES.findIndex(function(e){return e>o.scale});if(a)o.scale=a;else{if(!S.SCALES[s])return;o.scale=S.SCALES[s]}var c=o===E?R:E;R.isLocked&&c.scale!==o.scale&&(c.scale=o.scale),N(an({state:o},i)),e.eventTrack("Zoom",{category:"Mix Editor",label:"in",value:o.scale})}},x.zoomOut=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.state,o=void 0===n?E:n,a=t.scale,i=nn(t,["state","scale"]),r=o===E?"zoomOut":"midiRollZoomOut";if(p.isAllowed(r)){var s=S.SCALES.findIndex(function(e){return e>=o.scale})-1;if(a)o.scale=a;else{if(!S.SCALES[s])return;o.scale=S.SCALES[s]}var c=o===E?R:E;R.isLocked&&c.scale!==o.scale&&(c.scale=o.scale),N(an({state:o},i)),e.eventTrack("Zoom",{category:"Mix Editor",label:"out",value:E.scale})}},x.canChangeInput=function(){return p.isAllowed("changeInput")},x.displayInstrument=g.displayInstrument,x.displayMidiEditor=g.displayMidiEditor,x.displayPresetSettings=g.displayPresetSettings,x.extendAudioInput=g.extendAudioInput,x.getTrack=function(){return k.selectedTrack},x.hasSelectedNotes=A.hasSelectedNotes,x.hidePanel=g.hidePanel,x.refreshRollLayout=A.refreshRollLayout,x.resizeRollHeight=A.resizeRollHeight,x.storeRollHeight=A.storeRollHeight,n.race([d.init(x.revision),L.promise]).then(function(){x.revision=k.current,o.params.userId?(P.joinSession(),e.eventTrack("Join session via link",{category:"Realtime Collaboration"})):k.current.song.id&&P.joinProject(),_.some(x.revision.samples,{error:!0})&&s.addNotification({title:"Samples could not be loaded. Refresh the page and try again.",classList:"alert",autoclose:5e3}),isNaN(localStorage.countInDuration)||(S.COUNT_IN_DURATION=parseInt(localStorage.countInDuration)),angular.isDefined(localStorage.metronomeSound)&&(C.sound=_.find($.getSpriteMap(),{name:localStorage.metronomeSound})),angular.isDefined(localStorage.metronomeVolume)&&(C.gainNode.gain.value=localStorage.metronomeVolume),0!==x.revision.tracks.length||o.params.userId||"file"===o.params.source||x.displayAddTrack({pushUndo:!1}),o.params.soundbank&&g.displayInstrument({toggle:!1}),x.revision.tracks.forEach(function(e){e.isFrozen&&(e.isFrozen=!1,T.freezeTrack(x,e))})}).catch(function(e){e.message!==D&&(e.message===Q?alert(Q):(a.Raven.captureException(e.message||e.name||"Unable to initialize Mix Editor. Please re-open it.",{error:e,extra:{revision:x.revision}}),alert("Unable to initialize Mix Editor. Please re-open it.")),o.go("library.projects.songs",{category:"recent"}))}),N({state:E}),N({state:R}),x.$on(h.importFile,function(t,n){p.isAllowed("import")&&(b.importFile(n),n.file?e.eventTrack("Import File",{category:"Mix Editor",label:n.file.type}):e.eventTrack("Import Loop",{category:"Mix Editor",label:n.name}))}),x.$on(h.keyDown.addTrack,function(){x.displayAddTrack()}),x.$on(h.keyDown.zoomIn,function(){x.zoomIn()}),x.$on(h.keyDown.zoomOut,function(){x.zoomOut()}),x.$on(h.keyDown.save,function(){x.save({publish:!1})}),x.$on(h.keyDown.selectAllRegions,function(){k.selectedRegions=new Set(m.getRegions())}),x.$on(h.keyDown.snapEnable,function(){E.isSnappingDisabled||x.$apply(function(){E.isSnapping=!0})}),x.$on(h.keyDown.snapDisable,function(){E.isSnappingDisabled||x.$apply(function(){E.isSnapping=!1})}),x.$on(h.keyDown.toggleLoops,function(){x.$apply(function(){x.toggleTab("Loops")})}),x.$on(h.keyDown.toggleSnap,function(){x.$apply(function(){U()})}),x.$on(h.pausePlaying,function(){x.$applyAsync()}),x.$on("$destroy",function(){f.deleteFiles(),f.removeSnapshot(x.revision.id),w.reset(),L.reject(new Error(D))}),document.body.classList.add(E.theme),x.$watch("state.theme",function(e,t){document.body.classList.replace(t,e)})}]}}]),angular.module("bandlab.editor").directive("allowAction",["EditorAllowActions",function(e){return{restrict:"A",priority:-100,compile:function(t,n){return e.isAllowed(n.allowAction)||t.addClass("disabled").attr("disabled","disabled"),function(t,n,o){t.$watch("state",function(){e.isAllowed(o.allowAction)?n.removeClass("disabled").removeAttr("disabled"):n.addClass("disabled").attr("disabled","disabled")},!0)}}}}]),angular.module("bandlab.editor").directive("mixEditorAreaSelection",["$document","EditorRevision","EditorScroll","EditorScrollState",function(e,t,n,o){return{restrict:"A",link:function(a,i){var r,s,c,l,u,d,p;function m(e,t){d=e,p=t}function f(){var e=Math.min(l,d),t=Math.min(u,p),n=Math.max(l,d),o=Math.max(u,p);r.css({left:"".concat(e,"px"),top:"".concat(t,"px"),right:"calc(100% - ".concat(n,"px)"),bottom:"calc(100% - ".concat(o,"px)")})}function h(e){return!(e.bottomRight.y<Math.min(u,p)||Math.max(u,p)<e.topLeft.y||e.topLeft.x>Math.max(l,d)||Math.min(l,d)>e.bottomRight.x)}function g(){t.selectedRegions.clear(),_.chain(c).filter(h).filter(function(e){return e.model.canEdit}).forEach(function(e){t.selectedRegions.add(e.model)}).value()}function v(e){var t,r=i[0].getBoundingClientRect(),c=i[0].parentElement.scrollLeft,l=i[0].scrollTop,u=i[0].clientHeight+r.top,h=i[0].clientWidth;e.target===i[0]?m(e.offsetX,e.offsetY+i[0].scrollTop):m(r.left>e.pageX&&0===c?0:Math.min(e.pageX-r.left,h),r.top>e.pageY&&0===l?0:Math.min(e.pageY,u)-r.top+l),f(),g(),a.$digest(),clearInterval(s),s=setInterval(function(){t=function(e,t){var n=i[0].scrollHeight,a=i[0].clientWidth,r=o.SCROLL_STEP,s=i[0].parentElement.getBoundingClientRect();return s.top>t?(p=Math.max(p-r,0),{up:!0}):s.top+s.height<=t?(p=Math.min(p+r,n),{down:!0}):s.left>e?(d=Math.max(d-r,0),{left:!0}):s.left+s.width<=e?(d=Math.min(d+r,a),{right:!0}):void 0}(e.clientX,e.clientY),n.manualScroll(t),f()},30)}function b(){g(),a.$digest(),r.remove(),i.removeClass("selecting"),clearInterval(s),e.off("mousemove",v),e.off("mouseup",b),l=0,u=0,d=0,p=0}i.on("mousedown",function(t){var n,s,m=i[0].getBoundingClientRect().top;1!==t.which||t.target.closest(".mix-editor-region")||t.target.closest(".mix-editor-automation")||(r&&r.remove(),r=angular.element('<div class="mix-editor-area-selection"><div>'),i.append(r),i.addClass("selecting"),n=t.offsetX,s=t.clientY+o.tracksEl.scrollTop-m,l=n,u=s,d=n,p=s,c=function(e){var t=document.querySelectorAll(".mix-editor-region");return _.map(t,function(t){var n,i=t.getBoundingClientRect();return{model:(n=t.getAttribute("data-id"),_.chain(a.revision.tracks).map("regions").flatten().find({id:n}).value()),topLeft:{x:t.offsetLeft,y:i.top-e+o.tracksTop},bottomRight:{x:t.offsetLeft+i.width,y:i.top-e+i.height+o.tracksTop}}})}(m),e.on("mousemove",v),e.on("mouseup",b))})}}}]),angular.module("bandlab.editor").filter("pathString",["EditorAutomation","editorSettings",function(e,t){return function(n){var o;if(n)return 0!==n.track.automation[n.meta.name].length?((o=_.clone(n.track.automation[n.meta.name])).unshift({position:-10,value:o[0].value}),o.push({position:t.SONG_DURATION_MAX,value:o[o.length-1].value}),o.unshift({position:0,value:n.meta.base}),o.push({position:t.SONG_DURATION_MAX,value:n.meta.base})):o=[{position:0,value:n.track[n.meta.name]},{position:t.SONG_DURATION_MAX,value:n.track[n.meta.name]}],_.chain(o).map(function(t){return"".concat(e.convertTimeToX(t.position),",").concat(e.convertValueToY(t.value,n.height,n.meta))}).join(" ").value()}}]).directive("mixEditorAutomation",["$document","audioSettings","EditorAllowActions","EditorAutomation","EditorHelper","EditorHistory","EditorPlayer","EditorRevision","EditorState",function(e,t,n,o,a,i,r,s,c){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-automation-a5eb1a59.html",link:function(l,u){var d,p,m,f,h,g,v=u[0].clientHeight,b=o.MARKER_AREA,y=t.AUDIO_PARAMETERS[s.trackAutomationParameters.get(l.track)||"volume"];function w(){l.hasAutomation="pan"===y.name&&!!l.track.automation.pan.length||"volume"===y.name&&!!l.track.automation.volume.length}function k(){!m||d.position===m.position&&d.value===m.value||(p&&(i.pushUndo(p),p=null),r.current.setTrackAutomation(l.track,y.name,c.crTime)),l.$apply(),e.off("mousemove",S),e.off("mouseup",k),u.on("mousemove",P)}function S(e){if(m){var t=o.convertXtoTime(Math.max(e.clientX-g.left,b/2)),n=Math.max(Math.min(e.clientY-g.top,v-b),0);l.track.automation[y.name]=_.filter(h,function(e,n){return(e.position<d.position||e.position>t)&&(e.position>d.position||e.position<t)||n===f}),m.position=t,m.value=o.convertYtoValue(n,v,y),P(null,m),o.syncVolume()}}function P(e,t){t=t||T(e);var n=l.selectionMark||{};t?(l.selectionMark=o.convertToCoordinates([t],v,y)[0],l.selectionMark.value=t.value):l.selectionMark={},l.selectionMark.posX===n.posX&&l.selectionMark.posY===n.posY||l.$digest()}function E(e){var t;(t=T(e))&&(i.pushUndo(l.revision),l.track.automation[y.name].splice(_.findIndex(l.track.automation[y.name],{position:t.position}),1),l.$apply(),r.current.setTrackAutomation(l.track,y.name,c.crTime),0===l.track.automation[y.name].length&&r.current.setTrackParameter(l.track.id,y.name,l.track[y.name]),o.syncVolume(),w()),u.off("dblclick")}function T(e){var t=_.findIndex(o.convertToCoordinates(l.track.automation[y.name],v,y),function(t){return Math.pow(e.offsetX-t.posX,2)+Math.pow(e.offsetY-t.posY,2)<b*b});return f=t,l.track.automation[y.name][t]}l.getAutomationData=function(){return{track:l.track,height:v,meta:y}},l.getMarkerMidId=function(){return"marker-mid: url(#markerCircle-".concat(l.track.id,");")},l.resetAutomation=function(){i.pushUndo(l.revision),l.track.automation[y.name]=[],r.current.setTrackParameter(l.track.id,y.name,l.track[y.name]),o.syncVolume(),w()},l.$watch(function(){return s.trackAutomationParameters.get(l.track)},function(e){y=t.AUDIO_PARAMETERS[e||"volume"],w()}),l.toProperUnit=function(e){return"volume"===y.name?a.toDiffDecibels(e):a.panDisplay(e)},u.on("mousedown",function(a){2!==a.button&&n.isAllowed("editTrack")&&(g=u[0].getBoundingClientRect(),(m=T(a))?(p=_.cloneDeep(l.revision),u.on("dblclick",E)):m=function(e){i.pushUndo(l.revision);var n=o.convertToValues([e],v,y)[0],a=l.track.automation[y.name],s=_.sortedIndexBy(a,n,"position");return a.length||(n.value=t.AUDIO_PARAMETERS[y.name].default),a.splice(s,0,n),l.$apply(),r.current.setTrackAutomation(l.track,y.name,c.crTime),o.syncVolume(),f=s,w(),a[s]}({posX:a.offsetX,posY:Math.min(a.offsetY,v-b)}),P(null,m),h=_.clone(l.track.automation[y.name]),d=_.clone(m),e.on("mousemove",S),e.on("mouseup",k),u.off("mousemove",P))}),u.on("mousemove",P),w()}}}]),angular.module("bandlab.editor").directive("mixEditorBody",["editorEvents","EditorRevision","EditorState","EditorTrack",function(e,t,n,o){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-body-9fdd9b7a.html",controller:["$scope",function(a){a.selectTrack=function(e){n.isRecording||e.id===t.selectedTrack.id||o.setSelected(e)},a.$on(e.keyDown.selectTrack,function(e,n){var o=_.find(t.current.tracks,{order:n});o&&a.selectTrack(o)})}]}}]),angular.module("bandlab.editor").directive("mixEditorCollaborators",["$cookies","$interval","$q","appActions","AppNotifications","Chat","EditorCollaboratorsState","EditorRevision","EditorState","Me","Modal","SignalChat","User",function(e,t,n,o,a,i,r,s,c,l,u,d,p){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-collaborators-7a658097.html",controller:["$scope",function(i){var m;if(i.editorCollaboratorsState=r,i.openCollaboratorModal=function(){function e(){var e=new u({templateUrl:"https://www.bandlab.com/web-app/song/partials/_song-invite-collaborators-49a6c881.html",contentScope:{song:i.revision.song,me:l},onDestroy:h}),t=i.$on("$invite:changed",function(){h(),e.destroy(),t()});e.show()}i.revision.song.id||c.hasRevisionChanges?o.checkAllowed("projectInvite")&&(i.revision.song.id||!c.hasRevisionChanges?e():i.save({publish:!1}).then(function(){i.revision.song.canEdit=!0,e()})):a.addNotification({title:"Unable to invite collaborators",content:"Before inviting collaborators, you must create a project first.",autoclose:1e4})},!e.get("gotRealtimeHelp")){var f=new Date;f.setDate(f.getDate()+10),e.put("gotRealtimeHelp","true",{expires:f}),new u({templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-collaborators-help-4e469828.html"}).show()}function h(){n.resolve();var e="Band"===_.get(i,"revision.song.author.type")?p.fromBand({bandId:i.revision.song.author.id,accepted:!0}).$promise.then(function(e){return e.forEach(function(e){e.isMember=!0}),e}).catch(function(){return[]}):n.resolve([]),t="User"===_.get(i,"revision.song.author.type")?p.get({id:i.revision.song.author.id}).$promise.then(function(e){return e.isOwner=!0,[e]}).catch(function(){return[]}):n.resolve([]),o=i.revision.song.id?p.getCollaborators({songId:i.revision.song.id,limit:50}).$promise.then(function(e){return e.forEach(function(e){e.isCollaborator=!0}),e}).catch(function(){return[]}):n.resolve([]);return n.all([t,e,o]).then(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=_.chain(t).flatten().flatten().compact().uniqBy("id").filter(function(e){return!0}).map(function(e){var t=_.find(r.chats||[],{participant:{id:e.id}});return{participant:e,conversation:t&&t.conversation}}).value();r.chats=o,r.members=_.chain(t).flatten().flatten().compact().uniqBy("id").reduce(function(e,t){return e[t.id]=t,e},{}).value()})}i.$on("$destroy",function(){t.cancel(m)}),r.projectChat.messages=null,h().then(function(){d.connect(),d.getMessages({projectId:s.current.song.id}).then(function(e){return r.projectChat.messages=e.data,r.projectChat}),r.chats.length&&(r.activeChat=r.projectChat),m=t(h,3e4)})}]}}]).directive("mixEditorCollaboratorsConversation",function(){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-collaborators-conversation-74e32bd2.html",controller:["$analytics","$q","$rootScope","$scope","$state","$timeout","appActions","AppNotifications","EditorAllowActions","EditorCollaboratorsState","editorEvents","EditorPlayback","EditorRevision","EditorSocket","EditorState","Me","Modal","SignalChat",function(e,t,n,o,a,i,r,s,c,l,u,d,p,m,f,h,g,v){function b(){function e(){var e=new g({templateUrl:"https://www.bandlab.com/web-app/song/partials/_song-invite-collaborators-49a6c881.html",contentScope:{song:o.revision.song,me:h},onDestroy:function(){return e.destroy()}});e.show()}o.revision.song.id||!f.hasRevisionChanges?r.checkAllowed("projectInvite")&&e():o.save({publish:!1}).then(function(){o.revision.song.canEdit=!0,e()})}o.editorCollaboratorsState=l,o.getParticipantStatus=function(e){return l.writers[e.id]?"editing...":l.readers[e.id]?"online":e.isPending?"pending invite":"away"},o.getProjectMessages=function(){return v.getMessages({projectId:p.current.song.id}).then(function(e){l.projectChat.messages=e.data})},o.inviteCollaborator=function(){n.$broadcast("$chat:fillConversationInput",{message:"Follow this link to join my live session and check out this project’s progress in real-time: ".concat(m.getLink())})},o.me=h,o.openCollaboratorModal=b,o.upgradeCollaborator=function(n){return(f.isRecording?t(function(e){d.toggleRecord();var t=o.$on(u.completeRecord,function(){e(),t()})}):t.resolve()).then(function(){return new g({templateUrl:"https://www.bandlab.com/web-app/editor/partials/_allow-control-modal-28cced3a.html",contentScope:{user:n},onConfirm:a}).show()});function a(){var a=f.hasRevisionChanges?o.save({publish:!1,upgrade:!1}):c.isAllowed("stopLiveSession")?i(angular.noop,1e3):t(function(e){var t=o.$on(u.saveCompleted,function(){e(),t()})});f.canCollaborate=!1,a.then(function(){m.sendUpgrade(n),e.eventTrack("Transfer session",{category:"Realtime Collaboration"})})}},o.startSession=function(){m.joinSession(),a.go(".",{userId:h.id},{location:"replace"}),e.eventTrack("Start session",{category:"Realtime Collaboration"})},o.switchChat=function(e){_.get(o.editorCollaboratorsState.activeChat,"participant.id")!==e.id&&(o.chatLoaded=!1,i(function(){o.chatLoaded=!0,l.activeChat=_.find(l.chats,{participant:{id:e.id}})}))},o.chatLoaded=!0,o.$on("$conversation:messagesRead",function(e,t){var n=_.find(l.chats,{conversation:{id:t.id}});n&&(n.conversation.unreadMessageCount=0)}),o.$on("$message:new",function(e,t){var n=_.find(l.chats,{conversation:{id:t.conversation.id}});n&&n!==l.activeChat&&n.conversation.unreadMessageCount++}),o.$on("$inviteCollaborators",b)}]}}),angular.module("bandlab.editor").directive("mixEditorCycleSelection",function(){return{restrict:"E",replace:!0,scope:!0,templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-cycle-selection-3f058a94.html",controller:["$scope","AnimationFrame","EditorCycle","editorEvents","EditorHelper","EditorScrollState","editorSettings","EditorState",function(e,t,n,o,a,i,r,s){var c,l,u,d,p,m=4*a.getMeasureDuration(e.revision.metronome);function f(){return!s.isTimeRuler&&s.isSnapping}function h(){d.start=p,d.end=p,p=null}function g(){var e,t;d.start>d.end&&(e=d.start,d.start=d.end,d.end=e),e=d.start/s.scalePx,(t=d.end/s.scalePx)-e<r.CYCLE_DURATION_MIN&&(t=e+r.CYCLE_DURATION_MIN,d.end=t*s.scalePx),t>r.SONG_DURATION_MAX&&(t=r.SONG_DURATION_MAX,e=r.SONG_DURATION_MAX-r.CYCLE_DURATION_MIN,d.start=e*s.scalePx,d.end=t*s.scalePx),n.set(e,t),n.reschedule(),u=!1}function v(){document.body.classList.add("is-resizing")}function b(){document.body.classList.remove("is-resizing"),document.body.classList.remove("is-moving")}n.set(0,m),d={start:0,end:m*s.scalePx},t.add("scale:timeline",function(t){function n(e){return e*t.scalePx/t.oldScalePx}t&&(d.start=n(d.start),d.end=n(d.end),e.$digest())}),e.$on(o.cycleChanged,function(){d.start=n.get().startTime*s.scalePx,d.end=n.get().endTime*s.scalePx}),e.createCycleStart=function(e){e=e+i.timelineLeft-281-12;var t=s.snapDuration*s.scalePx;f()&&(e=a.snapToGrid(e,t,{padding:t/2})),p=e,l={start:e,end:e},c=_.once(h),v()},e.backupPosition=function(t){if(!s.isCycling)return u=!0,e.createCycleStart(t);l={start:d.start,end:d.end},p=null},e.getCycleStart=function(){return Math.min(d.end,d.start)},e.getCycleDuration=function(){return Math.abs(d.end-d.start)},e.setCycleStart=function(t){if(u)return e.setCycleEnd(t);var n=Math.max(l.start-t,0),o=s.snapDuration*s.scalePx;n=Math.min(n,i.timelineEl.scrollWidth-12),s.isCycling=!0,f()&&(n=a.snapToGrid(n,o,{padding:o/2})),d.start=n,v()},e.setCycleEnd=function(e,t){null!==p&&c();var n=Math.min(l.end-e,i.timelineEl.scrollWidth-12),o=s.snapDuration*s.scalePx;n=Math.max(n,0),s.isCycling=!0,f()&&!0!==t&&(n=a.snapToGrid(n,o,{padding:o/2})),d.end=n,v()},e.moveCycle=function(t){if(u)return e.setCycleEnd(t);var n=d.start,o=d.end;s.isCycling=!0,e.setCycleStart(t),e.setCycleEnd(t,!1),n-o!=d.start-d.end&&(t>0?d.end=d.start+(o-n):t<0&&(d.start=d.end-(o-n))),document.body.classList.add("is-moving")},e.createCycleEnd=function(e){b(),u&&(s.isCycling=!0),g()},e.setCycle=function(t){if(b(),u)return e.createCycleEnd(t);t?g():n.toggle()}}]}}),angular.module("bandlab.editor").directive("mixEditorFooter",["$analytics","$cookies","EditorDelayMeter","EditorScrollState","editorSettings","EditorState","MidiEditorState","Modal",function(e,t,n,o,a,i,r,s){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-footer-abaaae6f.html",link:function(c){c.snapSettings=a.SNAP_SETTINGS,i.snapSetting=a.SNAP_SETTINGS[0],c.openLatencyTest=function(){var e;new s({template:'\n               <header class="modal-header">\n                 <h2>'.concat("Round-trip Latency Correction",'</h2>\n               </header>\n               <div class="modal-content modal-content-medium">\n                 <latency-test></latency-test>\n               </div>\n            '),onCreate:function(){e=c.$on("$latencyTest:result",function(e,t){n.setLatencyCorrection(t.result)}),i.isInBackground=!0},onDestroy:function(){i.isInBackground=!1,e()}}).show()},c.openTuner=function(){new s({template:"<audio-tuner><audio-tuner>",onCreate:function(){i.isInBackground=!0},onDestroy:function(){i.isInBackground=!1}}).show()},c.showShortcuts=function(){new s({template:"<mix-editor-shortcuts></mix-editor-shortcuts>",onCreate:function(){i.isInBackground=!0},onDestroy:function(){i.isInBackground=!1}}).show()},c.setUiTheme=function(n){i.theme=n,t.put("mixEditorTheme",n),e.eventTrack("Change UI theme",{category:"Mix Editor",label:n})},c.toggleFullScreenMode=function(){var e=document.documentElement;c.isFullScreen=!c.isFullScreen,c.isFullScreen?e.webkitRequestFullScreen(e):document.webkitExitFullscreen()},c.toggleLock=function(){r.isLocked=!r.isLocked,r.isLocked&&(r.scale=i.scale,c.broadcastScale({state:r}),o.notesLeft=o.timelineLeft)}}}}]),angular.module("bandlab.editor").directive("mixEditorGrid",["AnimationFrame","EditorGrid",function(e,t){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-grid-3546933d.html",link:function(n){var o=document.getElementById("mix-editor-grid-pattern");function a(){t.updateRulerGrid({pattern:o})}n.$watchGroup(["state.snapSetting","state.isTimeRuler"],a),e.add("scale:timeline",a)}}}]),angular.module("bandlab.editor").directive("mixEditorHeader",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-header-30c879d9.html",controller:["$scope","Editor","EditorAllowActions","EditorCollaboratorsState",function(e,t,n,o){e.hasOnlineCollaborators=function(){return Object.keys(o.writers).length>0||Object.keys(o.readers).length>0},e.updateProjectName=t.updateProjectName}]}});var sn="";function cn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function ln(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?cn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):cn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function un(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function dn(e,t,n,o,a,i,r,s,c,l,u,d){function p(e){(c.hasRevisionChanges||c.isPreSaving||c.isSaving||c.isRecording)&&(e.returnValue=!0),c.isRecording&&r.toggleRecord()}function m(){i.removeSnapshot(n.revision.id)}function f(){s.releaseLock(),i.removeSnapshot(n.revision.id),window.removeEventListener("beforeunload",p),window.removeEventListener("unload",m)}n.revision=d,window.addEventListener("beforeunload",p),window.addEventListener("unload",m),this.uiCanExit=function(n){return c.canCollaborate&&c.songDuration&&(c.hasRevisionChanges||c.isPreSaving||c.isSaving)||c.isRecording||c.isWaitingCountIn?function(n){var o,i='\n      <div>\n        <header class="modal-header">\n          <h2>'.concat("Save changes?",'</h2>\n        </header>\n        <div class="modal-content modal-content-medium">\n          <div class="text-left">\n            <p class="small">').concat("If you leave without saving, all your changes will be lost.",'</p>\n          </div>\n          <div class="form-field-submit">\n            <button type="button" ng-click="leave()" style="float: left;">').concat("Don’t Save",'</button>\n            <button type="button" ng-click="cancel()">').concat("Cancel",'</button>\n            <button type="submit" class="scs" ng-click="save()">').concat("Save","</button>\n          </div>\n        </div>\n      </div>\n      "),r='\n        <div>\n          <header class="modal-header">\n            <h2>'.concat("Saving is in progress…",'</h2>\n          </header>\n          <div class="modal-content modal-content-medium">\n            <div class="text-left">\n            <p class="small">').concat("If you leave without saving, all your changes will be lost.",'</p>\n            </div>\n            <div class="form-field-submit">\n              <button type="button" ng-click="leave()" style="float: left;">').concat("Leave",'</button>\n              <button type="button" class="scs" ng-click="cancel()">').concat("Stay","</button>\n            </div>\n          </div>\n        </div>\n      "),s=t.defer();return(o=new u({template:c.isSaving||c.isPreSaving?r:i,contentScope:{leave:function(){e.eventTrack("Leave",{category:"Mix Editor",label:"leave"}),f(),o.destroy(),s.resolve(n)},save:function(){e.eventTrack("Leave",{category:"Mix Editor",label:"save"}),o.destroy(),a.startSave({publish:!1,redirect:!1}).then(function(e){setTimeout(function(){s.resolve(n)},1e3),f()})}},onCancel:function(){e.eventTrack("Leave",{category:"Mix Editor",label:"cancel"}),s.resolve(!1)}})).show(),s.promise}(n):(f(),n)}}function pn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function mn(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?pn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):pn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function fn(e,t,n,o){e.cancelScheduledValues(0),t.forEach(function(a,i){var r=Math.max(a.position-o+n,0);a.position<o&&!t[i+1]?e.setValueAtTime(a.value,n):a.position<o?e.setValueAtTime(a.value,r):e.linearRampToValueAtTime(a.value,r)})}function hn(e,t){var n=e.createGain();return n.setValue=function(e){void 0!==e&&(n.gain.cancelScheduledValues(0),n.gain.value=e)},n.setValue(t),n.setAutomation=function(t,o){fn(n.gain,t,e.currentTime,o)},n}function gn(e,t){var n=e.createGain(),o=e.createGain(),a=e.createChannelMerger(2),i=e.createChannelSplitter(2);i.connect(n,0),i.connect(o,1),n.connect(a,0,0),o.connect(a,0,1),s(t);var r=Object.assign(i,{cancelScheduledValues:function(e){n.gain.cancelScheduledValues(e),o.gain.cancelScheduledValues(e)},connect:function(e){a.connect(e)},disconnect:function(){a.disconnect()},linearRampToValueAtTime:function(e,t){n.gain.linearRampToValueAtTime(c(e),t),o.gain.linearRampToValueAtTime(l(e),t)},setAutomation:function(t,n){fn(r,t,e.currentTime,n)},setValue:s,setValueAtTime:function(e,t){n.gain.setValueAtTime(c(e),t),o.gain.setValueAtTime(l(e),t)}});return r;function s(e){n.gain.cancelScheduledValues(0),o.gain.cancelScheduledValues(0),n.gain.value=c(e),o.gain.value=l(e)}function c(e){return e<=0?1:1-e}function l(e){return e>=0?1:1+e}}function vn(e){var t=function(e){return function(t,n){var o=n.canEdit?n.effects:[],a=new hn(t,n.volume),i=new gn(t,n.pan),r=new e.FxChain(t,o),s=n.auxSends.map(function(e){return(o=new hn(t,(n=e).sendLevel)).id=n.id,o;var n,o}),c={volume:a,pan:i,sendLevel:s[0]},l=n.id,u=r.input,d=i,p=r.bypass;return r.connect(a),a.connect(i),s.forEach(function(e){return a.connect(e)}),{audioContext:t,auxSend:function(e){s.forEach(function(t){e.id===t.id&&t.connect(e.input)})},bypassFxChain:p,connect:function(e){d.connect(e)},disconnect:function(){a.disconnect(),i.disconnect(),r.cleanFxs(),r.disconnect(),u.disconnect(),d.disconnect(),s.forEach(function(e){return e.disconnect()})},getAsyncFx:function(){return Promise.all(r.initializing)},id:l,input:u,output:d,setAutomation:function(e,t,n){var o=function(e,t){return e.length?(0!==(e=He(e).sort(function(e,t){return parseFloat(e.position)-parseFloat(t.position)}))[0].position&&e.unshift({position:0,value:e[0].value}),e.slice(function(){for(var n=e.length-1;n>=0;n--)if(e[n].position<=t)return n;return-1}())):[]}(t.automation[e],n);c[e].setAutomation(o,n)},setEffectParameter:function(e,t,n){r.effects[e][t]=n},setEffects:function(e){r.cleanFxs(),r.addFxs(e)},setValue:function(e,t){c[e].setValue(t)}}}}(e),n=function(e){return function(t,n){var o=new e.FxChain(t,n.effects),a=new hn(t,n.returnLevel),i=o.bypass,r=n.effects,s=n.id,c=o.input,l=a;return c.id=n.id,o.connect(a),{audioContext:t,bypassFxChain:i,connect:function(e){l.connect(e)},disconnect:function(){a.disconnect(),o.cleanFxs(),o.disconnect(),c.disconnect(),l.disconnect()},effects:r,getAsyncFx:function(){return Promise.all(o.initializing)},id:s,input:c,output:l,setEffectParameter:function(e,t,n){o.effects[e][t]=n},setEffects:function(e){o.cleanFxs(),o.addFxs(e)},setValue:function(e,t){"returnLevel"===e&&(a.gain.value=t)}}}}(e);return function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=new Map,s=new hn(e,a),c=i.map(u);return o.forEach(l),{addAux:u,addTrack:l,audioContext:e,bypassTrackEffects:function(e,t){var n=r.get(e);n&&n.bypassFxChain(t)},connect:function(e){s.connect(e)},deleteTrack:d,getAllTracks:function(){return Array.from(r.values())},getAsyncFx:function(){var e=Array.from(r.values()).map(function(e){return e.getAsyncFx()}),t=c.map(function(e){return e.getAsyncFx()});return Promise.all([].concat(He(e),He(t)))},getTrack:function(e){return r.get(e)},hasTrack:function(e){return r.has(e)},output:s,reinitGraph:function(e,t){Array.from(r.values()).filter(function(t){return!e.some(function(e){return t.id===e.id})}).forEach(function(e){return d(e.id)}),e.filter(function(e){return!r.has(e.id)}).forEach(l),s.setValue(t)},setSongVolume:s.setValue,setTrackAutomation:function(e,t,n){var o=r.get(e.id);o&&o.setAutomation(t,e,n)},setTrackEffectParameter:function(e,t,n,o){var a=r.get(e);a&&a.setEffectParameter(t,n,o)},setTrackEffects:function(e,t){var n=r.get(e);n&&n.setEffects(t)},setTrackParameter:function(e,t,n){var o=r.get(e);o&&o.setValue(t,n)}};function l(n){var o=new t(e,n);return o.connect(s),c.forEach(function(e){return o.auxSend(e)}),r.set(n.id,o),o}function u(t){var o=new n(e,t);return o.connect(s),o}function d(e){var t=r.get(e);t&&(t.disconnect(),r.delete(e))}}}function bn(e,t){e.gain.setValueAtTime(0,t),e.gain.linearRampToValueAtTime(1,t+.01)}function yn(e,t){e.gain.setValueAtTime(1,t-.01),e.gain.linearRampToValueAtTime(0,t)}function wn(e,t,n){var o=e.createBufferSource();return o.buffer=t.buffer,o.regionId=t.regionId,o.loop=!1,o.connect(n),o}function kn(e,t,n){var o=t.id,a=t.trackId,i=e.createGain();i.regionId=t.id;var r,s=e.createBufferSource();return s.buffer=n.buffer,s.sampleId=n.id,s.regionId=t.id,s.connect(i),{audioContext:e,connect:function(e){i.connect(e)},play:function(n,o){var a,c,l,u,d=e.currentTime,p=null;function m(){t.loopLength>0&&((p=t.loopLength+t.sampleOffset>Math.round(1e3*s.buffer.duration)/1e3)?r=function(e,t,n,o){for(var a,i=[],r=t.endPosition-o+e.context.currentTime,s=e.buffer.duration-t.sampleOffset,c=e.context,l=Math.max(1,Math.ceil((o-t.startPosition)/t.loopLength)),u=t.startPosition+l*t.loopLength,d=u-o+e.context.currentTime;u<t.endPosition;)yn(n,d),bn(n,d),(a=wn(c,e,n)).start(d,t.sampleOffset),a.stop(Math.min(d+s,r)),i.push(a),l++,d=(u=t.startPosition+l*t.loopLength)-o+e.context.currentTime;return i}(s,t,i,n):function(e,t,n,o){e.loop=!0,e.loopStart=t.sampleOffset,e.loopEnd=t.loopLength+t.sampleOffset;for(var a=Math.max(1,Math.ceil((o-t.startPosition)/t.loopLength)),i=t.startPosition+a*t.loopLength,r=i-o+e.context.currentTime;i<t.endPosition;)yn(n,r),bn(n,r),a++,r=(i=t.startPosition+a*t.loopLength)-o+e.context.currentTime}(s,t,i,n))}i.connect(o),n>t.startPosition&&n<t.endPosition?(l=0,u=0,t.loopLength>0?(l=function(e,t){var n=Math.floor((t-e.startPosition)/e.loopLength);return t-(e.startPosition+e.loopLength*n)}(t,n),p&&l>s.buffer.duration&&(u=t.loopLength-l,l=0)):l=n-t.startPosition,a=d+u,c=d-n+t.endPosition,bn(i,a),yn(i,c),s.start(a,Math.max(0,t.sampleOffset+l),c-a),s.startedOnce=!0,s.stop(c),m()):n<=t.startPosition&&(a=d-n+t.startPosition,c=d-n+t.endPosition,bn(i,a),yn(i,c),s.start(a,Math.max(0,t.sampleOffset),c-a),s.startedOnce=!0,s.stop(c),m())},regionGain:i,regionId:o,regionSource:s,stop:function(){yn(i,e.currentTime+.01),setTimeout(function(){s.stop(),s.disconnect(),i.disconnect(),function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(e){e.stop(),e.disconnect()})}(r)},10)},trackId:a}}function Sn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Pn(){var e=null;try{window.AudioContext=window.AudioContext||window.webkitAudioContext,e=new AudioContext}catch(e){}return e}angular.module("bandlab.editor").directive("mixEditorInstrument",["$document","editorEvents","EditorHelper","EditorRevision","EditorState","InputsCollection","MidiKeyboardHandler",function(e,n,o,a,i,r,c){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-instrument-7d733fa2.html",link:function(l,u){var d,p,m=angular.element(u[0].querySelector(".mix-editor-instrument-header"));function f(e){u[0]===e.target||u[0].contains(e.target)||e.target.closest(".select-menu")||e.target.closest(".audio-input-extended")||e.target.closest(".audio-input-header")||e.target.closest(".mix-editor-audio-input")||e.target.closest(".mix-editor-context-menu")||e.target.closest(".mix-editor-footer")||e.target.closest(".mix-editor-region")||e.target.closest(".mix-editor-track-header")||e.target.closest(".modal")||(i.isAudioInputActive=!1,l.$applyAsync())}e.on("mousedown touchstart",f),u.css("transform",sn),u.on("mousedown touchstart",function(){i.isAudioInputActive=!0,l.$applyAsync()}),m.on("mousedown touchstart",function(n){if("A"!==n.target.nodeName){var o=getComputedStyle(u[0],null).getPropertyValue("transform").split(","),a=u[0].getBoundingClientRect(),r=a.height,s=a.width,c=function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?rn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):rn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},n.getCoordinates(),{translateX:parseInt(o[4]),translateY:parseInt(o[5]),height:r,width:s});n.preventDefault(),e.on("mousemove touchmove",m),e.on("mouseup touchend",function t(n){cancelAnimationFrame(d),p=!1,n.preventDefault(),u.removeClass("is-dragged"),e.off("mousemove touchmove",m),e.off("mouseup touchend",t),i.isAudioInputDragged=!1,l.$applyAsync()}),i.isAudioInputDragged=!0,l.$applyAsync()}function m(e){e.preventDefault(),e.stopPropagation(),p||(p=!0,d=requestAnimationFrame(function(){var t=e.getCoordinates(),n=c.translateX+(t.x-c.x);n=Math.min(n,window.innerWidth-32),n=Math.max(n,-(c.width-32));var o=c.translateY+(t.y-c.y);o=Math.max(o,0),o=Math.min(o,window.innerHeight-32),sn="matrix(1, 0, 0, 1, ".concat(n," ,").concat(o,")"),u.css("transform",sn),p=!1}))}}),l.current=r.getCurrent(),l.displayInstrument=o.displayInstrument,l.$watch("state.isAudioInputActive",function(e){e&&r.getCurrent().input.kind===s?c.enable():c.disable()}),l.$on(n.startRecord,function(){i.isAudioInputActive=!0}),l.$on("$destroy",function(){cancelAnimationFrame(d),p=!1,e.off("mousedown touchstart",f)}),l.getFloatingPosition=function(){if(!sn){var e=u[0].getBoundingClientRect(),t=e.left,n=e.top;sn="matrix(1, 0, 0, 1, ".concat(t,", ").concat(n-100,")"),u.css("transform",sn)}},l.toggleCreatorKitQuantization=function(){var e=!a.creatorKitQuantization.get(a.selectedTrack.id);a.creatorKitQuantization.set(a.selectedTrack.id,e)},l.getCreatorKitQuantization=function(){return a.creatorKitQuantization.get(a.selectedTrack.id)}}}}]),angular.module("bandlab.editor").directive("mixEditorKeyEvents",["$rootScope","editorEvents","EditorState","InputsCollection","MidiEditorState",function(e,t,n,o,a){return{restrict:"A",link:function(i){function r(i){var r=i.ctrlKey||i.metaKey;if((-1===["INPUT","TEXTAREA"].indexOf(i.target.nodeName)||"file"===i.target.type)&&-1===i.target.className.indexOf(s))if(n.isInBackground)i.preventDefault();else{if(n.isAudioInputActive&&!r){if(-1===[8,13,32,37,38,39,40].indexOf(i.which))return;if(32===i.which&&o.getCurrent().input.slug===c)return}if(n.canCollaborate)if(r||i.shiftKey){if(r&&!i.shiftKey){switch(String.fromCharCode(i.which).toLowerCase()){case"%":i.preventDefault(),e.$broadcast(t.keyDown.zoomOut);break;case"'":i.preventDefault(),e.$broadcast(t.keyDown.zoomIn);break;case"a":a.hasFocus||e.$broadcast(t.keyDown.selectAllRegions),i.preventDefault();break;case"c":a.hasFocus||e.$broadcast(t.keyDown.copy);break;case"x":a.hasFocus||e.$broadcast(t.keyDown.cut);break;case"v":a.hasFocus||e.$broadcast(t.keyDown.paste);break;case"s":i.preventDefault(),e.$broadcast(t.keyDown.save);break;case"z":i.preventDefault(),e.$broadcast(t.keyDown.undo)}e.$broadcast(t.keyDown.snapDisable)}else if(r&&i.shiftKey)switch(String.fromCharCode(i.which).toLowerCase()){case"z":i.preventDefault(),e.$broadcast(t.keyDown.redo)}else if(i.shiftKey){if(i.which>=49&&i.which<=57)return i.preventDefault(),void e.$broadcast(t.keyDown.selectTrack,i.which-49);switch(String.fromCharCode(i.which).toLowerCase()){case"d":i.preventDefault(),e.$broadcast(t.keyDown.duplicateTrack);break;case"m":i.preventDefault(),e.$broadcast(t.keyDown.muteTrack);break;case"s":i.preventDefault(),e.$broadcast(t.keyDown.soloTrack);break;case"t":i.preventDefault(),e.$broadcast(t.keyDown.addTrack)}switch(i.which){case 8:case 46:i.preventDefault(),e.$broadcast(t.keyDown.deleteTrack)}}}else switch(i.which){case 8:case 46:i.preventDefault(),a.hasFocus||e.$broadcast(t.keyDown.delete);break;case 13:e.$broadcast(t.keyDown.goToBeginning);break;case 32:i.preventDefault(),e.$broadcast(t.keyDown.play);break;case 37:case 39:n.isAudioInputExtended?(i.preventDefault(),e.$broadcast(t.changePreset,i)):e.$broadcast(t.keyArrow,i);break;case 71:e.$broadcast(t.keyDown.toggleSnap);break;case 72:a.canDragRegionInRuler=!0;break;case 67:e.$broadcast(t.keyDown.toggleCycle);break;case 76:e.$broadcast(t.keyDown.toggleLoops);break;case 77:e.$broadcast(t.keyDown.toggleMetronome);break;case 82:e.$broadcast(t.keyDown.toggleRecord);break;case 83:e.$broadcast(t.keyDown.triggerSlice);break;case 86:e.$broadcast(t.keyDown.toggleVelocity)}else if(!r&&!i.shiftKey)switch(i.which){case 13:e.$broadcast(t.keyDown.goToBeginning);break;case 32:i.preventDefault(),e.$broadcast(t.keyDown.play)}}}function l(n){switch(n.ctrlKey||n.metaKey||e.$broadcast(t.keyDown.snapEnable),n.which){case 72:return a.canDragRegionInRuler=!1,i.$applyAsync()}}function u(e){((32===e.keyCode||13===e.keyCode)&&"INPUT"===e.target.nodeName&&"file"===e.target.type||"BUTTON"===e.target.nodeName||e.target.closest("button"))&&e.preventDefault()}angular.element(document).on("keydown",u),angular.element(document.body).on("keydown",r),angular.element(window).on("keyup",l),i.$on("$destroy",function(){angular.element(document).off("keydown",u),angular.element(document.body).off("keydown",r),angular.element(window).on("keyup",l)})}}}]),angular.module("bandlab.editor").directive("mixEditorLoop",["EditorDraggedItem","EditorHelper","EditorRevision","Loop",function(e,t,n,o){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-loop-1718a5bd.html",link:function(a,i){var r;i.on("mousedown touchstart",function(){a.selectLoop(a.loop)}),i[0].draggable=!0,i[0].addEventListener("dragstart",function(i){var s=a.loop.duration||a.loop.bars*t.getMeasureDuration(n.current.metronome);i.stopPropagation(),i.dataTransfer.setDragImage&&((r=this.cloneNode(!0)).removeChild(r.querySelector(".mix-editor-loop-play")),r.removeChild(r.querySelector(".mix-editor-loop-value")),r.querySelector(".mix-editor-loop-name").classList.add("text-truncate"),r.style.backgroundColor="#282c32",r.style.borderRadius="5px",r.style.color="#ffffff",r.style.display="block",r.style.flex="",r.style.paddingLeft="12px",r.style.paddingRight="12px",r.style.transform="translateX(-500px)",r.style.minWidth="100px",r.style.maxWidth="200px",r.style.width="auto",document.body.appendChild(r),i.dataTransfer.setDragImage(r,0,0)),e.value=Object.assign({type:a.loop.fileType,duration:s},o.getPayload(a.loop))}),i[0].addEventListener("dragend",function(){r&&document.body.removeChild(r),e.value={}})}}}]),angular.module("bandlab.editor").directive("mixEditorLoopPacks",["$analytics","$q","AudioState","EditorLoopsState",function(e,t,n,o){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-loop-packs-cd663eba.html",controller:["$scope",function(a){var i=n.previewPlayer,r=null;i.addEventListener("ended",function(){a.$applyAsync()}),a.selectPack=function(t){o.selectedPack=t,o.tab="all",e.eventTrack("Select Loop Pack",{category:"Mix Editor",label:t.name})},a.previewPack=function(n,o){n.stopPropagation(),o.preview!==i.src||i.paused?(i.src=o.preview,t.resolve(i.play()).catch(angular.noop),e.eventTrack("Preview Loop Pack",{category:"Mix Editor",label:o.name})):i.pause(),r=o},a.isPreviewing=function(e){return e===r&&!i.paused},a.$on("$destroy",function(){i.pause(),i.onended=null,r=null})}]}}]),angular.module("bandlab.editor").directive("mixEditorLoops",["$analytics","AudioCtx","AudioStretch","editorEvents","EditorLoops","EditorLoopsState","EditorMidiScore","EditorRevision","EditorState","FileHelper","Loop","MetronomeState","MidiEditor","MidiScore",function(e,t,n,o,a,i,r,s,c,l,u,d,p,m){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-loops-c0308726.html",controller:["$q","$scope",function(f,h){var g=_.debounce(function(){i.search.length&&e.eventTrack("Search Loops",{category:"Mix Editor",label:i.search.length})},1e3);function v(){var e,t,n=_.filter(i.genres,{selected:!0}),o=_.filter(i.instruments,{selected:!0});h.results=a.filterLoops(i.loops,{genres:n,instruments:o,type:i.selectedType,pack:i.selectedPack}),h.results=a.orderLoops(h.results),i.genres.forEach(function(e){var t=a.filterLoops(i.loops,{genres:n.concat(e),instruments:o,type:i.selectedType});e.noMoreResults=0===t.length&&-1===n.indexOf(e)}),i.instruments.forEach(function(e){var t=a.filterLoops(i.loops,{genres:n,instruments:o.concat(e),type:i.selectedType});e.noMoreResults=0===t.length&&-1===o.indexOf(e)}),h.results=(e=h.results,(t=i.search)?_.filter(e,function(e){return e.fullName.toLowerCase().indexOf(t.toLowerCase())>-1||e.bpm===+t}):e),b()}function b(){setTimeout(function(){h.$broadcast("$md-resize")})}h.editorLoopsState=i,h.initializing=u.init(),f.resolve(u.init()).then(v),h.sortBy=function(e){i.sort.property===e&&(i.sort.order[e]=!i.sort.order[e]),i.sort.property=e,h.results=a.orderLoops(h.results)},h.clearFilters=function(){_.chain(i.genres).concat(i.instruments).forEach(function(e){e.selected=!1}).value(),i.selectedPack=null,i.selectedType=i.types[0],v()},h.togglePack=function(){i.selectedPack=null,v()},h.toggleFilter=function(t){t.selected=!t.selected,v(),t.selected&&e.eventTrack("Filter Loops",{category:"Mix Editor",label:t.name})},h.selectType=function(t){_.forEach(i.types,function(e){e.selected=e===t}),i.selectedType=t,v(),e.eventTrack("Select Loop type",{category:"Mix Editor",label:t.name})},h.getFilters=function(){return _.chain(i.genres).concat(i.instruments).filter({selected:!0}).sortBy("name").value()},h.selectLoop=function(e){i.selectedLoop=e},h.playLoop=function(e){if(e){var a,i=angular.noop,g=angular.noop;c.isPlaying&&h.togglePlay(),e.isPlaying?h.$broadcast(o.stopLoop):(h.$broadcast(o.stopLoop),i=h.$on(o.stopLoop,v),g=h.$on("$destroy",v),e.isPlaying=!0,a="midi"===e.fileType?l.download(u.getSrc(e)).then(function(t){var n=_.get(s,"current.metronome.pristine",!0)?e.bpm:_.get(s,"current.metronome.bpm",e.bpm);return t.name=e.name,r.importMidToScore(t).then(function(t){return e.key&&s.current.key?p.transposeScoreKey(t[0].id,e.key,s.current.key,e.soundbank):t[0]}).then(function(t){var o,a;return o=_.chain(e.instrumentIds).map(function(e){return _.find(h.instruments,{id:e})}).filter({slug:"fx"}).value().length>0,a=new m({bpm:n,sampleId:t.id,soundbank:e.soundbank}),o&&setTimeout(v,1e3*r.getExactDuration(t.id,n)+100),a.play(null,null,{delay:.5,loop:!o,notes:r.getNotesTime(t.id,n),signature:d.settings.signature})})}):n.convertLoop(e,s.current,_.get(s,"current.metronome.pristine",!0)).then(function(e){var n=t.get().createBufferSource();return n.buffer=e,n.loop=!0,n.connect(t.get().destination),n.start(),n}))}function v(){e.isPlaying=!1,i(),g(),"midi"===e.fileType?f.when(a).then(function(e){e()}):f.when(a).then(function(e){e.stop()}),h.$applyAsync()}},h.addToTrack=function(e){h.$emit(o.importFile,u.getPayload(e))},h.$watch("revision.metronome.bpm",_.debounce(function(e,t){e!==t&&i.selectedLoop&&i.selectedLoop.isPlaying&&(h.$broadcast(o.stopLoop),h.playLoop(i.selectedLoop))},100,{trailing:!0})),h.$watch("filtersVisible",b),h.$watch("editorLoopsState.search",function(){g(),v()})}]}}]),angular.module("bandlab.editor").directive("mixEditorMenu",["$analytics","$cookies","EditorDelayMeter","EditorScrollState","editorSettings","EditorState","MidiEditorState","Modal",function(e,t,n,o,a,i,r,s){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-menu-4700d547.html",link:function(c){c.snapSettings=a.SNAP_SETTINGS,i.snapSetting=a.SNAP_SETTINGS[0],c.openLatencyTest=function(){var e;new s({template:'\n               <header class="modal-header">\n                 <h2>'.concat("Round-trip Latency Correction",'</h2>\n               </header>\n               <div class="modal-content modal-content-medium">\n                 <latency-test></latency-test>\n               </div>\n            '),onCreate:function(){e=c.$on("$latencyTest:result",function(e,t){n.setLatencyCorrection(t.result)}),i.isInBackground=!0},onDestroy:function(){i.isInBackground=!1,e()}}).show()},c.openTuner=function(){new s({template:"<audio-tuner><audio-tuner>",onCreate:function(){i.isInBackground=!0},onDestroy:function(){i.isInBackground=!1}}).show()},c.showShortcuts=function(){new s({template:"<mix-editor-shortcuts></mix-editor-shortcuts>",onCreate:function(){i.isInBackground=!0},onDestroy:function(){i.isInBackground=!1}}).show()},c.setUiTheme=function(n){i.theme=n,t.put("mixEditorTheme",n),e.eventTrack("Change UI theme",{category:"Mix Editor",label:n})},c.toggleFullScreenMode=function(){var e=document.documentElement;c.isFullScreen=!c.isFullScreen,c.isFullScreen?e.webkitRequestFullScreen(e):document.webkitExitFullscreen()},c.toggleLock=function(){r.isLocked=!r.isLocked,r.isLocked&&(r.scale=i.scale,c.broadcastScale({state:r}),o.notesLeft=o.timelineLeft)}}}}]),angular.module("bandlab.editor").directive("metronomeSettings",["$analytics","audioSettings","EditorHistory","EditorRevision","editorSettings","EditorState","Metronome","MetronomeState",function(e,t,n,o,a,i,r,s){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-metronome-settings-506e7200.html",link:function(e,t){var n=t[0].querySelector(".metronome-tap-button-body");n.querySelector("label").addEventListener("mouseenter",function(){n.classList.add("hovered"),setTimeout(function(){n.classList.remove("hovered")},600)}),n.addEventListener("click",function(){n.classList.add("clicked"),setTimeout(function(){n.classList.remove("clicked")},300)})},controller:["$interval","$scope","$timeout",function(c,l,u){var d,p,m=s.settings,f=(new Date).getTime(),h=0;l.backupBPM(),s.settings=_.clone(s.settings),l.countInDuration="".concat(a.COUNT_IN_DURATION),l.gain={volume:s.gainNode.gain.value},l.isPreviewEnabled=!1,l.metronomeSettings=s.settings,l.metronomeSounds=_.uniqBy(r.getSpriteMap(),"name"),l.metronomeSound=_.find(l.metronomeSounds,{name:s.sound.name}),l.tempoMax=t.METRONOME_TEMPO_MAX,l.tempoMin=t.METRONOME_TEMPO_MIN,l.$on("$destroy",function(){l.isPreviewEnabled&&l.togglePreview(),n.pushUndo(o.current),a.COUNT_IN_DURATION=parseInt(l.countInDuration),m.bpm=s.settings.bpm,s.settings=m,localStorage.metronomeSound=s.sound.name,localStorage.metronomeVolume=s.gainNode.gain.value,localStorage.countInDuration=a.COUNT_IN_DURATION,l.stretchRevision()}),l.changeTempo=function(e){l.isPreviewEnabled&&l.togglePreview(),s.settings.bpm="up"===e?Math.min(t.METRONOME_TEMPO_MAX,s.settings.bpm+1):Math.max(t.METRONOME_TEMPO_MIN,s.settings.bpm-1),d=u(function(){p=c(function(){s.settings.bpm="up"===e?Math.min(t.METRONOME_TEMPO_MAX,s.settings.bpm+1):Math.max(t.METRONOME_TEMPO_MIN,s.settings.bpm-1)},125)},300)},l.stopChangeTempo=function(){u.cancel(d),c.cancel(p)},l.tapTempo=function(){l.isPreviewEnabled&&l.togglePreview();var e,n=(new Date).getTime(),o=n-f;f=n,e=6e4/o*4/s.settings.signature.noteValue,s.settings.bpm=Math.round((s.settings.bpm+e)/2),s.settings.bpm=Math.max(Math.min(s.settings.bpm,t.METRONOME_TEMPO_MAX),t.METRONOME_TEMPO_MIN),r.playWavTickAt(h%s.settings.signature.notesCount),h++},l.changeMetronomeSound=function(){s.sound=l.metronomeSound,e.eventTrack("Change Metronome Sound",{category:"Mix Editor",label:l.metronomeSound.name})},l.togglePreview=function(){l.isPreviewEnabled=!l.isPreviewEnabled,l.isPreviewEnabled?r.start(i.crTime):r.stop()},l.setGain=function(e){s.gainNode.gain.value=e}}]}}]),angular.module("bandlab.editor").directive("mixEditorOutVolumeMeter",["AnimationFrame","AudioMeterDisplay","editorEvents",function(e,t,n){return{replace:!0,restrict:"E",scope:{},template:'\n        <div class="volume-meter mix-editor-volume-meter">\n          <div class="volume-meter-background"></div>\n          <div class="volume-meter-mask"></div>\n          <div class="volume-meter-clip-indicator"></div>\n        </div>\n      ',link:function(o,a){var i=t.getMeterDisplay("out",a[0]);function r(){e.remove("playing",i.update)}o.$on(n.startPlay,function(){i.init(),i.update(),e.add("playing",i.update)}),o.$on(n.pausePlaying,function(){r(),i.stop()}),o.$on("$destroy",function(){r()})}}}]),angular.module("bandlab.editor").directive("mixEditorPanel",function(){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-panel-ae44dc76.html"}}),angular.module("bandlab.editor").directive("mixEditorPanSlider",["EditorAutomation","EditorHistory","EditorPlayer","EditorRevision","EditorState",function(e,t,n,o,a){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-pan-slider-876bd718.html",controller:["$scope",function(i){var r={};function s(){i.$digest()}i.panMetadata={name:"Pan",type:"float",displayStep:1,min:-1,max:1,default:0,displayUnit:"",displayMax:50,displayMin:-50},i.getTrackParam=function(){return r.pan=e.getMomentValue("pan",i.track),_.get(i.track,"automation.pan.length")?r:i.track},i.setTrackPan=function(){var t=i.track;e.syncVolume(),n.current.setTrackParameter(t.id,"pan",t.pan),a.hasRevisionChanges=!0},i.startSettingPanFromSlider=function(){t.pushUndo(o.current)},i.resetPan=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;i.track.automation.pan.length||(e!==i.track.pan&&t.pushUndo(o.current),i.track.pan=e,n.current.setTrackParameter(i.track.id,"pan",i.track.pan),a.hasRevisionChanges=!0)},i.$on("$destroy",function(){e.off("playing",s),e.off("syncVolume",s)}),e.on("playing",s),e.on("syncVolume",s)}]}}]),angular.module("bandlab.editor").directive("mixEditorPlayhead",["AnimationFrame","EditorAutomation","editorEvents","EditorPlayback","EditorPlayer","EditorScroll","EditorScrollState","editorSettings","EditorState","EditorView","Metronome",function(e,t,n,o,a,i,r,s,c,l,u){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-playhead-81f0caa2.html",link:function(d,p){var m,f;function h(e){a.setPlaybackPosition(e),t.syncVolume(),u.sync(c.crTime),g(),l.isVisible(p[0],!1)||i.scrollToX({time:e,scalePx:c.scalePx})}function g(){var e=Math.round(c.crTime*c.scalePx-s.PLAYHEAD_HALF_WIDTH);f!==e&&(p[0].style.transform="translateX(".concat(e,"px)")),f=e}"IntersectionObserver"in window&&(m=new IntersectionObserver(function(e){0!==e[0].intersectionRatio||!c.isPlaying||!c.isFollowingPlayhead||c.crTime<0||i.scrollToX({direction:"right",offset:0})})).observe(p[0]),e.add("playing",g),d.$on("$destroy",function(){e.remove("playing",g),m&&m.disconnect()}),d.$on(n.keyArrow,function(e,t){if(!c.isPlaying){var n,o,a,l,u,p,m=Math.floor(c.crTime/c.snapDuration)*c.snapDuration,f=m+c.snapDuration;m=m===c.crTime?m-c.snapDuration:m,f=f===c.crTime?f+c.snapDuration:f,h(37===t.which?Math.max(m,0):Math.min(f,s.SONG_DURATION_MAX)),n=t.which,o=c.crTime,a=r.timelineEl.scrollLeft+r.timelineEl.clientWidth-c.scalePx*o,l=r.timelineEl.clientWidth-a,u=r.timelineEl.clientWidth/6,p=(r.timelineEl.scrollLeft+r.timelineEl.clientWidth/2)/c.scalePx,39===n&&a-u<0&&a>0?i.scrollToX({time:p+c.snapDuration,scalePx:c.scalePx}):37===n&&l-u<0&&l<r.timelineEl.clientWidth&&l>0&&i.scrollToX({time:p-c.snapDuration,scalePx:c.scalePx}),d.$digest(t.which)}}),p.on("contextmenu",function(e){e.preventDefault(),e.stopImmediatePropagation()}),d.goToBeginning=function(){o.startPositions.play=o.startPositions.play||0,h(o.startPositions.play),o.startPositions.play=0},d.$on(n.keyDown.goToBeginning,function(){c.isPlaying||d.goToBeginning()}),d.goToEnd=function(){h(Math.min(c.songDuration,s.SONG_DURATION_MAX))}}}}]),angular.module("bandlab.editor").directive("mixEditorRecordingRegion",["AnimationFrame","EditorPlayback","EditorRecorder","EditorState","EditorView","EditorWaveform","SharedMidiSynth",function(e,t,n,o,a,i,r){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-recording-region-9a2032b3.html",link:function(s,c){var l=c.find("canvas")[0].getContext("2d");if(e.add("playing",m),c.css("left","".concat(Math.round(t.startPositions.record*o.scalePx),"px")),c.css("width","0px"),l.canvas.height=i.WAVEFORM_HEIGHT,i.useGPU(l),s.isRecordingMidi)e.add("playing",p);else{var u={1:"L",2:"R"}[s.channel]||"";s.$on("Recorder:onAudioProcess".concat(u),function(e,t){!function(e){var t=d();t&&i.drawRecord(l,e,n.eventInterval*o.scalePx,t.canvasLeft)}(t)})}function d(){var e=a.isVisible(l.canvas.parentElement,!0);if(e&&e.canvasWidth)return function(e,t){t.canvasLeft=Math.max(0,t.canvasLeft),e.width=2*Math.round(t.canvasWidth),e.style.left="".concat(t.canvasLeft,"px")}(l.canvas,e),e}function p(){var e=d();e&&i.drawMidiRecord(l,r.getEvents(),o.scalePx,e.canvasLeft,r.getStartRecordingTime())}function m(){c[0].style.width="".concat((o.crTime-t.startPositions.record)*o.scalePx,"px")}s.$on("$destroy",function(){e.remove("playing",p),e.remove("playing",m)})}}}]),angular.module("bandlab.editor").directive("mixEditorRegion",["$rootScope","AnimationFrame","AudioStretch","DrumMachine","EditorAllowActions","EditorCycle","EditorDB","editorEvents","EditorHelper","EditorHistory","EditorLoader","EditorMidiSamples","EditorMidiScore","EditorMixdown","EditorPlayback","EditorPlayer","EditorRevision","EditorScrollState","editorSettings","EditorState","EditorTimeline","EditorView","EditorWaveform","Impresario","MidiEditor","Sample",function(e,t,n,o,a,i,r,s,l,u,d,p,m,f,h,g,v,b,y,w,S,P,E,T,M,$){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-region-121a59a7.html",link:function(e,o){var a,i,r=o[0].querySelector("canvas").getContext("2d"),s=_.once(function(){t.add("scroll:timelineLeft",f),t.add("scale:timeline",y),E.useGPU(r),e.track.type===c&&e.$on("DrumMachine:update",function(t,n){e.track===v.selectedTrack&&n.parentId===e.region.sampleId&&(e.region.sampleId=n.id,g.current.reinitMidiRegion(e.region))}),e.$watch("region",function(t,n){switch(e.track.type===c&&t.sampleOffset!==n.sampleOffset&&(e.region.sampleOffset=0),!0){case t.isProcessing!==n.isProcessing:case t.sampleId!==n.sampleId:y();break;case t.bpm!==n.bpm:case t.endPosition>n.endPosition&&t.startPosition===n.startPosition:case t.sampleOffset!==n.sampleOffset:case t.loopLength!==n.loopLength:f(null,!0)}},!0),e.$on("$destroy",function(){t.remove("scroll:timelineLeft",f),t.remove("scale:timeline",y)}),e.$watch(function(){return e.isSelected()},function(){f(null,!0)}),e.canReversePlaybackRate=function(){return e.region.sampleOffset<a.buffer.duration},e.renameRegion=function(){o.find("input")[0].focus()},e.reversePlaybackRate=function(){u.pushUndo(v.current),e.region.playbackRate=-e.region.playbackRate,n.convertRegion(e.region).then(function(){e.region.loopLength?e.region.loopLength=Math.min(a.buffer.duration-e.region.sampleOffset,e.region.loopLength):e.region.endPosition=Math.min(e.region.startPosition+a.buffer.duration-e.region.sampleOffset,e.region.endPosition),e.region.sampleOffset=a.buffer.duration-(Math.min(e.region.endPosition-e.region.startPosition,e.region.loopLength||1/0)+e.region.sampleOffset),e.region.sampleOffset=Math.max(0,e.region.sampleOffset)}).catch(function(){e.region.playbackRate=-e.region.playbackRate})},f()}),d={};function m(){var t=e.region.canEdit||p.get(e.region.sampleId)?e.region.sampleId:e.track.sampleId;return p.get(t)||_.find(e.revision.samples,{id:t})}function f(t,n){t=t||b.timelineLeft,p.has(a.id)?e.track.type===c&&_.find(e.track.patterns,{sampleId:e.region.sampleId})?E.cachePattern(_.findIndex(e.track.patterns,{sampleId:e.region.sampleId}),e.region.sampleId,w.scalePx/e.revision.metronome.bpm*120,e.revision.metronome.signature,120):E.cacheScore(p.get(e.region.sampleId).notes,e.region.sampleId,w.scalePx/e.revision.metronome.bpm*120,120):a.buffer&&l.isAudioBuffer(a.buffer)&&E.cacheWaveform(a.buffer,a.id,w.scalePx);var o=P.isRegionVisible({left:e.region.startPosition*w.scalePx,width:l.getTotalDuration(e.region)*w.scalePx},t);o&&o.canvasWidth&&((n||o.canvasWidth!==d.canvasWidth||o.canvasLeft!==d.canvasLeft)&&(r.canvas.style.left="".concat(o.canvasLeft,"px"),E.drawFromBuffers(r,o.canvasLeft,o.canvasLeft+o.canvasWidth,a.id,p.get(a.id)?w.scalePx/e.revision.metronome.bpm*120:w.scalePx,w.scalePx*l.getFirstLoopDuration(e.region),e.region.canEdit?w.scalePx*e.region.sampleOffset:w.scalePx*e.region.startPosition,p.get(a.id)?120:"",e.isSelected())),d=o)}function h(){if(!a||!a.notes&&!a.buffer&&!a.error)return!1;e.region.hasSample=!a.error,e.region.isPlayable=l.isRegionPlayable(e.region,e.track)||!e.region.canEdit,(a.buffer&&l.isAudioBuffer(a.buffer)||p.has(a.id))&&s(),i()}function y(){a=m(),h(),f(null,!0)}e.track.type===c&&(o[0].querySelector(".mix-editor-region-left-handler").remove(),o[0].querySelector(".mix-editor-region-right-handler").remove()),r.canvas.height=E.WAVEFORM_HEIGHT,r.canvas.width=Ke(screen.width),i=e.$watch(function(){return(a=m())&&(a.buffer&&l.isAudioBuffer(a.buffer)||a.error||a.notes)},h)},controller:["$scope","$analytics",function(t,P){var E;function C(){E={startPosition:t.region.startPosition,sampleOffset:t.region.sampleOffset,loopLength:t.region.loopLength,endPosition:t.region.endPosition,firstTrack:t.track,scalePx:w.scalePx}}t.isSelected=function(){return v.selectedRegions.has(t.region)},t.quickResizeLoop=function(e){u.pushUndo(t.revision),v.selectedRegions.add(t.region),t.region.endPosition=(e-281+b.timelineLeft)/w.scalePx,C()},t.backupRegion=function(){u.pushUndo(t.revision),v.selectedRegions.add(t.region),C()},t.openEditor=function(){t.track.type===c&&l.displayInstrument({toggle:!1}),t.isEditable()&&t.region.isPlayable&&(v.selectedRegions=new Set([t.region]),l.displayMidiEditor({toggle:!1}),setTimeout(function(){M.scrollToNotes(t.region)}))},t.loadDrumMachinePattern=t.track.type===c?function(){var e=_.find(t.track.patterns,{sampleId:t.region.sampleId});e&&(t.selectTrack(t.track),t.midiEditorState.isVisible=!1,o.selectPattern(e),w.isAudioInputActive=!0)}:angular.noop,t.getFirstLoopWidth=function(){return l.getFirstLoopWidth(t.region)},t.getExtraLoopDuration=function(){return l.getExtraLoopDuration(t.region)},t.getTotalDuration=function(){return l.getTotalDuration(t.region)},t.resizingLeft=function(e){S.resizeRegionLeft(t.region,ln({},E,{delta:e}))},t.resizingRight=function(e){S.resizeRegionRight(t.region,ln({},E,{delta:e}))},t.expandLoop=function(e){S.expandRegionLoop(t.region,ln({},E,{delta:e}))},t.regionUpdate=function(){v.selectedRegions.clear(),v.selectedRegions.add(t.region),S.moveRegions(t.track),g.updateSourcesInTracks([t.track.id]),t.$applyAsync()},t.downloadRegionAsFile=function(){var e=d.pushTask("export");f.makeRegionsMixdown([t.region]).then(function(e){var n=_.find(v.current.samples,{id:t.region.sampleId}),o=n&&(n.name||n.id)||t.track.name;o="".concat(o,".").concat($.getExtensionByMime(e.blob.type)),saveAs(e.blob,o)}).finally(function(){d.finishTask(e)})},t.setCycleToSelection=function(n){var o=t.region.startPosition,a=t.region.endPosition;Array.from(v.selectedRegions).forEach(function(e){e.startPosition<o&&(o=e.startPosition),e.endPosition>a&&(a=e.endPosition)}),w.isCycling=!0,i.set(o,a),e.$broadcast(s.cycleChanged),n&&(w.crTime=i.get().startTime,w.isPlaying&&h.pausePlay(),h.togglePlay())},t.canAudioStretch=function(){return l.isAudioRegion(t.region)},t.audioStretchPitchShift=function(e){var o=d.pushTask("postProcessAudio");u.pushUndo(v.current),t.region.pitchShift=Math.max(Math.min(t.region.pitchShift+e,12),-12),n.convertRegion(t.region).finally(function(){d.finishTask(o)})},t.audioStretchPlaybackRate=function(e){e*=Math.sign(t.region.playbackRate),u.pushUndo(v.current);var o=t.region.playbackRate/(t.region.playbackRate+e),a=d.pushTask("postProcessAudio");t.region.playbackRate+=e,t.region.playbackRate=n.clampPlaybackRate(Math.abs(t.region.playbackRate))*Math.sign(t.region.playbackRate),n.convertRegion(t.region).then(function(){t.region.sampleOffset*=o,t.region.loopLength*=o,t.region.endPosition=t.region.startPosition+(t.region.endPosition-t.region.startPosition)*o,t.region.endPosition=Math.min(t.region.endPosition,y.SONG_DURATION_MAX)}).finally(function(){d.finishTask(a)})},t.launchAudioStretch=function(){n.preview(t.region)},t.launchAnalyzer=function(e){var n=k(),o={analyzer:{context:"region"}};T.displayAnalyzerModal(e,o),f.makeRegionsMixdown([t.region]).then(function(e){var t=e.blob;return $.upload({sampleType:"analyzed",blob:t,sampleId:n})}).then(function(){return T.requestAnalyze(n,e)}).then(function(e){P.eventTrack("Analyze Tempo",{category:"Mix Editor",label:"Region",value:e.tempo}),o.analyzer.result=e}).catch(function(e){o.analyzer.error=e.status})},t.isEditable=function(){return p.has(t.region.sampleId)&&t.track.type!==c},t.downloadMidFile=function(){var e=m.exportScoreToMid(t.region.sampleId,{bpm:t.revision.metronome.bpm,region:t.region,soundbank:t.track.soundbank});saveAs(e,"".concat(t.region.name||t.track.name,".mid"))},t.track.type!==c&&t.$on(s.slice,function(e,n){if(v.selectedRegions.has(t.region)&&a.isAllowed("slice")&&n-t.region.startPosition>y.REGION_DURATION_MIN&&t.region.endPosition-n>y.REGION_DURATION_MIN&&!t.region.isProcessing){u.pushUndo(t.revision);var o=S.splitRegion(t.region,n,n,t.track.regions);v.selectedRegions.delete(t.region),v.selectedRegions.add(o[1]),r.addSnapshot(t.revision.id,t.revision)}})}]}}]),angular.module("bandlab.editor").directive("mixEditorRuler",["AnimationFrame","AudioState","EditorAutomation","editorEvents","EditorGrid","EditorHelper","EditorPlayer","editorSettings","EditorState","Metronome",function(e,t,n,o,a,i,r,s,c,l){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-ruler-6ed7ee80.html",link:function(t,n){var i=n[0].querySelector(".mix-editor-ruler-graduation"),r=n[0].querySelector(".mix-editor-ruler-record-mark");function s(){a.updateGridLabel({element:i,state:c}),n[0].style.width="".concat(c.containerWidth,"px")}t.$watch("state.isTimeRuler",s),t.$on(o.startRecord,function(e,t){var n="translateX(".concat((t.fromTime*c.scalePx).toFixed(0),"px)");r.style.transform=n}),e.add("scale:timeline",s)},controller:["$scope",function(e){e.setCurrentTime=function(e,o){o=Math.max(0,o-12),o=c.isTimeRuler?o:i.snapToGrid(o,c.snapDuration*c.scalePx,{}),o=Math.min(o/c.scalePx,s.SONG_DURATION_MAX),r.setPlaybackPosition(o),t.isMetronomeEnabled&&l.sync(c.crTime),n.syncVolume()}}]}}]),angular.module("bandlab.editor").directive("mixEditorScrollable",["AnimationFrame","ClientDevice","ContextMenu","EditorScrollState","editorSettings","EditorState",function(e,t,n,o,a,i){return{restrict:"A",link:function(r,s,c){var l,u,d=_.max(a.SCALES),p=_.min(a.SCALES),m=r.$eval(c.listeners)||{},f=r.$eval(c.emitters)||{},h=0,g=0;function v(e){s[0].scrollTop=e}function b(e){s[0].scrollLeft=e}function y(e){var t=e.deltaX,n=void 0===t?0:t,a=e.deltaY,i=void 0===a?0:a;f.notesTop&&(o.notesTop+=i),f.timelineLeft&&(o.timelineLeft+=n),f.tracksTop&&(o.tracksTop+=i),f.notesLeft&&(o.notesLeft+=n)}s[0].addEventListener("wheel",function(e){n.currentMenu||(e.preventDefault(),i.isFollowingPlayhead=!1,function(e){return e.ctrlKey&&0!==e.deltaY&&0===e.deltaX}(e)?s[0].classList.contains("mix-editor-tracks")&&(t.isWindows||t.isMacOs)&&function(e){u||(u=requestAnimationFrame(function(){var t=e.pageX-281+o.timelineLeft,n=.5+Math.floor(i.scale/3);e.deltaY>0?h-=.3:h+=.3,Math.floor(h)<g?r.zoomOut({scale:Math.max(i.scale-n,p),time:t/i.scalePx}):Math.floor(h)>g&&r.zoomIn({scale:Math.min(i.scale+n,d),time:t/i.scalePx}),g=Math.floor(h),u=!1}))}(e):y(e))}),s[0].addEventListener("touchstart",function(e){l=e.getCoordinates()}),s[0].addEventListener("touchmove",function(e){if(l&&!i.isDraggingRegions){var t=e.getCoordinates(),n=l.x-t.x,o=l.y-t.y;e.preventDefault(),y({deltaX:n,deltaY:o}),l=t}}),s[0].addEventListener("touchend",function(){l=null}),m.notesTop&&e.add("scroll:notesTop",v),m.notesLeft&&e.add("scroll:notesLeft",b),m.timelineLeft&&e.add("scroll:timelineLeft",b),m.tracksTop&&e.add("scroll:tracksTop",v),s[0].classList.contains("mix-editor-tracks")&&(o.timelineEl=s[0]),s[0].classList.contains("mix-editor-block-tracks")&&(o.tracksEl=s[0]),s[0].classList.contains("mix-editor-panel-track")&&(o.notesTimelineEl=s[0]),s[0].classList.contains("midi-editor-container")&&(o.notesEl=s[0]),r.$on("$destroy",function(){e.remove("scroll:notesLeft",b),e.remove("scroll:notesTop",v),e.remove("scroll:timelineLeft",b),e.remove("scroll:tracksTop",v)})}}}]),angular.module("bandlab.editor").directive("mixEditorScrollbarHorizontal",["AnimationFrame","EditorScroll","EditorScrollState",function(e,t,n){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-scrollbar-horizontal-8d7bf882.html",link:function(o,a){var i=a[0].querySelector(".mix-editor-scrollbar-horizontal");function r(){var e=n.timelineEl.clientWidth,t=n.timelineEl.scrollWidth,o=n.timelineEl.scrollLeft,a=Math.round(e/t*e),r=Math.round(o/(t-e)*(e-a));i.style.width="".concat(a,"px"),i.style.transform="translateX(".concat(r,"px)")}new ResizeObserver(r).observe(a[0]),e.add("scroll:timelineLeft",r),e.add("scale:timeline",r),a.on("mousedown",function(e){var n=i.getBoundingClientRect(),o=e.clientX;o<n.left?t.scrollToX({direction:"left"}):o>n.right&&t.scrollToX({direction:"right"})}),r()},controller:["EditorScroll","$scope",function(e,t){var o,a;t.backupPositionX=function(e){o=e,a=n.timelineLeft},t.scrollX=function(t){e.scrollToX({clickPosition:o,offsetPosition:a,percent:t})}}]}}]).directive("mixEditorScrollbarVertical",["AnimationFrame","EditorScroll","EditorScrollState",function(e,t,n){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-scrollbar-vertical-daf9cb4e.html",link:function(o,a){var i=a[0].querySelector(".mix-editor-scrollbar-vertical"),r=new ResizeObserver(s);function s(){var e=n.tracksEl.clientHeight,t=n.tracksEl.scrollHeight,o=n.tracksEl.scrollTop,r=Math.round(e/t*e),s=Math.round(o/(t-e)*(e-r));i.style.height="".concat(r,"px"),i.style.transform="translateY(".concat(s,"px)"),a[0].classList.toggle("hidden",e>=t)}r.observe(a[0]),a.on("mousedown",function(e){var n=i.getBoundingClientRect(),o=e.clientY;o<n.top?t.scrollToY({direction:"up"}):o>n.bottom&&t.scrollToY({direction:"down"})}),o.$on("$destroy",function(){r.disconnect()}),o.$watch("revision.tracks.length",s),e.add("scroll:tracksTop",s)},controller:["EditorScroll","$scope",function(e,t){var o,a;t.backupPositionY=function(e){o=1-e,a=n.tracksTop},t.scrollY=function(t){e.scrollToY({clickPosition:o,offsetPosition:a,percent:1-t})}}]}}]),angular.module("bandlab.editor").directive("mixEditorShortcuts",["ClientDevice","editorShortcuts",function(e,t){return{replace:!0,restrict:"E",scope:{},templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-shortcuts-870fba1f.html",link:function(t,n){e.isMacOs&&n.addClass("mac")},controller:["$scope",function(e){e.query="",e.shortcuts=t,e.searchFn=function(t){var n=e.query.toLowerCase();return-1!==t.label.toLowerCase().indexOf(n)||t.keywords&&-1!==t.keywords.toLowerCase().indexOf(n)}}]}}]),angular.module("bandlab.editor").directive("mixEditorSidetabs",["$analytics","$state","$stateParams","EditorCollaboratorsState","editorEvents","EditorLoopsState","EditorState","Loop",function(e,t,n,o,a,i,r,s){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-sidetabs-97b93f8d.html",link:function(r){function c(){r.currentActiveTab=null,r.$broadcast(a.stopLoop)}function l(t){r.currentActiveTab=t,e.eventTrack("Open Side Panel",{category:"Mix Editor",name:t}),"Lyrics"===t&&r.$broadcast("elastic:adjust")}r.closeSideTab=c,r.editorCollaboratorsState=o,r.currentActiveTab=null,r.displayTab=l,r.editorLoopsState=i,r.toggleTab=function(e){r.currentActiveTab===e?c():l(e)},n.userId&&r.toggleTab("Collab"),t.params.loopPack&&(l("Loops"),i.tab="all",s.init().then(function(){i.selectedPack=_.find(i.packs,{slug:t.params.loopPack})}))}}}]),angular.module("bandlab.editor").directive("mixEditorToolbar",["$q","$sce","AnimationFrame","audioSettings","AudioState","AudioStretch","DrumMachine","DrumMachineState","EditorAllowActions","EditorCycle","EditorData","editorEvents","EditorHelper","EditorHistory","EditorLoader","EditorPlayback","EditorPlayer","EditorRevision","editorSettings","EditorState","EditorTimeline","EditorTrack","InputsCollection","Metronome","MidiEditor","MidiEditorState","Modal","RevisionImporter","Sample","Soundbank",function(e,t,n,o,a,i,r,s,l,u,d,p,h,g,v,b,y,w,k,S,P,E,T,M,$,C,A,R,I,O){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-toolbar-c775d07a.html",controller:["$scope",function(x){var D,L;function N(e){var t,o;g.state["undo"===e?"hasUndo":"hasRedo"]()&&(x.revision=g[e](x.revision),x.revision.tracks.length?(o=_.find(x.revision.tracks,{id:w.selectedTrack.id})||x.revision.tracks[0],E.setSelected(o)):E.setSelected({}),w.selectedTrack.patterns&&w.selectedTrack.patterns.length&&(t=r.getCurrentPresetIndex(),s.patterns=w.selectedTrack.patterns,r.selectPattern(w.selectedTrack.patterns[t])),w.selectedTrack.type===c?T.setDrumMachine(w.selectedTrack):w.selectedTrack.soundbank&&T.setFromSoundbank(w.selectedTrack.soundbank),S.hasSoloTrack=d.checkAnySolo(),y.updateSong(),n.start("syncVolume"))}function U(){var t=S.hasRevisionChanges,n=v.pushTask("uploadMeta"),o=v.pushTask("createMixdown");return e.resolve(t?x.save({publish:!1}):w.current).then(function(o){return v.finishTask(n),o.isFork||!t&&"Ready"===w.current.mixdown.status?e.resolve(o):R.pollMixdown(o)}).then(function(e){return v.finishTask(o),e}).catch(function(t){return v.flushQueue(),e.reject(t)})}x.changeTimeSignatureValue=function(e){g.pushUndo(x.revision),x.revision.metronome.signature.noteValue=e},x.changeTimeSignatureCount=function(e){g.pushUndo(x.revision),x.revision.metronome.signature.notesCount=e},x.$watch("revision.metronome",function(e,t){var o=t.bpm/e.bpm;if(e.bpm!==t.bpm){w.current.metronome.pristine=!1,S.scalePx=4*S.scale*e.bpm/120,C.scalePx=4*C.scale*e.bpm/120,y.setPlaybackPosition(Math.min(S.crTime*t.bpm/e.bpm,k.SONG_DURATION_MAX)),S.containerWidth=k.SONG_DURATION_MAX*S.scalePx,C.containerWidth=k.SONG_DURATION_MAX*C.scalePx,_.chain(w.current.tracks).map(function(e){return[e.automation.pan,e.automation.volume]}).flatten().flatten().forEach(function(e){e.position*=o}).value(),_.chain(w.current.tracks).map("regions").flatten().filter(h.isMidiRegion).filter(function(t){return t.bpm!==e.bpm}).forEach(function(t){var n=t._bpm/e.bpm;t.sampleOffset=t._sampleOffset*n,t.startPosition=t._startPosition*n,t.startPosition=Math.min(t.startPosition,k.SONG_DURATION_MAX),t.loopLength=t._loopLength*n,t.endPosition=t._endPosition*n,t.endPosition>k.SONG_DURATION_MAX&&(t.endPosition=k.SONG_DURATION_MAX,t.loopLength=Math.min(t.loopLength,t.endPosition-t.startPosition),P.warnTruncatedRegions()),t.bpm=e.bpm}).value(),_.chain(w.current.tracks).map("regions").flatten().filter(h.isAudioRegion).forEach(function(t){t.bpm=e.bpm}).value();var a=u.get(),i=a.startTime,r=a.endTime;u.set(i*o,r*o),u.reschedule(),M.sync(S.crTime),y.updateSong()}e.signature.notesCount===t.signature.notesCount&&e.signature.noteValue===t.signature.noteValue||(e.signature.pristine=!1),n.start("scale:notesTimeline",!1),n.start("scale:timeline",!1)},!0),x.optsKeys={major:m,minor:f},x.optsNoteValue=o.SIGNATURE_NOTE_VALUE,x.optsNotesCount=o.SIGNATURE_NOTES_COUNT,x.undo=function(){N("undo")},x.$on(p.keyDown.undo,function(){l.isAllowed("historyMove")&&x.$apply(function(){x.undo()})}),x.redo=function(){N("redo")},x.$on(p.keyDown.redo,function(){l.isAllowed("historyMove")&&x.$apply(function(){x.redo()})}),x.canSlice=function(){return!S.isPlaying&&!S.isRecording&&x.revision.tracks.filter(function(e){return e.type!==c}).some(function(e){return e.regions.some(function(e){return w.selectedRegions.has(e)&&e.startPosition<=S.crTime&&e.endPosition>=S.crTime})})},x.triggerSlice=function(){x.$broadcast(p.slice,S.crTime)},x.$on(p.keyDown.triggerSlice,function(){l.isAllowed("slice")&&x.$apply(function(){x.triggerSlice()})}),x.$on(p.keyDown.play,function(){x.togglePlay()}),x.togglePlay=b.togglePlay,x.toggleMetronome=function(){a.isMetronomeEnabled?(a.isMetronomeEnabled=!1,M.stop()):S.isPlaying?(a.isMetronomeEnabled=!0,M.start(S.crTime)):a.isMetronomeEnabled=!0},x.$on(p.keyDown.toggleMetronome,function(){l.isAllowed("toggleMetronome")&&x.$apply(function(){x.toggleMetronome()})}),x.backupBPM=function(){L=x.revision.metronome.bpm,_.chain(w.current.tracks).map("regions").flatten().forEach(function(e){e.bpm=L}).value(),S.isPlaying&&x.togglePlay()},x.setRevisionBPM=function(e,t){var n=L+parseInt(.3*t);n=Math.min(o.METRONOME_TEMPO_MAX,Math.max(n,o.METRONOME_TEMPO_MIN)),x.revision.metronome.bpm=n},x.stretchRevision=function(){setTimeout(function(){if(L!==w.current.metronome.bpm&&!h.hasUneditableTrack()){var t=w.current.metronome.bpm,n=_.chain(w.current.tracks).map("regions").flatten().value();S.hasRevisionChanges=!0,D||(w.current.metronome.bpm=L,g.pushUndo(w.current),w.current.metronome.bpm=t,h.areMidiRegions(n)||(D=new A({templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-stretching-modal-4eeb33bf.html",onCancel:function(){x.undo(),D=null},contentScope:{fromBPM:L,toBPM:w.current.metronome.bpm,dontAdjust:function(){D.destroy(),D=null},stretchRevision:function(){var t=v.pushTask("postProcessAudio");return D.destroy(),e.all(_.chain(n).filter(h.isAudioRegion).map(function(e){var t=w.current.metronome.bpm/L;return e.playbackRate*=t,i.convertRegion(e).then(function(){return e.sampleOffset/=t,e.startPosition/=t,e.startPosition=Math.min(e.startPosition,k.SONG_DURATION_MAX),e.loopLength/=t,e.endPosition/=t,e})}).value()).then(function(e){var t=_.filter(e,function(e){return e.endPosition-e.startPosition<k.REGION_DURATION_MIN});t.length&&(P.deleteRegionsFromTracks(w.current.tracks,t),P.warnDeletedRegions());var n=_.filter(e,function(e){return e.endPosition>k.SONG_DURATION_MAX});n.length&&(_.forEach(n,function(e){e.endPosition=k.SONG_DURATION_MAX,e.loopLength=Math.min(e.loopLength,e.endPosition-e.startPosition)}),P.warnTruncatedRegions())}).finally(function(){v.finishTask(t),d.updateSongDuration(),D=null})}}})).show())}})},x.setRevisionVolume=function(e){y.current.setSongVolume(e)},x.setRevisionKey=function(t){if(w.current.key!==t){var n=!w.current.key||0===$.transposeKeys(w.current.key,t)||!_.chain(w.current.tracks).filter(function(e){return!e.soundbank||"kit"!==O.getPropertyValue(e.soundbank,"category")}).map("regions").flatten().value().length||h.hasUneditableTrack();S.hasRevisionChanges=!0,n?(g.pushUndo(w.current),w.current.key=t):function(){var n=new A({templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-transposition-modal-43e52f63.html",onCreate:function(){g.pushUndo(w.current)},contentScope:{key:t,updateKey:function(){w.current.key=t,n.destroy()},transposeRevision:function(){S.isPlaying&&x.togglePlay();var o=v.pushTask("postProcessAudio");return n.destroy(),e.all([$.transposeRevision(w.current,t),i.convertRevision(w.current,t)]).then(function(){w.current.key=t,v.finishTask(o)})}}});n.show()}()}},x.toggleCycle=u.toggle,x.$on(p.keyDown.toggleCycle,function(){l.isAllowed("cycle")&&x.$apply(function(){x.toggleCycle()})}),x.toggleRecord=b.toggleRecord,x.$on(p.keyDown.toggleRecord,function(){x.$apply(function(){x.toggleRecord()})}),x.downloadEveryTrack=function(){return U().then(function(e){_.chain(e.tracks).filter("sampleId").map(function(e){return I.getJSON("tracks/".concat(e.sampleId,"?format=m4a")).then(function(n){e.mixdown={src:t.trustAsResourceUrl(n.value)}})}).value(),e.mixdown.duration=e.mixdown.duration||S.songDuration,new A({templateUrl:"https://www.bandlab.com/web-app/song/partials/_download-stems-modal-69849167.html",contentScope:{revision:e}}).show()})},x.downloadMixdown=function(){return U().then(function(e){new A({templateUrl:"https://www.bandlab.com/web-app/song/partials/_download-mixdown-modal-e6c80f37.html",contentScope:{revision:e}}).show()})}}]}}]),angular.module("bandlab.editor").directive("mixEditorToolbarBeatsDisplay",["$filter","AnimationFrame","EditorState",function(e,t,n){return{replace:!0,restrict:"E",template:'<div class="mix-editor-toolbar-beats-display" ng-class="{ recording: state.isRecording, playing: state.isPlaying }" ng-bind-html="state.crTime | timeToBeats: revision.metronome"></div>',link:function(o,a){var i,r=e("timeToBeats");function s(){var e=r(n.crTime,o.revision.metronome);i!==e&&(a[0].innerHTML=e),i=e}t.add("playing",s),o.$on("$destroy",function(){t.remove("playing",s)})}}}]).filter("timeToBeats",["EditorHelper",function(e){return function(t,n){var o=t/e.getMeasureDuration(n)+1,a=(o-Math.floor(o))*n.signature.notesCount+1;return o="".concat(Math.floor(Math.max(o,0))).padStart(3,0),a=Math.floor(a),'\n        <span class="bars">'.concat(o,'<span class="unit">bar</span></span>\n        <span class="beats">').concat(a,'<span class="unit">beat</span></span>\n      ')}}]),angular.module("bandlab.editor").directive("mixEditorToolbarTimeDisplay",["$filter","AnimationFrame","EditorState",function(e,t,n){return{replace:!0,restrict:"E",template:'<span class="mix-editor-toolbar-time-display" ng-class="{ recording: state.isRecording, playing: state.isPlaying }" ng-bind="state.crTime | soundTime: true"></span>',link:function(o,a){var i,r=e("soundTime");function s(){var e=r(n.crTime,!0);i!==e&&(a[0].firstChild.nodeValue=e),i=e}t.add("playing",s),o.$on("$destroy",function(){t.remove("playing",s)})}}}]),angular.module("bandlab.editor").directive("mixEditorTrack",["$compile","DrumMachine","EditorAllowActions","EditorAutomation","EditorClipboard","editorEvents","EditorHelper","EditorHistory","EditorMidiSamples","EditorPlayer","EditorRevision","EditorScroll","editorSettings","EditorState","EditorTimeline","EditorTrack",function(e,t,n,o,a,i,r,s,l,u,d,p,m,f,h,g){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-track-28881127.html",link:function(t,n){t.$on("Recorder:start",function(o){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{cycleCounter:0};if(f.isRecording&&g.isArmed(t.track)){var i={audio:r.isAudioTrack(t.track),midi:r.isBandLabInstrumentTrack(t.track)},s=Object.assign(t.$new(!0),a,{audio:i.audio,channel:t.track.channel,isRecordingMidi:i.midi}),c=e("<mix-editor-recording-region></mix-editor-recording-region>")(s);n.append(c);var l=t.$on("Recorder:stop",function(){c.remove(),s.$destroy(),l()})}})},controller:["$scope",function(e){e.pasteRegion=function(){if(a.value&&!(f.crTime>=m.SONG_DURATION_MAX)){s.pushUndo(e.revision);var t=_.minBy(a.value,"startPosition").startPosition,n=_.minBy(a.value,"trackOrder").trackOrder,i=_.maxBy(a.value,"trackOrder").trackOrder-n,r=f.crTime;e.track.order+i>=e.revision.tracks.length?e.revision.tracks.length<m.TRACKS_LIMIT?alert("Please add extra track"):alert("Please paste to other track"):(d.selectedRegions.clear(),_.forEach(a.value,function(o){var a=o.endPosition-o.startPosition,i=e.track.order-n+o.trackOrder,s=_.find(e.revision.tracks,{order:i});(o=_.clone(o)).id=k(),o.trackId=s.id,o.startPosition=o.startPosition-t+f.crTime,o.endPosition=Math.min(o.startPosition+a,m.SONG_DURATION_MAX),d.selectedRegions.add(o),o.startPosition<m.SONG_DURATION_MAX&&(s.regions.push(o),h.moveRegions(s),r=Math.max(r,o.endPosition))}),o.checkConfirmation("paste",a.value).then(function(){_.forEach(Array.from(d.selectedRegions),function(t){var n=_.find(e.revision.tracks,{id:t.trackId});o.deleteAutomationInRange(n.automation,t.startPosition,t.endPosition),o.pasteAutomation(n.automation,t.automation,t.startPosition)})}),u.setPlaybackPosition(r),p.scrollToX({time:r,scalePx:f.scalePx}),u.updateSourcesInTracks(_.map(Array.from(d.selectedRegions),"trackId")))}},e.createMidiRegion=e.track.type===c?function(){var n=l.get(t.getCurrentPreset().sampleId);h.createRegionFromMidiScore(n,e.track,f.crTime)}:function(){return h.createEmptyRegion(e.track)},e.clipboard=a,e.isSelected=function(){return d.selectedTrack===e.track},e.$on(i.keyDown.paste,function(){d.selectedTrack===e.track&&n.isAllowed("paste")&&e.$apply(e.pasteRegion)})}]}}]),angular.module("bandlab.editor").directive("mixEditorTrackDropFile",["EditorDraggedItem","editorEvents","EditorState",function(e,t,n){return{restrict:"A",link:function(o,a){var i=angular.element('<div class="mix-editor-region-ghost"></div>');function r(){a.removeClass("dropping"),i.remove(),i.removeClass("disallow"),i.css("width",null),window.removeEventListener("dragend",r)}function s(e){var t=Math.floor(e/n.scalePx/n.snapDuration)*n.snapDuration*n.scalePx;return n.isSnapping?t:e}a.bind("drop",function(a){var i=a.dataTransfer.items,c={time:s(a.offsetX)/n.scalePx,track:o.track};r(),a.preventDefault(),a.stopPropagation(),a.dataTransfer.files.length?o.$emit(t.importFile,Object.assign(c,{file:a.dataTransfer.files[0],type:i[0].type})):o.$emit(t.importFile,Object.assign(c,e.value))}),a.bind("dragover",function(t){if(t.preventDefault(),t.stopPropagation(),e.value.type===c&&e.value.trackId!==o.track.id)i.addClass("disallow not-drum-machine"),t.dataTransfer.dropEffect="none";else if("midi"!==e.value.type||o.track.soundbank&&o.track.type!==c){if("audio"===e.value.type&&o.track.soundbank)i.addClass("disallow not-audio"),t.dataTransfer.dropEffect="none";else if(_.includes(t.dataTransfer.types,"Files")||o.track.soundbank&&o.track.type!==c&&"midi"===e.value.type||o.track.type===c&&e.value.type===c||!o.track.soundbank&&"audio"===e.value.type)t.dataTransfer.dropEffect="copy";else if("track"===e.value.type)return n.droppedTrack=o.track,n.droppedTrackY=t.offsetY,i.css("visibility","hidden"),void o.$applyAsync()}else i.addClass("disallow not-midi"),t.dataTransfer.dropEffect="none";i.css("visibility","visible"),i.css("left","".concat(s(t.offsetX),"px"))}),a.bind("dragenter",function(t){a.addClass("dropping"),t.preventDefault(),t.stopPropagation(),window.removeEventListener("dragend",r),window.addEventListener("dragend",r),t.target.classList.contains("mix-editor-region")||(a.append(i),i.removeClass("disallow not-audio not-midi not-drum-machine"),i.css({left:"".concat(s(t.offsetX),"px"),width:"".concat(e.value.duration*n.scalePx,"px")}))}),a.bind("dragleave",function(e){e.target.classList.contains("mix-editor-region")||r()})}}}]),angular.module("bandlab.editor").directive("mixEditorTrackGrid",["AnimationFrame","EditorGrid",function(e,t){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-track-grid-19e114c1.html",link:function(n){var o=document.getElementById("mix-editor-track-grid-pattern");function a(){t.updateTrackGrid({pattern:o})}n.$watchGroup(["state.snapSetting","state.isTimeRuler"],a),e.add("scale:timeline",a)}}}]),angular.module("bandlab.editor").directive("mixEditorTrackHeader",["$filter","$timeout","AnimationFrame","ClientDevice","EditorDraggedItem","editorEvents","EditorHelper","EditorHistory","EditorMidiScore","EditorPlayer","EditorRevision","EditorScroll","EditorScrollState","EditorState","EditorTrack","EffectsPreset","InputsCollection","Modal",function(e,t,n,o,a,i,r,s,c,l,u,d,p,m,f,h,g,v){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-track-header-a0a44b8c.html",link:function(c,l){var f,h;function g(){l.off("dragstart",g),m.draggingTrack=c.track,m.droppedTrackY=0,m.droppedTrack={},a.value={type:"track"},l[0].parentElement.addEventListener("dragover",y),c.$applyAsync()}function v(e){var t=e.getCoordinates(),n=(t.x,t.y);clearInterval(h),h=setInterval(function(){var e=function(e,t){var n=l[0].parentElement.getBoundingClientRect(),o=n.top,a=n.height;return o>t?{up:!0}:o+a<=t?{down:!0}:void 0}(0,n);d.manualScroll(e)},30)}function b(){m.draggingTrack={},m.droppedTrack={},m.droppedTrackY=0,clearInterval(h),l[0].draggable=!1,document.removeEventListener("dragover",v),document.removeEventListener("mouseup",b)}function y(e){e.preventDefault()}o.isTablet||(l.on("mousedown",function(e){e.target===l[0]&&(l[0].draggable=!0,l.on("dragstart",g),document.addEventListener("dragover",v,{passive:!1}),document.addEventListener("mouseup",b))}),l.on("dragover",function(e){c.track!==m.draggingTrack&&(m.droppedTrack=c.track,m.droppedTrackY=e.offsetY,c.$applyAsync())}),l.on("dragend drop",function(){if(m.droppedTrack.id&&m.droppedTrackY<50){var e=m.droppedTrack.order-.5;Math.abs(e-m.draggingTrack.order)>1&&s.pushUndo(u.current),m.draggingTrack.order=e}else if(m.droppedTrack.id){var o=m.droppedTrack.order+.5;Math.abs(o-m.draggingTrack.order)>1&&s.pushUndo(u.current),m.draggingTrack.order=o}r.refreshTracksOrder(u.current.tracks),m.hasRevisionChanges=!0,l[0].parentElement.removeEventListener("dragover",y),b(),t(function(){n.start("scroll:tracksTop",!1,p.tracksEl.scrollTop)})})),c.selectFile=function(){setTimeout(function(){l[0].querySelector(".mix-editor-file-input").click()})},c.$on("$ngFile:fileChanged",function(e,t){c.$emit(i.importFile,{file:t[0],track:c.track})}),c.focusTrackName=function(){l[0].querySelector(".mix-editor-track-header-name input").focus(),l[0].querySelector(".mix-editor-track-header-name input").select()},c.blurTrackName=function(e){13!==e.which&&27!==e.which||e.currentTarget.blur()},c.onTrackNameFocus=function(){f=c.track.name},c.onTrackNameBlur=function(){var t=c.track.name||e("displayInstrument")(c.track);t!==f&&(c.track.name=f,s.pushUndo(u.current),m.hasRevisionChanges=!0),c.track.name=t}},controller:["$scope",function(e){e.duplicateTrack=function(){f.duplicateTrack(e.track)},e.isArmed=function(){return f.isArmed(e.track)},e.toggleSolo=function(){return f.toggleSolo(e.track)},e.toggleMute=function(){return f.toggleMute(e.track)},e.openAudioInput=function(){return r.displayInstrument({toggle:!1})},e.$on(i.keyDown.soloTrack,function(){e.isSelected()&&e.toggleSolo()}),e.$on(i.keyDown.muteTrack,function(){e.isSelected()&&e.toggleMute()}),e.current=g.getCurrent(),e.getPresets=h.getByInput,e.selectPreset=f.selectPreset,e.getTrack=function(){return e.track},e.setTrackVolume=function(t){l.current.setTrackParameter(e.track.id,"volume",t)},e.setAutomationParameter=function(t){u.trackAutomationParameters.set(e.track,t)},e.getAutomationParameter=function(){return u.trackAutomationParameters.get(e.track)||"volume"},e.getAutomationParameterLabel=function(){return{pan:"Pan",volume:"Volume"}[u.trackAutomationParameters.get(e.track)||"volume"]},e.isSelected=function(){return u.selectedTrack===e.track},e.downloadTrackAsFile=function(){return m.isPlaying&&e.togglePlay(),f.downloadTrackMixdown(e.track)},e.downloadTrackAsMid=function(){var t=c.exportTrackToMid(e.track,{bpm:e.revision.metronome.bpm});saveAs(t,"".concat(e.track.name||"MIDI Track",".mid"))},e.toggleFreeze=f.toggleFreeze(e),e.displayMobileEffectModal=function(){new v({templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-mobile-effect-d257290b.html"}).show()}}]}}]),angular.module("bandlab.editor").directive("mixEditorTrackPlaceholder",["$stateParams","AnimationFrame","EditorDraggedItem","editorEvents","EditorScrollState","EditorState",function(e,t,n,o,a,i){return{replace:!0,restrict:"E",template:['<div class="mix-editor-track-placeholder" ng-class="{ hidden : revision.tracks.length >= 12 }">','  <i class="icon-note-plus"></i>',"  <br>","Drop a loop or an audio/MIDI file",'  <input type="file" accept="audio/*" ng-file="importFile" multiple>',"</div>"].join(""),link:function(r,s){function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r.$emit(o.importFile,{file:e,time:(a.timelineEl.scrollLeft+t)/i.scalePx})}r.$watch("importFile",function(e){_.forEach(e,function(e){return c(e)})}),t.add("scroll:timelineLeft",function(e){e+a.timelineEl.clientWidth-12>i.containerWidth&&(e-=e+a.timelineEl.clientWidth-i.containerWidth-12),s[0].style.transform="translate3d(".concat(e,"px, 0, 0)")}),s.bind("mousedown",function(e){e.stopPropagation()}),s.on("drop",function(e){e.preventDefault(),e.stopPropagation(),s.removeClass("dropping"),e.dataTransfer.files.length?_.forEach(e.dataTransfer.files,function(t){return c(t,e.offsetX)}):r.$emit(o.importFile,Object.assign({time:(a.timelineEl.scrollLeft+e.offsetX)/i.scalePx},n.value))}),s.on("dragover",function(e){e.preventDefault(),e.stopPropagation(),s.addClass("dropping")}),s.on("dragleave",function(){s.removeClass("dropping")}),"file"===e.source&&s.find("input")[0].click()}}}]),angular.module("bandlab.editor").directive("mixEditorTracks",["$document","$window","AnimationFrame","AppNotifications","audioEvents","EditorAllowActions","EditorAutomation","EditorClipboard","editorEvents","EditorHelper","EditorHistory","EditorPlayer","EditorRevision","EditorScroll","EditorScrollState","editorSettings","EditorState","EditorTimeline","EditorTrack","EditorView","MidiEditor","MidiEditorState","Soundbank",function(e,o,a,i,r,s,l,u,d,p,m,f,h,g,v,b,y,w,S,P,E,T,M){function $(e){return h.selectedRegions.has(e)}return{restrict:"A",link:function(n,o){var i,r,c,u,d={x:0,y:0},S=0,E=0,T=0;function M(){var e,t,o,a,i,r,s,c=_.sortBy(Array.from(h.selectedRegions),"startPosition"),u=_.keyBy(h.current.tracks,"id");return r=_.map(c,"startPosition"),a=_.map(c,"id"),o=_.chain(c).map("endPosition").max().value(),_.forEach(c,function(e){e.automation=l.getAutomationInRange(u[e.trackId].automation,e.startPosition,e.endPosition)}),e=_.min(r),t=_.find(n.revision.tracks,{id:c[0].trackId}),s=n.revision,i=_.chain(s.tracks).filter(function(e){return _.some(e.regions,$)}).value(),{firstPosition:e,firstTrack:t,lastPosition:o,originalSelectedRegions:_.cloneDeep(c),possibleOffsets:C(n.revision,i),scalePx:y.scalePx,selectedRegions:c,startPositions:_.zipObject(a,r),tracksById:u}}function C(e,t){var o=function(e,t){return A(e,_.head(e.tracks),_.head(t))}(e,t),a=function(e,t){return A(e,_.last(e.tracks),_.last(t))}(e,t),i=function(e,t){return _.map(e.tracks,function(e){return t.includes(e)})}(n.revision,t),r=function(e){return _.chain(e.tracks).map({canEdit:!0}).map(function(e){return!!e}).value()}(n.revision);return Array.from(Array(a-o+1),function(e,t){return o+t}).filter(function(e){return function(e,t,n){return n<0?t=t.slice(Math.abs(n),t.length):n>0&&(t=Array(n).fill(!1).concat(t)),_.every(t,function(t,n){return!t||t===e[n]})}(r,i,e)})}function A(e,t,n){return e.tracks.indexOf(t)-e.tracks.indexOf(n)}function R(e,n){var o=0;_.forEach(n.selectedRegions,function(a,i){o=w.moveRegion(a,i,function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?un(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):un(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},n,{delta:e,firstRegionSnapped:o}))})}function I(e){var t,a,c,l,p,f,b,y,w;e.preventDefault(),e.stopPropagation(),s.isAllowed("editRegion")&&(i.dragged||m.pushUndo(n.revision),!i.dragged&&e.altKey?(h.selectedRegions.clear(),_.forEach(i.selectedRegions,function(e){var t=_.cloneDeep(e);t.id=k(),i.tracksById[e.trackId].regions.push(t),h.selectedRegions.add(t)}),i=M()):i.dragged||(document.removeEventListener("touchmove",I,{passive:!1}),e.target.addEventListener("touchmove",I,{passive:!1}),e.target.addEventListener("touchend",O,{passive:!1}),e.target.addEventListener("touchcancel",O,{passive:!1})),i.dragged=!0,t=e.getCoordinates(),(a=document.elementFromPoint(t.x,t.y))&&a.closest(".mix-editor-track")&&(c=_.find(n.revision.tracks,{id:a.closest(".mix-editor-track").getAttribute("data-id")}),(l=A(n.revision,c,r))-T&&i.possibleOffsets.includes(l)&&(f=n.revision.tracks,b=i.selectedRegions,y=l-T,w=new Set(b),_.forEach(f,function(e,t){var n=_.remove(e.regions,function(e){return w.has(e)&&w.delete(e)}),o=f[t+y];n.length&&(o.regions=o.regions.concat(n),_.forEach(n,function(e){e.trackId=o.id}))}),T=l)),R(t.x-d.x,i),n.$digest(),clearInterval(u),u=setInterval(function(){var e,a,r,s;e=t.x,a=t.y,r=v.SCROLL_STEP,s=o[0].parentElement.getBoundingClientRect(),p=s.top>a?{up:!0}:s.top+s.height<=a?{down:!0}:s.left>e?(d.x=Math.min(r+d.x,E),{left:!0}):s.left+s.width<e?(d.x=Math.max(d.x-r,S),{right:!0}):void 0,g.manualScroll(p),R(t.x-d.x,i),n.$digest()},30))}function O(t){var o,a,r,s;if(o=t.getCoordinates(),y.isDraggingRegions=!1,document.removeEventListener("mousemove",I,{passive:!1}),t.target.removeEventListener("touchmove",I,{passive:!1}),t.target.removeEventListener("touchcancel",O,{passive:!1}),t.target.removeEventListener("touchend",O,{passive:!1}),e.off("mouseup",O),clearInterval(u),!i.dragged)return h.selectedRegions.add(c),void n.$digest();l.checkConfirmation("move",i.selectedRegions).then(function(){d.x<o.x&&(i.selectedRegions.reverse(),i.originalSelectedRegions.reverse()),_.forEach(i.selectedRegions,function(e,o){var a=i.originalSelectedRegions[o],r=_.find(n.revision.tracks,{id:a.trackId}),s=_.find(n.revision.tracks,{id:e.trackId});t.altKey||l.deleteAutomationInRange(r.automation,a.startPosition,a.endPosition),l.deleteAutomationInRange(s.automation,e.startPosition,e.endPosition),l.pasteAutomation(s.automation,e.automation,e.startPosition)})}).catch(angular.noop),a=_.chain([].concat(i.selectedRegions,i.originalSelectedRegions)).map("trackId").uniq().value(),r=n.revision,s=a,_.forEach(r.tracks,function(e){s.length&&-1===s.indexOf(e.id)||w.moveRegions(e)}),n.$digest(),f.updateSourcesInTracks(a)}function x(){o[0].style.width="".concat(y.containerWidth,"px")}function D(){P.init(o[0].getBoundingClientRect())}o.on("mousedown touchstart",function(t){if(window.getSelection().removeAllRanges(),T=0,c=_.chain(n.revision.tracks).map("regions").flatten().find({id:t.target.getAttribute("data-id")}).value()){if(t.shiftKey||$(c)||h.selectedRegions.clear(),3===t.which)return h.selectedRegions.add(c),void n.$digest();1!==t.which&&0!==t.which||(d=t.getCoordinates(),r=_.find(n.revision.tracks,{id:c.trackId}),E=d.x+o[0].parentElement.scrollLeft,S=d.x-(o[0].parentElement.scrollWidth-o[0].parentElement.scrollLeft-o[0].parentElement.clientWidth),n.revision.tracks=p.refreshTracksOrder(n.revision.tracks),h.selectedRegions.add(c),y.isDraggingRegions=!0,n.$digest(),i=M(),document.addEventListener("mousemove",I,{passive:!1}),document.addEventListener("touchmove",I,{passive:!1}),e.on("mouseup",O))}else h.selectedRegions.clear()}),o.on("dblclick",function(e){if(p.isBandLabInstrumentTrack(h.selectedTrack)&&e.target===o[0]){e.preventDefault();var t=o[0].getBoundingClientRect().left,a=Math.max(0,e.clientX-t-12),i=Math.min(a/y.scalePx,b.SONG_DURATION_MAX),r=p.getMeasureDuration(h.current.metronome),s=Math.floor(i/r)*r;if(!_.filter(h.selectedTrack.regions,function(e){return e.startPosition>s&&e.startPosition<s+r||e.endPosition>s&&e.endPosition<s+r}).length){var c=(_.chain(h.selectedTrack.regions).filter(function(e){return e.startPosition>s}).minBy("startPosition").value()||{startPosition:1/0}).startPosition,l=Math.min(s+4*r,Math.floor(c/r)*r,b.SONG_DURATION_MAX);w.createEmptyRegion(h.selectedTrack,{startPosition:s,endPosition:l}),p.displayMidiEditor({toggle:!1}),n.$applyAsync()}}}),o.on("dragover drop",function(e){e.preventDefault(),e.stopPropagation()}),a.add("scale:timeline",function(e){x(),e&&g.focusedRescale(e)}),window.addEventListener("resize",D),n.$on("$destroy",function(){window.removeEventListener("resize",D)}),P.init(o[0].getBoundingClientRect()),x()},controller:["$scope","EditorMidiSamples",function(e,t){e.countSelectedRegions=function(){return h.selectedRegions.size},e.canMergeRegions=function(){var e,t=Array.from(h.selectedRegions),n=1===t.length&&!!t[0].loopLength,o=t.length>1,a=1===_.chain(t).map("trackId").uniq().tap(function(t){var n=_.find(h.current.tracks,{id:t[0]});e=n&&n.type===c}).size().value();return(n||o)&&(p.areAudioRegions(t)||p.areMidiRegions(t))&&a&&!e},e.copySelectedRegions=function(){var t=_.reduce(e.revision.tracks,function(e,t){var n=_.chain(t.regions).filter($).map(function(e){return _.assignIn({automation:l.getAutomationInRange(t.automation,e.startPosition,e.endPosition),trackOrder:t.order},e)}).value();return e.concat(n)},[]);t.length>0&&(u.value=t)},e.cutSelectedRegions=function(){m.pushUndo(e.revision),e.copySelectedRegions(),e.deleteSelectedRegions("cut")},e.deleteSelectedRegions=function(t){m.pushUndo(e.revision),h.selectedRegions.forEach(function(e){e.automation=l.getAutomationInRange(_.find(h.current.tracks,{id:e.trackId}).automation,e.startPosition,e.endPosition)}),l.checkConfirmation(t,Array.from(h.selectedRegions)).then(function(){e.revision.tracks.forEach(function(e){var t=_.remove(e.regions,$);_.forEach(t,function(t){l.deleteAutomationInRange(e.automation,t.startPosition,t.endPosition)})})}).catch(function(){e.revision.tracks.forEach(function(e){_.remove(e.regions,$)})}).finally(function(){f.updateSourcesInTracks(_.map(Array.from(h.selectedRegions),"trackId")),h.selectedRegions.clear()})},e.mergeSelectedRegions=function(e){var o=_.partition(Array.from(h.selectedRegions),function(e){return t.has(e.sampleId)}),a=n(o,2),r=a[0],s=a[1],c=r.length>1||r[0]&&r[0].loopLength,l=s.length>1||s[0]&&s[0].loopLength;(c||l)&&m.pushUndo(h.current),c?w.mergeMidiRegions([e],r,e,h.current.metronome.bpm):l&&w.mergeAudioRegions([e],s,e).catch(function(e){i.addNotification({title:e.message,content:U,classList:"alert",autoclose:5e3})})},e.moveTrack=function(t,n){var o="down"===n?t.order+1:t.order-1;o+1>e.revision.tracks.length||o<0||(_.find(e.revision.tracks,{order:o}).order=t.order,t.order=o)},e.deleteTrack=function(t){s.isAllowed("deleteTrack")&&(S.deleteTrack(t),h.current.tracks.length||(T.isVisible=T.hasFocus=!1,e.displayAddTrack()))},e.armTrack=function(e){p.isBandLabInstrumentTrack(e)&&p.isBandLabInstrumentTrack(h.armedTracks[1])||e!==h.armedTracks[1]&&(e===h.armedTracks[2]?h.armedTracks[2]=null:(h.armedTracks[2]=e,e.channel=1===h.armedTracks[1].channel?2:1))},e.transposeRegions=function(e){E.transposeRegions(h.current,e,h.selectedRegions)},e.canTransposeRegions=function(){var e=Array.from(h.selectedRegions);return _.chain(e).filter(function(e){return t.has(e.sampleId)&&(n=e.trackId,o=_.find(h.current.tracks,{id:n}),"kit"!==M.getPropertyValue(o.soundbank,"category"));var n,o}).value().length===e.length},e.$on(d.keyDown.delete,function(){e.$apply(function(){e.deleteSelectedRegions("erase")})}),e.$on(d.keyDown.copy,function(){e.$apply(function(){e.copySelectedRegions()})}),e.$on(d.keyDown.cut,function(){e.$apply(function(){e.cutSelectedRegions()})}),e.$on(d.keyDown.deleteTrack,function(){e.deleteTrack(h.selectedTrack)}),e.$on(d.keyDown.duplicateTrack,function(){h.selectedTrack.id&&e.$apply(function(){S.duplicateTrack(h.selectedTrack)})}),e.$on(r.EFFECTS_CHANGED,function(e,t){m.pushUndo(h.current),h.selectedTrack.preset=t.preset||"custom",h.selectedTrack.effects=t.effects,f.current.setTrackEffects(h.selectedTrack.id,h.selectedTrack.effects),y.hasRevisionChanges=!0,h.selectedTrack.effects.length||(h.selectedTrack.preset="none")}),e.$on(r.EFFECT_PARAMETER_CHANGED,function(t,n){m.pushUndo(h.current),h.selectedTrack.preset="custom",e.$applyAsync();try{f.current.setTrackEffectParameter(h.selectedTrack.id,n.effectOrder,n.paramSlug,n.value)}catch(e){o.Raven.captureException(e.message||e.name||"Error in setTrackEffectParameter",{extra:{data:n,trackEffects:h.selectedTrack.effects,trackPreset:h.selectedTrack.preset}})}}),e.$on(r.INPUT_CHANGED,function(){h.selectedTrack.id&&S.setInputSourceToTrack(h.selectedTrack)})}]}}]),angular.module("bandlab.editor").directive("mixEditorVolumeSlider",["$window","audioSettings","EditorAutomation","EditorHelper","EditorHistory","EditorRevision","EditorState",function(e,t,n,o,a,i,r){return{replace:!0,restrict:"E",scope:{history:"=",setVolume:"=",model:"="},templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-volume-slider-d77a0e1c.html",compile:function(){return{pre:function(s,c){var l,u,d,p=c[0].querySelector(".mix-editor-volume-slider-cursor"),m=c[0].querySelector(".mix-editor-volume-slider-cursor-shadow");function f(){h(n.getMomentValue("volume",s.model))}function h(e){if(e!==d){var n=100*o.scaleLinToLog(e/t.AUDIO_PARAMETERS.volume.range,1);p.style.left="".concat(n,"%"),m.style.width="calc(".concat(n,"% + 12px)"),d=e}}s.toDiffDecibels=o.toDiffDecibels,s.startSettingVolumeFromSlider=function(e){u=s.history?_.once(function(){return a.pushUndo(i.current)}):angular.noop,s.setVolumeFromSlider(e)},s.setVolumeFromSlider=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.scaleLinToLog(1/t.AUDIO_PARAMETERS.volume.range,1);if(!_.get(s,"model.automation.volume",[]).length){var a=t.AUDIO_PARAMETERS.volume.range,i=o.scaleLogToLin(n*a,a);i!==s.model.volume&&u(),(i<0||i>2)&&(e.Raven.captureException("Out of range volume",{extra:{uiValue:n,value:i}}),i=Math.min(2,Math.max(i,0))),s.model.volume=i,s.setVolume(i),r.hasRevisionChanges=!0,s.$applyAsync(function(){l(i)})}},s.model.regions?(n.on("playing",f),n.on("syncVolume",f),s.$on("$destroy",function(){n.off("playing",f),n.off("syncVolume",f)}),l=f):l=h,n.on("playing",f),n.on("syncVolume",f),s.$on("$destroy",function(){n.off("playing",f),n.off("syncVolume",f)}),l(s.model.volume)}}}}}]),angular.module("bandlab.editor").directive("moveHandler",["EditorScroll","EditorScrollState",function(e,t){return{restrict:"A",link:function(n,o,a){var i,r,s,c,l,u,d=n.$eval(a.onMoveEnd),p=n.$eval(a.onMoveStart),m=n.$eval(a.onMove),f=30,h=311,g=30,v=t.notesTimelineEl.contains&&t.notesTimelineEl.contains(o[0]),b=v?e.manualNotesScroll:e.manualScroll,y=v?t.notesTimelineEl:t.timelineEl;function w(e){var o,a=e.pageX>u-f,d=e.pageX<h;o=e.getCoordinates().x,i=r-o,clearInterval(l),(d||a)&&(l=setInterval(function(){d?(r=Math.min(r+t.SCROLL_STEP,c),b({left:!0})):(r=Math.max(r-t.SCROLL_STEP,s),b({right:!0})),m(r-o),n.$digest()},g)),angular.isFunction(m)&&(m(i),n.$digest())}function k(){angular.element(window).off("mousemove touchmove",w),angular.element(window).off("mouseup touchend",k),clearInterval(l),angular.isFunction(d)&&n.$apply(function(){d(i)})}o.on("mousedown touchstart",function(e){3!==e.which&&(e.stopPropagation(),e.preventDefault(),r=e.getCoordinates().x,i=0,u=document.documentElement.clientWidth,s=r-(y.scrollWidth-y.scrollLeft-y.clientWidth),c=r+y.scrollLeft,angular.element(window).on("mousemove touchmove",w),angular.element(window).on("mouseup touchend",k),angular.isFunction(p)&&(p(r),n.$digest()))})}}}]),dn.$inject=["$analytics","$q","$scope","$state","Editor","EditorDB","EditorPlayback","EditorRevision","EditorState","Me","Modal","revision"],angular.module("bandlab.editor.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("mixEditor",{url:"/mix-editor?"+["{id:new|[a-zA-Z0-9-_]+}","assignmentId","solutionId","classname","access","userId","projectId","bandId","source","soundbank","addTrack","loopPack"].join("&"),isCompatible:Ge,params:{rewriteTracking:{dynamic:!0,value:["$stateParams",function(e){return function(){return"/mix-editor".concat(e.id?"/revision":"")}}]}},template:'<mix-editor revision="revision"></mix-editor>',reloadOnSearch:!1,resolve:{isPracticeProject:["$stateParams",function(e){return!1}],templates:["$templateCache","$templateRequest","$q",function(e,t,n){return n.all([t("https://www.bandlab.com/web-app/audio/partials/_audio-input-preset-settings-3afe4e12.html"),t("https://www.bandlab.com/web-app/audio/partials/_audio-input-09000775.html"),t("https://www.bandlab.com/web-app/audio/partials/_drum-machine-bpm-input-9cbaa347.html"),t("https://www.bandlab.com/web-app/audio/partials/_drum-machine-start-button-41dbee97.html"),t("https://www.bandlab.com/web-app/audio/partials/_drum-machine-f966d5a7.html"),t("https://www.bandlab.com/web-app/audio/partials/_guitar-eb91fca2.html"),t("https://www.bandlab.com/web-app/audio/partials/_select-audio-device-c08efafd.html"),t("https://www.bandlab.com/web-app/audio/partials/_select-midi-device-a94291e5.html"),t("https://www.bandlab.com/web-app/audio/partials/_virtual-drum-pads-7f1d0eb1.html"),t("https://www.bandlab.com/web-app/audio/partials/_virtual-drums-27eff8da.html"),t("https://www.bandlab.com/web-app/audio/partials/_virtual-piano-05b3e4fe.html"),t("https://www.bandlab.com/web-app/audio/partials/_voice-microphone-5039a5ad.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-automation-a5eb1a59.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-body-9fdd9b7a.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-cycle-selection-3f058a94.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-footer-abaaae6f.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-grid-3546933d.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-header-30c879d9.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-loader-90d0ba8c.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-loop-1718a5bd.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-loops-c0308726.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-metronome-settings-506e7200.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-modal-075915a3.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-playhead-81f0caa2.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-recording-region-9a2032b3.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-region-121a59a7.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-ruler-6ed7ee80.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-scrollbar-horizontal-8d7bf882.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-scrollbar-vertical-daf9cb4e.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-shortcuts-870fba1f.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-sidetabs-97b93f8d.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-toolbar-c775d07a.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-track-header-a0a44b8c.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-track-new-modal-bc1a5cbe.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-track-28881127.html"),t("https://www.bandlab.com/web-app/editor/partials/_mix-editor-volume-slider-d77a0e1c.html"),t("https://www.bandlab.com/web-app/midi/partials/_midi-editor-grid-2f545e3f.html"),t("https://www.bandlab.com/web-app/midi/partials/_midi-editor-header-013c9426.html"),t("https://www.bandlab.com/web-app/midi/partials/_midi-editor-region-note-d485c9e6.html"),t("https://www.bandlab.com/web-app/midi/partials/_midi-editor-region-e928a292.html"),t("https://www.bandlab.com/web-app/midi/partials/_midi-editor-ruler-cc4b796b.html"),t("https://www.bandlab.com/web-app/midi/partials/_midi-editor-track-grid-6f458d98.html"),t("https://www.bandlab.com/web-app/midi/partials/_midi-editor-256a2876.html"),t("https://www.bandlab.com/web-app/song/partials/_revision-new-9c344f39.html")]).then(function(t){t.forEach(e.put)}).catch(function(){})}],theProject:["$stateParams","Song",function(e,t){return e.projectId?t.get({id:e.projectId}).$promise:{}}],revision:["$http","$q","$stateParams","DrumMachine","EditorHelper","EditorModel","editorSettings","EditorTimeline","EffectsPreset","Katnip","Revision","Song","Soundbank","isPracticeProject","theProject",function(e,t,o,r,s,l,u,d,p,m,f,g,v,b,y){return t.all([v.getList().then(function(e){var t=o.id,n=o.bandId||"";if(o.projectId)return f.get({id:y.revision.id,edit:!0}).$promise;if(t&&"new"!==t)return f.get({id:t,edit:!0}).$promise;var a=l.createRevision({song:new g(mn({bandId:n,canEdit:!0,isForkable:!1,name:b?"New Personal Project":"New Project"},y))});return o.soundbank&&_.find(e,{slug:o.soundbank})?a.tracks[0]=l.createTrack({soundbank:o.soundbank}):(o.addTrack||o.loopPack||o.source&&"file"!==o.source)&&(a.tracks[0]=l.createTrack({type:o.source||"voice"})),a}),p.getPresets(),e.get("https://www.bandlab.com/api/v2.0/options",{cache:!0}).then(function(e){var t=e.data.mixEditor;function n(e){return Number.isInteger(e)&&e>0}return n(t.maxTracks)&&(u.TRACKS_LIMIT=t.maxTracks),n(t.maxSongDuration)&&(u.SONG_DURATION_MAX=t.maxSongDuration),u}).catch(angular.noop),m]).then(function(e){var o,m,f,g=n(e,1)[0];return o=g,m=v.getBanks(),f=new Set,d.fixDuplicateRegionIds(o),o.tracks.forEach(function(e){e.canEdit=_.get(e,"autoPitch.bypass",!0)&&(!e.preset||"custom"===e.preset||!!p.getBySlug(e.preset)),e.canEdit||f.add(e.sampleId),e.regions.forEach(function(t){t.endPosition>u.SONG_DURATION_MAX&&(t.endPosition=u.SONG_DURATION_MAX),t.playbackRate=t.playbackRate||1,t.pitchShift=t.pitchShift||0,t.bpm=o.metronome.bpm||120,t.loopLength=t.endPosition-t.startPosition>=t.loopLength?t.loopLength:0,t.canEdit=e.canEdit,t._bpm=o.metronome.bpm,t._sampleOffset=t.sampleOffset,t._startPosition=t.startPosition,t._loopLength=t.loopLength,t._endPosition=t.endPosition,t.canEdit&&f.add(t.sampleId)}),e.colorName=e.colorName||i[0].name,e.color=s.colorNameToColorHex(e.colorName),e.automation=e.automation||{volume:[],pan:[]},e.preset=p.getBySlug(e.preset)||!e.canEdit?e.preset:e.effects&&e.effects.length?"custom":a.slug,e.effects=e.canEdit?e.effects&&e.effects.length?e.effects:_.cloneDeep(p.getBySlug(e.preset).effects):[],d.fixEffectParameters(e),e.soundbank&&!_.find(m,{slug:e.soundbank})&&(e.soundbank=h),e.type===c&&(e.patterns=r.fillMissingPatterns(e),e.patterns.forEach(function(e){var t=e.sampleId;return f.add(t)})),e.type=l.getTrackType(e),e.auxSends=e.auxSends.length?e.auxSends:_.cloneDeep(u.TRACK_AUX_DEFAULT),e.channel=1}),o.samples=o.samples.filter(function(e){return f.has(e.id)}),o.mastering=null,o.masteringSetting="auto",o.auxChannels=o.auxChannels.length?o.auxChannels:_.cloneDeep(u.AUX_CHANNELS_DEFAULT),o.auxChannels.forEach(function(e){e.preset=p.getBySlug(e.preset)?e.preset:u.AUX_CHANNELS_DEFAULT[0].preset,e.effects=e.effects&&e.effects.length?e.effects:_.cloneDeep(p.getBySlug(e.preset).effects)}),(g=o).canEdit||s.hasMagicKeyword()?g:t.reject({status:403})})}]},onEnter:["$analytics","$cookies","$rootScope","Page","EditorState","Player","ProjectUploader","revision",function(e,t,n,o,a,i,r,s){o.setMetadata({title:s.song.name}),i.getCurrentSong().id="",i.pause(),i.pauseOtherTabs(),r.isVisible=!1,e.eventTrack("Enter with specific UI theme",{category:"Mix Editor",label:a.theme}),a.theme=t.get("mixEditorTheme")||"🌙"}],onExit:["$analytics","$rootScope","EditorState","Page",function(e,t,n,o){o.clearMetadata(),e.eventTrack("Exit with specific UI theme",{category:"Mix Editor",label:n.theme})}],controller:dn})}]),angular.module("bandlab.editor").factory("AudioCore",["EditorMidiScore","EditorMidiSamples","EditorRevision","EditorState","Katnip","MidiScore","MidiSynth",function(e,n,o,a,i,r,s){var c=vn(i),l=function(e,t,n,o,a,i){return function(e){var r=e.audioContext,s=[],c=0;return{getPlaybackTime:l,muteTrack:function(t){e.getTrack(t.id).output.disconnect(),d(t)},playRegion:p,playSong:function(t,n){return n=n||0,c=r.currentTime-n,"OfflineAudioContext"===r.constructor.name?e.getAsyncFx().then(o):o();function o(){return Promise.all(t.map(function(e){return u(e,n)}))}},playTrack:u,reinitMidiRegion:function(e){var t=s.find(function(t){return t.regionId===e.id});t&&t.updateNotes(e,n.current.metronome.bpm)},replayTrack:function(t){e.hasTrack(t.id)&&(d(t),u(t,l()))},stopSong:function(){s.forEach(function(e){e.stop()}),s=[]},stopTrack:d,unmuteTrack:function(t,n){e.getTrack(t.id).output.connect(e.output),o.isPlaying&&u(t,n)}};function l(){return r.currentTime-c}function u(t,o){var a=e.getTrack(t.id),c=s.some(function(e){return e.trackId===t.id});if(!a||c)return Promise.resolve();if(t.soundbank&&!t.isFrozen&&(a.midiSynth&&a.midiSynth.outputNode.disconnect(),a.midiSynth=new i(r),a.midiSynth.outputNode.connect(a.input)),a.setAutomation("volume",t,o),a.setAutomation("pan",t,o),"OfflineAudioContext"===r.constructor.name)return a.getAsyncFx().then(u);if(t.isFrozen&&n.frozenTrackBuffers.has(t.id))return d(n.frozenTrackBuffers.get(t.id));if(!t.canEdit){var l=n.current.samples.find(function(e){return e.id===t.sampleId});return l?d(l.buffer):Promise.resolve()}return u();function u(){return a.bypassFxChain(!1),Promise.all(t.regions.map(function(e){if(e.endPosition>o&&e.isPlayable)return p(e,o,a)}))}function d(e){var t=r.createBufferSource(),n=r.currentTime;return a.bypassFxChain(!0),t.trackId=a.id,t.buffer=e,t.connect(a.input),o<0?t.start(n+Math.abs(o),0):t.start(n,o),s.push(t),Promise.resolve(t)}}function d(t){if(e.getTrack(t.id))for(var n=s.length-1;n>=0;n--)s[n].trackId===t.id&&(s[n].stop(),s.splice(n,1))}function p(e,o,c){return t.has(e.sampleId)?function(e,t,o){var c,l;return o=o||((l=new i(r)).outputNode.connect(r.destination),{audioContext:r,input:r.destination,midiSynth:l}),c=new a({bpm:n.current.metronome.bpm,midiSynth:o.midiSynth,regionId:e.id,sampleId:e.sampleId,soundbank:n.current.tracks.find(function(t){return t.id===e.trackId}).soundbank,trackId:e.trackId}),s.push(c),c.play(r,o.input,{endPosition:e.endPosition,loopLength:e.loopLength,playbackPosition:t,sampleOffset:e.sampleOffset,startPosition:e.startPosition})}(e,o,c):function(e,t,o){var a,i=n.current.samples.find(function(t){return t.id===e.sampleId});o=o||{audioContext:r,input:r.destination},a=new kn(r,e,i),s.push(a),a.play(t,o.input)}(e,o,c)}}}(0,n,o,a,r,s);return{getPlayer:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.tracks,a=n.volume,i=n.auxChannels,r=new c(e,o,a,i),s=new l(r);return r.getAsyncFx().then(function(){return function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?Sn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Sn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},r,{},s)})}}}]);var En=function(e){this.logN=0,this.X=null,this.bitRev=null,this.wMulTableRe=null,this.wMulTableIm=null,this.tempRe=null,this.tempIm=null,e&&this.init(e)};En.prototype.init=function(e){this.logN=e;var t=1<<e;this.X=new Array;for(var n=0;n<t;n++)this.X[n]=new Tn;for(n=0;n<t-1;n++)this.X[n].next=this.X[n+1];for(this.bitRev=new Uint32Array(t),n=0;n<t;n++)this.bitRev[n]=this.bitReverse(n,this.logN);this.wMulTableRe=new Float64Array(e+1),this.wMulTableIm=new Float64Array(e+1);for(var o=0;o<=e;o++){var a=-2*Math.PI/(1<<o);this.wMulTableRe[o]=Math.cos(a),this.wMulTableIm[o]=Math.sin(a)}this.tempRe=new Float64Array(t/2+1),this.tempIm=new Float64Array(t/2+1)},En.prototype.forwardComplex=function(e,t,n,o){this.runOutOfPlace(e,t,n,o,!1,this.logN)},En.prototype.inverseComplex=function(e,t,n,o){this.runOutOfPlace(e,t,n,o,!0,this.logN)},En.prototype.forwardReal=function(e,t,n){var o,a=1<<this.logN;for(o=0;o<a/2;o++)this.tempRe[o]=e[2*o],this.tempIm[o]=e[2*o+1];this.runOutOfPlace(this.tempRe,this.tempIm,this.tempRe,this.tempIm,!1,this.logN-1),this.tempRe[a/2]=this.tempRe[0],this.tempIm[a/2]=this.tempIm[0];var i=this.wMulTableRe[this.logN],r=this.wMulTableIm[this.logN],s=1,c=0;for(o=0;o<=a/2;o++){var l=.5*(this.tempRe[o]+this.tempRe[a/2-o]),u=.5*(this.tempIm[o]-this.tempIm[a/2-o]),d=.5*(this.tempIm[o]+this.tempIm[a/2-o]),p=-.5*(this.tempRe[o]-this.tempRe[a/2-o]);t[o]=l+(d*s-p*c),n[o]=u+(d*c+p*s);var m=s;s=s*i-c*r,c=m*r+c*i}},En.prototype.inverseReal=function(e,t,n){var o=1<<this.logN,a=this.wMulTableRe[this.logN],i=this.wMulTableIm[this.logN];i*=-1;for(var r=1,s=0,c=0;c<o/2;c++){var l=.5*(e[c]+e[o/2-c]),u=.5*(t[c]-t[o/2-c]),d=e[c]-e[o/2-c],p=t[c]+t[o/2-c],m=.5*(d*r-p*s),f=.5*(d*s+p*r);this.tempRe[c]=l-f,this.tempIm[c]=u+m;var h=r;r=r*a-s*i,s=h*i+s*a}for(this.runOutOfPlace(this.tempRe,this.tempIm,this.tempRe,this.tempIm,!0,this.logN-1),c=0;c<o/2;c++)n[2*c]=this.tempRe[c],n[2*c+1]=this.tempIm[c]},En.prototype.runOutOfPlace=function(e,t,n,o,a,i){var r=1<<i,s=r>>1,c=r>>1,l=r,u=this.X[0],d=0,p=a?1/r:1;for(d=0;d<r;d++)u.re=p*e[d],u.im=p*t[d],u=u.next;for(var m=0;m<i;++m){var f=this.wMulTableRe[i-m],h=this.wMulTableIm[i-m];a&&(h*=-1);for(var g=0;g<r;g+=l)for(var v=this.X[g],b=this.X[g+c],y=1,w=0,k=0;k<s;++k){var S=v.re,P=v.im,E=b.re,T=b.im;v.re=S+E,v.im=P+T,E=S-E,T=P-T,b.re=E*y-T*w,b.im=E*w+T*y,v=v.next,b=b.next;var M=y;y=y*f-w*h,w=M*h+w*f}s>>=1,c>>=1,l>>=1}var $=1<<this.logN-i,C=r-1;for(d=0;d<r;d++){var _=this.bitRev[d*$]&C;n[d]=this.X[_].re,o[d]=this.X[_].im}},En.prototype.bitReverse=function(e,t){for(var n=0,o=0;o<t;o++)n<<=1,n|=1&e,e>>=1;return n};var Tn=function(){this.re=0,this.im=0,this.next=null},Mn=function(){};Mn.clr=function(e,t){for(var n=0;n<t;n++)e[n]=0},Mn.add=function(e,t,n,o){if(e==n)for(var a=0;a<o;a++)n[a]+=t[a];else if(t==n)for(a=0;a<o;a++)n[a]+=e[a];else for(a=0;a<o;a++)n[a]=e[a]+t[a]},Mn.sub=function(e,t,n,o){for(var a=0;a<o;a++)n[a]=t[a]-e[a]},Mn.vlint=function(e,t,n,o){for(var a,i=e.length,r=0;r<o;r++){var s=t[r];if(s>0&&s<=i-1){var c=Math.floor(s),l=s-c;a=e[c],l&&(a+=l*(e[c+1]-a))}else a=0;n[r]=a}},Mn.mul=function(e,t,n,o){if(e==n)for(var a=0;a<o;a++)n[a]*=t[a];else if(t==n)for(a=0;a<o;a++)n[a]*=e[a];else for(a=0;a<o;a++)n[a]=e[a]*t[a]},Mn.sma=function(e,t,n,o,a){for(var i=0;i<a;i++)o[i]=t*e[i]+n[i]},Mn.mag=function(e,t,n,o){for(var a=0;a<o;a++)n[a]=Math.sqrt(e[a]*e[a]+t[a]*t[a])},Mn.phase=function(e,t,n,o){for(var a=0;a<o;a++)n[a]=Math.atan2(t[a],e[a])},Mn.cartToPolar=function(e,t,n,o,a){for(var i=0;i<a;i++)n[i]=Math.sqrt(e[i]*e[i]+t[i]*t[i]),o[i]=Math.atan2(t[i],e[i])},Mn.polarToCart=function(e,t,n,o,a){for(var i,r,s=0;s<a;s++)i=e[s],r=t[s],n[s]=i*Math.cos(r),o[s]=i*Math.sin(r)};var $n=function(){this.logN=0,this.N=0,this.S=0,this.numCh=2,this.fft=null};$n.prototype.init=function(e){this.logN=e,this.N=1<<e,this.invN=1/this.N,this.S=this.N/4,this.fft=new En,this.fft.init(e),this.win=new Float64Array(this.N),this.outBuf=new Array(this.numCh);for(var t=0;t<this.numCh;t++)this.outBuf[t]=new Float64Array(this.N);this.phase1=new Float64Array(this.N/2+1),this.phaseRate=new Float64Array(this.N/2+1),this.monoPhase=new Float64Array(this.N/2+1),this.channelPhase=new Float64Array(this.N/2+1),this.tempRe=new Float64Array(this.N),this.tempIm=new Float64Array(this.N),this.monoMix=new Float64Array(this.N),this.phaseAccum=new Float64Array(this.N/2+1),this.mag=new Float64Array(this.N/2+1),this.monoMag=new Float64Array(this.N/2+1),this.lastMonoMag=new Float64Array(this.N/2+1),this.fftBufRe=new Float64Array(this.N/2+1),this.fftBufIm=new Float64Array(this.N/2+1);for(var n=Math.sqrt(this.S)/Math.sqrt(this.N)*2/Math.sqrt(1.5),o=0;o<this.N;o++)this.win[o]=n*(.5+-.5*Math.cos(2*Math.PI*o/this.N))},$n.prototype.clear=function(){for(var e=0;e<this.numCh;e++)Mn.clr(this.outBuf[e],this.N);Mn.clr(this.monoPhase,this.N/2),this.prevFrameZero=!0,this.useOriginalPhase=!0},$n.prototype.process=function(e,t,n){var o,a,i=n||this.prevFrameZero;for(Mn.clr(this.monoMix,this.N),o=0;o<this.numCh;o++)Mn.add(e[o],this.monoMix,this.monoMix,this.N);if(Mn.mul(this.monoMix,this.win,this.tempRe,this.N),this.fft.forwardReal(this.tempRe,this.tempRe,this.tempIm),Mn.cartToPolar(this.tempRe,this.tempIm,this.monoMag,this.monoPhase,this.N/2),i)for(a=0;a<=this.N/2;a++)this.phaseAccum[a]=this.monoPhase[a];else{for(a=1;a<this.N-1;a++)this.tempRe[a-1]=this.monoMix[a];this.tempRe[this.N-1]=0,Mn.mul(this.tempRe,this.win,this.tempRe,this.N),this.fft.forwardReal(this.tempRe,this.tempRe,this.tempIm),Mn.phase(this.tempRe,this.tempIm,this.phase1,this.N/2),Mn.sub(this.monoPhase,this.phase1,this.phaseRate,this.N/2),Mn.sma(this.phaseRate,this.S,this.phaseAccum,this.phaseAccum,this.N/2),this.doPhaseLock()}for(o=0;o<this.numCh;o++){for(a=0;a<this.N;a++)this.tempRe[a]=e[o][a];for(Mn.mul(this.tempRe,this.win,this.tempRe,this.N),i||(this.fft.forwardReal(this.tempRe,this.tempRe,this.tempIm),Mn.cartToPolar(this.tempRe,this.tempIm,this.mag,this.channelPhase,this.N/2+1),Mn.sub(this.monoPhase,this.channelPhase,this.tempRe,this.N/2+1),Mn.add(this.phaseAccum,this.tempRe,this.channelPhase,this.N/2+1),this.mag[0]=this.mag[this.N/2]=0,this.channelPhase[0]=this.channelPhase[this.N/2]=0,Mn.polarToCart(this.mag,this.channelPhase,this.tempRe,this.tempIm,this.N/2+1),this.fft.inverseReal(this.tempRe,this.tempIm,this.tempRe)),Mn.mul(this.tempRe,this.win,this.tempRe,this.N),Mn.add(this.tempRe,this.outBuf[o],this.outBuf[o],this.N),a=0;a<this.S;a++)t[o][a]=this.outBuf[o][a];var r=this.S;for(a=0;a<this.N-this.S;a++)this.outBuf[o][a]=this.outBuf[o][r],r++;for(a=this.N-this.S;a<this.N;a++)this.outBuf[o][a]=0}for(a=0;a<=this.N/2;a++)this.lastMonoMag[a]=this.monoMag[a];this.prevFrameZero=!1},$n.prototype.doPhaseLock=function(){var e,t;for(e=1;e<this.N/2-1;e++)if(this.monoMag[e]>this.monoMag[e-1]&&this.monoMag[e]>this.monoMag[e+1]){t=this.phaseAccum[e]-this.monoPhase[e];for(var n=e-1;n>0&&this.monoMag[n]<this.monoMag[n+1];)this.phaseAccum[n]=this.monoPhase[n]+t,n--;for(n=e+1;n<this.N/2-1&&this.monoMag[n]<this.monoMag[n-1];)this.phaseAccum[n]=this.monoPhase[n]+t,n++}for(e=1;e<this.N/2;e++)this.monoMag[e]>2.5*this.lastMonoMag[e]&&(this.phaseAccum[e]=this.monoPhase[e])};var Cn=function(){this.vocoder=null,this.audioContext=null,this.ownsAudioContext=!1,this.srcBufL=null,this.srcBufR=null,this.stepBufL=null,this.stepBufR=null,this.NUM_CHANNELS=2,this.LOG2LEN=12,this.FRAME_LEN=1<<this.LOG2LEN,this.STEPS_PER_FRAME=4,this.STEP_LEN=this.FRAME_LEN/this.STEPS_PER_FRAME,this.NUM_BUFFERS=8,this.SEMITONES_PER_OCTAVE=12};Cn.prototype.init=function(e){if(e)this.ownsAudioContext=!1,this.audioContext=e;else{if(this.audioContext=Pn(),null==this.audioContext)return!1;this.ownsAudioContext=!0}return this.srcBufL=new Float64Array(this.FRAME_LEN),this.srcBufR=new Float64Array(this.FRAME_LEN),this.posBuf=new Float64Array(this.FRAME_LEN),this.stepBufL=new Float64Array(this.STEP_LEN),this.stepBufR=new Float64Array(this.STEP_LEN),this.vocoder=new $n,this.vocoder.init(this.LOG2LEN),!0},Cn.prototype.destroy=function(){this.ownsAudioContext&&null!=this.audioContext&&(this.audioContext.close(),this.audioContext=null)},Cn.prototype.getVersion=function(){return"2016-11-15 15:14"},Cn.prototype.getAudioContext=function(){return this.audioContext},Cn.prototype.grabSource=function(e,t,n,o,a){var i=0,r=e.getChannelData(0),s=e.getChannelData(1),c=e.length,l=t;for(i=0;i<this.FRAME_LEN;i++){var u=Math.floor(l),d=u+1,p=l-u,m=1-p;u>=0&&d<c?(o[i]=m*r[u]+p*r[d],a[i]=m*s[u]+p*s[d]):o[i]=a[i]=0,l+=n}},Cn.prototype.resample=function(e,t,n,o,a){for(var i,r=t,s=e.length,c=0;c<a;c++){if(r>0&&r<=s-1){var l=Math.floor(r);i=e[l],l!=r&&(i+=(r-l)*(e[l+1]-i))}else i=0;o[c]=i,r+=n}},Cn.prototype.convert=function(e,t,n){var o,a,i,r,s,c=this.audioContext,l=e.numberOfChannels,u=e.sampleRate,d=e.length;if(s=null!=n?Math.pow(2,n/this.SEMITONES_PER_OCTAVE):t,i=Math.floor(d/t),Math.abs(t/s-1)<1e-4)for(a=c.createBuffer(l,i,u),r=0;r<l;r++){var p=e.getChannelData(r),m=a.getChannelData(r);this.resample(p,0,s,m,i)}else{var f;i=(f=Math.ceil(i/this.STEP_LEN))*this.STEP_LEN;var h=(a=c.createBuffer(l,i,u)).getChannelData(0),g=a.getChannelData(1),v=this.STEPS_PER_FRAME-1,b=-v*this.STEP_LEN,y=b*t;this.vocoder.clear();for(var w=-v;w<f;w++){this.grabSource(e,y,s,this.srcBufL,this.srcBufR);var k=[this.srcBufL,this.srcBufR],S=[this.stepBufL,this.stepBufR];if(this.vocoder.process(k,S,!1),w>=0)for(o=0;o<this.STEP_LEN;o++)h[b+o]=this.stepBufL[o],g[b+o]=this.stepBufR[o];y+=t*this.STEP_LEN,b+=this.STEP_LEN}}return a},Cn.prototype.convertAsync=function(e,n,o,a){var i,r,s,c,l,u,d,p=this.audioContext,m={},f=e.numberOfChannels,h=e.sampleRate,g=e.length;return s=null!==o?Math.pow(2,o/this.SEMITONES_PER_OCTAVE):n,i=Math.floor(g/n),Math.abs(n/s-1)<1e-4?(t(l={},"function","linearResample"),t(l,"params",(t(c={},"dstLen",i),t(c,"srcBuffers",He(Array(e.numberOfChannels).keys()).map(function(t){return e.getChannelData(t)},e)),t(c,"pitchFactor",s),c)),m=l):(r=Math.ceil(i/this.STEP_LEN),i=r*this.STEP_LEN,t(d={},"function","speedPitchShift"),t(d,"params",(t(u={},"audioLen",e.length),t(u,"dstLen",i),t(u,"FRAME_LEN",this.FRAME_LEN),t(u,"LOG2LEN",this.LOG2LEN),t(u,"numSteps",r),t(u,"pitchFactor",s),t(u,"speed",n),t(u,"srcBufferL",e.getChannelData(0)),t(u,"srcBufferR",e.getChannelData(1)),t(u,"srcBufL",this.srcBufL),t(u,"srcBufR",this.srcBufR),t(u,"STEP_LEN",this.STEP_LEN),t(u,"stepBufL",this.stepBufL),t(u,"stepBufR",this.stepBufR),t(u,"STEPS_PER_FRAME",this.STEPS_PER_FRAME),t(u,"useOriginalPhase",!1),u)),m=d),a.postMessage(m),new Promise(function(e,t){a.onmessage=function(t){var n=t.data.reduce(function(e,t,n){return e.copyToChannel(t,n),e},p.createBuffer(f,i,h));e(n)},a.onerror=t})},Cn.prototype.init=Cn.prototype.init,Cn.prototype.destroy=Cn.prototype.destroy,Cn.prototype.getVersion=Cn.prototype.getVersion,Cn.prototype.getAudioContext=Cn.prototype.getAudioContext,Cn.prototype.convert=Cn.prototype.convert,Cn.prototype.convertAsync=Cn.prototype.convertAsync;var _n=function(){this.context=null,this.buffers=[],this.nextChunkTime=0,this.nextBufferID=0,this.interval=null,this.audioCallback=null,this.chunkLen=0,this.numChannels=0,this.numBuffers=0};_n.prototype.init=function(e,t,n,o,a){this.context=e,this.numChannels=n,this.chunkLen=o,this.audioCallback=t,this.numBuffers=a;for(var i=this.context.sampleRate,r=0;r<this.numBuffers;r++)this.buffers[r]=this.context.createBuffer(this.numChannels,this.chunkLen,i);return!0},_n.prototype.getSampleRate=function(){return this.context&&this.context.sampleRate,this.context.sampleRate},_n.prototype.getVersion=function(){return"2016-11-15 15:14"},_n.prototype.getAudioContext=function(){return this.context},_n.prototype.getLatency=function(){return 0},_n.prototype.start=function(){if(null==this.interval){this.nextChunkTime=0,this.nextBufferID=0,this.fillBuffers(!0);var e=this.chunkLen/this.context.sampleRate*500;this.interval=setInterval(this.fillBuffers.bind(this),e)}},_n.prototype.stop=function(){null!=this.interval&&(clearInterval(this.interval),this.interval=null)},_n.prototype.fillBuffers=function(e){for(var t=this.chunkLen/this.context.sampleRate,n=this.numBuffers-Math.ceil((this.nextChunkTime-this.context.currentTime)/t);n>0;){var o=this.nextBufferID,a=this.buffers[o];if(null!=e&&1==e)for(var i=0;i<this.numChannels;i++)Mn.clr(a.getChannelData(i),this.chunkLen);else{var r=[];for(i=0;i<this.numChannels;i++)r[i]=a.getChannelData(i);this.audioCallback(r)}var s=this.context.createBufferSource();s.buffer=this.buffers[this.nextBufferID],s.connect(this.context.destination),this.nextChunkTime=Math.max(this.nextChunkTime,this.context.currentTime),s.start(this.nextChunkTime),this.nextChunkTime+=t,this.nextBufferID=(this.nextBufferID+1)%this.numBuffers,n=this.numBuffers-Math.ceil((this.nextChunkTime-this.context.currentTime)/t)}};var An=function(){this.WAVEFORM_BACKGROUND_COLOR="#2a2a2a",this.WAVEFORM_WAVE_COLOR="#0d4186",this.WAVEFORM_MIDLINE_COLOR="#0d6ac0",this.LOOP_MARKER_COLOR="#c1c1c1",this.LOOP_LABEL_COLOR="#c1c1c1",this.WAVEFORM_PLAYHEAD_COLOR="#cc0000",this.TICK_MARK_COLOR="#505050",this.TIME_LABEL_COLOR="#c1c1c1",this.OVERVIEW_BACKGROUND_COLOR="#2a2a2a",this.OVERVIEW_WAVE_COLOR="#0d4186",this.OVERVIEW_MIDLINE_COLOR="#0d6ac0",this.OVERVIEW_PLAYHEAD_COLOR="#cc0000",this.TIME_LABEL_FONT="18px 'Lucida Console', Monaco, monospace",this.TIME_LABEL_HEIGHT=15,this.TIME_LABEL_TOP_PADDING=5,this.LOOP_LABEL_FONT="20px 'Lucida Console', Monaco, monospace",this.LOOP_MARKER_LINE_WIDTH=1,this.LOOP_MARKER_BOX_WIDTH=30,this.WAVEFORM_MIDLINE_WIDTH=1,this.WAVEFORM_HEIGHT_FRAC=.9,this.WAVEFORM_PLAYHEAD_WIDTH=1,this.TICK_LEN=10,this.TICK_LINE_WIDTH=1,this.OVERVIEW_MIDLINE_WIDTH=1,this.OVERVIEW_HEIGHT_FRAC=.9,this.OVERVIEW_PROG_BAR_WIDTH=.25,this.OVERVIEW_PLAYHEAD_WIDTH=1,this.OVERVIEW_DRAW_MARGIN=3,this.OVERVIEW_TOUCH_MARGIN=8,this.EVENT_PROGRESS="progress",this.EVENT_CANPLAY="canplay",this.EVENT_ERROR="error",this.EVENT_TIMEUPDATE="timeupdate",this.EVENT_SEEKING="seeking",this.EVENT_SEEKED="seeked",this.EVENT_VOLUMECHANGE="volumechange",this.EVENT_STATECHANGE="statechange",this.EVENT_PLAY="play",this.EVENT_PAUSE="pause",this.MIN_PRESS_DUR=200,this.MAX_JUMP_SECS=10,this.MAX_FAST_SPEED=30,this.MIN_FAST_SPEED=5,this.FASTFWD_REWIND_GAIN=.5,this.MIN_PLAYBACK_RATE=.1,this.MAX_PLAYBACK_RATE=10,this.MIN_PITCH_SHIFT=-12,this.MAX_PITCH_SHIFT=12,this.UPDATE_INTERVAL_MS=50,this.PIXELS_PER_SEC=100,this.PIXELS_PER_PANEL=1*this.PIXELS_PER_SEC,this.PLAY_STATE_STOPPED=0,this.PLAY_STATE_PLAYING=1,this.PLAY_STATE_REWIND=2,this.PLAY_STATE_FASTFWD=3,this.DSFACTOR=2,this.LOG2LEN=11,this.FRAME_LEN=1<<this.LOG2LEN,this.STEPS_PER_FRAME=4,this.STEP_LEN=this.FRAME_LEN/this.STEPS_PER_FRAME,this.SEMITONES_PER_OCTAVE=12,this.CHUNK_LEN=this.STEP_LEN*this.DSFACTOR,this.NUM_CHANNELS=2,this.NUM_BUFFERS=8,this.playPos=0,this.loopEnabled=!1,this.loopStartPos=0,this.loopEndPos=0,this.playbackRate=1,this.volume=1,this.currentRate=0,this.playState=this.PLAY_STATE_STOPPED,this.pitchShift=0,this.balance=0,this.audioContext=null,this.audioOutput=null,this.stopCount=0,this.audioBuffer=null,this.audioLen=0,this.httpRequest=null,this.srcBufL=null,this.srcBufR=null,this.stepBufL=null,this.stepBufR=null,this.lastOut=null,this.vocoder=null,this.sampleRate=0,this.origCount=0,this.useOriginalPhase=!1,this.downloadProgress=0,this.forwardButtonDown=!1,this.backButtonDown=!1,this.longPressTimer=null,this.prevPlayState=this.PLAY_STATE_STOPPED,this.waveformDiv=null,this.waveformCanvas=null,this.waveformData=null,this.waveformPanelCache=null,this.waveformPanelIDs=null,this.panelCacheLen=0,this.overviewDiv=null,this.overviewCanvas=null,this.overviewWaveformImage=null,this.overviewData=null,this.overviewX=0,this.overviewMouseIsDown=!1,this.offscreenCanvas=null,this.touchPosOnTouch=0,this.playPosOnTouch=0,this.targetPlayPos=0,this.scrubbing=!1,this.events={},this.playStateChanged=!1,this.playPosChanged=!1,this.debugText=null,this.sumElapsed=0,this.genCount=0};function Rn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}An.prototype.init=function(e,t){if(this.audioContext=t,this.audioContext)this.ownsAudioContext=!1,this.audioContext=t;else{if(this.audioContext=Pn(),null==this.audioContext)return!1;this.ownsAudioContext=!0}var n=this;if(this.audioOutput=new _n,!this.audioOutput.init(this.audioContext,function(e){n.audioCallback(e)},this.NUM_CHANNELS,this.CHUNK_LEN,this.NUM_BUFFERS))return!1;this.srcBufL=new Float64Array(this.FRAME_LEN),this.srcBufR=new Float64Array(this.FRAME_LEN),this.stepBufL=new Float64Array(this.STEP_LEN),this.stepBufR=new Float64Array(this.STEP_LEN),this.lastOut=new Float64Array(this.NUM_CHANNELS),this.vocoder=new $n,this.vocoder.init(this.LOG2LEN),this.sampleRate=this.audioOutput.getSampleRate()/this.DSFACTOR,this.NUM_FRAMES_BEFORE_LOCK=this.sampleRate/this.STEP_LEN,this.interval=setInterval(this.onTimer.bind(this),this.UPDATE_INTERVAL_MS),this.debugText=document.getElementById("debugText"),document.addEventListener("visibilitychange",function(){document.hidden&&n.pause(!0)});var o="",a="";if(e)for(var i in e){var r=e[i];if(e.hasOwnProperty(i))if("waveformDiv"==i)a=r;else if("overviewDiv"==i)o=r;else if("backgroundColor"==i)this.OVERVIEW_BACKGROUND_COLOR=this.WAVEFORM_BACKGROUND_COLOR=r;else if("waveColor"==i)this.OVERVIEW_WAVE_COLOR=this.WAVEFORM_WAVE_COLOR=r;else if("midlineColor"==i)this.OVERVIEW_MIDLINE_COLOR=this.WAVEFORM_MIDLINE_COLOR=r;else if("playheadColor"==i)this.OVERVIEW_PLAYHEAD_COLOR=this.WAVEFORM_PLAYHEAD_COLOR=r;else if("loopLabelFont"==i)this.LOOP_LABEL_FONT=r;else if("loopMarkerColor"==i)this.LOOP_MARKER_COLOR=r;else if("loopLabelColor"==i)this.LOOP_LABEL_COLOR=r;else if("tickMarkColor"==i)this.TICK_MARK_COLOR=r;else if("timeLabelColor"==i)this.TIME_LABEL_COLOR=r;else{if("timeLabelFont"!=i)throw new Error("setOverview unknown option:"+i);this.TIME_LABEL_FONT=r}}var s=this.getPixelHeightFromFontString(this.TIME_LABEL_FONT);return s>0&&(this.TIME_LABEL_HEIGHT=s),(s=this.getPixelHeightFromFontString(this.LOOP_LABEL_FONT))>0&&(this.LOOP_MARKER_BOX_WIDTH=s+6),this.setWaveformDiv(a),this.setOverviewDiv(o),!0},An.prototype.destroy=function(){this.audioOutput.stop(),clearInterval(this.interval),this.interval=null,this.ownsAudioContext&&null!=this.audioContext&&(this.audioContext.close(),this.audioContext=null),null!=this.waveformDiv&&null!=this.waveformCanvas&&this.waveformDiv.removeChild(this.waveformCanvas),null!=this.overviewDiv&&null!=this.overviewCanvas&&this.overviewDiv.removeChild(this.overviewCanvas)},An.prototype.getPixelHeightFromFontString=function(e){var t=e.search("px");if(t>0){var n=e.substring(Math.max(0,t-2),t),o=parseInt(n,10);if(o>0&&o<100)return o}return-1},An.prototype.addEventListener=function(e,t){this.events.hasOwnProperty(e)?this.events[e].push(t):this.events[e]=[t]},An.prototype.removeEventListener=function(e,t){if(this.events.hasOwnProperty(e)){var n=this.events[e].indexOf(t);-1!=n&&this.events[e].splice(n,1)}},An.prototype.fireEvent=function(e,t){if(this.events.hasOwnProperty(e)){t&&t.length||(t=[]);for(var n=this.events[e],o=n.length,a=0;a<o;a++)n[a].apply(null,t)}},An.prototype.estimateCPULoad=function(e){var t,n=!1;if(null==e&&(e=Pn(),n=!0),null==e)return-1;var o=e.sampleRate/this.DSFACTOR,a=new $n;a.init(this.LOG2LEN);var i=new Float64Array(this.FRAME_LEN),r=new Float64Array(this.FRAME_LEN),s=[i,r];for(t=0;t<this.FRAME_LEN;t++){var c=2*Math.random()-1;i[t]=r[t]=c}var l=[new Float64Array(this.STEP_LEN),new Float64Array(this.STEP_LEN)],u=new Date;for(t=0;t<100;t++)a.process(s,l,!1);var d=((new Date).getTime()-u.getTime())/1e3/(100*this.STEP_LEN/o);return n&&e.close(),d},An.prototype.play=function(){0!=this.audioLen&&this.setPlayState(this.PLAY_STATE_PLAYING)},An.prototype.pause=function(e){this.playState==this.PLAY_STATE_PLAYING&&(this.setPlayState(this.PLAY_STATE_STOPPED),e&&this.audioOutput.stop())},An.prototype.paused=function(){return this.playState==this.PLAY_STATE_STOPPED},An.prototype.seeking=function(){return this.playState==this.PLAY_STATE_REWIND||this.playState==this.PLAY_STATE_FASTFWD},An.prototype.resetPlayer=function(){this.httpRequest&&this.httpRequest.abort(),this.setPlayState(this.PLAY_STATE_STOPPED),this.setPlaybackRate(1),this.setCurrentTime(0),this.setPitchShift(0),this.setLoop(!1),this.setLoopStart(0),this.setLoopEnd(0),this.setBalance(0),this.audioBuffer=null,this.audioLen=0,this.overviewData=null,this.computeOverview(),this.updateOverview(),this.waveformData=null,this.clearWaveformPanelCache(),this.drawWaveform()},An.prototype.setSrc=function(e){if(this.resetPlayer(),null!=e){this.downloadProgress=0,this.httpRequest=new XMLHttpRequest,this.httpRequest.open("GET",e,!0),this.httpRequest.responseType="arraybuffer",this.fireEvent(this.EVENT_TIMEUPDATE,null),this.fireEvent(this.EVENT_PROGRESS,null);var t=this;this.httpRequest.onerror=function(e){t.fireEvent(this.EVENT_PROGRESS,null)},this.httpRequest.onprogress=function(e){var n=e.total>0?e.loaded/e.total:0;n=Math.min(n,1),t.downloadProgress=n,t.onDownloadProgress&&t.onDownloadProgress(n),t.fireEvent(this.EVENT_PROGRESS,null)},this.httpRequest.onload=function(){this.downloadProgress=1,t.onDownloadComplete&&t.onDownloadComplete(),t.audioOutput.context.decodeAudioData(t.httpRequest.response,function(e){t.decodeSuccessCallback(e)},function(){t.fireEvent(this.EVENT_ERROR,null)})},this.httpRequest.send()}},An.prototype.setAudioBuffer=function(e){this.resetPlayer(),this.decodeSuccessCallback(e)},An.prototype.getProgress=function(){return this.downloadProgress},An.prototype.setPlayState=function(e){if(0!=this.audioLen&&e!=this.playState){switch(this.playState=e,this.playState){case this.PLAY_STATE_PLAYING:0!=this.playbackRate&&(this.currentRate=this.playbackRate);break;case this.PLAY_STATE_STOPPED:this.currentRate=0;break;case this.PLAY_STATE_FASTFWD:this.currentRate=Math.max(this.currentRate,this.MIN_FAST_SPEED);break;case this.PLAY_STATE_REWIND:this.currentRate=Math.min(this.currentRate,-this.MIN_FAST_SPEED)}this.audioOutput.start(),this.playStateChanged=!0}},An.prototype.decodeSuccessCallback=function(e){this.httpRequest=null,this.audioBuffer=e,this.audioLen=e.length;var t=this.DSFACTOR;if(1!=t){for(var n=this.audioOutput.getAudioContext(),o=Math.floor(this.audioLen/t),a=n.createBuffer(this.NUM_CHANNELS,o,this.sampleRate),i=0;i<this.NUM_CHANNELS;i++)for(var r=e.getChannelData(i),s=0,c=a.getChannelData(i),l=0;l<o;l++){for(var u=0,d=0;d<t;d++)u+=r[s++];c[l]=u/t}this.audioBuffer=a,this.audioLen=o}this.setLoopStart(0),this.setLoopEnd(this.audioBuffer.duration),this.setLoop(!1),this.clearWaveformPanelCache(),this.computeWaveformData(),this.drawWaveform(),this.computeOverview(),this.updateOverview(),this.fireEvent(this.EVENT_CANPLAY,null)},An.prototype.getVersion=function(){return"2016-11-15 15:14"},An.prototype.getAudioContext=function(){return this.audioOutput.getAudioContext()},An.prototype.back=function(e){if(0!=this.audioLen)if(this.backButtonDown=e,e){var t=this;this.longPressTimer=setTimeout(function(){t.beginSeekBack()},this.MIN_PRESS_DUR)}else this.seeking()?this.endSeek():this.jumpBack(),clearTimeout(this.longPressTimer)},An.prototype.forward=function(e){if(0!=this.audioLen)if(this.forwardButtonDown=e,e){var t=this;this.longPressTimer=setTimeout(function(){t.beginSeekForward()},this.MIN_PRESS_DUR)}else this.seeking()?this.endSeek():this.jumpForward(),this.forwardButtonDown=!1,clearTimeout(this.longPressTimer)},An.prototype.beginSeekBack=function(){this.prevPlayState=this.playState,this.setPlayState(this.PLAY_STATE_REWIND)},An.prototype.jumpBack=function(){var e=Math.max(0,this.playPos-this.MAX_JUMP_SECS*this.sampleRate);this.playPos=e,this.playPosChanged=!0},An.prototype.beginSeekForward=function(){this.prevPlayState=this.playState,this.setPlayState(this.PLAY_STATE_FASTFWD)},An.prototype.jumpForward=function(){this.playPos=Math.min(this.audioLen,this.playPos+this.MAX_JUMP_SECS*this.sampleRate),this.playPosChanged=!0},An.prototype.endSeek=function(){this.setPlayState(this.prevPlayState),this.fireEvent(this.EVENT_SEEKED,null)},An.prototype.setLoop=function(e){0!=this.audioLen&&(this.loopEnabled=e,this.drawWaveform())},An.prototype.getLoop=function(){if(0!=this.audioLen)return this.loopEnabled},An.prototype.setLoopStart=function(e){0!=this.audioLen&&(null==e&&(e=this.getCurrentTime()),this.loopStartPos=Math.floor(this.sampleRate*e),this.loopStartPos=Math.max(this.loopStartPos,0),this.loopStartPos=Math.min(this.loopStartPos,this.audioLen),this.loopEndPos<=this.loopStartPos&&(this.loopEndPos=this.audioLen))},An.prototype.getLoopStart=function(){return this.sampleRate?this.loopStartPos/this.sampleRate:0},An.prototype.setLoopEnd=function(e){0!=this.audioLen&&(null==e&&(e=this.getCurrentTime()),this.loopEndPos=Math.ceil(this.sampleRate*e),this.loopEndPos=Math.max(this.loopEndPos,0),this.loopEndPos=Math.min(this.loopEndPos,this.audioLen),this.loopEndPos<=this.loopStartPos&&(this.loopStartPos=0))},An.prototype.getLoopEnd=function(){return this.sampleRate?this.loopEndPos/this.sampleRate:0},An.prototype.setPitchShift=function(e){return e=Math.max(e,this.MIN_PITCH_SHIFT),e=Math.min(e,this.MAX_PITCH_SHIFT),this.pitchShift=e,this.pitchShift},An.prototype.getPitchShift=function(){return this.pitchShift},An.prototype.setPlaybackRate=function(e){e=Math.max(e,this.MIN_PLAYBACK_RATE),e=Math.min(e,this.MAX_PLAYBACK_RATE),this.playbackRate=e,this.playState==this.PLAY_STATE_PLAYING&&(this.currentRate=this.playbackRate)},An.prototype.getPlaybackRate=function(){return this.playbackRate},An.prototype.setVolume=function(e){e=Math.max(e,0),(e=Math.min(e,1))!=this.volume&&(this.volume=e,this.fireEvent(this.EVENT_VOLUMECHANGE,null))},An.prototype.getVolume=function(){return this.volume},An.prototype.setBalance=function(e){this.balance=e,this.balance=Math.max(this.balance,-1),this.balance=Math.min(this.balance,1),this.balance=.01*Math.round(100*this.balance)},An.prototype.getBalance=function(){return this.balance},An.prototype.getDuration=function(){return this.sampleRate>0?this.audioLen/this.sampleRate:0},An.prototype.setCurrentTime=function(e){this.playPos=e*this.sampleRate,this.playPos=Math.max(this.playPos,0),this.playPos=Math.min(this.playPos,this.audioLen),this.playPosChanged=!0},An.prototype.getCurrentTime=function(){return this.sampleRate>0?this.playPos/this.sampleRate:0},An.prototype.getCurrentTimeAsString=function(){var e=this.getCurrentTime();return this.timeToString(e)},An.prototype.getRemainingTimeAsString=function(){var e=this.getDuration(),t=this.getCurrentTime(),n=Math.floor(e)-Math.floor(t);return this.timeToString(n)},An.prototype.getSourceFrame=function(){var e=0;if((this.playState!=this.PLAY_STATE_STOPPED||this.scrubbing||0!=this.currentRate)&&this.audioLen>0){var t,n,o=this.audioBuffer.getChannelData(0),a=this.audioBuffer.getChannelData(1);if(0==this.pitchShift){var i=Math.floor(this.playPos),r=Math.min(this.FRAME_LEN,this.audioLen-i);for(e=0;e<r;e++)this.srcBufL[e]=o[i],this.srcBufR[e]=a[i],i++}else{var s=Math.pow(2,this.pitchShift/this.SEMITONES_PER_OCTAVE),c=this.playPos;for(e=0;e<this.FRAME_LEN&&c<this.audioLen-1;e++){var l=Math.floor(c),u=l+1,d=c-l,p=1-d;this.srcBufL[e]=p*o[l]+d*o[u],this.srcBufR[e]=p*a[l]+d*a[u],c+=s}}for(;e<this.FRAME_LEN;)this.srcBufL[e]=this.srcBufR[e]=0,e++;if(this.balance<0)for(t=1-(n=Math.max(1+this.balance,0)),e=0;e<this.FRAME_LEN;e++)this.srcBufR[e]=t*this.srcBufL[e]+n*this.srcBufR[e];else if(this.balance>0)for(n=1-(t=Math.max(1-this.balance,0)),e=0;e<this.FRAME_LEN;e++)this.srcBufL[e]=t*this.srcBufL[e]+n*this.srcBufR[e];if(1!=this.volume||this.seeking()){var m=this.volume*(this.seeking()?this.FASTFWD_REWIND_GAIN:1);for(e=0;e<this.FRAME_LEN;e++)this.srcBufL[e]*=m,this.srcBufR[e]*=m}}else for(e=0;e<this.FRAME_LEN;e++)this.srcBufL[e]=this.srcBufR[e]=0},An.prototype.upsample=function(e,t,n,o,a){var i;if(1==a)for(i=0;i<t;i++)n[i]=e[i];else if(2==a){var r=0,s=o;for(i=0;i<this.STEP_LEN;i++){var c=e[i];n[r++]=.5*(c+s),n[r++]=c,s=c}}},An.prototype.audioCallback=function(e){if(1==this.DSFACTOR)this.generateStep(e);else{var t=[this.stepBufL,this.stepBufR];this.generateStep(t);for(var n=0;n<this.NUM_CHANNELS;n++){var o=t[n];this.upsample(o,this.STEP_LEN,e[n],this.lastOut[n],this.DSFACTOR),this.lastOut[n]=o[this.STEP_LEN-1]}}},An.prototype.generateStep=function(e){if(this.debugText)var t=(new Date).getTime();this.updatePlayRate(),this.getSourceFrame(),1==this.currentRate&&0==this.pitchShift?this.useOriginalPhase||(this.origCount++,this.origCount>this.NUM_FRAMES_BEFORE_LOCK&&(this.useOriginalPhase=!0)):this.useOriginalPhase&&(this.origCount=0,this.useOriginalPhase=!1);var n=[this.srcBufL,this.srcBufR];if(this.vocoder.process(n,e,this.useOriginalPhase),this.updatePlayPosition(),this.playState!=this.PLAY_STATE_STOPPED||0!=this.currentRate||this.scrubbing?this.stopCount=0:(this.stopCount++,this.stopCount>=this.STEPS_PER_FRAME&&(this.audioOutput.stop(),this.vocoder.clear(),this.useOriginalPhase=!0)),this.debugText){var o=(new Date).getTime()-t;if(this.sumElapsed=this.sumElapsed+o,this.genCount%100==0){var a=this.sumElapsed/100,i=100*a/(1e3*this.STEP_LEN/this.sampleRate);this.debugText.innerHTML="ChunkCnt:"+this.genCount+",  ms/step:"+a.toFixed(2)+", Load:"+i.toFixed(2)+"%",this.sumElapsed=0}this.genCount++}},An.prototype.updatePlayRate=function(){if(0!=this.audioLen){if(this.scrubbing){var e=Math.exp(-Number(this.STEP_LEN)/this.sampleRate/.07),t=e*this.playPos+(1-e)*this.targetPlayPos;this.currentRate=(t-this.playPos)/this.STEP_LEN}else{var n=0,o=3;this.playState==this.PLAY_STATE_REWIND||this.playState==this.PLAY_STATE_FASTFWD?(n=(this.playState==this.PLAY_STATE_REWIND?-1:1)*this.MAX_FAST_SPEED,o=5):this.playState==this.PLAY_STATE_STOPPED||0==this.playbackRate?Math.abs(this.currentRate)<2&&(o=1):this.playState==this.PLAY_STATE_PLAYING&&(n=this.playbackRate);var a=o*this.STEP_LEN/this.sampleRate;n>this.currentRate?this.currentRate=Math.min(this.currentRate+a,n):this.currentRate=Math.max(this.currentRate-a,n)}this.currentRate=Math.min(this.currentRate,this.MAX_FAST_SPEED),this.currentRate=Math.max(this.currentRate,-this.MAX_FAST_SPEED)}else this.currentRate=0},An.prototype.updatePlayPosition=function(){var e=this.audioLen;if(0!=this.audioLen){var t=this.playPos,n=t+this.currentRate*this.STEP_LEN,o=!0;Math.min(t,n)>this.loopEndPos&&(o=!1),Math.max(t,n)<this.loopStartPos&&(o=!1),o&&this.loopEnabled&&0==this.scrubbing&&this.playState==this.PLAY_STATE_PLAYING&&(n<this.loopStartPos||n>this.loopEndPos)&&(this.playbackRate>0?n=this.loopStartPos:this.playbackRate<0?n=this.loopEndPos:(n=Math.max(n,this.loopStartPos),n=Math.min(n,this.loopEndPos)),this.currentRate=this.playbackRate),n<0?(n=0,this.currentRate=0,0==this.scrubbing&&(this.playState==this.PLAY_STATE_REWIND||this.playState==this.PLAY_STATE_PLAYING&&this.playbackRate>=0||this.setPlayState(this.PLAY_STATE_STOPPED))):n>e&&(n=e,this.currentRate=0,0==this.scrubbing&&(this.playState==this.PLAY_STATE_FASTFWD||this.playState==this.PLAY_STATE_PLAYING&&this.playbackRate<=0||this.setPlayState(this.PLAY_STATE_STOPPED))),n!=t&&(this.playPosChanged=!0),this.playPos=n}else this.playPos=0},An.prototype.onTimer=function(){var e=this.syncCanvasToDivSize(this.waveformDiv,this.waveformCanvas);(this.playPosChanged||e.any)&&(e.height&&this.clearWaveformPanelCache(),this.drawWaveform()),e=this.syncCanvasToDivSize(this.overviewDiv,this.overviewCanvas),(this.playPosChanged||e.any||this.httpRequest)&&(e.any&&(this.overviewWaveformImage=null),this.updateOverview()),this.playStateChanged&&(this.fireEvent(this.EVENT_STATECHANGE,null),this.playState==this.PLAY_STATE_PLAYING?this.fireEvent(this.EVENT_PLAY,null):this.playState==this.PLAY_STATE_STOPPED?this.fireEvent(this.EVENT_PAUSE,null):this.playState!=this.PLAY_STATE_REWIND&&this.playState!=this.PLAY_STATE_FASTFWD||this.fireEvent(this.EVENT_SEEKING,null)),this.playPosChanged&&this.fireEvent(this.EVENT_TIMEUPDATE,null),this.playPosChanged=!1,this.playStateChanged=!1},An.prototype.syncCanvasToDivSize=function(e,t){var n=new Object;if(n.width=!1,n.height=!1,n.any=!1,null!=e&&null!=t){var o=e.getBoundingClientRect(),a=Math.ceil(o.width);t.width!=a&&(t.width=a,n.width=n.any=!0);var i=Math.ceil(o.height);t.height!=i&&(t.height=i,n.height=n.any=!0)}return n},An.prototype.initOffscreenCanvas=function(){null==this.offscreenCanvas&&(this.offscreenCanvas=document.createElement("canvas"))},An.prototype.setWaveformDiv=function(e){if(0!=e.length){if(this.waveformDiv=document.getElementById(e),null==this.waveformDiv)throw new Error("waveformDivName "+e+" not found");var t=document.createElement("canvas");t.style.backgroundColor=this.WAVEFORM_BACKGROUND_COLOR,this.syncCanvasToDivSize(this.waveformDiv,t),this.waveformDiv.appendChild(t),this.waveformCanvas=t,this.initOffscreenCanvas(),t.addEventListener("mousedown",this.waveformMouseDown.bind(this),!1),t.addEventListener("mousemove",this.waveformMouseMove.bind(this),!1),t.addEventListener("mouseup",this.waveformMouseUp.bind(this),!1),t.addEventListener("mouseleave",this.waveformMouseUp.bind(this),!1),t.addEventListener("touchstart",this.waveformTouchDown.bind(this),!1),t.addEventListener("touchmove",this.waveformTouchMove.bind(this),!0),t.addEventListener("touchend",this.waveformTouchUp.bind(this),!1),t.addEventListener("touchleave",this.waveformTouchUp.bind(this),!1),t.addEventListener("dragover",this.handleDragOver.bind(this),!1),t.addEventListener("drop",this.handleFileSelect.bind(this),!1),t.addEventListener("selectstart",function(){return!1}),t.onselectstart=function(){return!1},t.unselectable="on",t.style["-moz-user-select"]="none",t.style["-webkit-user-select"]="none",t.style["-webkit-touch-callout"]="none",t.style["-webkit-user-select"]="none",t.style["-khtml-user-select"]="none",t.style["-moz-user-select"]="none",t.style["-ms-user-select"]="none",t.style["user-select"]="none",t.style.outline="none",t.style["-webkit-tap-highlight-color"]="rgba(0,0,0,0)",this.clearWaveformPanelCache(),this.drawWaveform()}},An.prototype.waveformMouseDown=function(e){0!=this.audioLen&&(this.touchPosOnTouch=e.clientX,this.playPosOnTouch=this.playPos,this.targetPlayPos=this.playPos,this.scrubbing=!0,this.waveformMouseMove(e),this.audioOutput.start())},An.prototype.waveformMouseUp=function(e){0!=this.audioLen&&(this.waveformMouseMove(null),this.scrubbing=!1)},An.prototype.waveformMouseMove=function(e){if(0!=this.audioLen&&(this.waveformCanvas.getBoundingClientRect(),e&&this.scrubbing)){var t=e.clientX-this.touchPosOnTouch,n=this.sampleRate/this.PIXELS_PER_SEC;this.targetPlayPos=this.playPosOnTouch-t*n}},An.prototype.waveformTouchDown=function(e){e.preventDefault();var t=e.touches[0]||e.changedTouches[0];this.waveformMouseDown(t)},An.prototype.waveformTouchUp=function(e){e.preventDefault();var t=e.touches[0]||e.changedTouches[0];this.waveformMouseUp(t)},An.prototype.waveformTouchMove=function(e){e.preventDefault();var t=e.touches[0]||e.changedTouches[0];this.waveformMouseMove(t)},An.prototype.computeWaveformData=function(){if(this.waveformData=null,null!=this.waveformDiv&&null!=this.audioBuffer){var e=this.audioBuffer.getChannelData(0),t=this.audioBuffer.getChannelData(1),n=this.audioLen,o=(this.sampleRate,Math.ceil(this.PIXELS_PER_SEC*n/this.sampleRate));this.waveformData=new Array(o);for(var a=Math.floor(this.sampleRate/this.PIXELS_PER_SEC),i=0,r=0,s=0,c=0;c<n&&r<o;c++)c==a&&(this.waveformData[r]=i,s=Math.max(s,i),r++,a=Math.floor((r+1)*this.sampleRate/this.PIXELS_PER_SEC),i=0),i=Math.max(i,Math.abs(e[c])),i=Math.max(i,Math.abs(t[c]));if(s>0){var l=1/s;for(c=0;c<o;c++)this.waveformData[c]*=l}}},An.prototype.getMinWaveformCacheLen=function(){return Math.ceil(this.waveformCanvas.width/this.PIXELS_PER_PANEL)+1},An.prototype.clearWaveformPanelCache=function(){this.panelCacheLen=0,this.waveformPanelCache=null,this.waveformPanelIDs=null},An.prototype.drawWaveform=function(){if(null!=this.waveformDiv){var e,t=this.waveformCanvas,n=t.width,o=t.height,a=t.getContext("2d"),i=this.getMinWaveformCacheLen();this.panelCacheLen<i&&(this.panelCacheLen=i+5,this.waveformPanelCache=new Array(this.panelCacheLen),this.waveformPanelIDs=new Array(this.panelCacheLen));for(var r=Math.floor(this.PIXELS_PER_SEC*this.playPos/this.sampleRate)-Math.floor(n/2),s=Math.floor(r/this.PIXELS_PER_PANEL),c=s*this.PIXELS_PER_PANEL-r;c<n;){var l=this.getWaveformPanelImage(s);a.putImageData(l,c,0),s++,c+=this.PIXELS_PER_PANEL}if(this.loopEnabled){e=Math.floor(this.PIXELS_PER_SEC*this.loopStartPos/this.sampleRate)-r+this.LOOP_MARKER_LINE_WIDTH/2;var u=Math.floor(o/2);a.fillStyle=this.WAVEFORM_BACKGROUND_COLOR,a.fillRect(e-this.LOOP_MARKER_BOX_WIDTH,u-this.LOOP_MARKER_BOX_WIDTH/2,this.LOOP_MARKER_BOX_WIDTH,this.LOOP_MARKER_BOX_WIDTH),a.strokeStyle=this.LOOP_MARKER_COLOR,a.lineWidth=this.LOOP_MARKER_LINE_WIDTH,a.strokeRect(e-this.LOOP_MARKER_BOX_WIDTH,u-this.LOOP_MARKER_BOX_WIDTH/2,this.LOOP_MARKER_BOX_WIDTH,this.LOOP_MARKER_BOX_WIDTH),a.fillStyle=this.LOOP_LABEL_COLOR,a.textAlign="center",a.textBaseline="middle",a.font=this.LOOP_LABEL_FONT,a.fillText("A",e-this.LOOP_MARKER_BOX_WIDTH/2,u),a.strokeStyle=this.LOOP_MARKER_COLOR,a.lineWidth=this.LOOP_MARKER_LINE_WIDTH,a.beginPath(),a.moveTo(e,0),a.lineTo(e,o),a.stroke();var d=Math.floor(this.PIXELS_PER_SEC*this.loopEndPos/this.sampleRate)-r;e=d+this.LOOP_MARKER_LINE_WIDTH/2,a.fillStyle=this.WAVEFORM_BACKGROUND_COLOR,a.fillRect(e,u-this.LOOP_MARKER_BOX_WIDTH/2,this.LOOP_MARKER_BOX_WIDTH,this.LOOP_MARKER_BOX_WIDTH),a.strokeStyle=this.LOOP_MARKER_COLOR,a.lineWidth=this.LOOP_MARKER_LINE_WIDTH,a.strokeRect(e,u-this.LOOP_MARKER_BOX_WIDTH/2,this.LOOP_MARKER_BOX_WIDTH,this.LOOP_MARKER_BOX_WIDTH),a.fillStyle=this.LOOP_LABEL_COLOR,a.textAlign="center",a.textBaseline="middle",a.font=this.LOOP_LABEL_FONT,a.fillText("B",e+this.LOOP_MARKER_BOX_WIDTH/2,u),e=d+this.WAVEFORM_PLAYHEAD_WIDTH/2,a.beginPath(),a.moveTo(e,0),a.lineTo(e,o),a.stroke()}var p=this.timeToString(this.playPos/this.sampleRate);e=Math.floor(n/2)+this.WAVEFORM_PLAYHEAD_WIDTH/2,a.fillStyle=this.TIME_LABEL_COLOR,a.textAlign="center",a.textBaseline="top",a.font=this.TIME_LABEL_FONT,a.fillText(p,e,this.TIME_LABEL_TOP_PADDING),a.strokeStyle=this.WAVEFORM_PLAYHEAD_COLOR,a.lineWidth=this.WAVEFORM_PLAYHEAD_WIDTH,a.beginPath(),a.moveTo(e,this.TIME_LABEL_HEIGHT+this.TIME_LABEL_TOP_PADDING),a.lineTo(e,o),a.stroke()}},An.prototype.timeToString=function(e){var t=Math.floor(e),n=Math.floor(t/60);t-=60*n;for(var o=n.toString();o.length<2;)o="0"+o;for(var a=t.toString();a.length<2;)a="0"+a;return o+":"+a},An.prototype.getWaveformPanelImage=function(e){var t=(e+this.panelCacheLen)%this.panelCacheLen;if(this.waveformPanelIDs[t]!=e){var n=this.drawWaveformPanelImage(e);this.waveformPanelIDs[t]=e,this.waveformPanelCache[t]=n}return this.waveformPanelCache[t]},An.prototype.drawWaveformPanelImage=function(e){var t=this.offscreenCanvas;t.width=this.PIXELS_PER_PANEL,t.height=this.waveformCanvas.height;var n,o=t.width,a=t.height,i=Math.floor(a/2),r=this.WAVEFORM_HEIGHT_FRAC*Math.floor(a/2);if((n=t.getContext("2d")).globalAlpha=1,(n=t.getContext("2d")).fillStyle=this.WAVEFORM_BACKGROUND_COLOR,n.fillRect(0,0,o,a),this.waveformData)for(var s=this.waveformData.length,c=e*this.PIXELS_PER_PANEL,l=0;l<o;l++){if(c>=0&&c<s){var u=this.waveformData[c],d=Math.ceil(u*r),p=i-d,m=i+d;if(n.strokeStyle=this.WAVEFORM_WAVE_COLOR,n.lineWidth=1,n.beginPath(),n.moveTo(l+.5,p),n.lineTo(l+.5,m),n.stroke(),c%this.PIXELS_PER_SEC==0){n.strokeStyle=this.TICK_MARK_COLOR,n.lineWidth=this.TICK_LINE_WIDTH;var f=l+this.TICK_LINE_WIDTH/2;n.beginPath(),n.moveTo(f,0),n.lineTo(f,this.TICK_LEN),n.stroke(),n.beginPath(),n.moveTo(f,a-this.TICK_LEN),n.lineTo(f,a),n.stroke()}}c++}n.strokeStyle=this.TICK_MARK_COLOR,n.lineWidth=this.TICK_LINE_WIDTH,n.beginPath();var h=this.TICK_LINE_WIDTH/2;n.moveTo(0,h),n.lineTo(o,h),n.stroke(),n.beginPath(),h=Math.floor(a)-this.TICK_LINE_WIDTH/2-1,n.moveTo(0,h),n.lineTo(o,h),n.stroke(),n.strokeStyle=this.WAVEFORM_MIDLINE_COLOR,n.lineWidth=this.WAVEFORM_MIDLINE_WIDTH;var g=i+this.WAVEFORM_MIDLINE_WIDTH/2;return n.beginPath(),n.moveTo(0,g),n.lineTo(o,g),n.stroke(),n.getImageData(0,0,o,a)},An.prototype.setOverviewDiv=function(e){if(0!=e.length){if(this.overviewDiv=document.getElementById(e),null==this.overviewDiv)throw new Error("overviewDivName "+e+" not found");var t=document.createElement("canvas");t.style.backgroundColor=this.OVERVIEW_BACKGROUND_COLOR,this.syncCanvasToDivSize(this.overviewDiv,t),this.overviewDiv.appendChild(t),this.overviewCanvas=t,this.initOffscreenCanvas(),t.addEventListener("mousedown",this.overviewMouseDown.bind(this),!1),t.addEventListener("mousemove",this.overviewMouseMove.bind(this),!1),t.addEventListener("mouseup",this.overviewMouseUp.bind(this),!1),t.addEventListener("mouseleave",this.overviewMouseUp.bind(this),!1),t.addEventListener("touchstart",this.overviewTouchDown.bind(this),!1),t.addEventListener("touchmove",this.overviewTouchMove.bind(this),!0),t.addEventListener("touchend",this.overviewTouchUp.bind(this),!1),t.addEventListener("touchleave",this.overviewTouchUp.bind(this),!1),document.body.addEventListener("mouseup",this.overviewMouseUp.bind(this),!1),document.body.addEventListener("touchcancel",this.overviewTouchUp.bind(this),!1),t.addEventListener("dragover",this.handleDragOver.bind(this),!1),t.addEventListener("drop",this.handleFileSelect.bind(this),!1),t.addEventListener("selectstart",function(){return!1}),t.onselectstart=function(){return!1},t.unselectable="on",t.style["-moz-user-select"]="none",t.style["-webkit-user-select"]="none",t.style["-webkit-touch-callout"]="none",t.style["-webkit-user-select"]="none",t.style["-khtml-user-select"]="none",t.style["-moz-user-select"]="none",t.style["-ms-user-select"]="none",t.style["user-select"]="none",t.style.outline="none",t.style["-webkit-tap-highlight-color"]="rgba(0,0,0,0)",this.updateOverview()}},An.prototype.overviewMouseDown=function(e){this.overviewMouseIsDown=!0,this.overviewMouseMove(e)},An.prototype.overviewMouseUp=function(e){this.overviewMouseIsDown=!1,this.overviewMouseMove(null)},An.prototype.overviewMouseMove=function(e){if(null!=this.overviewDiv){var t=this.overviewCanvas.getBoundingClientRect();if(e&&(this.overviewX=e.clientX-t.left),this.getDuration()>0&&this.overviewMouseIsDown){var n=this.overviewX-this.OVERVIEW_TOUCH_MARGIN,o=t.width-2*this.OVERVIEW_TOUCH_MARGIN;if(o>0){var a=n/o;a=Math.max(a,0),a=Math.min(a,1),this.setCurrentTime(a*this.getDuration()),this.playState==this.PLAY_STATE_PLAYING?this.currentRate=this.playbackRate:this.currentRate=0}}}},An.prototype.overviewTouchDown=function(e){this.overviewMouseIsDown=!0,this.overviewMouseMove(e.touches.item(0))},An.prototype.overviewTouchUp=function(e){this.mouseUp(e)},An.prototype.overviewTouchMove=function(e){e.preventDefault();var t=e.touches[0]||e.changedTouches[0];this.overviewMouseMove(t)},An.prototype.mouseUp=function(e){e.preventDefault(),this.overviewMouseUp(null),this.waveformMouseUp(null)},An.prototype.touchUp=function(e){this.mouseUp(e)},An.prototype.computeOverview=function(){if(this.overviewData=null,this.overviewWaveformImage=null,null!=this.overviewDiv&&null!=this.audioBuffer){var e=this.audioBuffer.getChannelData(0),t=this.audioBuffer.getChannelData(1),n=this.audioLen,o=Math.floor(Math.max(screen.width,screen.height));this.overviewData=new Array(o);for(var a=Math.floor(n/o),i=0,r=0,s=0,c=0;c<n&&s<o;c++)c==a&&(this.overviewData[s]=i,r=Math.max(r,i),s++,a=Math.floor((s+1)*n/o),i=0),i=Math.max(i,Math.abs(e[c])),i=Math.max(i,Math.abs(t[c]));if(r>0){var l=1/r;for(c=0;c<o;c++)this.overviewData[c]*=l}}},An.prototype.updateOverview=function(){if(null!=this.overviewDiv){var e=this.overviewCanvas,t=e.getContext("2d"),n=e.width,o=e.height,a=Math.floor(o/2);if(null==this.overviewWaveformImage&&this.drawOverviewWaveformImage(),t.putImageData(this.overviewWaveformImage,0,0),this.httpRequest){t.strokeStyle=this.OVERVIEW_WAVE_COLOR,t.lineWidth=Math.floor(this.OVERVIEW_PROG_BAR_WIDTH*o),t.beginPath(),t.moveTo(0,a);var i=Math.floor(this.downloadProgress*n);t.lineTo(i,a),t.stroke()}t.strokeStyle=this.OVERVIEW_MIDLINE_COLOR,t.lineWidth=this.OVERVIEW_MIDLINE_WIDTH,t.beginPath();var r=a+this.OVERVIEW_MIDLINE_WIDTH/2;if(t.moveTo(0,r),t.lineTo(n,r),t.stroke(),this.overviewData){t.strokeStyle=this.OVERVIEW_PLAYHEAD_COLOR,t.lineWidth=this.OVERVIEW_PLAYHEAD_WIDTH;var s=this.overviewCanvas.width-2*this.OVERVIEW_DRAW_MARGIN,c=this.OVERVIEW_DRAW_MARGIN+Math.floor(s*this.playPos/this.audioLen)-this.OVERVIEW_PLAYHEAD_WIDTH/2;t.beginPath(),t.moveTo(c,0),t.lineTo(c,o),t.stroke()}}},An.prototype.drawOverviewWaveformImage=function(){var e=this.offscreenCanvas;this.syncCanvasToDivSize(this.overviewDiv,e);var t=e.width,n=e.height,o=Math.floor(n/2),a=this.OVERVIEW_HEIGHT_FRAC*o,i=e.getContext("2d");if(i.fillStyle=this.OVERVIEW_BACKGROUND_COLOR,i.fillRect(0,0,t,n),this.overviewData){var r=this.overviewData.length,s=this.overviewCanvas.width-2*this.OVERVIEW_DRAW_MARGIN,c=r/s;i.strokeStyle=this.OVERVIEW_WAVE_COLOR,i.lineWidth=1;for(var l=0,u=0;u<s;u++){for(var d=Math.floor(u*c),p=0;l<=d;)p=Math.max(p,this.overviewData[l]),l++;var m=Math.round(p*a),f=o-m,h=o+m;i.beginPath(),i.moveTo(u+.5+this.OVERVIEW_DRAW_MARGIN,f),i.lineTo(u+.5+this.OVERVIEW_DRAW_MARGIN,h),i.stroke()}}this.overviewWaveformImage=i.getImageData(0,0,t,n)},An.prototype.handleFileSelect=function(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;if(null!=t&&0!=t.length){this.resetPlayer();var n=this,o=new FileReader;o.onerror=function(e){},o.onloadend=function(e){n.audioOutput.context.decodeAudioData(e.target.result,function(e){n.decodeSuccessCallback(e)},function(){n.fireEvent(this.EVENT_ERROR,null)})},o.readAsArrayBuffer(t[0])}},An.prototype.handleDragOver=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},An.prototype.init=An.prototype.init,An.prototype.destroy=An.prototype.destroy,An.prototype.estimateCPULoad=An.prototype.estimateCPULoad,An.prototype.addEventListener=An.prototype.addEventListener,An.prototype.removeEventListener=An.prototype.removeEventListener,An.prototype.play=An.prototype.play,An.prototype.pause=An.prototype.pause,An.prototype.paused=An.prototype.paused,An.prototype.seeking=An.prototype.seeking,An.prototype.setSrc=An.prototype.setSrc,An.prototype.setAudioBuffer=An.prototype.setAudioBuffer,An.prototype.getVersion=An.prototype.getVersion,An.prototype.getAudioContext=An.prototype.getAudioContext,An.prototype.back=An.prototype.back,An.prototype.forward=An.prototype.forward,An.prototype.setLoop=An.prototype.setLoop,An.prototype.getLoop=An.prototype.getLoop,An.prototype.setLoopStart=An.prototype.setLoopStart,An.prototype.getLoopStart=An.prototype.getLoopStart,An.prototype.setLoopEnd=An.prototype.setLoopEnd,An.prototype.getLoopEnd=An.prototype.getLoopEnd,An.prototype.setPitchShift=An.prototype.setPitchShift,An.prototype.getPitchShift=An.prototype.getPitchShift,An.prototype.setPlaybackRate=An.prototype.setPlaybackRate,An.prototype.getPlaybackRate=An.prototype.getPlaybackRate,An.prototype.setVolume=An.prototype.setVolume,An.prototype.getVolume=An.prototype.getVolume,An.prototype.setBalance=An.prototype.setBalance,An.prototype.getBalance=An.prototype.getBalance,An.prototype.getProgress=An.prototype.getProgress,An.prototype.getDuration=An.prototype.getDuration,An.prototype.setCurrentTime=An.prototype.setCurrentTime,An.prototype.getCurrentTime=An.prototype.getCurrentTime,An.prototype.getCurrentTimeAsString=An.prototype.getCurrentTimeAsString,An.prototype.getRemainingTimeAsString=An.prototype.getRemainingTimeAsString,angular.module("bandlab.editor").factory("AudioStretch",["$q","$window","AppNotifications","AudioCtx","CrossOriginWorker","EditorHelper","EditorHistory","EditorLoader","EditorRevision","editorSettings","Loop","MidiEditor","Modal","Sample",function(e,t,n,o,a,i,r,s,c,l,u,d,p,m){return{clampPlaybackRate:f,convertAudioBuffer:h,convertLoop:function(e,t,n){var a=n||!e.bpm?1:f(c.current.metronome.bpm/e.bpm),i=0;return e.key&&t.key&&(i=d.transposeKeys(e.key,t.key)),m.getBuffer(u.getSrc(e)).then(o.decodeAudioData).then(function(e){return h(e,a,i)})},convertRegion:g,convertRevision:function(t,n){var o=d.transposeKeys(t.key,n);return e.all(_.chain(t.tracks).map(function(e){return e.regions=_.filter(e.regions,function(e){return e.endPosition-e.startPosition>=l.REGION_DURATION_MIN}),e}).map("regions").flatten().filter(i.isAudioRegion).forEach(function(e){e.pitchShift=(e.pitchShift+o+12)%12,e.pitchShift>6&&(e.pitchShift=e.pitchShift-12)}).map(g).value())},preview:function(e){var t=new An,a=e.playbackRate,i=e.pitchShift,u=e.playbackRate,d=e.pitchShift,m=(e.endPosition-e.startPosition)/l.REGION_DURATION_MIN,h={playbackRate:Math.abs(e.playbackRate),pitchShift:e.pitchShift},b={player:t,region:e,regionCopy:h,reset:function(){b.setPlaybackRate(1),b.setPitchShift(0)},adjustPlaybackRate:function(e,n){h.playbackRate=u+.01*n,h.playbackRate=f(h.playbackRate,m),t.setPlaybackRate(h.playbackRate)},adjustPitchShift:function(e,n){h.pitchShift=d+.01*n,h.pitchShift=Math.min(Math.max(h.pitchShift,-12),12),t.setPitchShift(h.pitchShift)},startAdjusting:function(){u=h.playbackRate,d=h.pitchShift},setPlaybackRate:function(e,n){n&&(e=parseFloat(e.toFixed(2)),e=n>0?5*Math.ceil(100*h.playbackRate/5+.51*n)/100:5*Math.floor(100*h.playbackRate/5+.51*n)/100),h.playbackRate=f(e,m),t.setPlaybackRate(h.playbackRate)},setPitchShift:function(e,n){n&&(e=parseFloat(e.toFixed(2)),e=n>0?Math.floor(h.pitchShift)+n:Math.ceil(h.pitchShift)+n),h.pitchShift=Math.min(Math.max(e,-12),12),t.setPitchShift(h.pitchShift)}};new p({templateUrl:"https://www.bandlab.com/web-app/editor/partials/_audiostretch-preview-c320525a.html",contentScope:b,onCreate:function(){setTimeout(function(){var n=e.drySampleId||e.sampleId,a=_.find(c.current.samples,{id:n});t.init({waveformDiv:"waveformDiv",overviewDiv:"overviewDiv",backgroundColor:"rgba(0, 0, 0, 0)",waveColor:"#7e8999",midlineColor:"#7e8999",playheadColor:"#dc3710",loopLabelFont:"20px 'Lucida Console', Monaco, monospace",loopMarkerColor:"#c1c1c1",loopLabelColor:"#c1c1c1",tickMarkColor:"#d3dce2",timeLabelColor:"#282c32",timeLabelFont:"14px 'Roboto Condensed', 'Lucida Console', Monaco, monospace"},o.get()),e.playbackRate<0?t.setAudioBuffer(v(a.buffer)):t.setAudioBuffer(a.buffer),t.setPlaybackRate(h.playbackRate),t.setPitchShift(h.pitchShift),t.estimateCPULoad()},100)},onConfirm:function(){if(Math.abs(a)!==h.playbackRate||i!==h.pitchShift){r.pushUndo(c.current);var t=s.pushTask("postProcessAudio"),o=Math.abs(a)/h.playbackRate;return e.playbackRate=h.playbackRate*Math.sign(a),e.pitchShift=h.pitchShift,g(e).then(function(){var t=(e.endPosition-e.startPosition)*o;e.sampleOffset*=o,e.loopLength*=o,e.endPosition=e.startPosition+t,e.endPosition>l.SONG_DURATION_MAX&&(e.endPosition=l.SONG_DURATION_MAX,e.loopLength=Math.min(e.loopLength,e.endPosition-e.startPosition),n.addNotification({title:"Track duration has been exceeded.",content:"Region has been truncated",autoclose:5e3}))}).finally(function(){s.finishTask(t)})}},onDestroy:function(){t.pause(),t.destroy()},overlayClose:!1}).show()}};function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return Math.min(Math.max(e,.1),Math.min(t,10))}function h(n,i,r){var s=new Cn;return s.init(o.get()),new a("https://www.bandlab.com/web-app/common/workers/AudioStretchWorker-082bf9e7d1.js").then(function(e){return s.convertAsync(n,Math.abs(i),r,e)}).then(function(e){return s.destroy(),i<0?v(e):e}).catch(function(n){return t.Raven.captureException(n&&(n.message||n.name),{extra:{colno:n&&n.colno,lineno:n&&n.lineno,message:n&&n.message}}),e.reject(n)})}function g(t){var n=t.drySampleId||t.sampleId,o=_.find(c.current.samples,{id:n}),a=Math.round(t.playbackRate);if(t.drySampleId||(t.drySampleId=n),!o||!o.buffer)return e.reject(new Error("Sample not found"));Math.abs(t.playbackRate-a)<1e-6&&(t.playbackRate=a);var i=_.find(c.current.samples,{drySampleId:n,playbackRate:t.playbackRate,pitchShift:t.pitchShift});return i?(t.sampleId=i.id,e.resolve()):h(o.buffer,t.playbackRate,t.pitchShift).then(function(e){var o={id:k(),buffer:e,drySampleId:n,playbackRate:t.playbackRate,pitchShift:t.pitchShift};c.current.samples.push(o),t.sampleId=o.id})}function v(e){for(var t=o.get().createBuffer(e.numberOfChannels,e.length,e.sampleRate),n=0;n<e.numberOfChannels;n++)t.copyToChannel(e.getChannelData(n),n,0),t.getChannelData(n).reverse();return t}}]),angular.module("bandlab.editor").factory("Editor",["$analytics","$http","$q","$rootScope","$state","$timeout","$window","AppNotifications","AudioStretch","ConfirmModal","EditorAllowActions","EditorData","EditorDB","editorEvents","EditorHelper","EditorHistory","EditorImporter","EditorLoader","EditorMidiSamples","EditorMidiScore","EditorPlayer","EditorRevision","EditorSocket","EditorState","EditorTimeline","EditorTrack","FileHelper","Katnip","Loop","Metronome","MetronomeState","MidiEditor","Modal","Page","Revision","RevisionImporter","Sample","Song","Soundbank",function(e,n,o,a,i,r,s,c,l,u,d,p,m,f,h,g,v,b,y,w,S,P,E,T,M,$,C,A,R,I,O,x,L,N,j,q,V,G,z){var W,K="locks"in navigator;return{init:function(t){var n,a,r,s=t.song.id&&b.pushTask("loadSample");return P.current=t,O.settings=t.metronome,(K?(n=P.current.id||"new",a=o.defer(),r=new Promise(function(e){P.releaseLock=function(){return e()}}),navigator.locks.request(n,{ifAvailable:!0},function(e){return e?a.resolve():a.reject({message:Q}),r}),a.promise).then(function(){var t=P.current.id||"new";if(m.checkSnapshotAvailability(t)){var n;if(!_.isEmpty(m.getSnapshot(P.current.id).revision))return n=o.defer(),new u({confirmLabel:"Some Work Will Be Lost",contentScope:{title:"Restore Snapshot",message:"<p>You have unsaved changes for this revision.<br>The latest snapshot can be restored.</p>"},onConfirm:function(){var t=function(){var e=m.getSnapshot(P.current.id);return e.revision.song=new G(e.revision.song),P.current=e.revision,T.hasRevisionChanges=!0,e}();e.eventTrack("Restore Snapshot",{category:"Mix Editor"}),n.resolve(t)},onCancel:function(){m.addSnapshot(P.current.id),e.eventTrack("Decline Snapshot",{category:"Mix Editor"}),n.resolve()}}).show(),n.promise;m.removeSnapshot(P.current.id)}else m.addSnapshot(P.current.id)}):o.resolve()).then(function(){return o.all([p.loadAllSamples(P.current),m.deleteAllUnusedFiles(),A,z.getList()])}).then(function(){var e=_.chain(P.current.tracks).map("regions").flatten().value();return o.resolve(_.chain(e).filter(function(e){return h.isAudioRegion(e)&&(1!==e.playbackRate||0!==e.pitchShift)}).reduce(function(e,t){return e.then(function(){return l.convertRegion(t)}).catch(angular.noop)},o.resolve()).value()).then(function(){return S.init(P.current)}).then(function(){return _.chain(e).filter(function(e){return h.isMidiRegion(e)&&0!==e.pitchShift}).groupBy("pitchShift").reduce(function(e,t,n){return e.then(function(){return x.transposeRegions(P.current,parseFloat(n),new Set(t))})},o.resolve()).value()})}).then(function(){if(i.params.remoteSample)return C.download(i.params.remoteSample).then(function(e){return v.importFile({file:e,time:0})}).catch(angular.noop)}).then(function(){P.current.tracks[0]&&$.setSelected(P.current.tracks[0])}).finally(function(){b.finishTask(s),T.isInBackground=!1,T.hasSoloTrack=p.checkAnySolo(),p.updateSongDuration(),R.init(),I.init()})},updateProjectName:function(e,t){if(e.song.name!==t)return e.song.id&&e.song.canEdit?(T.isSaving=!0,G.update({id:e.song.id,name:e.song.name}).$promise.then(function(){T.isSaving=!1,N.setMetadata({title:e.song.name}),N.update()})):(N.setMetadata({title:e.song.name}),void N.update())},startSave:function(n){var r=n.publish,s=void 0!==r&&r,l=n.upgrade,u=void 0===l||l,p=n.redirect,m=void 0===p||p;return!s&&!d.isAllowed("save")||s&&!d.isAllowed("publish")?o.reject({message:"Saving is unavailable."}):(e.eventTrack("Start Saving",{category:"Mix Editor",label:s?"Long Save":"Quick Save"}),(s?function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).isPublic;var e=T.hasRevisionChanges;return Y({masteringSetting:"auto",hasRevisionChanges:e}).then(function(e){return o(function(t,n){var o,a;a=_.cloneDeep(e.song),(o=new L({templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-new-9c344f39.html",contentScope:{editorState:T,revision:e,resolve:function(e){_.assignIn(P.current.song,e.song),t(e),o.destroy()}},onCancel:function(){e.song=a,n({message:D})}})).show()})}).then(function(t){return e?te(t):function(e,t){return T.isSaving=!0,e.song.id&&e.song.canEdit?G.update({id:e.song.id,name:e.song.name,isForkable:e.song.isForkable,pictureId:e.song.pictureId}).$promise.then(function(){return n()}):n();function n(){var t,n,o=e.masteringSetting;return"auto"===o?e.mastering={preset:"cdMaster"}:"manual"===o?(t=b.pushTask("masterTrack"),n=b.pushTask("loadMasterPreview")):e.mastering=null,new j({description:e.description,genres:e.genres,id:e.id,placeId:e.placeId}).$update().then(function(e){return"manual"===o?q.pollMixdown(e).then(function(){return q.masterRevision(e,t,n)}).catch(function(){return e}):e})}}(t)}).finally(function(){T.isPreSaving=!1,T.isSaving=!1})}():Y({masteringSetting:"off",hasRevisionChanges:!0}).then(te)).then(function(t){return e.eventTrack("End Saving",{category:"Mix Editor",label:s?"Long Save":"Quick Save"}),t}).catch(ne).then(function(e){return function(e){P.current.createdOn=e.createdOn,P.current.creator=e.creator,P.current.description=e.description,P.current.genres=e.genres,P.current.id=e.id,P.current.isFork=e.isFork,P.current.mixdown=e.mixdown,P.current.modifiedOn=e.modifiedOn,P.current.parentId=e.parentId,P.current.placeId=e.placeId,_.assign(P.current.song,_.omit(e.song,"name"))}(e),m&&i.is("mixEditor")?(function(e){var n={title:e.isPublic?"Revision published":"Revision saved",action:'<a ui-sref="'.concat("Band"===e.song.author.type?"bandSong":"userSong",'({\n               username: $parent.innerScope.revision.song.author.username,\n               slug: $parent.innerScope.revision.song.slug,\n               revId: $parent.innerScope.revision.id\n             })"\n             class="notification-actions-item"\n             analytics-on="click"\n             analytics-event="Go to Revision page"\n             analytics-category="Mix Editor"\n             analytics-label="Save success notification">\n            ').concat("View Revision",'\n          </a>\n          <div ng-show="$parent.innerScope.revision.isPublic" class="notification-actions-item">\n            <a dropdown-menu="https://www.bandlab.com/web-app/post/partials/_post-share-dropdown-menu-f4f1963d.html"\n               dropdown-menu-align="right"\n               dropdown-menu-container="parent"\n               dropdown-menu-parse="{ type: \'Revision\', object: $parent.innerScope.revision }"\n               analytics-on="click"\n               analytics-event="Open Share Modal"\n               analytics-category="Mix Editor"\n               analytics-label="Save success notification">\n              ').concat("Share","\n            </a>\n          </div>")};c.addNotification(function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?Rn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Rn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},n,{image:e.song.picture.xs,innerScope:{revision:e},autoclose:1e4,classList:"light project notification-actions"}))}(e),i.go(".",{id:e.id},{location:"replace",inherit:!1}).then(function(){return u&&T.canCollaborate&&(E.sendUpgrade(),T.canCollaborate=!0),a.$broadcast(f.saveCompleted),e})):e}))}};function Y(e){var t,a,i,r,s=e.masteringSetting,l=e.hasRevisionChanges,d=void 0!==l&&l;return o.resolve((a=P.current,i=_.chain(a.tracks).map(function(e){return e.regions}).flatten().some(function(e){return e.takes&&e.takes.length>1}).value(),r=o.defer(),i?(new u({contentScope:{title:"Warning",message:"<p>By saving, you will lose all unused takes made during cycle recording.</p>"},onConfirm:function(){r.resolve()},onCancel:function(){r.reject()}}).show(),r.promise):o.resolve())).then(function(){return W=JSON.stringify(P.current),function(e){var t=_.chain(e.tracks).filter(function(e){return e.canEdit}).filter(function(e){return!_.every(e.regions,function(t){return h.isRegionPlayable(t,e)})}).value(),n=o.defer();return t.length?(new u({confirmLabel:"Save Anyway",cancelLabel:"Move Regions",contentScope:{title:"Some Work Will Be Lost",message:'<p class="text-left">'.concat("We’ve found some regions that are incompatible with the track they are in (e.g. MIDI region in an audio track).\nIncompatible regions in the following tracks will be deleted if they are not moved before saving:",'</p><p><ul class="text-left">').concat(_.map(t,function(e){return"<li>".concat(e.name,"</li>")}).join(""),"</ul></p>")},onConfirm:function(){g.pushUndo(P.current),_.chain(e.tracks).filter(function(e){return e.canEdit}).forEach(function(e){e.regions=_.filter(e.regions,function(t){return h.isRegionPlayable(t,e)})}).value(),n.resolve()},onCancel:function(){n.reject(new Error(F))}}).show(),n.promise):o.resolve()}(P.current)}).then(function(){return t=_.cloneDeep(P.current),c.clearAll(),T.isPreSaving=!0,M.sanitize(t),d&&(t.description="",t.masteringSetting=s,t.placeId=null),o.all([(a=(new Date).getTime(),n.head("https://www.bandlab.com/api/v1.3/ping").catch(function(e){return e.status<=0?o.reject(new Error(B)):o.reject(e)}).finally(function(){ga("send","timing","Mix Editor","Pre-save Revision",(new Date).getTime()-a,"Ping")})),(e=t,o.when(p.getTracksDuration(e.tracks,!0)).then(function(e){return e>0?o.resolve(e):o.reject(new Error(H))})),!1]);var e,a}).then(function(){return t.song.id?G.get({id:t.song.id}).$promise.then(function(e){return e.name=t.song.name,e.description=t.song.description,t.song=e,t}):t}).finally(function(){T.isPreSaving=!1})}function X(e){return _.chain(e.tracks).map(function(e){return[e.regions,e.patterns]}).flatten().flatten().map(function(e){return[e.drySampleId,e.sampleId]}).flatten().compact().uniq().value()}function J(e){return _.chain(X(e)).filter(function(e){return y.has(e)&&!y.get(e).isSaved}).uniq().map(ee).value()}function ee(e){var t=y.get(e);return{blob:w.exportScoreToMid(t.id),id:t.id,score:t}}function te(t,n){var a,i,c,l,u,d=(new Date).getTime(),p=t.masteringSetting;return T.isSaving=!0,T.hasRevisionChanges=!1,"manual"===p?(c=b.pushTask("createMixdown"),u=b.pushTask("masterTrack"),l=b.pushTask("loadMasterPreview")):t.mastering="auto"===p?{preset:"cdMaster"}:null,t.post=t.post||{},t.post.state=t.availabilitySetting||"Private",delete t.availabilitySetting,t.sampleId=k(),s.Raven.captureBreadcrumb({message:"Save Revision: start",category:"editor.save"}),o.all(_.map(P.uploadingSamples,function(e){if(!e.$$timeoutId)return e;r.cancel(e)})).then(function(){return o.all([(e=t,n=X(e),m.getAll().then(function(e){return _.chain(e).concat(_.map(Array.from(P.sampleFiles),function(e){return e[1]})).uniqBy("sampleId").filter(function(e){return _.includes(n,e.sampleId)&&e.blob instanceof Blob}).map(function(e){return{id:e.sampleId,blob:e.blob}}).value()})),J(t),o.all(_.map(P.failedEncodingTasks,function(e){return e()}))]);var e,n}).then(function(e){var t;return e=_.flatten(e),a=(new Date).getTime(),s.Raven.captureBreadcrumb({message:"Save Revision: upload samples",category:"editor.save"}),t=_.chain(e).compact().map(function(e){return V.upload({blob:e.blob,buffer:e.buffer,sampleId:e.id,sampleType:"samples"}).then(function(){m.deleteFile(e.id),e.score&&(e.score.isSaved=!0)})}).value(),o.all(t)}).then(function(){return ga("send","timing","Mix Editor","Save Revision",(new Date).getTime()-a,"Upload Samples"),i=(new Date).getTime(),t.tracks.forEach(function(e){e.regions.forEach(function(e){e.sampleId=e.drySampleId||e.sampleId})}),s.Raven.captureBreadcrumb({message:"Save Revision: post revision",category:"editor.save"}),t.song.id&&t.song.canEdit?G.update({id:t.song.id,name:t.song.name,description:t.song.description,isForkable:!!T.isPracticeProject||t.song.isForkable,pictureId:t.song.pictureId}).$promise.then(function(){return j.save({revision:t}).$promise}):j.save({revision:t}).$promise}).then(function(n){return ga("send","timing","Mix Editor","Save Revision",(new Date).getTime()-i,"Post Revision"),t.id||e.eventTrack("Create Song",{category:"Mix Editor"}),m.removeSnapshot(t.id),m.addSnapshot(n.id),P.sampleFiles.clear(),b.finishTask(c),e.eventTrack("Create Revision",{category:"Mix Editor",label:"".concat(_.startCase(p)," mastering")}),ga("send","timing","Mix Editor","Save Revision",(new Date).getTime()-d,"All Steps"),"manual"===p?q.pollMixdown(n).then(function(){return q.masterRevision(n,u,l)}).catch(function(){return n}):n}).finally(function(){b.finishTask(c),b.finishTask(u),b.finishTask(l),P.uploadingSamples=[],T.isSaving=!1})}function ne(e){var t=e.message||e.statusText;switch(W=JSON.parse(W),_.forEach(P.current.tracks,function(e,t){e.regions=W.tracks[t].regions}),t){case B:m.addSnapshot(P.current.id,P.current),n("isOffline");break;case H:n("isEmpty");break;case D:case F:case"Unauthorized":break;default:!function(){var t=function(e){var t=_.get(e,"config.url",""),n=_.get(e,"status",0);switch(!0){case t.includes("/uploads/samples"):return{fingerprint:["sample","upload",n,e.xhrStatus],message:"Error ".concat(n," on upload sample")};case t.includes("/samples")&&t.includes("amazonaws.com"):return{fingerprint:["prelude-sample","upload",n,e.xhrStatus],message:"Error ".concat(n," on upload sample to prelude")};case t.includes("/ping"):return{fingerprint:["ping",n],message:"Error ".concat(n," on ping")};case t.includes("/revisions"):return{fingerprint:["save","revision",n],message:"Error ".concat(n," on save revision ").concat(_.get(e,"data.modelState[0]",""))};case t.includes("/songs"):return{fingerprint:["save","song",n],message:"Error ".concat(n," on save revision ").concat(_.get(e,"data.message",""))};default:return{fingerprint:["{{ default }}"],message:e&&(e.message||e.status||e.name)}}}(e),n=t.fingerprint,o=t.message;s.Raven.captureException(o,{extra:{error:e,original:W,sanitized:P.current},fingerprint:n,tags:{issue:"cannot-save-revision"}})}(),c.addNotification({title:Z,content:U,classList:"alert"})}return T.hasRevisionChanges=!0,b.flushQueue(),o.reject(e);function n(e){new L({templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-modal-075915a3.html",contentScope:{status:e},onDestroy:function(){T.isInBackground=!1}}).show()}}}]),angular.module("bandlab.editor").factory("EditorAllowActions",["AudioState","EditorRevision","editorSettings","EditorState","InputsCollection","MidiEditorState",function(e,t,n,o,a,i){var s=n.SCALES[0],c=n.SCALES[n.SCALES.length-1];return{isAllowed:function(n){switch(n){case"addTrack":case"editTrack":case"editRegion":return o.canCollaborate;case"armTrack":case"changeBPM":case"changeKey":case"changeTrackSoundbank":case"cycle":case"cycleSelect":case"historyMove":case"import":case"paste":case"play":return o.canCollaborate&&!o.isRecording;case"deleteTrack":return o.canCollaborate&&!o.isRecording&&t.current.tracks.length;case"analyze":case"effect":return!o.isPlaying;case"export":case"exportMixdown":return(o.canCollaborate||!o.hasRevisionChanges)&&!o.isSaving&&!o.isPreSaving&&!o.isRecording&&!o.isMixing&&o.songDuration&&!o.isPlaying;case"record":return o.canCollaborate&&(o.isRecording||!o.isPlaying||!o.isWaitingCountIn)&&t.current.tracks.length;case"publish":case"save":return o.canCollaborate&&o.hasRevisionChanges&&!o.isSaving&&!o.isPreSaving&&!o.isRecording&&!o.isMixing&&o.songDuration;case"movePlayHead":return!o.isRecording;case"toggleMetronome":return!o.isRecording||e.isMetronomeEnabled;case"changeInput":return!o.isRecording&&!o.isWaitingCountIn&&o.canCollaborate;case"midiRollZoomOut":return!o.isRecording&&i.scale>s;case"midiRollZoomIn":return!o.isRecording&&i.scale<c;case"zoomOut":return!o.isRecording&&o.scale>s;case"zoomIn":return!o.isRecording&&o.scale<c;case"analyseAudioInput":return a.getCurrent().input.kind===r;case"stopLiveSession":return!o.isSaving&&!o.isPreSaving;default:return!0}}}}]),angular.module("bandlab.editor").factory("EditorAutomation",["$q","AnimationFrame","audioSettings","EditorHelper","EditorHistory","EditorRevision","editorSettings","EditorState","Modal",function(e,t,n,o,a,i,r,s,c){var l=6;return{MARKER_AREA:l,checkConfirmation:function(t,n){return e(function(e,o){var s;_.some(n,function(e){return e.automation.pan.length||e.automation.volume.length})?!0===r.AUTOMATION[t]?e():!1===r.AUTOMATION[t]?o():(s=new c({templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-automation-modal-1c45fd39.html",contentScope:{action:_.startCase(t),doNothing:function(){o(),s.destroy()}},onCancel:function(){a.undo(i.current),o()},onConfirm:e})).show():o()})},convertToCoordinates:function(e,t,n){return _.map(e,function(e){return{posX:d(e.position),posY:u(e.value,t,n)}})},convertToValues:function(e,t,n){return _.map(e,function(e){return{position:m(e.posX),value:p(e.posY,t,n)}})},convertTimeToX:d,convertValueToY:u,convertXtoTime:m,convertYtoValue:p,deleteAutomationInRange:function(e,t,n){function o(e){return e.position>=t&&e.position<=n}_.remove(e.volume,o),_.remove(e.pan,o)},getMomentValue:function(e,t){return t.automation&&t.automation[e].length?function(e,t){var a,i,c=n.AUDIO_PARAMETERS[e],l=c.max-c.min,u=(a=t[e],(i=_.clone(a)).unshift({position:0,value:i[0].value}),i.push({position:r.SONG_DURATION_MAX,value:i[i.length-1].value}),i),d=_.findIndex(u,function(e){return e.position>0&&e.position<=r.SONG_DURATION_MAX&&e.position>=s.crTime}),p=_.clone(u[d-1]),m=_.clone(u[d]);return"log"===c.scale?(p.value=o.scaleLinToLog(p.value,l),m.value=o.scaleLinToLog(m.value,l),o.scaleLogToLin(f(p,m)*(s.crTime-p.position)+p.value,l)):f(p,m)*(s.crTime-p.position)+p.value;function f(e,t){return(t.value-e.value)/(t.position-e.position)}}(e,t.automation):t[e]},getAutomationInRange:function(e,t,n){return{pan:o(e.pan),volume:o(e.volume)};function o(e){return _.chain(e).filter(function(e){return e.position>=t&&e.position<=n}).map(function(e){return(e=_.clone(e)).position=e.position-t,e}).value()}},off:t.remove,on:t.add,pasteAutomation:function(e,t,n){function o(o){_.forEach(t[o],function(t){(t=_.clone(t)).position=t.position+n,e[o].push(t)}),e[o]=_.sortBy(e[o],"position")}o("pan"),o("volume")},syncVolume:t.start.bind(this,"syncVolume")};function u(e,t,n){var a=e-n.min,i=t-l,r=(t-2*l)*a/n.range;return"log"===n.scale?i-o.scaleLinToLog(r,t-2*l):i-r}function d(e){return e*s.scalePx}function p(e,t,n){var a=t-l,i=(a*n.max-e*n.range)/a;return"log"===n.scale?o.scaleLogToLin(i,n.range):i}function m(e){return e/s.scalePx}}]),angular.module("bandlab.editor").value("EditorClipboard",{value:null}),angular.module("bandlab.editor").factory("EditorCycle",["$rootScope","editorEvents","EditorState",function(e,t,n){var o,a,i;return{get:function(){return{startTime:a,endTime:i}},reschedule:function(){s(),r()},set:function(e,t){a=e,i=t},stop:s,toggle:function(){n.isCycling=!n.isCycling,s(),n.isCycling&&r()}};function r(){var a=i-n.crTime;if(a&&!(a<=0))return o=setTimeout(function(){n.isCycling&&n.isPlaying&&(e.$broadcast(t.endOfCycle),s(),o=r())},1e3*a)}function s(){clearTimeout(o)}}]),angular.module("bandlab.editor").factory("EditorData",["$q","$timeout","$window","AudioCtx","EditorCollaboratorsState","EditorDB","EditorLoader","EditorMidiSamples","EditorMidiScore","EditorRevision","editorSettings","EditorState","EffectsPreset","FileHelper","Sample",function(e,t,n,o,a,i,r,s,l,u,d,p,m,f,h){return{checkAnySolo:g,getRegions:function(){return _.chain(u.current.tracks).filter(function(e){return e.canEdit}).map("regions").flatten().value()},getRegionsDuration:function(t){var n=_.minBy(t,"startPosition"),o=_.maxBy(t,"endPosition").endPosition-n.startPosition,a=_.filter(t,function(e){return s.has(e.sampleId)}),i=_.map(a,function(e){return l.getMidiRegionDuration(e,u.current.metronome.bpm,(t=e.trackId,_.find(u.current.tracks,{id:t}).soundbank));var t});return e.all(i.concat(o)).then(function(e){return _.max(e)})},getSongDuration:y,getTracksDuration:v,loadAllSamples:function(t){return e.all(_.map(t.samples,function(a){var u=r.pushTask("loadSample");return i.getFile(a.id).then(function(n){if(n)return n.blob.notes?(s.set(n.blob.id,n.blob),e.resolve()):Je(n.blob).then(d).catch(p);var o="regions-mix"===a.name?"tracks":"samples";return h.getJSON("".concat(o,"/").concat(a.id,"?format=").concat(a.isMidi?"mid":"Ready"===a.status?"m4a":"")).then(function(e){return"mid"===e.format.toLowerCase()?f.download(e.value).then(function(e){return l.importMidToScore(e,a.id,!0,(n=a.id,o=t.tracks,_.chain(o).filter({type:c}).find(function(e){return _.find(e.patterns,{sampleId:n})}).get("id").value()),t);var n,o}):h.getBuffer(e.value).then(d)}).catch(p)}).finally(function(){r.finishTask(u)});function d(e){return o.decodeAudioData(e).then(function(e){return a.buffer=e,a})}function p(e){return n.Raven.captureException("Sample not found ".concat(a.source),{error:e,extra:{revision:t},tags:{issue:"cannot-fetch-sample"}}),a.error=!0,a}}))},scheduleSampleUpload:function(e,n){var o=Object.keys(a.readers).length?0:d.EARLY_UPLOAD_DELAY,r=t(function(){if(_.chain(u.current.tracks).map("regions").flatten().map(function(e){return[e.sampleId,e.drySampleId]}).flatten().includes(n).value()){var t=h.upload({blob:e,sampleId:n,sampleType:"samples"});u.uploadingSamples.push(t),t.then(function(){return i.deleteFile(n)})}},o);return u.uploadingSamples.push(r),r},updateSongDuration:function(){return p.songDuration=_.chain(u.current.tracks).map(b).max().value(),e.when(y()).then(function(e){p.songDuration=e})}};function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.current.tracks;return _.some(e,{isSolo:!0})}function v(t,n){var o=g(t),a=_.chain(t).filter(function(e){return!n||!e.isMuted&&(!o||e.isSolo)}).map(function(e){var t,n=function(e){return e.preset?_.chain(m.getAll()).find({slug:e.preset}).get("duration",0).value():0}(e);return e.soundbank&&e.canEdit?l.getMidiTrackDuration(e,u.current.metronome.bpm).then(function(e){return e&&e+n}):(t=b(e))&&t+n}).value();return e.all(a).then(function(e){return _.max(e)||0})}function b(e){return _.chain(e.regions).filter(function(e){return e.isPlayable||_.isUndefined(e.isPlayable)}).map(function(e){return e.endPosition}).max().value()||0}function y(e){return v(u.current.tracks,e)}}]),angular.module("bandlab.editor").factory("EditorDB",["$analytics","$q","$timeout","EditorClipboard","EditorRevision",function(e,t,n,o,a){var i=_.once(function(){var e=t(function(e,t){var n=indexedDB.open(g,2);n.onerror=t,n.onclose=t,n.onblocked=t,n.onsuccess=function(){e(n.result)},n.onupgradeneeded=function(e){var t=e.currentTarget.result;try{t.deleteObjectStore(v)}catch(e){}t.createObjectStore(v,{keyPath:"sampleId",autoIncrement:!1})}}),o=n(function(){return t.reject(new Error("Could not create IndexedDB instance"))},3e4);return t.race([e,o]).catch(r)});return{addSnapshot:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=JSON.parse(JSON.stringify(t)),o=[];n.tracks&&(n.tracks.forEach(function(e){e.regions.forEach(function(e){e.sampleId=e.drySampleId||e.sampleId,o.push(e.sampleId)}),e.patterns&&o.push.apply(o,He(e.patterns.map(function(e){return e.sampleId})))}),n.samples=o.map(function(e){return{id:e}})),localStorage.setItem("snapshot_".concat(e||"new"),JSON.stringify({revision:n,createdAt:(new Date).getTime()}))},checkSnapshotAvailability:function(e){var t="snapshot_".concat(e||"new"),n=localStorage.getItem(t);return!!n&&(!!((n=JSON.parse(n)).createdAt&&(new Date).getTime()-n.createdAt<2592e6)||(localStorage.removeItem(t),!1))},deleteAllUnusedFiles:function(){var e,n,i,r,l=[].concat(He((e=_.chain([{state:a.current}]).concat(a.undoStack.concat(a.redoStack)).map("state.tracks").flatten().value(),n=_.map(e,"sampleId"),i=_.chain(e).map("regions").flatten().concat(o.value).compact().map(function(e){return[e.sampleId].concat(e.takes)}).flatten().compact().uniq().value(),r=_.chain(e).map("patterns").flatten().compact().map(function(e){return e.sampleId}).uniq().value(),[].concat(He(n),He(i),He(r)))),He(function(){var e,t,n=[],o=[],a=[];for(e in localStorage)if(-1!==e.indexOf("snapshot_"))try{if(t=localStorage.getItem(e),!(t=JSON.parse(t)).createdAt||(new Date).getTime()-t.createdAt>2592e6){localStorage.removeItem(e);continue}_.isEmpty(t.revision)||(a=_.map(t.revision.tracks,"id"),n=_.chain(t.revision.tracks).map("regions").flatten().map(function(e){return[e.sampleId,e.drySampleId]}).flatten().compact().concat(n).value(),o=_.chain(t.revision.tracks).map("patterns").flatten().compact().map(function(e){return e.sampleId}).uniq().concat(o).value())}catch(e){}return[].concat(He(a),He(n),He(o))}()));return _.remove(a.current.samples,function(e){return-1===_.indexOf(l,e.id)}),function(e){return s().then(function(n){var o=_.chain(n).filter(function(t){return-1===e.indexOf(t.sampleId)}).map(function(e){return c(e.sampleId)}).value();return t.all(o)})}(l)},deleteFile:c,deleteFiles:function(){return s().then(function(e){var n=_.map(e,function(e){return c(e.sampleId)});return t.all(n)})},getAll:s,getFile:function(e){return t.when(i()).then(function(n){var o=n.transaction([v],"readonly"),a=o.objectStore(v).get(e),i=t(function(e,t){a.onerror=t,a.onsuccess=function(t){e(t.target.result)}});return t.all([l(o),i]).then(function(){return i})}).catch(function(e){r(e)})},getSnapshot:function(e){return JSON.parse(localStorage.getItem("snapshot_".concat(e||"new")))},removeSnapshot:function(e){localStorage.removeItem("snapshot_".concat(e||"new"))},updateFile:function(e){return a.sampleFiles.set(e.sampleId,e),t.when(i()).then(function(n){var o=n.transaction([v],"readwrite"),a=o.objectStore(v).put(e),i=t(function(e,t){a.onerror=t,a.onsuccess=e});return t.all([l(o),i]).then(function(){})}).catch(r)}};function r(n){return e.eventTrack("IndexedDB error",{category:"Mix Editor",label:[_.get(n,"target.error.code"),_.get(n,"target.error.message"),_.get(n,"target.error.name")].join(" ")}),t.reject(n)}function s(){return t.when(i()).then(function(e){var t=e.transaction([v],"readonly"),n=t.objectStore(v).getAll(),o=new Promise(function(e,t){n.onerror=t,n.onsuccess=function(t){e(t.target.result)}});return Promise.all([l(t),o]).then(function(){return o})}).catch(function(e){return r(e),[]})}function c(e){return a.sampleFiles.delete(e),t.when(i()).then(function(n){var o=n.transaction([v],"readwrite"),a=o.objectStore(v).delete(e),i=t(function(e,t){a.onerror=t,a.onsuccess=e});return t.all([l(o),i]).then(function(){})}).catch(r)}function l(e){return t(function(t,n){e.onabort=n,e.oncomplete=t,e.onerror=n})}}]),angular.module("bandlab.editor").factory("EditorDelayMeter",["ClientDevice",function(e){var t,n,o=localStorage.recordingLatency&&parseFloat(localStorage.recordingLatency)||0,a=0;return{getRecordingDelay:r,getTotalLatency:function(){var t,n;return e.isWindows?(n=.005,t=.09):e.isMacOs?(n=0,t=.025):(n=.025,t=.09),(o>0?o:t)+n-r()},markStartRecording:function(){t=performance.now()},markStartPlaying:function(){n=performance.now()},setLatencyCorrection:function(e){o=e/1e3,localStorage.recordingLatency=o},setRecordCountIn:function(e){a=e}};function i(){t=null,n=null,a=0}function r(){var e;return n?(e=(e=t&&Math.round(t-n-1e3*a))>0&&e<200?e:0,i(),e/1e3):(i(),0)}}]),angular.module("bandlab.editor").value("EditorDraggedItem",{value:{}}),angular.module("bandlab.editor").factory("EditorEncoder",["$q","$window","CrossOriginWorker",function(e,t,n){var o=[];return{cancel:function(){_.forEach(o,function(e){e.terminate()}),o=[]},createWav:function(o){return new n("https://www.bandlab.com/web-app/common/workers/encoderWorker-a661dbb844.js").then(function(n){var a=e.defer();n.onerror=function(e){t.Raven.captureException(e&&(e.message||e.name),{extra:{colno:e&&e.colno,lineno:e&&e.lineno,message:e&&e.message}}),a.reject(e)},n.onmessage=function(e){e.data?a.resolve(new Blob([e.data],{type:"audio/wav"})):a.reject("Unable to encode audio"),n.terminate()};var i=2===o.numberOfChannels?[o.getChannelData(0).buffer,o.getChannelData(1).buffer]:[o.getChannelData(0).buffer];return n.postMessage({dataChannel:i,sampleRate:o.sampleRate}),a.promise})}}}]),angular.module("bandlab.editor").constant("editorEvents",{abortRecord:"MixEditor:abortRecord",changePreset:"MixEditor:changePreset",completeRecord:"MixEditor:completeRecord",cycleChanged:"MixEditor:cycleChanged",endOfCycle:"MixEditor:endOfCycle",importFile:"MixEditor:importFile",keyArrow:"MixEditor:keyArrow",keyDown:{addTrack:"MixEditor:addTrack",copy:"MixEditor:copy",cut:"MixEditor:cut",delete:"MixEditor:delete",deleteTrack:"MixEditor:deleteTrack",duplicateTrack:"MixEditor:duplicateTrack",goToBeginning:"MixEditor:goToBeginning",muteTrack:"MixEditor:muteTrack",paste:"MixEditor:paste",play:"MixEditor:play",record:"MixEditor:record",redo:"MixEditor:redo",save:"MixEditor:save",selectAllRegions:"MixEditor:selectAllRegions",selectTrack:"MixEditor:selectTrack",snapDisable:"MixEditor:snapDisable",snapEnable:"MixEditor:snapEnable",soloTrack:"MixEditor:soloTrack",toggleCycle:"MixEditor:toggleCycle",toggleLoops:"MixEditor:toggleLoops",toggleMetronome:"MixEditor:toggleMetronome",toggleRecord:"MixEditor:toggleRecord",toggleSnap:"MixEditor:toggleSnap",toggleVelocity:"MixEditor:toggleVelocity",triggerSlice:"MixEditor:triggerSlice",undo:"MixEditor:undo",zoomIn:"MixEditor:zoomIn",zoomOut:"MixEditor:zoomOut"},pausePlaying:"MixEditor:pausePlaying",pushUndo:"MixEditor:pushUndo",saveCompleted:"MixEditor:saveCompleted",slice:"MixEditor:slice",startPlay:"MixEditor:startPlay",startRecord:"MixEditor:startRecord",stopLoop:"MixEditor:stopLoop"}),angular.module("bandlab.editor").factory("EditorGrid",["$filter","EditorHelper","EditorRevision","editorSettings","EditorState",function(e,t,n,o,a){return{updateGridLabel:function(s){var c=s.element,l=s.state,u=a.isTimeRuler?function(t){for(var n=_.find(o.RULER_GRADUATIONS,function(e){return t.scale>=e.scaleMin&&t.scale<=e.scaleMax}),a=1,i=0,r=n.primary<=.2,s=e("soundTime"),c=[];a*n.primary*t.scalePx<50;)a++;for(;i<o.SONG_DURATION_MAX;)c.push(s(i,r).substring(1)),i+=a*n.primary;return{array:c,interval:n.primary*t.scalePx*a}}(l):function(e){for(var a,s,c,l,u=n.current.metronome,d=1,p=r(e),m=i(e),f=p>50,h=1,g=[];m<=4;)m*=2,d*=2;for(a=m,s=d;a<50;)a+=m,d+=s;for(c=a,f&&(c=p);h<=o.SONG_DURATION_MAX/t.getMeasureDuration(u);){for(g.push("".concat(h)),l=2;f&&l<=u.signature.notesCount;)g.push("".concat(h,".").concat(l)),l++;h+=d}return{array:g,interval:c}}(l),d=_.reduce(u.array,function(e,t,n){return e.concat('<span style="left: '.concat(Math.round(u.interval*n),'px">').concat(t,"</span>"))},"");c.innerHTML=d},updateRulerGrid:function(e){var t,n,l,u,d,p=e.pattern,m=e.state,f=void 0===m?a:m;return a.isTimeRuler?(t=s((d=_.find(o.RULER_GRADUATIONS,function(e){return f.scale>=e.scaleMin&&f.scale<=e.scaleMax})).primary,f),n=s(d.secondary,f)):(t=i(f),n=r(f)),0===a.snapSetting.value&&((l=n)>=16&&(l/=2),(u=l)>=16&&(u/=2)),c(p,t,n,l,u)},updateTrackGrid:function(e){var t,l,u,d,p,m=e.pattern,f=e.state,h=void 0===f?a:f;switch(a.snapSetting.value){case 0:a.isTimeRuler?(t=s((p=_.find(o.RULER_GRADUATIONS,function(e){return h.scale>=e.scaleMin&&h.scale<=e.scaleMax})).primary,h),l=s(p.secondary,h)):(t=i(h),l=r(h)),(u=l)>=16&&(u/=2),(d=u)>=16&&(d/=2);break;case 1:t=i(h);break;case.5:t=60/n.current.metronome.bpm*2*h.scalePx;break;case.25:t=60/n.current.metronome.bpm*h.scalePx;break;case 1/8:t=60/n.current.metronome.bpm/2*h.scalePx;break;case 1/16:t=60/n.current.metronome.bpm/4*h.scalePx;break;case 1/32:t=60/n.current.metronome.bpm/8*h.scalePx}a.snapDuration=c(m,t,l,u,d)/h.scalePx}};function i(e){return t.getMeasureDuration(n.current.metronome)*e.scalePx}function r(e){return t.getNoteDuration(n.current.metronome)*e.scalePx}function s(e,t){return e*t.scalePx}function c(e,t,n,o,a){for(var i,r,s;t<=4;)t*=2;for(;n<=4;)n*=2;for(r=t;r<50;)r+=t;for(n&&r>t&&(n=0),e.setAttribute("width",r);e.lastChild;)e.removeChild(e.lastChild);for(i=t,l(e,0,0,"first-graduation"),s=0;t*s<r;s++)l(e,t*s,30,"first-graduation");if(n>=8)for(i=n,s=0;n*s<r;s++)l(e,n*s,30,"second-graduation");if(o>=16)for(i=o,s=0;o*s<r;s++)l(e,o*s,30,"second-graduation");if(a>=32)for(i=a,s=0;a*s<r;s++)l(e,a*s,30,"second-graduation");return i}function l(e,t,n,o){if(!e.querySelector('[x="'.concat(t,'"]'))){var a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("width",.5),a.setAttribute("height",1240),a.setAttribute("class",o),a.setAttribute("x",t),a.setAttribute("y",n),e.appendChild(a)}}}]),angular.module("bandlab.editor").factory("EditorHelper",["$stateParams","audioSettings","EditorMidiSamples","EditorRevision","EditorState","MidiEditorState",function(e,t,n,o,a,r){return{areAudioRegions:function(e){return _.every(e,g)},areMidiRegions:function(e){return _.every(e,h)},calcAbsMax:function(e){var t,n,o=0,a=0;for(t=0;t<e.length;t++)(n=e[t])>a?a=n:n<o&&(o=n);return Math.max(a,-o)},closestSnapPosition:function(e){var t,n=_.reduce(e,function(e,n){return Math.abs(n)<e&&(t=Math.sign(n),e=Math.abs(n)),e},1/0);return n===1/0?0:Math.sign(t)*n},colorNameToColorHex:function(e){var t=_.find(i,{name:e});return t&&t.hex||i[0].hex},displayInstrument:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).toggle,t=void 0===e||e;if(a.isAudioInputVisible&&t)return a.isAudioInputActive=!1,a.isAudioInputExtended=!1,a.isAudioInputVisible=!1,void(a.isAudioInputActive=!1);y(),a.isAudioInputVisible=!0,a.isAudioInputActive=!0},displayMidiEditor:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).toggle,t=void 0===e||e;r.isVisible&&t?r.isVisible=!1:(y(),a.isAudioInputActive=!1,r.isVisible=!0,r.track=o.selectedTrack)},displayPresetSettings:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).toggle,t=void 0===e||e;if(a.isPresetSettingsVisible&&t)return a.isPresetSettingsVisible=!1,void(a.isAudioInputActive=!1);y(),a.isPresetSettingsVisible=!0,a.isAudioInputActive=!0},extendAudioInput:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).toggle,t=void 0===e||e;a.isAudioInputExtended&&t?a.isAudioInputExtended=!1:(a.isAudioInputExtended=!0,a.isAudioInputFloating=!1,a.isAudioInputActive=a.isAudioInputVisible)},getExtraLoopDuration:f,getExtraLoopWidth:function(e){return f(e)*a.scalePx},getFirstLoopDuration:m,getFirstLoopWidth:function(e){return m(e)*a.scalePx},getMeasureDuration:function(e){return s(e)*e.signature.notesCount},getNoteDuration:s,getTotalDuration:function(e){return m(e)+f(e)},hasMagicKeyword:function(){return"letMeSeeItPlease"===e.access},hasUneditableTrack:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.current;return _.some(e.tracks,{canEdit:!1})},hidePanel:y,isAudioBuffer:v,isAudioRegion:g,isAudioTrack:function(e){return e&&[l,u,d,p].includes(e.type)},isBandLabInstrumentTrack:function(e){return e&&e.soundbank&&e.type!==c},isMidiRegion:h,isRegionPlayable:function(e,t){var a;return t.patterns&&t.patterns.length?(a=n.get(e.sampleId))&&_.some(t.patterns,{sampleId:a.id}):t.soundbank?(a=n.get(e.sampleId),n.has(e.sampleId)&&!a.trackId):(a=_.find(o.current.samples,{id:e.sampleId}))&&a.buffer&&v(a.buffer)},isTimeSignatureValid:function(e,n){return t.SIGNATURE_NOTES_COUNT.includes(e)&&t.SIGNATURE_NOTE_VALUE.includes(n)},linToLog:function(e,t,n){var o=(e-t)/(n-t),a=t*Math.pow(n/t,o);return Math.min(Math.max(a,t),n)},logToLin:function(e,t,n){var o=t+Math.log(e/t)/Math.log(n/t)*(n-t);return Math.min(Math.max(o,t),n)},panDisplay:function(e){return(e=(50*e).toFixed(0))<=0?e:"+".concat(e)},refreshTracksOrder:function(e){return _.chain(e).sortBy("order").forEach(function(e,t){e.order=t}).value()},scaleLinToLog:function(e,t){return Math.sqrt(e*t)},scaleLogToLin:function(e,t){return e*e/t},snapToEndRegion:function(e,t,n){var o=_.chain(t.regions).filter(function(t){return t.id!==e.id}).map(function(t){var n=t.endPosition;return{snappingEdge:n,distance:Math.abs(n-e.startPosition)}}).filter(function(e){return e.distance<5/n}).minBy("distance").get("snappingEdge",0).value();return o&&a.isSnapping?o-e.startPosition:0},snapToGrid:function(e,t,n){var o=Math.round(e/t)*t,i=o+t;return n=angular.extend({padding:5,force:!1,delta:!1},n),Math.abs(e-o)<=n.padding&&a.isSnapping||0!==a.snapSetting.value&&a.isSnapping||n.force?n.delta?o-e:o:Math.abs(e-i)<=n.padding&&a.isSnapping||n.force?n.delta?i-e:i:n.delta?1/0:e},snapToLoopLength:function(e,t){if(!e.loopLength)return 1/0;var n=(e.endPosition-e.startPosition)/e.loopLength,o=e.startPosition+Math.ceil(n)*e.loopLength,a=e.startPosition+Math.floor(n)*e.loopLength;return Math.abs(o-e.endPosition)<5/t?o-e.endPosition:Math.abs(a-e.endPosition)<5/t?a-e.endPosition:1/0},snapToPlayhead:function(e,t){return Math.abs(e-a.crTime)*t<=5},snapToStartRegion:function(e,t,n){var o=_.chain(t.regions).reduce(function(t,n){return n.id!==e.id&&t.push(n.startPosition),t},[]).find(function(t){return Math.abs(t-e.endPosition)<5/n}).value();return o&&a.isSnapping?o-e.endPosition:1/0},toDecibels:b,toDiffDecibels:function(e){var t=b(e).toFixed(1);return t>=0?"+".concat(t," dB"):"".concat(t," dB")},updateRegions:function(e,t,n){_.chain(e.tracks).map("regions").flatten().filter({sampleId:t}).forEach(function(e){e.sampleId=n}).value()},updateTracks:function(e,t,n){_.chain(e.tracks).map("patterns").flatten().filter({sampleId:t}).forEach(function(e){e.sampleId=n}).value()}};function s(e){return 60/e.bpm/e.signature.noteValue*4}function m(e){return e.loopLength||e.endPosition-e.startPosition}function f(e){return e.loopLength?e.endPosition-e.startPosition-e.loopLength:0}function h(e){return n.has(e.sampleId)}function g(e){return _.find(o.current.samples,{id:e.sampleId})&&!n.has(e.sampleId)}function v(e){return e&&e.constructor===AudioBuffer}function b(e){return 20*Math.log10(e)}function y(){a.isAudioInputExtended=!1,a.isAudioInputVisible=!1,a.isPresetSettingsVisible=!1,r.isVisible=!1}}]),angular.module("bandlab.editor").factory("EditorHistory",["EditorHelper","EditorPlayer","EditorRevision","editorSettings","EditorState",function(e,t,n,o,a){var i=o.HISTORY_UNDOS_MAX,r=0;return{clear:function(){n.undoStack=[],n.redoStack=[]},pushUndo:function(e){r>0||(n.redoStack=[],n.undoStack.push({state:c(e)}),a.hasRevisionChanges=!0,n.undoStack=n.undoStack.slice(-i))},redo:function(e){var t=n.redoStack.pop();return n.undoStack.push({state:c(e)}),s(e,t)},rewritePlaceholder:function(e,t,o){_.chain(n.undoStack).concat(n.redoStack).concat([{state:o}]).map("state").flatten().filter({tracks:[{regions:[{sampleId:e}]}]}).map("tracks").flatten().map("regions").flatten().filter({sampleId:e}).forEach(function(e){e.sampleId=t.id,e.isProcessing=!1,e.isPlayable=!0}).value()},startToIgnorePushUndo:function(){r++},state:{hasUndo:function(){return n.undoStack.length>0},hasRedo:function(){return n.redoStack.length>0}},stopToIgnorePushUndo:function(){r--},undo:function(e){var t=n.undoStack.pop();return n.redoStack.push({state:c(e)}),s(e,t)}};function s(n,o){if(a.hasRevisionChanges=!0,_.merge(n.metronome,o.state.metronome),setTimeout(function(){n.metronome.pristine=o.state.metronome.pristine}),n.key=o.state.key,n.volume=o.state.volume,n.tracks.length===o.state.tracks.length)return _.forEach(n.tracks,function(e){var n=_.find(o.state.tracks,{id:e.id});e.automation=n.automation,e.effects=n.effects,e.name=n.name,e.pan=n.pan,e.patterns=n.patterns,e.preset=n.preset,e.regions=n.regions,e.soundbank=n.soundbank,e.volume=n.volume,e.order=n.order,t.current.setTrackEffects(e.id,e.effects)}),n;n.tracks=_.filter(n.tracks,function(e){return _.some(o.state.tracks,{id:e.id})});var i=_.filter(o.state.tracks,function(e){return!_.some(n.tracks,{id:e.id})});return _.isEmpty(i)?n:(i.forEach(t.addTrack),n.tracks=i.concat(n.tracks),e.refreshTracksOrder(n.tracks),n)}function c(e){var t=_.cloneDeep(e);return t.samples=null,t}}]);var In={0:{name:"Acoustic Grand Piano",soundbank:"grand-piano"},1:{name:"Bright Acoustic Piano",soundbank:"upright-piano"},2:{name:"Electric Grand Piano",soundbank:"electric-piano"},3:{name:"Honky-tonk Piano",soundbank:"honky-tonk-piano"},4:{name:"Electric Piano 1",soundbank:"wurlitzer"},5:{name:"Electric Piano 2",soundbank:"rhodes"},6:{name:"Harpsichord",soundbank:"studio-harpsichord"},7:{name:"Clavi",soundbank:null},8:{name:"Celesta",soundbank:null},9:{name:"Glockenspiel",soundbank:"glockenspiel"},10:{name:"Music Box",soundbank:null},11:{name:"Vibraphone",soundbank:"vibraphone"},12:{name:"Marimba",soundbank:"marimba"},13:{name:"Xylophone",soundbank:null},14:{name:"Tubular Bells",soundbank:"bells"},15:{name:"Dulcimer",soundbank:null},16:{name:"Drawbar Organ",soundbank:"synth-organ"},17:{name:"Percussive Organ",soundbank:null},18:{name:"Rock Organ",soundbank:"rock-organ"},19:{name:"Church Organ",soundbank:"church-organ"},20:{name:"Reed Organ",soundbank:null},21:{name:"Accordion",soundbank:"accordion"},22:{name:"Harmonica",soundbank:null},23:{name:"Tango Accordion",soundbank:null},24:{name:"Acoustic Guitar (nylon)",soundbank:"nylon-guitar"},25:{name:"Acoustic Guitar (steel)",soundbank:"sparkling-acoustic"},26:{name:"Electric Guitar (jazz)",soundbank:null},27:{name:"Electric Guitar (clean)",soundbank:null},28:{name:"Electric Guitar (muted)",soundbank:null},29:{name:"Overdriven Guitar",soundbank:"guitar-power-chord"},30:{name:"Distortion Guitar",soundbank:null},31:{name:"Guitar harmonics",soundbank:null},32:{name:"Acoustic Bass",soundbank:"acoustic-bass-legato"},33:{name:"Electric Bass (finger)",soundbank:"electric-bass-legato"},34:{name:"Electric Bass (pick)",soundbank:"electric-bass-staccato"},35:{name:"Fretless Bass",soundbank:null},36:{name:"Slap Bass 1",soundbank:"slap-bass"},37:{name:"Slap Bass 2",soundbank:null},38:{name:"Synth Bass 1",soundbank:"attack-bass"},39:{name:"Synth Bass 2",soundbank:"classic-synth-bass"},40:{name:"Violin",soundbank:"violin-section"},41:{name:"Viola",soundbank:"viola-section"},42:{name:"Cello",soundbank:"cello-section"},43:{name:"Contrabass",soundbank:"double-bass-section"},44:{name:"Tremolo Strings",soundbank:null},45:{name:"Pizzicato Strings",soundbank:"string-orchestra-pizz"},46:{name:"Orchestral Harp",soundbank:"harp"},47:{name:"Timpani",soundbank:null},48:{name:"String Ensemble 1",soundbank:"string-orchestra"},49:{name:"String Ensemble 2",soundbank:"string-orchestra"},50:{name:"SynthStrings 1",soundbank:"string-pad"},51:{name:"SynthStrings 2",soundbank:"string-pad"},52:{name:"Choir Aahs",soundbank:null},53:{name:"Voice Oohs",soundbank:null},54:{name:"Synth Voice",soundbank:"choir-synth"},55:{name:"Orchestra Hit",soundbank:"string-orchestra-pizz"},56:{name:"Trumpet",soundbank:"trumpet"},57:{name:"Trombone",soundbank:"trombone"},58:{name:"Tuba",soundbank:"tuba"},59:{name:"Muted Trumpet",soundbank:null},60:{name:"French Horn",soundbank:"french-horn"},61:{name:"Brass Section",soundbank:null},62:{name:"SynthBrass 1",soundbank:"retro-synth-brass"},63:{name:"SynthBrass 2",soundbank:"smooth-brass-pad"},64:{name:"Soprano Sax",soundbank:null},65:{name:"Alto Sax",soundbank:"alto-saxophone"},66:{name:"Tenor Sax",soundbank:"tenor-saxophone"},67:{name:"Baritone Sax",soundbank:null},68:{name:"Oboe",soundbank:"oboe"},69:{name:"English Horn",soundbank:null},70:{name:"Bassoon",soundbank:null},71:{name:"Clarinet",soundbank:"clarinet"},72:{name:"Piccolo",soundbank:null},73:{name:"Flute",soundbank:"flute"},74:{name:"Recorder",soundbank:null},75:{name:"Pan Flute",soundbank:null},76:{name:"Blown Bottle",soundbank:null},77:{name:"Shakuhachi",soundbank:null},78:{name:"Whistle",soundbank:null},79:{name:"Ocarina",soundbank:null},80:{name:"Lead 1 (square)",soundbank:"g-funk-lead"},81:{name:"Lead 2 (sawtooth)",soundbank:"berlin-lead"},82:{name:"Lead 3 (calliope)",soundbank:null},83:{name:"Lead 4 (chiff)",soundbank:null},84:{name:"Lead 5 (charang)",soundbank:null},85:{name:"Lead 6 (voice)",soundbank:"choir-synth"},86:{name:"Lead 7 (fifths)",soundbank:"house-organ"},87:{name:"Lead 8 (bass + lead)",soundbank:null},88:{name:"Pad 1 (new age)",soundbank:null},89:{name:"Pad 2 (warm)",soundbank:"warm-pad"},90:{name:"Pad 3 (polysynth)",soundbank:"atmosphere-pad"},91:{name:"Pad 4 (choir)",soundbank:"choir-synth"},92:{name:"Pad 5 (bowed)",soundbank:null},93:{name:"Pad 6 (metallic)",soundbank:"fm-pad"},94:{name:"Pad 7 (halo)",soundbank:null},95:{name:"Pad 8 (sweep)",soundbank:"swell-pad"},96:{name:"FX 1 (rain)",soundbank:null},97:{name:"FX 2 (soundtrack)",soundbank:null},98:{name:"FX 3 (crystal)",soundbank:null},99:{name:"FX 4 (atmosphere)",soundbank:null},100:{name:"FX 5 (brightness)",soundbank:null},101:{name:"FX 6 (goblins)",soundbank:null},102:{name:"FX 7 (echoes)",soundbank:null},103:{name:"FX 8 (sci-fi)",soundbank:null},104:{name:"Sitar",soundbank:"sitar"},105:{name:"Banjo",soundbank:null},106:{name:"Shamisen",soundbank:null},107:{name:"Koto",soundbank:null},108:{name:"Kalimba",soundbank:null},109:{name:"Bag pipe",soundbank:null},110:{name:"Fiddle",soundbank:null},111:{name:"Shanai",soundbank:null},112:{name:"Tinkle Bell",soundbank:null},113:{name:"Agogo",soundbank:null},114:{name:"Steel Drums",soundbank:"steel-drum"},115:{name:"Woodblock",soundbank:null},116:{name:"Taiko Drum",soundbank:null},117:{name:"Melodic Tom",soundbank:null},118:{name:"Synth Drum",soundbank:null},119:{name:"Reverse Cymbal",soundbank:null},120:{name:"Guitar Fret Noise",soundbank:null},121:{name:"Breath Noise",soundbank:null},122:{name:"Seashore",soundbank:null},123:{name:"Bird Tweet",soundbank:null},124:{name:"Telephone Ring",soundbank:null},125:{name:"Helicopter",soundbank:null},126:{name:"Applause",soundbank:null},127:{name:"Gunshot",soundbank:"sfx-firearm"},128:{name:"General MIDI Percussion",soundbank:"general-midi-drums-v4"}},On={"62-p-bass":33,"808-kit":128,"808-saturated-bass":87,accordion:21,"acid-bass":38,"acoustic-bass-legato":32,"acoustic-bass-staccato":32,"acoustic-guitar":25,"afro-cuban-percussion":128,"alto-saxophone":65,"ambient-lead":82,"atmosphere-pad":88,"attack-bass":38,bells:112,"berlin-lead":80,"blues-kit":128,"borealis-pad":88,"brush-kit":128,"cat-pad":97,"cello-section":42,"choir-synth":91,"church-organ":19,"cinematic-kit":128,clarinet:71,"classic-metal-kit":128,"classic-rock-kit":128,"classic-synth-bass":62,"country-kit":128,"dance-lead":81,"dark-hop-hop-kit":128,"dark-organ":16,"deep-house-bass":39,"deep-house-synth":89,"double-bass-section":35,"drive-bass":38,"dry-kit":128,"dub-supersaw":82,"dubstep-kit":128,"edm-kit":128,"electric-bass-legato":33,"electric-bass-staccato":34,"electric-piano":4,"electro-pop-kit":128,"evolve-bass":87,"evolve-pad":95,"fancy-bass":39,"fanfare-organ":18,"fat-n-dirty":87,"festive-pad":98,flute:73,"fm-Lead":80,"fm-pad":93,"freestyle-kit":128,"french-horn":60,"funk-kit":128,"funk-guitar":0,"fusion-kit":128,"future-keys":81,"g-funk-lead":80,"general-midi-drums-v4":128,"glitch-kit":128,"glitch-lead":80,glockenspiel:9,"grand-piano":0,"grime-bass":38,"growler-bass":38,"guitar-power-chord":29,"hard-rock-kit":128,harp:46,harpsichord:81,"heavy-lead":80,"hip-hop-kit":128,"house-organ":16,"indie-rock-kit":128,"industrial-kit":128,"jazz-kit":128,"latin-kit":128,"lo-fi-kit":128,"lofi-piano":0,marimba:12,"modern-hip-hop-bass":38,"modern-metal-kit":128,"moog-bass":38,"new-wave-kit":128,"nu-house-kit":128,"nylon-guitar":24,oboe:68,"plucked-lead":81,"pop-rock-kit":128,"prince-kit":128,"punchy-jazz-bass":33,"reggae-kit":128,"retro-juno-pad":90,"retro-pick-bass":33,"retro-synth-brass":62,rhodes:5,"rock-organ":18,"rumble-bass":38,"scary-sound-pad":102,"sfx-firearm":128,"sfx-pad":103,"sine-bass":38,"sinister-trap":128,sitar:104,"slap-bass":36,"smooth-brass-pad":63,"solo-violin":40,"sparkling-acoustic":25,"square-sub-bass":38,"steel-drum":114,"string-orchestra":48,"string-orchestra-pizz":48,"string-orchestra-stacc":48,"string-pad":50,"studio-grand":0,"studio-harpsichord":6,"swell-pad":95,"synth-kit":128,"synth-organ":18,"techno-throwback-kit":128,"tenor-saxophone":66,"thriller-bass":38,"trap-kit":128,trombone:57,"tropical-house-bass":39,trumpet:56,tuba:58,"tubular-bells":14,"uber-lead":81,ukelele:24,"upright-piano":1,vibraphone:11,"vintage-hip-hop-kit":128,"vintage-pad":92,"viola-section":41,"violin-section":40,"warm-pad":89,wurlitzer:5};function xn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Dn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Ln(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?Dn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Dn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function Nn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Un(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?Nn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Nn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function jn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Bn(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?jn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):jn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function Fn(e){var t=e.defaultSlides,o=e.breakpoints,a=n(o=void 0===o?[1024,600,480]:o,3),i=a[0],r=a[1],s=a[2],c=e.slides,l=n(c=void 0===c?[]:c,3),u=l[0],d=l[1],p=l[2];return{arrows:!0,dots:!1,draggable:!1,infinite:!0,slidesToShow:t,slidesToScroll:t,responsive:[{breakpoint:i,settings:{arrows:!0,dots:!0,infinite:!0,slidesToShow:u,slidesToScroll:u}},{breakpoint:r,settings:{arrows:!1,dots:!0,slidesToShow:d,slidesToScroll:d}},{breakpoint:s,settings:{arrows:!1,dots:!0,slidesToShow:p,slidesToScroll:p}}]}}function qn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Vn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Hn(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?Vn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Vn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function Gn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function zn(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?Gn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Gn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function Wn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Kn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Yn(){var e=S(["Invitation could not be accepted"]);return Yn=function(){return e},e}function Xn(){var e=S(["The number of members reached the maximum."]);return Xn=function(){return e},e}function Jn(){var e=S(["This Project does not exist."]);return Jn=function(){return e},e}function Qn(){var e=S(["This User does not exist."]);return Qn=function(){return e},e}function Zn(){var e=S(["This Band does not exist."]);return Zn=function(){return e},e}function eo(){var e=S(["This invitation has already been accepted."]);return eo=function(){return e},e}function to(){var e=S(["The invitation code is not valid."]);return to=function(){return e},e}function no(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function oo(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function ao(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function ro(){var e=S(["Error saving Card"]);return ro=function(){return e},e}function so(){var e=S(["This tip is generous! Please confirm the amount: <strong>USD","</strong>"]);return so=function(){return e},e}function co(){var e=S(["Are you sure?"]);return co=function(){return e},e}function lo(){var e=S(["Please give BandLab access to continue."]);return lo=function(){return e},e}function uo(){var e=S(["Stripe Account not connected"]);return uo=function(){return e},e}function po(){var e=S(["Error saving Card"]);return po=function(){return e},e}function mo(){var e=S(["Error creating tip"]);return mo=function(){return e},e}function fo(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function ho(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?fo(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):fo(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function go(){var e=S(["Tip via PayPal"]);return go=function(){return e},e}function vo(){var e=S(["Maximum file size: "," MB"]);return vo=function(){return e},e}function bo(){var e=S(["Do you want to cancel your upload?"]);return bo=function(){return e},e}function yo(){var e=S(["Upload in progress"]);return yo=function(){return e},e}function wo(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function ko(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?wo(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):wo(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function So(){var e=S(["You are not permitted to create posts"]);return So=function(){return e},e}function Po(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Eo(){var e=S(["Are you sure you want to leave this collaboration?<br>This cannot be undone."]);return Eo=function(){return e},e}function To(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Mo(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?To(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):To(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function $o(){var e=S(["File cannot be processed"]);return $o=function(){return e},e}function Co(){var e=S(["Duration should be less than 10 minutes."]);return Co=function(){return e},e}angular.module("bandlab.editor").factory("EditorImporter",["$q","$rootScope","AppNotifications","AudioStretch","DrumMachineState","EditorDB","EditorHelper","EditorHistory","EditorMidiSamples","EditorMidiScore","EditorPlayer","EditorRevision","editorSettings","EditorTimeline","EditorTrack","FileHelper","MidiEditor","Soundbank",function(e,o,a,i,r,s,l,u,d,p,m,f,g,v,b,y,w,k){return{importFile:function(n){return f.selectedRegions.clear(),u.pushUndo(f.current),u.startToIgnorePushUndo(),function(){switch(!0){case"midi"===n.type:return function(n){try{n.track=n.track||b.addTrack({name:n.name,soundbank:n.soundbank})}catch(t){return e.reject(t)}n.time=n.time||0;var o=l.getMeasureDuration(f.current.metronome),a=8*o,i=_.find(n.track.regions,function(e){return n.time>e.startPosition&&n.time<e.endPosition}),r=_.chain(n.track.regions).sortBy("startPosition").filter(function(e){return e.startPosition>n.time}).value().shift(),s=i||r&&r.startPosition<n.time+a?o*n.bars:a,c=v.createRegionPlaceholder(n.track,{duration:s,name:n.name},n.time,null,o*n.bars);return y.download(n.src).then(function(e){var t=n.src.split("/"),o=e;return o.name=t.pop(),S(n,o)}).then(function(e){return n.key&&f.current.key?w.transposeScoreKey(e[0].id,n.key,f.current.key,n.soundbank):e[0]}).then(function(e){v.updateRegionPlaceholder(c.sampleId,function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?xn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):xn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},e,{isMidi:!0})),n.key&&(f.current.key=f.current.key||n.key),n.bpm&&f.current.metronome.pristine&&(f.current.metronome.bpm=n.bpm,f.current.metronome.pristine=!1)}).catch(function(t){return _.remove(n.track.regions,c),e.reject(t)})}(n);case"audio"===n.type:return function(t){try{t.track=t.track||b.addTrack({name:t.name})}catch(t){return e.reject(t)}var n,o=f.current.metronome.pristine||!t.bpm?1:i.clampPlaybackRate(f.current.metronome.bpm/t.bpm),a=0;return t.key&&(f.current.key=f.current.key||t.key,a=w.transposeKeys(t.key,f.current.key)),t.bpm&&f.current.metronome.pristine&&(f.current.metronome.bpm=t.bpm,f.current.metronome.pristine=!1),n=v.createRegionPlaceholder(t.track,{duration:t.duration/o,name:t.name,pitchShift:a,playbackRate:o},t.time||0),v.createSampleFromAudioLoopURL(t.src).then(function(e){return e.name=t.name,v.updateRegionPlaceholder(n.sampleId,e),n.isProcessing=!0,i.convertRegion(n)}).then(function(){n.isProcessing=!1}).catch(function(o){return _.remove(t.track.regions,n),e.reject(o)})}(n);case n.type===c:return function(t){var n=d.get(r.selectedPattern.sampleId);return n&&n.notes.length?(t.time=t.time||0,v.createRegionFromMidiScore(n,f.selectedTrack,t.time),o.$broadcast("DrumMachine:update",n),e.resolve()):e.reject(new Error("Make a beat first before exporting it to a track."))}(n);case!n.file:return e.resolve()}return y.checkMidi(n.file).then(function(e){return"audio/midi"===e.type||"audio/mid"===e.type?S(n,e):function(e,t){return y.checkType(t,g.IMPORT_FILE_ACCEPTED_TYPES).then(function(e){return y.checkSize(e,g.IMPORT_FILE_SIZE_MAX)}).then(function(t){try{e.track=e.track||b.addTrack({name:t.name})}catch(e){return}return v.createRegionFromAudioFile(t,e.track,e.time)})}(n,e)})}().then(m.updateSong).catch(function(e){a.addNotification({title:j,content:e.message,classList:"alert",autoclose:8e3})}).finally(u.stopToIgnorePushUndo)}};function S(e,t){return p.importMidToScore(t).then(function(t){function o(t){var n=e.soundbank||In[t.programChange]&&In[t.programChange].soundbank||h,o=_.find(k.getBanks(),{slug:n});return{name:t.name||o.name,soundbank:n}}return _.map(t,function(t,a){try{e.track=a?b.addTrack(o(t)):e.track||b.addTrack(o(t))}catch(e){return}if(t.originalBpm&&f.current.metronome.pristine&&(f.current.metronome.bpm=t.originalBpm,f.current.metronome.pristine=!1),t.keySignature&&!f.current.key&&(f.current.key=t.keySignature),t.timeSignature&&l.isTimeSignatureValid(t.timeSignature.notesCount,t.timeSignature.noteValue)&&f.current.metronome.signature.pristine){var i=n(t.timeSignature,2),r=i[0],c=i[1];f.current.metronome.signature.notesCount=r,f.current.metronome.signature.noteValue=c,f.current.metronome.signature.pristine=!1}if(e.time=e.time||0,s.updateFile({blob:t,sampleId:t.id}),"midi"===e.type)return t;if(t.keySignature&&f.current.key){var u=e.track,d=e.time;return w.transposeScoreKey(t.id,t.keySignature,f.current.key,u.soundbank).then(function(e){return v.createRegionFromMidiScore(e,u,d)})}return v.createRegionFromMidiScore(t,e.track,e.time)})})}}]),angular.module("bandlab.editor").factory("EditorLoader",["Modal",function(e){var t,n={forkRevision:{operation:"load",title:"Loading sample…",label:"Preparing audio…",rate:1e4},loadSample:{operation:"load",title:"Loading sample…",label:"Preparing audio…"},uploadMeta:{operation:"save",title:"Saving revision…",label:"Updating song metadata…"},createMixdown:{operation:"save",title:"Saving revision…",label:"Creating mixdown…"},uploadMixdown:{operation:"save",title:"Saving revision…",label:"Syncing mixdown…"},export:{operation:"export",title:"Exporting audio…",label:"Save Audio As File"},postProcessAudio:{operation:"postProcessAudio",title:"Processing audio…",label:""},uploadTrack:{operation:"master",title:"Mastering",label:"Uploading Track"},masterTrack:{operation:"master",title:"Mastering",label:"Enhancing your mixdown to distribution quality…",rate:2e3},loadMasterPreview:{operation:"master",title:"Mastering",label:"Loading preview…"},downloadRevision:{operation:"downloadRevision",title:"Exporting revision…",label:"Downloading mixdown…"}},o=0,a=[],i=!1;return{getDone:function(){return o},getQueue:function(){return a},finishTask:function(e){-1!==a.indexOf(e)&&(a.splice(a.indexOf(e),1),o++)},flushQueue:function(){a.splice(0,a.length),o=0,t&&(t.destroy(),t=null),i=!1},pushTask:function(o,r){var s=_.assignIn({},n[o],r);return i||((t=new e({templateUrl:"https://www.bandlab.com/web-app/editor/partials/_mix-editor-loader-90d0ba8c.html",class:"mix-editor-loader",overlayClose:!1,noStateChangeListeners:!0})).show(),i=!0),a.push(s),s}}}]).controller("EditorLoaderCtrl",["$interval","$rootScope","$scope","$timeout","EditorEncoder","EditorLoader","EditorMixdown","EditorState",function(e,t,n,o,a,i,r,s){var c;n.queue=i.getQueue(),n.progress=0,n.cancelExport=function(){a.cancel(),i.flushQueue(),r.cancel(),s.isMixing=!1},n.cancelMaster=function(){t.$broadcast("Mastering:cancel")},n.$watch("queue.length",function(t){t&&(n.title=n.queue[0].title,n.operation=n.queue[0].operation,n.label=n.queue[0].label),e.cancel(c),c=e(function(){var a=Math.round(i.getDone()/(i.getDone()+n.queue.length)*100)||0,r=Math.round((i.getDone()+1)/(i.getDone()+n.queue.length)*100)||0,s=Math.min(n.progress+1,r,98);n.progress=Math.min(Math.max(a,s),100),100!==a&&0!==t||(i.flushQueue(),e.cancel(c),o(function(){n.progress=0},1e3))},n.queue[0]&&n.queue[0].rate||500)})}]),angular.module("bandlab.editor").value("EditorLoopsState",{genres:[],instruments:[],types:[{id:"all",name:"All"},{id:"audio",name:"Audio"},{id:"midi",name:"MIDI"}],loopIndex:0,loops:[],packs:[],search:"",selectedLoop:null,selectedPack:null,selectedType:null,sort:{property:"name",order:{bpm:!1,key:!1,name:!1}},tab:"packs"}).factory("EditorLoops",["$filter","EditorLoopsState",function(e,t){var n=e("orderBy");return{filterLoops:function(e,t){return _.filter(e,function(e){var n=e.genreIds,o=e.instrumentIds,a=e.packIds,i=e.fileType,r=_.every(t.genres,function(e){return n.includes(e.id)}),s=_.every(t.instruments,function(e){return o.includes(e.id)}),c=!t.pack||_.some(a,function(e){return e===t.pack.id});return(!t.type||"all"===t.type.id||i===t.type.id)&&r&&s&&c})},orderLoops:function(e){return n(e,[t.sort.property,"icon",function(e){if(t.sort.order.name)switch(e.part.toLowerCase()){case"verse":return"3".concat(e.part);case"chorus":return"2".concat(e.part);case"bridge":return"1".concat(e.part);default:return"0".concat(e.part)}else switch(e.part.toLowerCase()){case"verse":return"0".concat(e.part);case"chorus":return"1".concat(e.part);case"bridge":return"2".concat(e.part);default:return"3".concat(e.part)}}],t.sort.order[t.sort.property])}}}]),angular.module("bandlab.editor").factory("EditorMidiSamples",function(){return new Map}).factory("EditorMidiScore",["$q","$window","EditorDB","EditorHelper","EditorMidiSamples","EditorRevision","editorSettings","MidiEditorState","Soundbank","SoundbankSamples",function(e,t,n,o,a,i,r,s,c,l){var u=MidiConvert.secondsToTicks,d=MidiConvert.ticksToSeconds;return{createScore:function(){var e={id:k(),isSaved:!1,key:i.current.key,notes:[],pitchShift:0};return a.set(e.id,e),e},editScore:p,exportScoreToMid:function(e,t){t=t||{};var n=a.get(e);return b(_.chain(n.notes).filter(t.region?function(e){var n=parseFloat(e.time),a=u(t.region.sampleOffset,t.bpm),i=u(t.region.sampleOffset+o.getFirstLoopDuration(t.region),t.bpm);return n>=a&&n<=i}:{}).map(t.region?function(e){return _.assign({},e,{time:"".concat(parseInt(e.time)-u(t.region.sampleOffset,t.bpm),"i")})}:angular.identity).map(t.region?function(e){return _.assign({},e,{duration:"".concat(Math.min(parseInt(e.duration),u(t.region.endPosition-t.region.startPosition,t.bpm)-parseInt(e.time)),"i")})}:angular.identity).value(),t)},exportTrackToMid:function(e,t){var n=t.bpm;return b(S(e.regions,n).notes,{bpm:n})},flattenNotes:w,getExactDuration:m,getMidiRegionDuration:function(e,t,n){return E(n).then(function(n){return"kit"!==n.category?e.endPosition-e.startPosition+r.TAIL_DURATION_MIN:_.chain(w(f(e.sampleId,t),e)).groupBy(T).reduce(M,[]).map(function(e){return P(e,n)}).max().value()})},getMidiTrackDuration:function(e,t){return E(e.soundbank).then(function(n){return"kit"!==n.category?_.chain(e.regions).map("endPosition").max().value()+r.TAIL_DURATION_MIN||0:_.chain(e.regions).filter({isPlayable:!0}).reduce(function(e,n){var o=w(f(n.sampleId,t),n);return o=_.map(o,function(e){return e.time+=n.startPosition,e}),e.concat(o)},[]).groupBy(T).reduce(M,[]).map(function(e){return P(e,n)}).max().value()||0})},getNotesTime:f,getRoundedDuration:function(e,t,n){var a,i=m(e,n);return(a=o.getMeasureDuration({bpm:n,signature:t}))*Math.ceil(i/a)},importMidToScore:function(t,n,o,i){return function(t){var n=e.defer(),o=new FileReader;return o.onload=function(e){n.resolve(e.target.result)},o.readAsBinaryString(t),n.promise}(t).then(function(e){var t=MidiConvert.parse(e),r=t.parts,s=t.transport;return r.length?_.map(r,function(e,t){var r,c,l,u=s.instruments&&s.instruments[t];return c=s.trackNames[t]?s.trackNames[t]:In[u]?In[u].name:"",(l=_.assign({id:n||k(),isSaved:o,name:c,notes:e,pitchShift:0,programChange:u,trackId:i},s)).notes=_.map(l.notes,function(e){return e.id=k(),e}),l.originalBpm=Math.round(s.bpm),a.set(l.id,l),r=y(l.notes),l.notes.length===r.length?(l.notes=r,l):p(l,r)}):a.set(n,{id:n,isSaved:o,pitchShift:0,notes:[],trackId:i})})},mergeScore:S,secondsToTicks:u,storeRecordAsScore:function(e,t,o,r){(function(e,t,n){_.chain(n).map("midiNote").uniq().compact().forEach(function(o){var a=_.filter(n,{midiNote:o});"NoteOff"===_.head(a).name&&n.unshift({name:"NoteOn",midiNote:a[0].midiNote,velocity:.8,time:e}),"NoteOn"===_.last(a).name&&n.push({name:"NoteOff",midiNote:a[0].midiNote,velocity:.8,time:t})}).value()})(e,t,o),function(e,t,n){var o=_.filter(n,v);if(!o.length)return n;"SustainOff"===_.head(o).name&&n.unshift({name:"SustainOn",time:e}),"SustainOn"===_.last(o).name&&n.push({name:"SustainOff",time:t})}(e,t,o);var s,c,l,d,p=_.filter(o,{name:"PitchBend"}),m=_.chain(o).filter(g).partition({name:"NoteOn"}).value(),f=m[0],h=m[1],b=_.chain(o).filter(v).partition({name:"SustainOn"}).value(),w=b[0],S=b[1];(c=_.reduce(f,function(t,n){var o=n.time-e,a=_.find(h,function(e){return e.time>=n.time&&e.midiNote===n.midiNote}).time-e-o;return t.concat({id:k(),time:"".concat(u(o/1e3,i.current.metronome.bpm),"i"),duration:"".concat(u(a/1e3,i.current.metronome.bpm),"i"),midiNote:n.midiNote,velocity:n.velocity||1})},[])).length&&(d=_.reduce(w,function(t,n){var o,a=n.time-e;return o=_.find(S,function(e){return e.time>=n.time}).time-e-a,t.concat({eventName:"sustain",id:k(),time:"".concat(u(a/1e3,i.current.metronome.bpm),"i"),duration:"".concat(u(o/1e3,i.current.metronome.bpm),"i")})},[]),s=_.reduce(p,function(t,n){var o=n.time-e;return t.concat({eventName:"pitchBend",id:k(),time:"".concat(u(o/1e3,i.current.metronome.bpm),"i"),value:n.value})},[]),l={id:r,notes:[].concat(y(c),d,s),pitchShift:0},n.updateFile({blob:l,sampleId:r}),a.set(r,l))},ticksToSeconds:d};function p(e,t){var o=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).pitchShift,i=void 0===o?0:o,r=k(),s=_.clone(e);return s.id=r,s.notes=y(t),s.pitchShift=i,s.isSaved=!1,n.updateFile({blob:s,sampleId:r}),a.set(r,s),s}function m(e,t){var n=a.get(e);return _.chain(n.notes).map(function(e){return d(parseFloat(e.time)+parseFloat(e.duration),t)}).max().value()||0}function f(e,t){var n=a.get(e);return _.chain(n.notes).map(function(e){return _.assign({},e,{duration:d(parseFloat(e.duration),t),time:d(parseFloat(e.time),t)})}).sortBy("time").value()}function h(e){var t,n=new ArrayBuffer(e.length),o=new Uint8Array(n);for(t=0;t<e.length;t++)o[t]=e.charCodeAt(t);return n}function g(e){return _.includes(e.name,"Note")}function v(e){return _.includes(e.name,"Sustain")}function b(e,n){var o=n.bpm,a=void 0===o?i.current.metronome.bpm:o,r=n.soundbank,s={parts:[e],transport:{bpm:a,timeSignature:[i.current.metronome.signature.notesCount,i.current.metronome.signature.noteValue],instruments:[On[r]]}};try{return new Blob([h(MidiConvert.generate(s))],{type:"audio/midi"})}catch(e){throw t.Raven.captureException(e,{extra:s}),e}}function y(e){return _.chain(e).filter(function(e){var n=e.midiNote>=0&&e.midiNote<=127||"sustain"===e.eventName||"pitchBend"===e.eventName;return n||t.Raven.captureException("Out of range MIDI note",{extra:e}),n}).sortBy(function(e){return-parseInt(e.duration)}).value()}function w(e,t){return _.chain(e).map(function(e){if(e.time>=t.sampleOffset-s.TIME_APPROXIMATION&&(t.loopLength&&e.time-t.sampleOffset<t.loopLength||!t.loopLength&&e.time-t.sampleOffset<t.endPosition))return function(e){for(var n=t.loopLength?(t.endPosition-t.startPosition)/t.loopLength:1,o=e.time-t.sampleOffset,a=t.endPosition-t.startPosition,i=[],r=0;r<n&&o<a-s.TIME_APPROXIMATION;)i.push(_.merge({},e,{time:o,inLoop:r})),r++,o=e.time+t.loopLength*r-t.sampleOffset;return i}(e)}).flatten().compact().sortBy("time").value()}function S(e,t){var o,i,r=_.minBy(e,"startPosition").startPosition;return o=_.chain(e).filter({isPlayable:!0}).map(function(e){var n=f(e.sampleId,t);return n=w(n,e),_.map(n,function(t){return t.time+=e.startPosition,t})}).flatten().map(function(e){return e.time-=r,e.time="".concat(u(e.time,t),"i"),e.duration="".concat(u(e.duration,t),"i"),e.id=k(),e}).value(),i={id:k(),notes:o,pitchShift:0},n.updateFile({blob:i,sampleId:i.id}),a.set(i.id,i),i}function P(e,t){var n=l[t.slug][e.midiNote];return n&&n.buffer?e.time+n.buffer.duration:e.time+e.duration}function E(e){return c.getList().then(function(t){return c.getBank(_.find(t,{slug:e}))})}function T(e){return _.includes([46,44,42],e.midiNote)?"42-44-46":_.includes([38,37],e.midiNote)?"37-38":_.includes([51,53],e.midiNote)?"51-53":e.midiNote}function M(e,t){return e.push(_.maxBy(t,"time")),e}}]),angular.module("bandlab.editor").factory("EditorMixdown",["$q","AudioCore","AudioCtx","EditorData","EditorEncoder","EditorRevision","EditorState","Katnip",function(e,t,n,o,a,i,r,s){var c=[];return{cancel:function(){_.forEach(c,function(e){e.cancel()}),c=[]},getMixdownBuffer:l,makeMixdown:d,makeRegionsMixdown:function(e){return d(null,e)}};function l(a,r,l){var d,p=!1,m=e.resolve(s).then(function(){return function(t,a){var i;return i=t?o.getTracksDuration(t):a?o.getRegionsDuration(a):o.getSongDuration(!0),e.when(i).then(function(e){return e*n.get().sampleRate})}(a,r)}).then(function(o){return o<=0?e.reject(new Error(V)):(d=new OfflineAudioContext(2,o,n.get().sampleRate),a?function(e,n,o){return o&&(n=_.map(_.cloneDeep(n),function(e){return e.automation={pan:[],volume:[]},e.pan=0,e.volume=1,e})),u(e).then(function(){return t.getPlayer(e,Object.assign({},i.current,{tracks:n}))}).then(function(t){return t.connect(e.destination),t.playSong(n)})}(d,a,l):r?function(n,o){return u(n).then(function(){return t.getPlayer(n)}).then(function(t){t.connect(n.destination);var a=_.map(o,function(e){return t.playRegion(e,_.minBy(o,"startPosition").startPosition)});return e.all(a)})}(d,r):function(e){return u(e).then(function(){return t.getPlayer(e,i.current)}).then(function(t){var n=_.some(i.current.tracks,{isSolo:!0}),o=_.filter(i.current.tracks,function(e){return!e.isMuted&&(!n||e.isSolo)});return t.connect(e.destination),t.playSong(o)})}(d))}).then(function(){return!p&&d.startRendering()});return m.cancel=function(){return p=!0,d&&d.suspend(d.currentTime+1)},c.push(m),m}function u(e){return Promise.all([e.audioWorklet.addModule("https://www.bandlab.com/web-app/common/workers/libsfaw-31388d2e8a.js"),e.audioWorklet.addModule("https://www.bandlab.com/web-app/common/workers/libvasynthaw-5438bc1063.js")])}function d(t,n){var o;return r.isMixing=!0,l(t,n).then(function(e){return o=e,a.createWav(e)}).then(function(e){return{blob:e,buffer:o}}).catch(function(t){return e.reject(new Error(q))}).finally(function(){r.isMixing=!1})}}]),angular.module("bandlab.editor").factory("EditorModel",["EditorHelper","EditorRevision","editorSettings","Me","Revision","Soundbank",function(e,t,n,o,r,s){return{createRegion:function(e){var n=_.defaults({},e,{automation:{pan:[],volume:[]},canEdit:!0,id:k(),loopLength:0,name:"Region",playbackRate:1,pitchShift:0,sampleId:w,sampleOffset:0,startPosition:0,trackId:w});return n.name=n.name.substring(0,40).trim(),n._bpm=_.get(t,"current.metronome.bpm",120),n._sampleOffset=n.sampleOffset,n._startPosition=n.startPosition,n._loopLength=n.loopLength,n._endPosition=n.endPosition,n},createRevision:function(e){var t=_.defaults({},e,{canEdit:!0,creator:o,genres:[{id:"other",name:"Other"}],id:null,key:null,lyrics:null,mastering:null,metronome:{bpm:120,pristine:!0,signature:{notesCount:4,noteValue:4,pristine:!0}},pan:0,parentId:null,sampleId:k(),samples:[],song:null,title:"New Revision",tracks:[],volume:1,auxChannels:_.cloneDeep(n.AUX_CHANNELS_DEFAULT)});return new r(t)},createTrack:function(e){var t,o=_.defaults({},e,{automation:{volume:[],pan:[]},canEdit:!0,channel:1,effects:[],id:k(),isMuted:!1,isSolo:!1,name:"Track",order:0,pan:0,patterns:null,preset:a.slug,regions:[],soundbank:null,volume:1,auxSends:_.cloneDeep(n.TRACK_AUX_DEFAULT)}),r=(t=o.order,i[t%i.length]);return _.defaults(o,{color:r.hex,colorName:r.name,type:l(o)}),o.type===c&&(o.patterns=[]),o.name=o.name.substring(0,128).trim(),o},getTrackType:l};function l(t){return t.patterns&&t.patterns.length?c:t.soundbank?s.getPropertyValue(t.soundbank,"instrumentSlug"):e.isAudioTrack(t)?t.type:p}}]),angular.module("bandlab.editor").factory("EditorPlayback",["$analytics","$q","$rootScope","$timeout","AnimationFrame","AppNotifications","AudioState","EditorCycle","EditorData","EditorDB","EditorDelayMeter","EditorEncoder","editorEvents","EditorHelper","EditorMidiSamples","EditorPlayer","EditorRecorder","EditorRevision","EditorScroll","editorSettings","EditorState","EditorTimeline","InputDevice","Metronome",function(e,t,n,o,a,i,r,s,l,u,d,p,m,f,h,g,v,b,y,w,k,S,P,E){var T,M,$,C=angular.noop,_=angular.noop,A={record:0,play:0};return{pausePlay:V,startPositions:A,togglePlay:function(){k.isFollowingPlayhead=!0,B(),C=n.$on(m.endOfCycle,function(){g.setPlaybackPosition(s.get().startTime),E.sync(k.crTime),k.isFollowingPlayhead&&y.scrollToX({time:s.get().startTime,scalePx:k.scalePx})}),k.isPlaying?k.isRecording?I():(E.stop(),V()):(A.play=k.crTime,k.isCycling&&(g.setPlaybackPosition(s.get().startTime),y.scrollToX({time:s.get().startTime,scalePx:k.scalePx})),q(),r.isMetronomeEnabled&&E.start(k.crTime),n.$broadcast(m.startPlay),n.$broadcast(m.stopLoop))},toggleRecord:I};function R(){q(),n.$broadcast(m.startPlay),k.isCycling&&s.reschedule()}function I(){var t=s.get(),a=t.endTime-t.startTime;if(B(),b.selectedTrack.id){if(k.isRecording&&!k.isWaitingCountIn)return U();if(k.isWaitingCountIn)o.cancel(T),o.cancel(M),E.stop(),O(new Error(D));else if(Math.ceil(k.crTime)<w.SONG_DURATION_MAX){if(!b.armedTracks[1]&&!b.armedTracks[2])return b.selectedTrack.type===c?void i.addNotification({title:W,content:K,autoclose:8e3}):void i.addNotification({title:G,content:z,autoclose:8e3});if(k.isCycling){if(!a||a<w.CYCLE_RECORDING_DURATION_MIN)return void i.addNotification({title:L,content:N.replace("{$1}",String(w.CYCLE_RECORDING_DURATION_MIN)),autoclose:5e3});g.setPlaybackPosition(t.startTime)}!function(){var t=0;k.isFollowingPlayhead=!0,A.play=A.record=k.crTime,y.scrollToX({scalePx:k.scalePx,time:A.record}),n.$broadcast(m.startRecord,{input:P.getCurrent().device,fromTime:A.record}),B();try{!function(){var e,t=(e=f.getMeasureDuration(b.current.metronome),A.record%e+e*w.COUNT_IN_DURATION);function n(e){if(v.connectInput(),k.isRecording=!0,!e)return d.setRecordCountIn(0),v.start(),R(),void(r.isMetronomeEnabled&&E.start(k.crTime));d.setRecordCountIn(t),R(),T=o(function(){v.start(),k.isWaitingCountIn=!1},1e3*t,!1),(r.isMetronomeEnabled||w.COUNT_IN_DURATION>0)&&t&&(E.start(k.crTime),M=o(function(){r.isMetronomeEnabled||E.stop()},1e3*t-300,!1))}k.isPlaying?(t=0,k.isCycling?(V(),g.setPlaybackPosition(s.get().startTime),n()):(k.isRecording=!0,v.connectInput(),v.start())):(w.COUNT_IN_DURATION?(g.setPlaybackPosition(A.record-t),k.isWaitingCountIn=!0,n(!0)):n(),k.isCycling&&s.reschedule())}()}catch(e){O()}finally{e.eventTrack("Record Audio",{category:"Mix Editor",label:P.getCurrent().device.name})}_=n.$on("Recorder:timeout",U),C=n.$on(m.endOfCycle,function(){if(++t>=w.CYCLE_RECORDS_AMOUNT_MAX&&!b.selectedTrack.soundbank)U($);else{g.setPlaybackPosition(A.record),V(),v.stop(),$=j($);try{v.connectInput(),v.start({cycleCounter:t}),q(),E.sync(k.crTime)}catch(e){k.isRecording=!1,C()}}})}()}}}function O(e){v.disconnectInput(),V(),g.setPlaybackPosition(A.record),k.isRecording=!1,k.isWaitingCountIn=!1}function x(e){return p.createWav(e).then(function(t){u.updateFile({blob:t,sampleId:e.id}),l.scheduleSampleUpload(t,e.id)}).catch(function(){b.failedEncodingTasks.push(function(){return p.createWav(e).then(function(t){return{blob:t,id:e.id}})})})}function U(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$;B(),k.isRecording=!1,v.stop(),V(),E.stop(),s.stop(),g.setPlaybackPosition(A.record),a.start("playing",!1),j(e),l.updateSongDuration(),$=null}function j(e){var o,a,r=f.isBandLabInstrumentTrack(b.armedTracks[1])||f.isBandLabInstrumentTrack(b.armedTracks[2]),c=f.isAudioTrack(b.armedTracks[1])||f.isAudioTrack(b.armedTracks[2]);b.selectedRegions.clear(),r&&(o=v.getMidiRecord(),a=f.isBandLabInstrumentTrack(b.armedTracks[1])&&b.armedTracks[1]||f.isBandLabInstrumentTrack(b.armedTracks[2])&&b.armedTracks[2],h.has(o.id)&&a&&S.createRegionFromMidiScore(h.get(o.id),a,A.record,k.isCycling&&s.get().endTime,w.ADDITIVE_RECORDING),n.$broadcast(m.completeRecord)),c&&function(e){var n=v.getAudioRecord(),o=n.duration,a=n.left,r=n.right,c=n.stereo,l={1:a,2:r,3:c};return o<w.REGION_DURATION_MIN?(i.addNotification({title:Y,content:X.replace("{$1}",String(w.REGION_DURATION_MIN)),autoclose:5e3}),t.resolve()):(e?e=S.addTakeToRegion(c,e):(f.isAudioTrack(b.armedTracks[1])&&(e=S.createRegionFromAudioBuffer(b.armedTracks[1],l[b.armedTracks[1].channel],A.record,k.isCycling&&s.get().endTime)),f.isAudioTrack(b.armedTracks[2])&&(e=S.createRegionFromAudioBuffer(b.armedTracks[2],l[b.armedTracks[2].channel],A.record,k.isCycling&&s.get().endTime))),t.all([a&&x(a),r&&x(r),c&&x(c)]))}(e).finally(function(){n.$broadcast(m.completeRecord)})}function B(){C(),_()}function F(){k.isPlaying&&(k.crTime=g.current.getPlaybackTime(),k.crTime>=w.SONG_DURATION_MAX&&(k.isRecording?U():(V(),E.stop()),k.crTime=w.SONG_DURATION_MAX))}function q(){k.crTime>=w.SONG_DURATION_MAX||(g.startPlaying(),a.add("playing",F),a.start("playing",!0,k),d.markStartPlaying())}function V(){g.pausePlaying(),s.stop(),a.stop("playing"),a.remove("playing",F),n.$broadcast(m.pausePlaying)}}]),angular.module("bandlab.editor").factory("EditorPlayer",["AudioCore","AudioCtx","EditorCycle","EditorData","EditorDB","EditorRevision","EditorState",function(e,t,n,o,a,i,r){var s={addTrack:function(e){s.current.addTrack(e),u()},current:{},deleteTrack:function(e){r.isPlaying&&s.current.stopTrack(e),s.current.deleteTrack(e.id),u()},init:function(n){return e.getPlayer(t.get(),n).then(function(e){s.current=e,s.current.connect(t.get().destination)})},pausePlaying:function(){s.current.stopSong&&s.current.stopSong(),r.isPlaying=!1},setPlaybackPosition:function(e){r.crTime=e,r.isPlaying&&(s.current.stopSong(),c())},startPlaying:c,updateSong:function(){r.isPlaying&&s.current.stopSong(),s.current.reinitGraph(i.current.tracks,i.current.volume),r.isPlaying&&c(),u()},updateSourcesInTracks:function(e){r.isPlaying&&_.forEach(i.current.tracks,function(t){_.includes(e,t.id)&&d(t)&&s.current.replayTrack(t)}),u()},updateTrackAudibility:l,updateTracksAudibility:function(){_.forEach(i.current.tracks,l)}};return s;function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.crTime,t=_.filter(i.current.tracks,d);s.current.playSong(t,e),r.isCycling&&n.reschedule(),r.isPlaying=!0}function l(e){d(e)?s.current.unmuteTrack(e,s.current.getPlaybackTime()):s.current.muteTrack(e)}function u(){o.updateSongDuration(),r.songDuration&&a.addSnapshot(i.current.id,i.current)}function d(e){return!e.isMuted&&(!o.checkAnySolo()||e.isSolo)&&(!(r.isRecording&&!e.soundbank)||!function(e){return i.selectedTrack===e}(e))}}]),angular.module("bandlab.editor").factory("EditorRecorder",["$analytics","$rootScope","AudioCtx","ClientDevice","EditorDelayMeter","EditorHelper","EditorRevision","editorSettings","EditorTrack","InputDevice","SharedMidiSynth",function(e,t,n,o,a,i,r,s,c,l,u){var d,p,m,f,h=s.SONG_DURATION_MAX*n.get().sampleRate,g=[16384,8192,4096][Math.min(Math.round(96e3/n.get().sampleRate),2)+o.isMacOs-1];return{connectInput:function(){(m=n.get().createScriptProcessor(g)).componentName="Recorder",l.connectDry(m)},disconnectInput:b,eventInterval:g/n.get().sampleRate,getAudioRecord:function(){if(!d.float32ArraysL&&!d.float32ArraysR)return{};var t,o,s,c=a.getTotalLatency(),u=v(d.float32ArraysL,c),p=v(d.float32ArraysR,c),m="Audio record",f=d.duration;return d={},h(1)&&((o=n.get().createBuffer(2,u.length,n.get().sampleRate)).getChannelData(0).set(u),o.getChannelData(1).set(u),o.name=m,o.id=k()),h(2)&&((s=n.get().createBuffer(2,p.length,n.get().sampleRate)).getChannelData(0).set(p),s.getChannelData(1).set(p),s.name=m,s.id=k()),h(3)&&((t=n.get().createBuffer(2,u.length,n.get().sampleRate)).getChannelData(0).set(u),t.getChannelData(1).set(p),t.name=m,t.id=k()),e.eventTrack("Record sound",{category:"Recorder",label:l.getCurrent().device.kind,value:l.getCurrent().device.name}),{duration:f,left:o,right:s,stereo:t};function h(e){return i.isAudioTrack(r.armedTracks[1])&&r.armedTracks[1].channel===e||i.isAudioTrack(r.armedTracks[2])&&r.armedTracks[2].channel===e}},getMidiRecord:function(){return d},start:function(e){if(d={duration:0,float32ArraysL:[],float32ArraysR:[],id:k(),length:0,waveform:[],waveformL:[],waveformR:[]},(f={midi:i.isBandLabInstrumentTrack(r.armedTracks[1])||i.isBandLabInstrumentTrack(r.armedTracks[2]),audio:i.isAudioTrack(r.armedTracks[1])||i.isAudioTrack(r.armedTracks[2])}).midi){u.startRecordEvents();var o=i.isBandLabInstrumentTrack(r.armedTracks[1])&&r.armedTracks[1]||i.isBandLabInstrumentTrack(r.armedTracks[2])&&r.armedTracks[2];o&&c.setSelected(o)}f.audio&&(m.onaudioprocess=function(e){var o=e.inputBuffer.getChannelData(0),a=e.inputBuffer.getChannelData(1),r=i.calcAbsMax(o),s=i.calcAbsMax(a);if(d.length>=h)return t.$broadcast("Recorder:timeout",d),y();d.float32ArraysL&&(d.length+=o.length,d.duration=d.length/n.get().sampleRate,d.float32ArraysL.push(new Float32Array(o)),d.float32ArraysR.push(new Float32Array(a)),d.waveformL.push(r),d.waveformR.push(s),d.waveform.push(Math.max(r,s)),t.$broadcast("Recorder:onAudioProcessL",d.waveformL),t.$broadcast("Recorder:onAudioProcessR",d.waveformR),t.$broadcast("Recorder:onAudioProcess",d.waveform))},m.connect(n.get().destination)),t.$broadcast("Recorder:start",e),p=!0,a.markStartRecording()},stop:y};function v(e,t){var o,a,i,r=t*n.get().sampleRate,s=Math.ceil(e.length*g);if(r>s)return[];for(a=r<0?-r:0,o=new Float32Array(s+a),i=0;i<e.length;i++)o.set(e[i],a),a+=e[i].length;return r>=0?o.subarray(r):o}function b(){m.onaudioprocess=angular.noop,m.disconnect()}function y(){p&&(f.midi&&u.stopRecordEvents(d.id),f.audio&&b(),p=!1,t.$broadcast("Recorder:stop"))}}]),angular.module("bandlab.editor").factory("EditorReset",["$q","$rootScope","AnimationFrame","AudioReset","EditorClipboard","EditorCollaboratorsState","EditorHistory","EditorLoader","EditorMidiSamples","EditorPlayback","EditorRevision","EditorScroll","EditorSocket","EditorState","EditorWaveform","MetronomeState","MidiDevice","MidiEditorState",function(e,t,n,o,a,i,r,s,c,l,u,d,p,m,f,h,g,v){return{reset:function(){o.reset(),s.flushQueue(),l.pausePlay(),r.clear(),f.deleteUnusedCache(),c.clear(),v.isVisible=null,a.value=null,u.current={},u.uploadingSamples=[],u.frozenTrackBuffers.clear(),u.selectedRegions.clear(),u.selectedTrack={},u.trackFreezing.clear(),p.disconnect(),g.unplug(),i.activeChat=null,i.chats=null,i.members={},i.readers={},i.sessions=[],i.writers={},e.resolve(h.worker).then(function(e){e.postMessage("stop")}),n.reset(["playing","scroll:notesTop","scroll:timelineLeft","scroll:tracksTop","scale:timeline"]),m.reset(),d.reset(),function(){for(var e in t.$$listeners)/MixEditor/.test(e)&&delete t.$$listeners[e]}()}}}]),angular.module("bandlab.editor").factory("EditorRevision",function(){return{armedTracks:{1:null,2:null},creatorKitQuantization:new Map,current:{},failedEncodingTasks:[],frozenTrackBuffers:new Map,lastTrack:{guitar:{},voice:{}},lastVoiceMonitoring:null,redoStack:[],releaseLock:function(){},sampleFiles:new Map,selectedRegions:new Set,selectedTrack:{},trackAutomationParameters:new WeakMap,lastDevice:null,trackFreezing:new Map,trackMonitoring:new WeakMap,undoStack:[],uploadingSamples:[]}}),angular.module("bandlab.editor").factory("EditorScrollState",["AnimationFrame","EditorState","MidiEditorState",function(e,t,n){return new Proxy({notesLeft:0,notesTop:0,timelineLeft:0,tracksTop:0,notesEl:{},notesTimelineEl:{},timelineEl:{},tracksEl:{},SCROLL_STEP:30},{set:function(o,a,i){if(o[a]===i)return!0;switch(a){case"notesLeft":i=Math.max(i,0),(i=Math.min(i,n.containerWidth+100-o.notesTimelineEl.clientWidth))!==o.notesTimelineEl.scrollLeft&&(e.start("scroll:notesLeft",!1,i),n.isLocked&&!n.isZooming&&(e.start("scroll:timelineLeft",!1,i),o.timelineLeft=i));break;case"notesTop":i=Math.max(i,0),(i=Math.min(i,o.notesEl.scrollHeight-o.notesEl.clientHeight))!==o.notesEl.scrollTop&&e.start("scroll:notesTop",!1,i);break;case"timelineLeft":i=Math.max(i,0),(i=Math.min(i,t.containerWidth+100-o.timelineEl.clientWidth))!==o.timelineEl.scrollLeft&&(e.start("scroll:timelineLeft",!1,i),n.isLocked&&!n.isZooming&&(e.start("scroll:notesLeft",!1,i),o.notesLeft=i));break;case"tracksTop":i=Math.max(i,0),(i=Math.min(i,o.tracksEl.scrollHeight-o.tracksEl.clientHeight))!==o.tracksEl.scrollTop&&e.start("scroll:tracksTop",!1,i)}return o[a]=i,!0}})}]).factory("EditorScroll",["AnimationFrame","EditorScrollState",function(e,t){return{focusedNotesRescale:function(n){t.notesLeft=a(Ln({clientWidth:t.notesTimelineEl.clientWidth,scrollLeft:t.notesLeft},n)),e.start("scroll:notesLeft",!1,t.notesLeft,!0,!1)},focusedRescale:function(n){t.timelineLeft=a(Ln({clientWidth:t.timelineEl.clientWidth,scrollLeft:t.timelineLeft},n)),e.start("scroll:timelineLeft",!1,t.timelineLeft,!0,!1)},manualScroll:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.left,o=e.right,a=e.up,i=e.down,r=t.SCROLL_STEP;n||o?t.timelineLeft+=n?-r:r:(a||i)&&(t.tracksTop+=a?-r:r)},manualNotesScroll:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.left,o=e.right,a=e.up,i=e.down,r=t.SCROLL_STEP;n||o?t.notesLeft+=n?-r:r:(a||i)&&(t.notesTop+=a?-r:r)},reset:function(){t.notesLeft=0,t.notesTop=0,t.timelineLeft=0,t.tracksTop=0,t.notesEl={},t.timelineEl={},t.tracksEl={}},scrollNotesToX:function(e){t.notesLeft=n(t.notesLeft,t.notesTimelineEl,e)},scrollNotesToY:function(e){t.notesTop=o(t.notesTop,t.notesEl,e)},scrollToBottom:function(){t.tracksTop=1/0},scrollToX:function(e){t.timelineLeft=n(t.timelineLeft,t.timelineEl,e)},scrollToY:function(e){t.tracksTop=o(t.tracksTop,t.tracksEl,e)}};function n(e,t,n){return angular.isDefined(n.time)?Math.round(n.time*n.scalePx)-Math.round(t.clientWidth/2):"left"===n.direction?e-t.clientWidth:"right"===n.direction?e+t.clientWidth+(n.offset||0):angular.isDefined(n.percent)?(n.percent-n.clickPosition)*t.scrollWidth+n.offsetPosition:void 0}function o(e,t,n){return"up"===n.direction?e-t.clientHeight:"down"===n.direction?e+t.clientHeight:angular.isDefined(n.percent)?(n.percent-n.clickPosition)*t.scrollHeight+n.offsetPosition:void 0}function a(e){var t=e.clientWidth,n=e.scrollLeft,o=e.time,a=e.oldScalePx,i=e.scalePx,r=o*(a||i);if(r>=n&&r<=n+t)return o*i-(o*(a||i)-n);var s=t/2;return(n+s)/(a||i)*i-s}}]),angular.module("bandlab.editor").constant("editorSettings",{ADDITIVE_RECORDING:!0,AUTOMATION:{cut:null,erase:null,move:null,paste:null},COUNT_IN_DURATION:1,CYCLE_DURATION_MIN:1,CYCLE_RECORDING_DURATION_MIN:2,CYCLE_RECORDS_AMOUNT_MAX:6,EARLY_UPLOAD_DELAY:3e4,HISTORY_UNDOS_MAX:20,IMPORT_FILE_ACCEPTED_TYPES:{formats:["audio/aac","audio/aiff","audio/amr","audio/asf","audio/flac","audio/m4a","audio/mp3","audio/mp4","audio/mpeg","audio/ogg","audio/wav","audio/webm","audio/x-m4a","audio/x-ms-wma","audio/x-wav","video/mp4","video/ogg"],signatures:[{type:"audio/aac",extension:".m4a",signature:[0,0,0,32,102,116,121,112,77,52,65]},{type:"audio/ogg",extension:".ogg",signature:[79,103,103,83]},{type:"audio/mp3",extension:".mp3",signature:[255,243]},{type:"audio/mp3",extension:".mp3",signature:[255,251]},{type:"audio/mp3",extension:".mp3",signature:[73,68,51]},{type:"audio/wav",extension:".wav",signature:[82,73,70,70]}],readable:"MP3, MP4, WAV, AAC, OGG, FLAC"},IMPORT_FILE_SIZE_MAX:120,PLAYHEAD_HALF_WIDTH:7,REGION_DURATION_MIN:.1,RULER_HEIGHT:40,RULER_GRADUATIONS:[{scaleMin:1,scaleMax:4,primary:10,secondary:1},{scaleMin:4,scaleMax:6,primary:5,secondary:1},{scaleMin:5,scaleMax:9,primary:2,secondary:1},{scaleMin:10,scaleMax:159,primary:1,secondary:.25},{scaleMin:160,scaleMax:640,primary:.2,secondary:.01}],SCALES:[1,2,4,6,10,20,40,80,160,320,640],SNAP_SETTINGS:[{readable:"Smart",value:0},{readable:"Bar",value:1},{readable:"1/2",value:.5},{readable:"1/4",value:.25},{readable:"1/8",value:1/8},{readable:"1/16",value:1/16},{readable:"1/32",value:1/32}],SONG_DURATION_MAX:360,TAIL_DURATION_MIN:.5,TRACKS_LIMIT:12,TRACK_HEADER_WIDTH:297,AUX_CHANNELS_DEFAULT:[{id:"aux1",returnLevel:1,preset:"sharedReverb"}],TRACK_AUX_DEFAULT:[{id:"aux1",sendLevel:0}]}),angular.module("bandlab.editor").constant("editorShortcuts",[{shortcut:"<kbd>Space</kbd>",label:"Play / Pause"},{shortcut:"<kbd>R</kbd>",label:"Record"},{shortcut:"<kbd>S</kbd>",label:"Slice Region",keywords:"crop cut"},{shortcut:"<kbd>C</kbd>",label:"Toggle Cycle"},{shortcut:"<kbd>M</kbd>",label:"Toggle Metronome"},{shortcut:"<kbd>G</kbd>",label:"Toggle Snap to Grid"},{shortcut:'<kbd class="cmd-ctrl"></kbd>',label:"Disable Snap to Grid"},{shortcut:"<kbd>L</kbd>",label:"Display Loop List"},{shortcut:"<kbd>H</kbd>",label:"Allow dragging of MIDI region via ruler"},{shortcut:"<kbd>Enter</kbd> or <kbd>Return</kbd>",label:"Go to Beginning"},{shortcut:"<kbd>⇦</kbd> or <kbd>⇨</kbd>",label:"Move Playhead"},{shortcut:"<kbd>Backspace</kbd> or <kbd>Delete</kbd>",label:"Delete Region"},{shortcut:'<kbd class="cmd-ctrl"></kbd> + <kbd>C</kbd>',label:"Copy Region"},{shortcut:'<kbd class="cmd-ctrl"></kbd> + <kbd>X</kbd>',label:"Cut Region"},{shortcut:'<kbd class="cmd-ctrl"></kbd> + <kbd>V</kbd>',label:"Paste Region"},{shortcut:'<kbd class="cmd-ctrl"></kbd> + <kbd>S</kbd>',label:"Save Revision"},{shortcut:'<kbd class="cmd-ctrl"></kbd> + <kbd>Z</kbd>',label:"Undo"},{shortcut:'<kbd class="cmd-ctrl"></kbd> + <kbd class="cmd-shift"></kbd> + <kbd>Z</kbd>',label:"Redo"},{shortcut:'<kbd class="cmd-ctrl"></kbd> + <kbd>⇦</kbd>',label:"Zoom Out"},{shortcut:'<kbd class="cmd-ctrl"></kbd> + <kbd>⇨</kbd>',label:"Zoom In"},{shortcut:'<kbd class="cmd-shift"></kbd> + <kbd>M</kbd>',label:"Mute Track"},{shortcut:'<kbd class="cmd-shift"></kbd> + <kbd>S</kbd>',label:"Solo Track"},{shortcut:'<kbd class="cmd-shift"></kbd> + <kbd>T</kbd>',label:"Add Track"},{shortcut:'<kbd class="cmd-shift"></kbd> + <kbd>D</kbd>',label:"Duplicate Track"},{shortcut:'<kbd class="cmd-shift"></kbd> + <kbd>Delete</kbd>',label:"Delete Track"},{shortcut:'<kbd class="cmd-shift"></kbd> + <kbd>[1-9]</kbd>',label:"Select Track"}]),angular.module("bandlab.editor").value("EditorCollaboratorsState",{activeChat:null,chats:null,members:{},readers:{},writers:{},projectChat:{}}).factory("EditorSocket",["$cookies","$q","$rootScope","$state","$stateParams","$timeout","AppNotifications","AudioCtx","AudioStretch","EditorAutomation","EditorCollaboratorsState","EditorData","EditorHelper","EditorHistory","EditorLoader","EditorMidiSamples","EditorPlayer","EditorRevision","EditorState","EditorTrack","FileHelper","Me","MetronomeState","Sample","User",function(e,t,o,a,i,r,s,c,l,u,d,p,m,f,h,g,v,b,y,w,k,S,P,E,T){var M=t.defer(),$=angular.noop,C={disconnect:angular.noop,disconnected:!0};return{disconnect:A,isConnected:function(){return!!i.userId},getLink:function(){return a.go("mixEditor",{projectId:i.projectId,userId:i.userId||S.id}),a.href("mixEditor",{projectId:i.projectId,userId:i.userId||S.id},{absolute:!0})},joinProject:D,joinSession:x,sendUpgrade:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S;d.session&&(C.disconnected?O({withLoader:!1}):(C.emit("message",{type:"upgrade",payload:{midiSamples:He(g),revision:b.current,user:e}}),$(),L({revId:b.current.id,userId:e.id}),a.go(".",{id:b.current.id,userId:e.id},{location:"replace"}),y.canCollaborate&&($=R())))}};function A(){C.disconnect(),$(),d.activeChat=null,d.chats=null,d.members={}}function R(){return o.$watch(function(){return _.omit(b.current,"samples")},U,!0)}function I(){A(),h.flushQueue(),i.userId&&s.addNotification({title:"Unable to connect to live session",content:"Make sure the link is correct and try again.",action:'\n          <div style="position: relative;">\n            <a ui-sref="library">\n              '.concat("Go to Library","\n            </a>\n          </div>\n          "),classList:"alert"})}function O(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=n.withLoader,l=void 0===c||c,u=n.session,p=void 0!==u&&u,m=n.project,f=void 0!==m&&m,g=l&&h.pushTask("loadSample");(C=io("https://realtime.bandlab.com/mix-editors?userId=".concat(S.id),{reconnectionAttempts:3,transportOptions:{polling:{extraHeaders:{Authorization:"Bearer ".concat(e.get("sessionKey")),"X-Client-Id":"BandLab-Web","X-Client-Version":"8.0.86"}}}})).on("connect",function(){p?x():f&&D(),y.canCollaborate&&(U(),h.finishTask(g))}),C.on("disconnect",function(){r.cancel(t)}),C.on("reconnect_failed",function(){return I()}),C.on("error",function(){return I()}),C.on("exception",function(){return I()}),C.on("message",function(e){switch(e.type){case"upgrade":b=(v=e.payload).midiSamples,w=v.revision,k=v.user,$(),N({midiSamples:b,revision:w}),L({revId:w.id,userId:k.id}),a.go(".",{id:w.id,userId:k.id},{location:"replace"}),y.canCollaborate&&($=R());break;case"revision":N(e.payload).finally(function(){h.finishTask(g)});break;case"list":var n=j()&&!e.payload.writers.length;r.cancel(t),n&&(t=r(function(){return!j()&&void s.addNotification({title:"Inactive live session",content:"The collaborator controlling the Mix Editor has left the session."})},1e4));var i=_.reduce(e.payload.readers,function(e,t){return e[t]=!0,e},{}),c=_.reduce(e.payload.writers,function(e,t){return e[t]=!0,e},{}),l=Un({},i,{},c);d.writers[S.id]||d.readers[S.id]||!c[S.id]?!d.writers[S.id]&&c[S.id]?s.addNotification({title:"You’re now in Edit mode.",content:"Once you’re done, click ‘Allow Control’ button to hand over this project to other collaborators.",image:"https://www.bandlab.com/web-app/images/mix-editor/icon-edit-72169d789d.png",autoclose:5e3}):!d.readers[S.id]&&i[S.id]&&s.addNotification({title:"You’re now in View mode",content:"To work on this project, send a message to the collaborator who is currently editing it.",image:"https://www.bandlab.com/web-app/images/mix-editor/icon-view-71cc87ee1b.png",autoclose:5e3}):s.addNotification({title:"You’re now live!",content:"Invite more members to this project to collaborate!",image:d.members[S.id].picture.xs,classList:"user",action:'\n                  <div style="position: relative;">\n                    <a ng-click="$root.$broadcast(\'$inviteCollaborators\')">\n                      Invite Collaborators\n                    </a>\n                  </div>\n                '});var u=Object.keys(Un({},c,{},i)),p=Object.keys(Un({},d.writers,{},d.readers)),m=_.chain(u).difference(p).filter(function(e){return e!==S.id}).value();p.length&&m.length&&d.members[m[0]]&&s.addNotification({title:"".concat(d.members[m[0]].name," joined live session."),image:d.members[m[0]].picture.s,classList:"user",autoclose:5e3});var f=_.chain(p).difference(u).filter(function(e){return e!==S.id}).value();p.length&&f.length&&d.members[f[0]]&&s.addNotification({title:"".concat(d.members[f[0]].name," left your Live Session"),image:d.members[f[0]].picture.s,classList:"user",autoclose:5e3}),d.readers=i,d.writers=c,$(),y.canCollaborate&&Object.keys(l).length>1&&(U(),$=R()),o.$applyAsync();break;default:I()}var v,b,w,k}),C.on("projectMessage",function(e){switch(e.type){case"sessionList":var t=e.payload.sessions;if(d.sessions&&t.length>d.sessions.length){var n=_.reduce(d.sessions,function(e,t){return[].concat(He(e),He(t.write.clients),He(t.read.clients))},[]),a=_.reduce(t,function(e,t){return[].concat(He(e),[t.userId])},[]),r=_.chain(a).difference(n).filter(function(e){return![S.id,i.userId].includes(e)}).value();r.length&&(d.members[r[0]]?s.addNotification({title:"".concat(d.members[r[0]].name," started a live session."),image:d.members[r[0]].picture.s,classList:"user",autoclose:5e3}):T.get({id:r[0]}).$promise.then(function(e){s.addNotification({title:"".concat(e.name," started a live session."),image:e.picture.s,classList:"user",autoclose:5e3})}))}d.session=_.find(e.payload.sessions,{userId:i.userId}),d.userId=i.userId,d.projectId=b.current.song.id,d.sessions=t,o.$applyAsync()}})}function x(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).userId,t=void 0===e?i.userId||S.id:e,n=t===S.id?"write":"read";y.canCollaborate=t===S.id,C.disconnected?O({session:!0}):b.current.song.id&&(C.emit("joinSession","/".concat(b.current.song.id,"/").concat(t,"/").concat(n)),C.emit("joinProject","/".concat(b.current.song.id)))}function D(){C.disconnected?O({project:!0}):b.current.song.id&&C.emit("joinProject","/".concat(b.current.song.id))}function L(e){var t=e.userId,n=void 0===t?i.userId||S.id:t,o=n===S.id?"write":"read";y.canCollaborate=n===S.id,C.disconnected?O({session:!0,project:!0}):b.current.song.id&&(C.emit("joinSession","/".concat(b.current.song.id,"/").concat(n,"/").concat(o)),C.emit("joinProject","/".concat(b.current.song.id)))}function N(e){var a=e.midiSamples,i=e.revision;M.reject("Abort"),M=t.defer(),_.merge(P.settings,i.metronome),f.clear(),a.map(function(e){var t=n(e,2),o=t[0],a=t[1];return g.set(o,a)});var s=_.chain(b.current.samples).intersectionBy(i.samples,"id").concat(i.samples).uniqBy("id").value(),d=_.filter(s,function(e){return!g.has(e.id)&&(!e.buffer||e.buffer&&e.buffer.constructor!==AudioBuffer)}),h=_.chain(d).filter(function(e){return!e.drySampleId}).map(function(e){return e.buffer=null,function(e){return e.src?k.download(e.src).then(Je).then(c.decodeAudioData):E.getJSON("samples/".concat(e.id,"?format=m4a")).then(function(e){var t=e.value;return E.getBuffer(t)}).then(c.decodeAudioData)}(e).then(function(t){return e.buffer=t,e}).catch(function(n){return e.buffer=null,t.reject(n)})}).value();return t.race([t.all(h),M.promise]).then(function(){var e=_.chain(d).filter(function(e){return e.drySampleId}).map(function(e){var n=_.find(s,{id:e.drySampleId}).buffer;return l.convertAudioBuffer(n,e.playbackRate,e.pitchShift).then(function(t){e.buffer=t}).catch(function(n){return e.buffer=null,t.reject(n)})}).value();return t.race([t.all(e),M.promise])}).catch(function(e){if("Abort"===e)return t.reject();var n;n=M,r(function(){0===n.promise.$$state.status&&N({midiSamples:a,revision:i})},5e3)}).then(function(){_.mergeWith(b.current,i,function(e,t,n){return"samples"===n?s:("tracks"===n&&_.chain(t).map("regions").flatten().forEach(function(e){var t=_.find(s,{id:e.sampleId});e.isProcessing=!(t&&m.isAudioBuffer(t.buffer)||g.has(e.sampleId))}).value(),t)}),y.hasSoloTrack=p.checkAnySolo(),v.updateSong(),_.forEach(b.current.tracks,function(e){v.current.setTrackEffects(e.id,e.effects),v.current.setTrackParameter(e.id,"pan",e.pan),v.current.setTrackParameter(e.id,"sendLevel",e.auxSends[0].sendLevel),v.current.setTrackParameter(e.id,"volume",e.volume),e.id===b.selectedTrack.id&&w.setSelected(e)}),o.$applyAsync(function(){u.syncVolume()}),b.current.song=i.song})}function U(){C.emit("message",{type:"revision",payload:{midiSamples:He(g),revision:b.current}})}function j(){return Object.keys(d.writers).length}}]),angular.module("bandlab.editor").factory("EditorState",function(){return{crTime:0,canCollaborate:!0,hasRevisionChanges:null,hasSoloTrack:!1,isArming:!1,isAudioInputActive:!1,isAudioInputDragged:!1,isAudioInputVisible:!1,isAutomationVisible:!1,isBeatsDisplayed:!1,isCycling:!1,isDraggingRegions:!1,isInBackground:!0,isMixing:!1,isPlaying:!1,isPreSaving:!1,isPresetSettingsVisible:!1,isRecording:!1,isSaving:!1,isSnapping:!0,isSnappingDisabled:!1,isTimeRuler:!1,isWaitingCountIn:!1,songDuration:0,theme:"🌙",reset:function(){_.forOwn(this,function(e,t){"boolean"==typeof e&&(this[t]=!1)}.bind(this)),this.canCollaborate=!0,this.crTime=0,this.hasRevisionChanges=null,this.isInBackground=!0,this.isSnapping=!0}}}),angular.module("bandlab.editor").factory("EditorTimeline",["$window","AppNotifications","AudioCtx","EditorAutomation","EditorData","EditorDB","EditorHelper","EditorHistory","EditorMidiSamples","EditorMidiScore","EditorMixdown","EditorModel","EditorRevision","editorSettings","EditorState","FileHelper","Katnip","MidiEditor","Soundbank",function(e,t,n,o,a,i,r,s,c,l,u,d,p,m,f,h,g,v,b){return{addTakeToRegion:function(e,t){var n={id:e.id||k(),buffer:e,name:e.name};return t.takes=t.takes||[t.sampleId],t.takes=t.takes.concat(e.id),t.sampleId=e.id,s.pushUndo(p.current),p.current.samples.push(n),p.selectedRegions.add(t),t},createEmptyRegion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s.pushUndo(p.current);var n=p.current.metronome,a=l.createScore(),c=f.crTime,u=Math.min(c+4*r.getMeasureDuration(n),m.SONG_DURATION_MAX),h=d.createRegion(Bn({automation:o.getAutomationInRange(e.automation,c,u),endPosition:u,isPlayable:!!e.soundbank,name:e.name,sampleId:a.id,startPosition:c,trackId:e.id},t));return p.selectedRegions=new Set([h]),e.regions.push(h),D(e),i.addSnapshot(p.current.id,p.current),h},createRegionFromAudioBuffer:U,createRegionFromAudioFile:function(e,t,o){var r=k();return Je(e).then(n.decodeAudioData).then(function(n){n.id=r,n.name=e.name;var s=U(t,n,angular.isDefined(o)?o:f.crTime);return i.updateFile({blob:e,sampleId:r}),a.scheduleSampleUpload(e,r),{region:s,audioBuffer:n}}).catch(function(){throw new Error("Unable to process audio for ".concat(e.name))})},createRegionFromMidiScore:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;s.pushUndo(p.current);var u,f=p.current.metronome,h=l.getRoundedDuration(e.id,f.signature,f.bpm),g=a||n+h*c,y=d.createRegion({automation:o.getAutomationInRange(t.automation,n,g),endPosition:g,isPlayable:!!t.soundbank,loopLength:c>1?h:null,name:t.name,sampleId:e.id,startPosition:n,trackId:t.id});return y.endPosition>m.SONG_DURATION_MAX&&(y.endPosition=m.SONG_DURATION_MAX,y.loopLength=Math.min(y.loopLength,y.endPosition-y.startPosition),F()),p.selectedRegions.add(y),t.regions.push(y),r?(u=_.filter(t.regions,function(e){return e.endPosition>y.startPosition&&e.startPosition<y.endPosition})).length>1&&(y=j([t],u,t,p.current.metronome.bpm)):D(t),"creators-kit"===b.getPropertyValue(t.soundbank,"instrumentSlug")&&p.creatorKitQuantization.get(t.id)&&v.quantizeNotesInRegion(16,[y]),i.addSnapshot(p.current.id,p.current),y},createRegionPlaceholder:function(e,t,n,a,i){s.pushUndo(p.current);var r=a||n+t.duration,c=d.createRegion({automation:o.getAutomationInRange(e.automation,n,r),endPosition:r,isPlayable:!1,isProcessing:!0,loopLength:i,name:t.name,pitchShift:t.pitchShift,playbackRate:t.playbackRate,sampleId:k(),startPosition:n,trackId:e.id});return c.endPosition>m.SONG_DURATION_MAX&&(c.endPosition=m.SONG_DURATION_MAX,c.loopLength=Math.min(c.loopLength,c.endPosition-c.startPosition),F()),p.selectedRegions.add(c),e.regions.push(c),D(e),c},createSampleFromAudioLoopURL:function(e){var t,o=k();return h.download(e).then(function(e){return t=e,e}).then(Je).then(n.decodeAudioData).then(function(n){return n.id=o,n.src=e,i.updateFile({blob:t,sampleId:o}),a.scheduleSampleUpload(t,o),n})},deleteRegionsFromTracks:B,expandRegionLoop:function(e,t){var n=t.delta,o=t.endPosition,a=t.firstTrack,i=t.loopLength,s=t.scalePx,c=t.startPosition;if(o-n/s<=e.startPosition+r.getFirstLoopDuration(e))return e.loopLength=0,void(e.endPosition=i?c+i:o);e.loopLength=r.getFirstLoopDuration(e),x(e,{delta:n,endPosition:o,firstTrack:a,loopLength:i,scalePx:s,startPosition:c,updateOnlyEndPosition:!0})},fixDuplicateRegionIds:O,fixEffectParameters:I,mergeAudioRegions:function(e,t,n){var o=_.minBy(t,"startPosition").startPosition,a=k();return f.isMixing=!0,u.makeRegionsMixdown(t).then(function(r){var s=function(t){var r;return t.buffer.name=e.name,t.buffer.id=a,r=U(n,t.buffer,o),i.updateFile({blob:t.blob,sampleId:t.buffer.id}),r}(r);f.isMixing=!1,p.selectedRegions.clear(),p.selectedRegions.add(s),B(e,t)})},mergeMidiRegions:j,moveRegion:function(e,t,n){var o=n.delta,a=n.firstPosition,i=n.firstRegionSnapped,s=n.firstTrack,c=n.lastPosition,l=n.scalePx,u=n.startPositions,d=e.endPosition-e.startPosition,p=u[e.id],h=Math.max(p+o/l,p-a);h=Math.min(h,p+m.SONG_DURATION_MAX-c);var g=r.snapToEndRegion({id:e.id,startPosition:h},s,l);return 0!==t?h+=i:r.snapToPlayhead(h,l)?(i=f.crTime-h,h=f.crTime):0!==g?(i=g,h+=g):(i=(g=r.snapToGrid(h,f.snapDuration,{padding:5/l}))-h,(h=g)>m.SONG_DURATION_MAX-d&&(h-=i,i=0)),e.startPosition=Math.min(h,m.SONG_DURATION_MAX-d),e.endPosition=Math.min(h+d,m.SONG_DURATION_MAX),i},moveRegions:D,resizeRegionLeft:function(e,t){var n=t.delta,o=t.endPosition,a=t.loopLength,i=t.sampleOffset,s=t.scalePx,c=t.startPosition,l=0,u=(c*s-n)/s,d=i*s-n;if(!(o-u<m.REGION_DURATION_MIN))return u<0?(e.startPosition=Math.max(0,c-i),e.sampleOffset=Math.max(0,i-c),void(a&&(e.loopLength=a+c-e.startPosition))):d<0?(e.startPosition=c-i,e.sampleOffset=0,void(a&&(e.loopLength=a+i))):void(a&&(e.loopLength=a+n/s,e.loopLength<m.REGION_DURATION_MIN)?e.loopLength=m.REGION_DURATION_MIN:(e.startPosition=u,r.snapToPlayhead(e.startPosition,s)?(l=e.startPosition-f.crTime,e.startPosition=f.crTime):(l=e.startPosition-r.snapToGrid(e.startPosition,f.snapDuration,{padding:5/s}),e.startPosition-=l),e.startPosition=Math.min(e.startPosition,e.endPosition-m.REGION_DURATION_MIN),e.sampleOffset=d?d/s-l:e.sampleOffset-l,e.sampleOffset=Math.max(e.sampleOffset,0),e.loopLength&&(e.loopLength+=l)))},resizeRegionRight:x,sanitize:function(t){(function(e){e.metronome.bpm=Math.round(e.metronome.bpm)})(t),O(t),t.tracks.filter(function(e){return e.canEdit}).forEach(function(t){_.forEach(t.regions,L),function(e){e.regions=_.filter(e.regions,function(e){var t;return c.has(e.sampleId)?l.getExactDuration(e.sampleId,p.current.metronome.bpm)>0:(t=_.find(p.current.samples,{id:e.sampleId}))&&!t.error})}(t),function(t){_.forEach(t.regions,function(n){if(n)for(var o=_.filter(t.regions,function(e){return e!==n}),a=A([n],o);a[0]&&a[1];)e.Raven.captureException("Found overlapping regions before saving",{extra:{regionA:a[0],regionB:a[1],revision:p.current}}),C(a,t.regions),o=_.filter(t.regions,function(e){return e!==n}),a=A([n],o)})}(t),function(e){_.forEach(e.regions,function(e){e.loopLength>=e.endPosition-e.startPosition&&(e.loopLength=0)})}(t),function(e){_.forEach(e.regions,function(e){delete e.takes})}(t),function(e){e.patterns=_.filter(e.patterns,function(t){return c.get(t.sampleId).notes.length||_.some(e.regions,{sampleId:t.sampleId})})}(t),R(t),function(e){"custom"!==e.preset&&(e.effects=[])}(t),I(t),function(e){e.automation&&(e.automation=Bn({},e.automation,{pan:_.map(e.automation.pan,function(e){var t=e.value;return{position:e.position,value:y(t,-1,1)}})}))}(t),function(e){e.pan=y(e.pan,-1,1)}(t),function(e){e.volume=y(e.volume,0,2)}(t)})},splitRegion:P,updateRegionPlaceholder:function(e,t){var n={buffer:t,id:t.id,isMidi:t.isMidi,name:t.name,src:t.src};p.current.samples.push(n),s.rewritePlaceholder(e,n,p.current)},warnDeletedRegions:function(){t.addNotification({title:"Regions less than ".concat(1e3*m.REGION_DURATION_MIN," ms will be deleted."),autoclose:5e3})},warnTruncatedRegions:F};function y(t,n,o){return(t<n||t>o)&&e.Raven.captureException("Found out of range value",{extra:{value:t,revision:p.current}}),Math.max(n,Math.min(o,t))}function w(e,t,n){var o=_.clone(e),a=e.endPosition,i=(t-e.startPosition)/e.loopLength;o.id=k(),e.loopLength?(e.sampleOffset+=t-e.startPosition-Math.floor(i)*e.loopLength,S(e,e.startPosition+Math.ceil(i)*e.loopLength),e.loopLength=0,e.startPosition=t,o.startPosition=e.endPosition,o.endPosition-o.startPosition<o.loopLength&&(o.loopLength=0),e.endPosition>a?e.endPosition=a:n.push(o)):(e.sampleOffset+=t-e.startPosition,e.startPosition=t)}function S(e,t){e.loopLength&&t-e.startPosition<e.loopLength&&(e.loopLength=0),e.endPosition=t}function P(e,t,n,o){var a,i=_.clone(e),r=_.clone(e),s=[];return i.id=k(),r.id=k(),e.loopLength?(a=(t-e.startPosition)/e.loopLength,S(i,e.startPosition+Math.ceil(a)*e.loopLength),a=(n-e.startPosition)/e.loopLength,i.startPosition=n,i.sampleOffset=Math.max(i.sampleOffset+(n-e.startPosition)-Math.floor(a)*e.loopLength,0),i.loopLength=0,S(i,e.startPosition+Math.ceil(a)*e.loopLength),i.endPosition>i.startPosition&&(o.push(i),s.push(i)),r.startPosition=i.endPosition,r.endPosition-r.startPosition<r.loopLength&&(r.loopLength=0),r.endPosition>r.startPosition?(o.push(r),s.push(r)):i.endPosition=e.endPosition,S(e,t),t<=e.startPosition+e.loopLength&&(e.loopLength=0)):(w(i,n),S(e,t),o.push(i),s.push(i)),s.unshift(e),s}function E(e,t){return t.startPosition<e.endPosition&&t.endPosition>e.endPosition}function T(e,t){return t.startPosition<e.startPosition&&t.endPosition>e.startPosition}function M(e,t){return t.startPosition<e.startPosition&&t.endPosition>e.endPosition}function $(e,t){return t.startPosition>=e.startPosition&&t.endPosition<=e.endPosition}function C(e,t){var n=e[0],o=e[1];$(n,o)?function(e,t){t.splice(t.indexOf(e),1)}(e[1],t):M(n,o)?P(o,n.startPosition,n.endPosition,t):E(n,o)?w(o,n.endPosition,t):T(n,o)&&S(o,n.startPosition)}function A(e,t){var n;return[_.find(e,function(e){return n=_.find(t,function(t){return M(e,t)||$(e,t)||E(e,t)||T(e,t)})}),n]}function R(e){e.regions=_.filter(e.regions,function(e){return e.endPosition-e.startPosition>=m.REGION_DURATION_MIN})}function I(t){t.effects=_.map(t.effects,function(n){return n.params=_.reduce(n.params,function(o,a,i){var r=g.metadata[n.slug].params[i];return"float"===r.type?(a=parseFloat(a),a=isNaN(a)?r.default:a,a=Math.max(Math.min(a,r.max),r.min)):"enum"===r.type&&(a=_.get(_.find(r.values,{slug:a}),"slug",r.default)),o[i]=a,n.params[i]!==o[i]&&e.Raven.captureException("Found incorrect value for effect parameter",{extra:{expected:o[i],found:n.params[i],parameter:i,track:t}}),o},{}),n})}function O(t){_.chain(t.tracks).map("regions").flatten().groupBy("id").pickBy(function(e){return e.length>1}).forEach(function(n){e.Raven.captureException("Found duplicate region ID",{extra:{revisionId:t.id}}),_.chain(n).splice(0,1).forEach(function(e){e.id=k()}).value()}).value()}function x(e,t){var n,o,a,i,s,c=t.delta,l=t.endPosition,u=t.firstTrack,d=t.loopLength,p=t.scalePx,h=t.startPosition,g=t.updateOnlyEndPosition,v=void 0!==g&&g;!e.loopLength||v?(!e.loopLength&&d?e.endPosition=d+h-c/p:e.endPosition=l-c/p,r.snapToPlayhead(e.endPosition,p)?e.endPosition=f.crTime:(o=f.isTimeRuler?0:r.snapToGrid(e.endPosition,f.snapDuration,{delta:!0,padding:5/f.scalePx}),a=r.snapToLoopLength(e,p),i=r.snapToStartRegion({id:e.id,endPosition:e.endPosition},u,p),e.endPosition+=r.closestSnapPosition([i,o,a])),e.endPosition=Math.max(e.endPosition,e.startPosition+m.REGION_DURATION_MIN),e.endPosition=Math.min(e.endPosition,m.SONG_DURATION_MAX)):(s=d-c/p,f.isTimeRuler||(s-=o=(n=e.startPosition+s)-r.snapToGrid(n,f.snapDuration,{padding:5/p})),s=Math.max(s,m.REGION_DURATION_MIN),e.loopLength=s),r.getFirstLoopDuration(e)>=r.getTotalDuration(e)&&(e.loopLength=0)}function D(e){if(!(e.regions.length<=1)){for(var t=_.partition(e.regions,function(e){return p.selectedRegions.has(e)}),n=t[0],o=t[1],a=A(n,o);a[0]&&a[1];)C(a,e.regions),a=A(n,o=_.filter(e.regions,function(e){return!p.selectedRegions.has(e)}));R(e)}}function L(e){e.endPosition=N(e.endPosition),e.loopLength=N(e.loopLength),e.sampleOffset=N(e.sampleOffset),e.startPosition=N(e.startPosition)}function N(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return+Math.round(1e6*e)/1e6}function U(e,t,n,a){var r=a||n+t.duration,c={id:t.id||k(),buffer:t,name:t.name},l=d.createRegion({automation:o.getAutomationInRange(e.automation,n,r),endPosition:r,isPlayable:!e.soundbank,name:e.name,sampleId:c.id,startPosition:n,trackId:e.id});return l.endPosition>m.SONG_DURATION_MAX&&(l.endPosition=m.SONG_DURATION_MAX,F()),s.pushUndo(p.current),p.current.samples.push(c),p.selectedRegions.add(l),e.regions.push(l),D(e),i.deleteAllUnusedFiles(),i.addSnapshot(p.current.id,p.current),l}function j(e,t,n,a){var i=l.mergeScore(t,a),r=_.minBy(t,"startPosition").startPosition,s=_.maxBy(t,"endPosition").endPosition,c=d.createRegion({automation:o.getAutomationInRange(e[0].automation,r,s),endPosition:s,isPlayable:!!e[0].soundbank,name:e.name,sampleId:i.id,startPosition:r,trackId:e[0].id});return p.selectedRegions.clear(),p.selectedRegions.add(c),B(e,t),n.regions.push(c),c}function B(e,t){_.forEach(e,function(e){e.regions=_.difference(e.regions,t)})}function F(){t.addNotification({title:"Regions over ".concat(m.SONG_DURATION_MAX/60," minutes will be trimmed."),autoclose:5e3})}}]),angular.module("bandlab.editor").factory("EditorTrack",["$analytics","$q","$rootScope","$window","AppNotifications","audioEvents","AudioMonitoring","audioSettings","ConfirmModal","DrumMachine","DrumMachineState","EditorData","editorEvents","EditorHelper","EditorHistory","EditorLoader","EditorMidiSamples","EditorMidiScore","EditorMixdown","EditorModel","EditorPlayer","EditorRevision","EditorScroll","editorSettings","EditorState","EditorTimeline","EffectsPreset","InputDevice","InputsCollection","Sample","SharedMidiSynth","Soundbank",function(e,t,o,a,i,r,s,l,u,d,p,m,f,h,g,v,b,y,w,S,P,E,T,M,$,C,A,R,I,O,x,L){var N,U={};return{addTrack:function(t){if(E.current.tracks.length>=M.TRACKS_LIMIT)throw G(),new Error(ee);(t=angular.extend({order:E.current.tracks.length,pushUndo:!0},t)).pushUndo&&g.pushUndo(E.current),t.type&&!_.find(l.INSTRUMENTS,{slug:t.type})&&delete t.type,t.soundbank&&!_.find(L.getBanks(),{slug:t.soundbank})&&delete t.soundbank;var n,a,i=S.createTrack(t);return i.name=j({name:i.name}),i.type===c&&(i.patterns=d.createDefaultPatterns(i.id),n=b.get(i.patterns[0].sampleId),a=C.createRegionFromMidiScore(n,i,0,0,0,4),n=b.get(i.patterns[1].sampleId),C.createRegionFromMidiScore(n,i,a.endPosition,0,0,4),d.selectPattern(i.patterns[0])),h.isAudioTrack(i)&&(R.testSampleRate(),E.trackMonitoring.set(i,E.trackMonitoring.get(E.lastTrack[i.type]))),E.current.tracks.push(i),o.$broadcast(f.stopLoop),t.mutePrevious&&(E.selectedTrack.isMuted=!0),P.addTrack(i),B(i),e.eventTrack("Add Track",{category:"Mix Editor",label:""}),T.scrollToBottom(),i},deleteTrack:function(t){var n=E.current.tracks.indexOf(t);-1!==n&&(g.pushUndo(E.current),E.current.tracks.splice(n,1),P.deleteTrack(t),h.refreshTracksOrder(E.current.tracks),t===E.armedTracks[1]?E.armedTracks[1]=null:t===E.armedTracks[2]&&(E.armedTracks[2]=null),t===E.selectedTrack&&(E.selectedRegions.clear(),E.current.tracks.length?B(E.current.tracks[E.current.tracks.length-1]):E.selectedTrack={}),e.eventTrack("Delete Track",{category:"Mix Editor",label:""}),$.hasSoloTrack=m.checkAnySolo(),P.updateTracksAudibility())},downloadTrackMixdown:function(n){var o=v.pushTask("export");return w.makeMixdown([n]).then(function(t){saveAs(t.blob,"".concat(E.current.song.name," - ").concat(n.name,".").concat(O.getExtensionByMime(t.blob.type))),e.eventTrack("Export Track",{category:"Mix Editor",label:O.getExtensionByMime(t.blob.type)})}).catch(function(e){return i.addNotification({title:q,content:e.message,classList:"alert",autoclose:5e3}),t.reject(e)}).finally(function(){v.finishTask(o)})},duplicateTrack:function(e){if(E.current.tracks.length>=M.TRACKS_LIMIT)return G();g.pushUndo(E.current);var t=_.cloneDeep(e);return t.id=k(),t.name=j({name:e.name,isDuplicatingTrack:!0}),t.isFrozen=!1,t.isFreezing=!1,_.forEach(t.regions,function(e){e.id=k(),e.trackId=t.id}),t.type===c&&_.forEach(t.patterns,function(e){var n=b.get(e.sampleId),o=y.editScore(n,n.notes);_.chain(t.regions).filter({sampleId:e.sampleId}).forEach(function(e){e.sampleId=o.id}).value(),o.trackId=t.id,e.sampleId=o.id}),E.current.tracks.push(t),h.refreshTracksOrder(E.current.tracks),E.trackMonitoring.set(e,E.trackMonitoring.get(e)),P.addTrack(t),t},freezeTrack:F,isArmed:function(e){return E.armedTracks[1]===e?1:E.armedTracks[2]===e&&2},selectPreset:function(t){function n(){t=_.cloneDeep(t),E.lastTrack[I.getCurrent().input.slug]=E.selectedTrack,o.$broadcast(r.EFFECTS_CHANGED,{preset:t.slug,effects:t.effects})}N||("custom"===t.slug||"custom"!==E.selectedTrack.preset&&!A.isDeprecatedPreset(E.selectedTrack.preset)?n():(N=new u({confirmLabel:"Apply",contentScope:{title:"Apply New Effects",message:"<p>".concat("Apply ".concat("<strong>".concat(t.name).concat(A.isNewerPreset(E.selectedTrack.preset,t.slug)?" (updated)":"","</strong>")," preset? Your current settings will be lost."),"</p>")},onConfirm:n,onDestroy:function(){N=null}})).show(),e.eventTrack("Select FX Preset",{category:"Audio Input",label:t.name}))},setInputSourceToTrack:function(e){var t=I.getCurrent();e.soundbank?(e.soundbank!==t.soundbank.slug&&($.hasRevisionChanges=!0,e.soundbank=t.soundbank.slug,e.type=S.getTrackType(e),P.updateSourcesInTracks([e.id])),$.isAudioInputActive=!0):(e.type!==t.input.slug&&($.hasRevisionChanges=!0),E.lastDevice=R.getCurrent().device,E.lastTrack[e.type]=e)},setSelected:B,toggleFreeze:function(e){return function(t){t.isFrozen?H(t):F(e,t)}},toggleMute:function(t){t.isMuted=!t.isMuted,P.updateTrackAudibility(t),e.eventTrack("Toggle Mute",{category:"Mix Editor",label:t.isMuted}),$.hasRevisionChanges=!0},toggleSolo:function(t){t.isSolo=!t.isSolo,$.hasSoloTrack=m.checkAnySolo(),t.isMuted=t.isMuted&&t.isSolo?!t.isMuted:t.isMuted,P.updateTracksAudibility(),e.eventTrack("Toggle Solo",{category:"Mix Editor",label:t.isSolo}),$.hasRevisionChanges=!0},unfreezeTrack:H};function j(e){var t=e.existingTracks,o=void 0===t?_.sortBy(E.current.tracks,"name"):t,a=e.isDuplicatingTrack,i=void 0!==a&&a,r=e.name,s=/\s+(copy)?(\s\d*)?$/,c=r.substr(0,128),l=r.match(s)||[],u=n(l,1)[0],d=void 0===u?"":u;for(r=r.replace(s,"");_.some(o,{name:c});)i&&!/(\s+)copy(\s\d*)?$/.test(d)?d+=" Copy":/(\s+)(\d+)$/.test(d)?d=d.replace(/(.*)(\s+)(\d+)$/,function(e,t,n,o){return t+n+ ++o}):d+=" 2",c=r.substr(0,128-d.length)+d;return c}function B(e){e!==E.selectedTrack&&e.canEdit&&(E.selectedTrack=e,E.armedTracks[2]===e&&(E.armedTracks[2]=E.armedTracks[1]),E.armedTracks[1]=e,h.isBandLabInstrumentTrack(E.armedTracks[1])&&h.isBandLabInstrumentTrack(E.armedTracks[2])&&(E.armedTracks[2]=null),s.switchTrackChain(),function(e){var n,o=E.lastDevice;if(e.type===c)I.setDrumMachine(e),p.patterns=e.patterns,d.selectPattern(e.patterns[0]),x.outputNode.disconnect(),x.outputNode.connect(P.current.getTrack(e.id).input),E.armedTracks[1]=null,E.armedTracks[2]=null;else if(e.soundbank)I.setFromSoundbank(e.soundbank),x.outputNode.disconnect(),x.outputNode.connect(P.current.getTrack(e.id).input);else{I.setFromAudioType(e.type),$.isRecording||(n=o?R.switchTo(o):R.getAudioDevices().then(function(e){return R.switchTo(e[0])}),t.resolve(n).then(function(){R.selectChannel({channel:e.channel})}));var a=h.isBandLabInstrumentTrack(E.armedTracks[1])&&E.armedTracks[1]||h.isBandLabInstrumentTrack(E.armedTracks[2])&&E.armedTracks[2];a&&L.getBank({slug:a.soundbank}).then(function(e){x.setSoundbank(e),x.outputNode.disconnect(),x.outputNode.connect(P.current.getTrack(a.id).input)})}}(e))}function F(e,n){var o;return n.isFreezing=!0,E.trackFreezing.set(n,t.defer()),U[n.id]=e.$watch(function(){return{effects:n.effects,soundbank:n.soundbank,regions:_.map(n.regions,function(e){return _.pick(e,["startPosition","endPosition","loopLength","sampleId"])})}},function(e,t){if(!_.isEqual(e,t))return H(n)},!0),o=w.getMixdownBuffer([n],null,!0),t.race([o,E.trackFreezing.get(n).promise]).then(function(e){E.frozenTrackBuffers.set(n.id,e),n.isFreezing=!1,n.isFrozen=!0,P.updateSourcesInTracks([n.id])}).catch(function(e){H(n),o.cancel(),e!==D&&e!==V&&(a.Raven.captureException(e),i.addNotification({title:ne,content:e.message,classList:"alert",autoclose:8e3}))})}function H(e){e.isFreezing=!1,e.isFrozen=!1,U[e.id](),E.trackFreezing.get(e).reject(D),P.updateSourcesInTracks([e.id])}function G(){i.addNotification({title:ee,content:te.replace("{$1}",String(M.TRACKS_LIMIT)),classList:"alert",autoclose:5e3})}}]),angular.module("bandlab.editor").factory("EditorView",function(){var e;return{init:function(t){e=t},isRegionVisible:function(t,n){var o={left:n,width:e.width};return o.right=o.left+o.width,t.right=t.left+t.width,!(t.right<o.left||t.left>o.right)&&(t.left<o.right&&t.right>o.right?{canvasLeft:Math.max(0,o.left-t.left-12),canvasWidth:o.width}:t.left<=o.left&&t.right>o.left?{canvasLeft:Math.max(0,o.left-t.left-12),canvasWidth:t.width-(o.left-t.left)}:t.left>=o.left&&t.right<=o.right?{canvasLeft:0,canvasWidth:t.width}:t.left<o.left&&t.right>o.right?{canvasLeft:0,canvasWidth:o.width}:void 0)},isVisible:function(t,n){var o=t.getBoundingClientRect(),a=n?0:e.left;return!(o.right<a||o.left>e.right)&&(o.left<e.right&&o.right>e.right?{canvasLeft:Math.max(0,e.left-o.left),canvasWidth:e.width}:o.left<=a&&o.right>a?{canvasLeft:Math.max(0,e.left-o.left),canvasWidth:o.width-(e.left-o.left)}:o.left>=a&&o.right<=e.right?{canvasLeft:0,canvasWidth:o.width}:o.left<a&&o.right>e.right?{canvasLeft:0,canvasWidth:e.width}:void 0)}}}),angular.module("bandlab.editor").factory("EditorWaveform",["EditorHelper","EditorMidiScore","editorSettings",function(e,t,n){var o,a,i=Ke(1),r=91,s=32e3,c={loop:"rgba(255, 255, 255, 1)",main:"rgba(0, 0, 0, 0.35)",record:"#DC3710",selected:"rgba(255, 255, 255, 0.85)"},l=3,u=4*_.last(n.SCALES),d=(a=(o=document.createElement("canvas")).getContext("2d"),o.width=257,o.height=257,a.fillStyle="transparent",a.fillRect(0,0,257,257),o),p=function(){var e=document.createElement("canvas").getContext("2d");return e.canvas.width=s,e.canvas.height=r,e.canvas}(),m=new Map,f=new Map;return l*=i,{WAVEFORM_HEIGHT:r*=i,cachePattern:function(t,n,o,a,l){var u,d=n+o+l,p=0,m=18,h=16,g=6,v=7,b=[],y=[];if(f.has(d+!1))return f.get(d);for(o*=i,m*=i,h*=i,v*=i,g*=i,u=e.getMeasureDuration({bpm:l,signature:a}),p=u*o;p>0;)b.push(w(c.main)),y.push(w(c.selected)),p-=Math.min(p,s);function w(e){var n=document.createElement("canvas"),o=n.getContext("2d");return n.width=Math.min(p,s),n.height=r,o.fillStyle=e,o.font="".concat(m,"px bandlab"),o.fillText("",p/2-h,r/2+v),o.font="".concat(m,"px Verdana"),o.fillText(String.fromCharCode(97+t).toUpperCase(),p/2+g,r/2+v-1),n}f.set(d+!1,b),f.set(d+!0,y)},cacheScore:function(e,n,o,a){var r,s,c=n+o+a,l=[],u=[];f.has(c+!1)||(o*=i,s=t.getExactDuration(n,a),r=e.length?s*o:0,v(e.length?h(e,o,a):new Path2D,r,l,u),f.set(c+!1,l),f.set(c+!0,u))},cacheWaveform:function(e,t,n){var o=t+n,a=Math.floor(e.duration*n),s=[],c=[];f.has(o+!1)||(a*=i,v(g(function(e,t,n){return m.has(n)||m.set(n,function(e){var t,n,o,a,i,r,s,c,d=u/l,p=new Array(Math.floor(e.duration*d)),m=e.numberOfChannels,f=e.length/p.length;for(n=0;n<m;n++)for(t=e.getChannelData(n),i=0;i<p.length;i++){for(o=0,s=Math.floor(i*f),c=Math.floor(s+f),r=s;r<c;r+=8)o=(a=Math.abs(t[r]))>o?a:o;(0===n||o>p[i])&&(p[i]=Math.floor(100*o))}return p}(e)),function(e,t){var n,o,a,i,r,s=u/t,c=new Array(Math.floor(e.length/s)),l=e.length/c.length;if(1===s)return e;for(o=0;o<c.length;o++){for(n=0,i=Math.floor(o*l),r=Math.max(Math.floor(i+l),i+1),a=i;a<r;a++)n=e[a]>n?e[a]:n;c[o]=n}return c}(m.get(n),t)}(e,n*=i,t),l,r/2/100),a,s,c),f.set(o+!1,s),f.set(o+!0,c))},deleteUnusedCache:function(){f.clear(),m.clear()},drawFromBuffers:function(e,t,n,o,a,r,s,l,u){t*=i,n*=i,r*=i,s*=i;var d,p=S(Math.floor(t%r+s),Math.floor(s+r),o,a,l,u),m=0;if(p.length){for(e.clearRect(0,0,99999,99999),l||w(e,u?c.selected:c.main),d=0;d<p.length;d++)m=P(e,p[d],m);for(k(e,m),p=S(s,s+r,o,a,l,u);m<n-t;){for(d=0;d<p.length;d++)m=P(e,p[d],m);k(e,m)}}},drawMidiRecord:function(e,t,n,o,a){0!==t.length&&(o*=i,y(e,h(t,n*=i,null,a),-o,c.record))},drawRecord:function(e,t,n,o){o*=i,y(e,g(t,n*=i,r/2),-o,c.record),w(e,c.record)},useGPU:function(e){e.drawImage(d,257,257)}};function h(e,n,o,a){var s,c,l,u=_.minBy(e,"midiNote"),d=_.maxBy(e,"midiNote"),p=2,m=4,f=new Path2D,h=new Path2D;for(p*=i,m*=i,u=u?u.midiNote:0,d=d?d.midiNote:0;g(p,m)<0;)m=Math.max(m-.1,1),p-=.1;return s=g(p,m),o?function(){for(l=0;l<e.length;l++)c={midiNote:e[l].midiNote,duration:t.ticksToSeconds(parseFloat(e[l].duration),o),time:t.ticksToSeconds(parseFloat(e[l].time),o)},angular.isDefined(c.midiNote)?f.rect(Math.round(c.time*n),2*Math.round((r-2-s-(c.midiNote-u)*(p+m))/2),2*Math.round(Math.max(c.duration*n,4)/2),2*Math.round(m/2)):h.rect(Math.round(c.time*n),r-m,Math.round(Math.max(c.duration*n,8))||Ke(1),m)}():a&&(_.chain(e).filter({name:"NoteOn"}).forEach(function(t){var o=_.find(e,function(e){return"NoteOff"===e.name&&e.midiNote===t.midiNote&&e.time>t.time}),i=o?o.time-t.time:36e4;f.rect((t.time-a)/1e3*n,r-s-(t.midiNote-u)*(p+m),i/1e3*n,m)}).value(),_.chain(e).filter({name:"SustainOn"}).forEach(function(t){var o=_.find(e,function(e){return"SustainOff"===e.name&&e.time>t.time}),i=o?o.time-t.time:36e4;h.rect((t.time-a)/1e3*n,r-m,i/1e3*n,m)}).value(),_.chain(e).filter({name:"PitchBend"}).forEach(function(e){h.rect((e.time-a)/1e3*n,r-m,Ke(1),m)}).value()),{lower:h,upper:f};function g(e,t){return(r-(d-u)*(e+t))/2}}function g(e,t,n){var o,a,i,s=new Path2D,c=new Path2D,l=Math.round(r/2);for(s.moveTo(0,l),c.moveTo(0,l-1),o=0;o<e.length;o++)a=o*t,i=e[o]*n,s.lineTo(a,l+i),c.lineTo(a,l-1-i);return a=o*t,s.lineTo(a,l),c.lineTo(a,l-1),{lower:s,upper:c}}function v(e,t,n,o){for(var a=0;t>0;)n.push(b(e,a,t,c.main)),o.push(b(e,a,t,c.selected)),t-=Math.min(t,s),a-=n[n.length-1].width}function b(e,t,n,o){var a=document.createElement("canvas"),i=a.getContext("2d");return a.width=Math.min(n,s),a.height=r,y(i,e,t,o),a}function y(e,t,n,o){e.translate(n,0),e.fillStyle=o,t.lower&&e.fill(t.lower),t.upper&&e.fill(t.upper)}function w(e,t){e.fillStyle=t||c.main,e.fillRect(0,Math.round(r/2)-1,s,1)}function k(e,t){e.fillStyle=c.loop,e.fillRect(t,0,.5,r)}function S(e,t,n,o,a,i){i=!!i,a=a||"";var r,s,c=f.get(n+o+a+i),l=0,u=0,d=[];for(s=0;s<c.length;s++)r=c[s],l<=e&&l+r.width>e?(d.push({from:e-l,to:Math.min(t-l,r.width),buffer:r}),u+=Math.min(t-l,r.width)-(e-l)):l<t&&l+r.width>t&&(d.push({from:0,to:t-l,buffer:r}),u+=t-l),l+=r.width;return u<t-e&&d.push({from:0,to:t-e-u,buffer:p}),d}function P(e,t,n){return e.imageSmoothingEnabled=!0,e.drawImage(t.buffer,t.from,0,t.to-t.from,r,n,0,t.to-t.from,r),n+(t.to-t.from)}}]),angular.module("bandlab.common").factory("Emoji",["$http","$q","ClientDevice",function(e,t,n){var o=!n.isMobile&&!n.isTablet&&!n.isWindows;return{categories:[{name:"people",icon:"emoji-smiley",title:"Smiley & People"},{name:"animals_and_nature",icon:"emoji-nature",title:"Nature"},{name:"food_and_drink",icon:"emoji-food",title:"Food & Drink"},{name:"activity",icon:"emoji-activity",title:"Activity"},{name:"travel_and_places",icon:"emoji-travel",title:"Travel and Places"},{name:"objects",icon:"emoji-object",title:"Objects"},{name:"symbols",icon:"emoji-symbol",title:"Symbols"},{name:"flags",icon:"emoji-flag",title:"Flags"}],fetch:o?function(){return e.get("https://www.bandlab.com/web-app/emoji-6cf5b5eb3c.json",{cache:!0}).then(function(e){return e.data})}:function(){return t.resolve([])},isEnabled:o}}]),angular.module("bandlab.common").component("emojiPicker",{bindings:{dropdownDirection:"@",dropdownMenuContainer:"@"},templateUrl:"https://www.bandlab.com/web-app/emoji/partials/_emoji-picker-3176ce85.html",controllerAs:"vm",controller:["$scope","$element","Emoji",function(e,t,n){this.target=t.parent().find("textarea"),this.target&&n.isEnabled||(e.$destroy(),t.remove())}]}),angular.module("bandlab.common").controller("EmojiCtrl",["$filter","$scope","Emoji",function(e,t,n){var o=t.target,a=o[0],i=[];t.searchQuery="",t.categories=n.categories,t.activeEmojiCategory=t.categories[0],this.$onInit=function(){n.fetch().then(function(e){t.emojis=e,i=_.chain(e).values().flatten().value()})},t.panelClick=function(e){e.target.closest(".emoji-container")&&e.stopPropagation()},t.pick=function(e){var t=a.selectionStart,n=a.selectionEnd,i=" ".concat(e.char," ");a.value=a.value.substring(0,t)+i+a.value.substring(n),a.selectionStart=t+i.length,a.selectionEnd=t+i.length,a.focus(),o.triggerHandler("change")},t.selectCategory=function(e){t.activeEmojiCategory=e,t.searchQuery=""},t.getEmojiList=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,o=n.name,a=arguments.length>2?arguments[2]:void 0;if(a){var r=e("filter")(i,a),s=e("limitTo")(r,40);return s}return t[o]||i}}]),angular.module("bandlab.error.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("0",{url:"/0",templateUrl:"https://www.bandlab.com/web-app/error/views/0-67be6e07.html"}).state("403",{url:"/403",templateUrl:"https://www.bandlab.com/web-app/error/views/403-518abbbf.html",onEnter:function(){document.querySelector('meta[name="prerender-status-code"]').setAttribute("content","403")},onExit:function(){document.querySelector('meta[name="prerender-status-code"]').setAttribute("content","200")}}).state("404",{url:"/404",templateUrl:"https://www.bandlab.com/web-app/error/views/404-766b80dd.html",onEnter:function(){document.querySelector('meta[name="prerender-status-code"]').setAttribute("content","404")},onExit:function(){document.querySelector('meta[name="prerender-status-code"]').setAttribute("content","200")}}).state("500",{url:"/500",templateUrl:"https://www.bandlab.com/web-app/error/views/500-b833af01.html",onEnter:function(){document.querySelector('meta[name="prerender-status-code"]').setAttribute("content","500")},onExit:function(){document.querySelector('meta[name="prerender-status-code"]').setAttribute("content","200")}}).state("error201",{url:"/error-201",templateUrl:"https://www.bandlab.com/web-app/error/views/error-201-fed01e86.html",controller:["$scope","AppNotifications","Me",function(e,t,n){t.clearAll(),e.me=n}],onEnter:function(){document.querySelector('meta[name="prerender-status-code"]').setAttribute("content","403")},onExit:function(){document.querySelector('meta[name="prerender-status-code"]').setAttribute("content","200")}}).state("error203",{url:"/error-203",templateUrl:"https://www.bandlab.com/web-app/error/views/error-203-219d2cd2.html",controller:["AppNotifications",function(e){e.clearAll()}],onEnter:function(){document.querySelector('meta[name="prerender-status-code"]').setAttribute("content","403")},onExit:function(){document.querySelector('meta[name="prerender-status-code"]').setAttribute("content","200")}}).state("useChrome",{url:"/use-chrome",templateUrl:"https://www.bandlab.com/web-app/error/views/use-chrome-850c5ed0.html"}).state("updateBrowser",{url:"/update-browser",templateUrl:"https://www.bandlab.com/web-app/error/views/update-browser-da39dea8.html"}).state("unavailable",{url:"/unavailable?url&notSupported",templateUrl:"https://www.bandlab.com/web-app/error/views/unavailable-65e0818d.html",controller:["$scope","$stateParams","ClientDevice",function(e,t,n){e.mobileOS=n.isAndroid?"Android":"iOS",t.notSupported&&"true"===t.notSupported&&(e.notSupported=!0),t.url&&(e.url=decodeURIComponent(t.url))}]})}]),angular.module("bandlab.explore",[]),angular.module("bandlab.explore").controller("PostsListCtrl",["$location","$q","$scope","PlayerHistory","Post",function(e,t,n,o,a){var i,r=null,s=10,c=!1,l=e.url();function u(){if(c)return t.resolve([]);var e=n.genre?a.exploreGenre:n.contest?a.fromContest:a.explore;return i=e({after:r,contestId:n.contest?n.contest.id:null,genres:n.genre?n.genre.id:null,limit:s,sort:n.sort,tags:n.tag?n.tag.id:null,timeRange:"trending"===n.sort?n.timeRange:null,types:"revision"}).$promise.then(function(e){return c=e.paging.itemsCount<e.paging.limit,r=_.get(e,"paging.cursors.after",0),e.data})}function d(){return n.infiniteScrollEnded?t.reject("No more results"):i=i.then(function(e){return n.infiniteScrollEnded=c,n.posts=n.posts||[],n.posts=_.uniqBy(n.posts.concat(e),"id"),o.pushQueueSongs(n.posts,l),u()})}n.loadMore=d,o.setState({loader:d,url:l}),n.filterList=function(e){return!n.filters||!0!==n.filters.song.isForkable||!0===e.revision.song.isForkable},u().then(n.loadMore)}]),angular.module("bandlab.explore").component("explorePreview",{templateUrl:"https://www.bandlab.com/web-app/explore/partials/_explore-preview-0b15b39b.html",controller:["$http",function(e){var t=this;t.switchPosition=function(e){t.currentPosition=Math.max(0,t.currentPosition+e)},t.currentPosition=0,e.get("https://www.bandlab.com/api/v2.0/contents/explore?types=banners",{cache:!0}).then(function(e){return e.data.data}).catch(function(){return[]}).then(function(e){t.banners=_.filter(e,function(e){return _.includes(e.link,"https://lab.fm/")}),t.loaded=!0})}],controllerAs:"vm"}),angular.module("bandlab.explore.routes",["ui.router"]).config(["$stateProvider",function(e){i.$inject=["$stateParams"],a.$inject=["$stateParams"],r.$inject=["$http"];var t=["recent","trending","popular","inspiring"],o=["week","month"];function a(e){return _.includes(t,e.sort)?e.sort:t[0]}function i(e){return _.includes(o,e.timeRange)?e.timeRange:o[0]}function r(e){return Promise.all([e.get("https://www.bandlab.com/api/v2.0/contents/explore?types=genres",{cache:!0}),s(e)]).then(function(e){var t=n(e,2),o=t[0],a=t[1];return _.map(o.data.data,function(e){return e.hasChannel=a.some(function(t){return t.id===e.id}),e.picture.square=["https://www.bandlab.com/web-app/images/genres/blues-4c0c6d9d95.png","https://www.bandlab.com/web-app/images/genres/classical-7643a99ea7.png","https://www.bandlab.com/web-app/images/genres/country-21460807cb.png","https://www.bandlab.com/web-app/images/genres/electronic-97d0ffb8cb.png","https://www.bandlab.com/web-app/images/genres/folk-3028ecee32.png","https://www.bandlab.com/web-app/images/genres/funk-0b3837ba2b.png","https://www.bandlab.com/web-app/images/genres/hip-hop-fab11cf2c3.png","https://www.bandlab.com/web-app/images/genres/jazz-ec294c87a7.png","https://www.bandlab.com/web-app/images/genres/latin-3adb764b19.png","https://www.bandlab.com/web-app/images/genres/metal-c38a48b7c6.png","https://www.bandlab.com/web-app/images/genres/other-03b95ada65.png","https://www.bandlab.com/web-app/images/genres/other-03b95ada65.png","https://www.bandlab.com/web-app/images/genres/pop-5642bd0506.png","https://www.bandlab.com/web-app/images/genres/r-n-b-7fc2879f73.png","https://www.bandlab.com/web-app/images/genres/reggae-684c5b7098.png","https://www.bandlab.com/web-app/images/genres/rock-18dd40c403.png"].find(function(t){return t.includes(e.id)}),e})}).catch(function(){return[]})}function s(e){return e.get("https://www.bandlab.com/api/v2.0/contents/explore?types=channels",{cache:!0}).then(function(e){return e.data.data}).catch(function(){return[]})}e.state("explore",{url:"/explore",redirectTo:"explore.home",template:"<ui-view/>",resolve:{scripts:function(){return O("https://cdn.jsdelivr.net/npm/jquery@1.11.0/dist/jquery.min.js").then(function(){return O("https://cdn.jsdelivr.net/npm/jquery-migrate@1.2.1/dist/jquery-migrate.min.js")}).then(function(){return O("https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js")})}}}).state("explore.home",{url:"/home",templateUrl:"https://www.bandlab.com/web-app/explore/views/explore-home-7d2582da.html",controller:["$document","$http","$location","$q","$scope","$timeout","FileHelper","Me","User","Post",function(e,t,n,o,a,i,s,c,l,u){var d=document.querySelector(".view-main");function p(e){var t,n=e.selector,o=e.skeleton,a=void 0===o||o;switch(n){case".genres-slider":t=Fn({defaultSlides:4,breakpoints:[1024,900,480],slides:[3,2,1]});break;case".user-slider":t=Fn({defaultSlides:6,slides:[5,3,3]});break;case".tracks-slider":t=Fn({defaultSlides:6,slides:[4,4,3]});break;case".collections-slider":t=Fn({defaultSlides:4,slides:[3,2,2]});break;case".contests-slider":t=Fn({defaultSlides:3,breakpoints:[1024,900,580],slides:[3,2,1]})}jQuery("".concat(n).concat(a?"-skeleton":"")).slick(t),a||jQuery("".concat(n,"-skeleton")).slick("unslick").remove()}d.style.opacity=0,a.me=c,(c.isAnonymous()?l.getRecommendations().$promise:l.suggested().$promise).then(function(e){a.users=e,e.length&&i(function(){return p({selector:".user-slider",skeleton:!1})})}),r(t).then(function(t){a.genres=a.me.isAnonymous()?_.shuffle(t):[].concat(He(_.shuffle(t.filter(function(e){return c.genres.some(function(t){return t.id===e.id})}))),He(_.shuffle(t.filter(function(e){return!c.genres.some(function(t){return t.id===e.id})})))),t.length&&o(function(e){var n=new Image;n.onload=e,n.src=t[0].picture.square}).then(function(){i(function(){p({selector:".genres-slider",skeleton:!1});var t=n.hash();if(t){var o=angular.element(document.getElementById(t));e.scrollToElementAnimated(o,60)}})})}),function(e){return e.get("https://www.bandlab.com/api/v2.0/contents/explore?types=collections",{cache:!0}).then(function(e){return e.data.data}).catch(function(){return[]})}(t).then(function(e){a.collections=e,e.length&&i(function(){return p({selector:".collections-slider",skeleton:!1})})}),function(e){return e.get("https://www.bandlab.com/api/v2.0/contents/explore?types=contests",{cache:!0}).then(function(e){var t=e.data.data;return _.map(t,function(e){return e.startDateObject=new Date(e.startDate),e.endDateObject=new Date(e.endDate),e.now=new Date,e})}).catch(function(){return[]})}(t).then(function(e){a.contests=e,e.length&&o(function(t){var n=new Image;n.onload=t,n.src=e[0].picture.m}).then(function(){i(function(){return p({selector:".contests-slider",skeleton:!1})})})}),a.postsArray=[],o.all([u.explore({limit:10,sort:"Popular",types:"revision"}).$promise,u.exploreGenre({genres:"all",limit:10,sort:"trending",timeRange:"week",types:"revision"}).$promise]).then(function(e){a.postsArray=e.map(function(e){return e.data.forEach(function(e){e.revision.song.isPublic=!0}),_.shuffle(e.data)}),i(function(){return p({selector:".tracks-slider",skeleton:!1})})}),i(function(){p({selector:".genres-slider"}),p({selector:".user-slider"}),p({selector:".tracks-slider"}),p({selector:".collections-slider"}),p({selector:".contests-slider"}),d.style.opacity=1})}]}).state("explore.genre",{url:"/{genre:[a-z0-9-]{3,30}}?sort&timeRange",resolve:{theGenres:r,theGenre:["$q","$stateParams","theGenres",function(e,t,n){var o=_.find(n,{id:t.genre});return o?e.resolve(o):e.reject({status:404})}],theSort:a,theTimeRange:i},views:{"":{templateUrl:"https://www.bandlab.com/web-app/explore/views/explore-genres-9cbf277e.html",controller:["$scope","Me","theGenre","theGenres","theSort","theTimeRange",function(e,t,n,o,a,i){e.me=t,e.genres=o,e.genre=n,e.me.isAnonymous()||(e.mygenres=e.genres.filter(function(e){return t.genres.map(function(e){return e.id}).includes(e.id)}),e.othergenres=e.genres.filter(function(e){return!t.genres.map(function(e){return e.id}).includes(e.id)})),e.sort=a,e.timeRange=i,e.filters={song:{isForkable:!1}}}]},"sort@explore.genre":{templateUrl:"https://www.bandlab.com/web-app/explore/partials/_sort-56536dfb.html"},"sort-trending@explore.genre":{templateUrl:"https://www.bandlab.com/web-app/explore/partials/_sort-trending-366a8337.html"},"list@explore.genre":{templateUrl:"https://www.bandlab.com/web-app/explore/partials/_explore-posts-19628176.html",controller:"PostsListCtrl"}},onEnter:["Page","theGenre",function(e,t){e.setMetadata({title:"".concat(t.title," | BandLab"),image:t.picture.square})}],onExit:["Page",function(e){e.clearMetadata()}]}).state("explore.channel",{url:"/channels/{channel:[a-z0-9-]{3,30}}",resolve:{theChannel:["$http","$stateParams",function(e,t){var n=t.channel;return e.get("https://www.bandlab.com/api/v2.0/contents/explore?types=banners,communities,collections,hashtags&channel=".concat(n),{cache:!0}).then(function(e){return e.data}).catch(function(){return[]})}],theGenres:r},views:{"":{templateUrl:"https://www.bandlab.com/web-app/explore/views/explore-channel-24a7d4c8.html",controller:["$location","$scope","$stateParams","$timeout","PlayerHistory","theChannel","theGenres",function(e,t,n,o,a,i,r){var s=document.querySelector(".view-main");s.style.opacity=0,t.banners=_.get(i,"banners.data",[]),t.channel=_.find(r,{id:n.channel}),t.collections=_.get(i,"collections.data"),t.communities=_.get(i,"communities.data"),t.hashtags=_.get(i,"hashtags.data[0].tags"),o(function(){jQuery(".banners-slider").slick({arrows:!0,dots:!1,draggable:!1,infinite:!0,slidesToShow:2,slidesToScroll:2,responsive:[{breakpoint:800,settings:{arrows:!1,dots:!0,slidesToShow:2,slidesToScroll:2}},{breakpoint:680,settings:{arrows:!1,dots:!0,slidesToShow:1,slidesToScroll:1}}]}),jQuery(".collections-slider").slick({arrows:!0,dots:!1,draggable:!1,infinite:!0,slidesToShow:4,slidesToScroll:4,responsive:[{breakpoint:1024,settings:{arrows:!0,dots:!0,slidesToShow:3,slidesToScroll:3}},{breakpoint:600,settings:{arrows:!1,dots:!0,slidesToShow:2,slidesToScroll:2}},{breakpoint:480,settings:{arrows:!1,dots:!0,slidesToShow:2,slidesToScroll:2}}]}),jQuery(".communities-slider").slick({arrows:!0,dots:!1,draggable:!1,infinite:!0,slidesToShow:3,slidesToScroll:3,responsive:[{breakpoint:800,settings:{arrows:!1,dots:!0,slidesToShow:2,slidesToScroll:2}},{breakpoint:480,settings:{arrows:!1,dots:!0,slidesToShow:1,slidesToScroll:1}}]}),s.style.opacity=1})}]}}})}]),angular.module("bandlab.global",[]),angular.module("bandlab.global").directive("flyout",["$animate","Me",function(e,t){return{restrict:"E",replace:!0,scope:{},templateUrl:"https://www.bandlab.com/web-app/global/partials/_flyout-2a55c614.html",link:function(n,o){function a(){e.leave(o[0],{removeClass:"visible"}),o.off("click",a),n.$digest()}o.remove(),n.me=t,n.$on("siteTopBar:openFlyout",function(){e.enter(o[0],document.body,document.body.lastChild),o.on("click",a),setTimeout(function(){o.addClass("visible")})})}}}]),angular.module("bandlab.global").component("landingLogos",{restrict:"E",templateUrl:"https://www.bandlab.com/web-app/global/partials/_landing-logos-5145d33f.html"}),angular.module("bandlab.global").component("languageSelector",{templateUrl:"https://www.bandlab.com/web-app/global/partials/_language-selector-6073d97c.html",controllerAs:"vm",controller:["$cookies",function(e){this.language=document.documentElement.lang,this.reload=function(t){e.put("language",t),location.reload()}}]}),angular.module("bandlab.common").directive("pageHeader",["$state","$window",function(e,t){return{restrict:"C",link:function(n,o){var a,i,r=!1,s=!1;function c(){(document.documentElement.scrollTop||document.body.scrollTop)>=i.clientHeight?r||(a&&a.classList.add("locked"),i&&(i.style.marginTop="-".concat(i.clientHeight,"px")),r=!0):r&&l()}function l(){a&&a.classList.remove("locked"),i&&(i.style.marginTop="0px"),r=!1}n.$on("$destroy",function(){s&&(t.removeEventListener("scroll",c,!0),s=!1)}),setTimeout(function(){if(!e.views||!_.find(Object.keys(e.views),function(e){return-1!==e.indexOf("overlay")}))return a=o[0],i=a.querySelector(".page-header-content")||a.querySelector(".page-header-cover"),a.querySelector("nav")?(document.body.scrollTop=document.documentElement.scrollTop=Math.min(Math.max(document.body.scrollTop,document.documentElement.scrollTop),i.clientHeight),void(s||(t.addEventListener("scroll",c,!0),s=!0))):(document.body.scrollTop=document.documentElement.scrollTop=0,void l())})}}}]),angular.module("bandlab.global").component("siteFooter",{templateUrl:"https://www.bandlab.com/web-app/global/partials/_site-footer-985b69cb.html"}),angular.module("bandlab.global").component("siteFooterCard",{templateUrl:"https://www.bandlab.com/web-app/global/partials/_site-footer-card-4e2ef74c.html"}),angular.module("bandlab.global").component("siteNavBar",{templateUrl:"https://www.bandlab.com/web-app/global/partials/_site-nav-bar-e2479de7.html",controller:["$rootScope","$state","$transitions","Me",function(e,t,n,o){var a=this;this.me=o,n.onBefore({},function(e){var t=e.to().name,n=e.params().username;a.state=t.split(".")[0],"user"===a.state&&n===o.username&&(a.state="profile")})}],controllerAs:"vm"}),angular.module("bandlab.global").component("siteTabBar",{templateUrl:"https://www.bandlab.com/web-app/global/partials/_site-tab-bar-644b5411.html",controller:["$rootScope","$state","Me",function(e,t,n){this.me=n,this.openFlyout=function(){return e.$broadcast("siteTopBar:openFlyout")},this.state=t}],controllerAs:"vm"}),angular.module("bandlab.global").component("siteTopBar",{templateUrl:"https://www.bandlab.com/web-app/global/partials/_site-top-bar-89d62f1f.html",controller:["$analytics","$state","$transitions","AppNotifications","ChatCache","FloatingChat","Me","Identity","Shout",function(e,n,o,a,i,r,s,c,l){var u=this;u.cache=i,u.me=s,u.openPhotoBooth=function(){var t=l.createPhotoBoothModal(function(o){return t.destroy(),l.post(o).then(function(){e.eventTrack("Create Post",{category:"Post",label:"".concat(_.startCase(o.type)," from ").concat(o.import?" import":"camera")}),n.includes("feed")||a.addNotification({autoclose:5e3,content:"Shout published",title:"Upload complete"})}).catch(function(){n.includes("feed")||a.addNotification({autoclose:5e3,content:"Unable to publish shout",classList:"alert",title:"Unable to upload. Check your internet connection and try again."})})});t&&t.show()},u.state=n;try{u.shouldShowNewStarter=0!==cxApi.chooseVariation()}catch(e){u.shouldShowNewStarter=!1}u.openConversation=function(e){n.includes("chat")?n.go("chat.conversation",{id:e.uuid}):(e.isMinimized=!1,r.activeConversations=[e])},o.onSuccess({},_.throttle(function(){s.isUser()&&c.counters({id:s.id}).$promise.then(function(e){u.me.counters=function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?qn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):qn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},u.me.counters,{},e.counters)})},6e4))}],controllerAs:"vm"}),angular.module("bandlab.global").component("testimonials",{restrict:"E",templateUrl:"https://www.bandlab.com/web-app/global/partials/_testimonials-aab2bd5b.html",controller:["$scope",function(e){e.testimonials=_.sampleSize([{text:"Whether you're a beginner or a studio musician it's amazing. I've been able to establish an amazing fanbase & online musical career using BandLab. The staff are amazing & friendly.",user:{id:"3a1189a5-6423-e611-80c3-0003ff466b24",name:"Philypay L.B.R.",username:"philypay_lbr_ceo"}},{text:"Great app... Keeps my creative juices flowing... Thanks guys for making my phone a studio!!",user:{id:"bdb051c0-fc55-e611-80c3-0003ff4667a0",name:"Claude Inge",username:"killaclaude5651"}},{text:"BandLab. I love this app. To be honest it can't get any better. 10 stars if I could",user:{id:"e53ad273-d96f-e611-80c3-0003ff466d11",name:"Garrett Greenstreet",username:"spitsick4life"}},{text:"Love this app! Great recording sound, I can add layers of rhythm, bass and lead all by myself & no need for jamming partners",user:{id:"87834212-2f7f-e611-80c3-0003ff466d11",name:"Sherry Akber",username:"sherry"}},{text:"Best app for a guy with a guitar I've been looking for something like this long time ago. Sometimes I just don't have my computer close to record something but this baby does it",user:{id:"26e787e4-7c7c-e611-80c3-0003ff466d11",name:"Luis Manuel Deras",username:"ggderas"}},{text:"I use it mostly to share work in progress recordings with the bands and producers involved. It is nice to have a central system where they can listen privately and give feedback",user:{id:"3b436fd5-9d45-e511-80c4-0003ff466a2f",name:"Eugene Gouws",username:"egouwsmusic"}},{text:"I use it to take all the tracks from my musicians. I tell them go get BandLab it makes life easy.",user:{id:"78151402-106d-e611-80c3-0003ff466ad8",name:"Scott Winterstein",username:"viralsdead"}},{text:"Bandlab is a great platform to work with other musicians that are like minded. Their DAW feature helps me keep my musical flow when I have great ideas on the go.",user:{id:"8a171d77-4f88-e511-80c6-0003ff466845",name:"David Foster",username:"axs2952"}}],3)}]}),angular.module("bandlab.global.redirects",["ui.router"]).config(["$stateProvider",function(e){e.state("bandId",{url:"/".concat("bands","/{id:[a-zA-Z0-9-_]+}"),redirectTo:function(e){return e.injector().get("Band").get({id:e.params().id}).$promise.then(function(e){return{state:"band.feed",params:{username:e.username}}})}}).state("postId",{url:"/posts/{id:[a-zA-Z0-9-_]+}",redirectTo:function(e){return{state:"post",params:{id:e.params().id}}}}).state("revisionId",{url:"/revisions/{id:[a-zA-Z0-9-_]+}",redirectTo:function(e){return e.injector().get("Revision").get({id:e.params().id}).$promise.then(function(e){return{state:"Band"===e.song.author.type?"bandSong":"userSong",params:{username:e.song.author.username,slug:e.song.slug,revId:e.id}}})}}).state("songId",{url:"/songs/{id:[a-zA-Z0-9-_]+}",redirectTo:function(e){return e.injector().get("Song").get({id:e.params().id}).$promise.then(function(e){return{state:"Band"===e.author.type?"bandSong":"userSong",params:{username:e.author.username,slug:e.slug,revId:e.revision.id}}})}}).state("userId",{url:"/users/{id:[a-zA-Z0-9-_]+}",redirectTo:function(e){return e.injector().get("User").get({id:e.params().id}).$promise.then(function(e){return{state:"user.feed",params:{username:e.username}}})}}).state("redirectProjects",{url:"/projects",redirectTo:"library.projects.songs"}).state("redirectProjects.category",{url:"/:category",redirectTo:function(e){return{state:"library.projects.songs",params:{category:e.params().category}}}}).state("redirectProjectsTree",{url:"/projects/:category/tree?songId",redirectTo:function(e){return{state:"library.projects.songs.tree",params:{category:e.params().category,songId:e.params().songId}}}}).state("getStarted",{url:"/get-started",redirectTo:"mixEditor"}).state("shareProfile",{url:"/share-profile",redirectTo:function(e){var t=e.injector().get("authService"),n=e.injector().get("Me");return t.isAuth()?t.refreshMe().then(function(){return{state:"user.feed",params:{username:n.username}}}):{state:"login"}}}).state("channelSlug",{url:"/channels/:slug",redirectTo:function(e){return{state:"explore.channel",params:{channel:e.params().slug}}}})}]),angular.module("bandlab.global.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("landing",{url:"/",templateUrl:"https://www.bandlab.com/web-app/global/views/landing-99c4cd0e.html",controller:["$scope","$timeout","ClientDevice",function(e,t,n){var o;e.clientDevice=n,e.showSecondaryContent=!1,t(function(){e.showSecondaryContent=!0},700),n.isMobile||(e.screen=-1,e.$on("$destroy",function(){t.cancel(o)}),function n(){e.screen=++e.screen%4,o=t(n,5e3)}())}]}).state("feed",{url:"/feed",templateUrl:"https://www.bandlab.com/web-app/global/views/feed-layout-39f01fb6.html",controller:["$location","$q","$scope","$timeout","Me","PlayerHistory","Post","Shout",function(e,t,o,a,i,r,s,c){var l,u,d=10,p=null,m=!1,f=e.url();function h(){return m?t.resolve([]):l=s.fromFollowees({after:p,limit:d,userId:i.id}).$promise.then(function(e){return m=e.paging.itemsCount<e.paging.limit,p=_.get(e,"paging.cursors.after",0),e.data})}function g(){return o.infiniteScrollEnded?t.reject("No more results"):l=l.then(function(e){return o.infiniteScrollEnded=m,o.posts=o.posts||[],o.posts=_.chain(o.posts).concat(e).uniqBy("id").value(),r.pushQueueSongs(o.posts,f),h()})}o.loadMore=g,o.openPhotoBooth=function(){return c.createShoutPost({type:"photo",user:i})},o.onShoutUploaded=function e(r,c){var l=s.fromFollowees({userId:i.id,offset:0,limit:10}).$promise;return a.cancel(u),u=a(angular.noop,2e3),t.all([l,u]).then(function(t){var i=n(t,1)[0].data,s=_.find(i,r);s?(s.canChangePinState=!1,c.remove(),o.posts.unshift(s),a.cancel(u)):e(r,c)})},o.onPostCreate=function(e){e.canChangePinState=!1,o.posts.unshift(e)},o.user=i,r.setState({loader:g,url:f}),h().then(o.loadMore),o.$on("$revision:changed",function(e,t){"unpublish"===t.action?_.remove(o.posts,function(e){return e.revision&&e.revision.id===t.revision.id}):"create"===t.action&&t.revision.isPublic&&s.get({id:t.revision.postId}).$promise.then(function(e){o.posts.unshift(e)})}),o.$on("$post:delete",function(e,t){_.remove(o.posts,function(e){return e.id===t.post.id})}),o.$on("$destroy",function(){a.cancel(u)})}]}).state("feed.tree",{url:"/tree?songId",params:{rewriteTracking:function(){return function(e){return e.replace(/\?songId=.*/g,"")}}},reloadOnSearch:!1,resolve:{theSong:["$stateParams","Song",function(e,t){return t.get({id:e.songId}).$promise}]},onEnter:function(){bt()},onExit:function(){vt()},views:{"overlay@":{templateUrl:"https://www.bandlab.com/web-app/song/views/song-tree-view-7288b339.html",controller:"SongRevisionsFeedCtrl"}}}).state("onboarding",{url:"/onboarding?force",reloadOnSearch:!1,redirectTo:function(e){var t=e.injector().get("Me"),n=e.injector().get("appStates");if(t.isOnboarded&&!e.params().force)return{state:n.AFTER_LOGIN,params:{}}},controller:["$analytics","$rootScope","$state","appActions","authService","completeProfile","Me","Modal",function(e,t,n,o,a,i,r,s){var c=(new Date).getTime();function l(){return-1!==r.skills.indexOf("Drummer")?"dry-kit":-1!==r.skills.indexOf("DJ/Beatmaker")?"808-kit":-1!==r.skills.indexOf("Keyboardist")?"grand-piano":-1!==r.skills.indexOf("Bass Player")?"acoustic-bass-legato":void 0}e.pageTrack("/onboarding/complete-profile"),i.start().then(function(){ga("send","timing","Onboarding","Complete Profile",(new Date).getTime()-c,"All Steps"),i.stop()}).then(function(){if(o.checkStateCompatibility(n.get("mixEditor")))return n.go("explore.home",{replace:!0});e.pageTrack("/onboarding/get-started");var a={};new s({id:"getStartedModal",templateUrl:"https://www.bandlab.com/web-app/global/partials/_get-started-fe0e1acb.html",overlayClose:!1,contentScope:{getMySoundbank:l,videoState:a},onCreate:function(){return O("https://player.vimeo.com/api/player.js").then(function(){var e=document.querySelector("iframe.vimeo-player");e&&new Vimeo.Player(e).on("timeupdate",function(e){a.seconds=e.seconds,t.$digest()})})},onDestroy:function(){ga("send","timing","Onboarding","Get Started",(new Date).getTime()-c,"All Steps")}}).show()})}]}).state("download",{url:"/download?url&notSupported",templateUrl:"https://www.bandlab.com/web-app/global/views/download-35b70f80.html",controller:["$anchorScroll","$document","$location",function(e,t,n){setTimeout(function(){var e=n.hash();if(e){var o=angular.element(document.getElementById(e));t.scrollToElementAnimated(o,40)}})}]}).state("features",{url:"/creation-features",templateUrl:"https://www.bandlab.com/web-app/global/views/features-layout-312d63e9.html",onEnter:x}).state("promos",{url:"/promos?id",templateUrl:"https://www.bandlab.com/web-app/global/views/promos-0f62aa0c.html",resolve:{thePromo:["$http","$sanitize","$stateParams",function(e,t,n){var o="https://blt-cosmos.firebaseio.com/promos/".concat(t(n.id),".json");return e.get(o).then(function(e){return e.data}).catch(function(){return[]})}]},controller:["$http","$scope","$sanitize","$stateParams","thePromo","Me",function(e,t,n,o,a,i){var r=null;t.me=i,t.promo=a,i.isUser()&&a&&e.post("https://cosmos-api-dot-blt-cosmos.appspot.com/api/promos",{userId:i.id,promoName:n(o.id),username:i.username},{headers:{Authorization:"Bearer xW61gS4kg4"}}).catch(function(){return[]}),t.$on("$destroy",function(){clearInterval(r)}),t.showClock=function(e,t){var n=document.getElementById("timeTicker");function o(){var e=new Date,o=e.getTime()+6e4*e.getTimezoneOffset(),a=new Date(o+36e5*t);n.innerHTML="".concat(a.toLocaleString())}o(),clearInterval(r),r=setInterval(o,1e3)}}]}).state("allihoopa",{url:"/bandlab-x-allihoopa",redirectTo:function(){return Promise.resolve({state:"community.feed",params:{username:"allihoopa_stars"}})}})}]),angular.module("bandlab.library.routes",["ui.router"]).config(["$stateProvider",function(e){var t=["recent","my-projects","collaborations","bands"];e.state("library",{url:"/library",redirectTo:"library.projects.songs",templateUrl:"https://www.bandlab.com/web-app/library/views/library-layout-15e20448.html",resolve:{theUser:["Me",function(e){return e}]},controller:["$scope","Me",function(e,t){e.isOwnProfile=!0,e.me=t}]}).state("library.projects",{url:"/projects",redirectTo:"library.projects.songs",templateUrl:"https://www.bandlab.com/web-app/library/views/library-projects-d520fa0b.html",resolve:{theBands:["Band","Me",function(e,t){var n=[];function o(){return e.fromUser({userId:t.id,offset:n.length,limit:50}).$promise}return function e(t,a){return t.then(function(t){return n=n.concat(t),t.length<50?n:e(a(),o)})}(o(),o).then(function(e){return _.sortBy(e,function(e){return e.name.toLowerCase()})})}]},controller:["$scope","$state","theBands",function(e,t,n){e.bands=n,e.category="recent",e.$on("$band:changed",function(t,n){"create"===n.action&&e.bands.unshift(n.band)}),e.selectCategory=function(e){t.go(".",{category:e})}}]}).state("library.projects.songs",{url:"/:category",params:{category:"recent",rewriteTracking:["$stateParams",function(e){return function(n){return-1!==t.indexOf(e.category)?n:"/library/projects/band"}}]},resolve:{theBand:["$q","$stateParams","theBands",function(e,n,o){if(-1!==t.indexOf(n.category))return e.resolve(null);var a=_.find(o,function(e){return e.username===n.category.toLowerCase()});return a?e.resolve(a):e.reject({status:404})}],theUser:["$q","Me",function(e,t){return e.resolve(t)}]},views:{header:{templateProvider:["$stateParams","theBand",function(e,t){var n='\n                <a class="button single last"\n                  async-modal="https://www.bandlab.com/web-app/song/partials/_song-help-modal-ca13944f.html">'.concat("Help",' <i class="icon-help"></i>\n                </a>\n              ');switch(e.category){case"recent":case"my-projects":return"\n                <label>".concat("New Project",' </label>\n                <a class="button"\n                   ui-sref="mixEditor"\n                   analytics-on="click"\n                   analytics-event="Open Mix Editor"\n                   analytics-category="Content Creation"\n                   analytics-label="Projects: ').concat(e.category,'">\n                  <i class="icon-micro"></i> ').concat("Mix Editor",'\n                </a>\n                <revision-importer\n                   analytics-on="mousedown"\n                   analytics-event="Open Importer"\n                   analytics-category="Content Creation"\n                   analytics-label="Projects: ').concat(e.category,'">\n                  <a class="button"><i class="icon-cloud-upload"></i> ').concat("Upload","</a>\n                </revision-importer>\n                ").concat(n,"\n              ");case"collaborations":case"bands":return n;default:return"\n                <label>".concat("New Project",' </label>\n                <a class="button"\n                   ui-sref="mixEditor({ bandId: \'').concat(t.id,'\' })"\n                   analytics-on="click"\n                   analytics-event="Open Mix Editor"\n                   analytics-category="Content Creation"\n                   analytics-label="Projects: band">\n                  <i class="icon-micro"></i> ').concat("Mix Editor","\n                </a>\n                <revision-importer band-id=\"'").concat(t.id,'\'"\n                   analytics-on="mousedown"\n                   analytics-event="Open Importer"\n                   analytics-category="Content Creation"\n                   analytics-label="Projects: band"\n                  <a class="button"><i class="icon-cloud-upload"></i> Upload</a>\n                </revision-importer>\n                <a class="button single last chevron-right" ui-sref="band.feed(::{ username: \'').concat(t.username,"' })\">").concat("Go to Band","</a>\n              ")}}]},list:{templateUrl:"https://www.bandlab.com/web-app/project/views/projects-list-e1df0ad8.html",controller:"ProjectsCtrl"}}}).state("library.projects.songs.tree",{url:"/tree?songId",params:{rewriteTracking:function(){return function(e){return e.replace(/\?songId=.*/g,"")}}},reloadOnSearch:!1,resolve:{theSong:["$stateParams","Song",function(e,t){return t.get({id:e.songId}).$promise}]},onEnter:["Page","theSong",function(e,t){bt(),e.setMetadata({title:t.name,description:t.description?t.description:"Listen to ".concat(t.name," from ").concat(t.author.name," on BandLab and share your opinion in its creative process."),image:t.picture.s,imageHeight:"360",imageWidth:"360",objectPath:"/songs/".concat(t.id)})}],onExit:["Page",function(e){vt(),e.clearMetadata()}],views:{"overlay@":{templateUrl:"https://www.bandlab.com/web-app/song/views/song-tree-view-7288b339.html",controller:"SongRevisionsFeedCtrl"}}}).state("library.collections",{url:"/collections?likes",params:{rewriteTracking:["$stateParams",function(e){return function(){return"/library/collections".concat(e.likes?"/likes":"")}}]},templateUrl:"https://www.bandlab.com/web-app/library/views/library-collections-dae076cd.html",controller:"UserCollectionsCtrl"}).state("library.bands",{url:"/bands?role",params:{rewriteTracking:["$stateParams",function(e){return function(){return"/library/bands".concat(e.role?"/".concat(e.role):"")}}]},templateUrl:"https://www.bandlab.com/web-app/library/views/library-bands-792d9fc2.html",controller:"UserBandsCtrl"}).state("library.communities",{url:"/communities?role",templateUrl:"https://www.bandlab.com/web-app/library/views/library-communities-18c52384.html",controller:"UserCommunitiesCtrl"})}]),angular.module("bandlab.editor").directive("lyricEditor",function(){return{restrict:"E",replace:!0,scope:{editorState:"=",lyrics:"=",readonly:"<"},templateUrl:"https://www.bandlab.com/web-app/lyric/partials/_lyric-editor-05607fbd.html"}}),angular.module("bandlab.editor").directive("midiEditor",["AnimationFrame","EditorHelper","EditorHistory","EditorRevision","EditorScroll","EditorState","EditorTrack","MidiEditor","midiEditorEvents","MidiEditorState","Soundbank",function(e,t,n,o,a,i,r,s,l,u,d){return{replace:!0,restrict:"E",scope:{},templateUrl:"https://www.bandlab.com/web-app/midi/partials/_midi-editor-256a2876.html",link:function(t){function n(e){document.querySelector(".midi-editor-container").style.width="".concat(u.containerWidth+12,"px"),e&&a.focusedNotesRescale(e)}n(),e.add("scale:notesTimeline",n),t.$on("$destroy",function(){e.remove("scale:notesTimeline",n)})},controller:["$scope",function(e){function a(e){var t=s.getSelectedNotes();if(t.length){var n=s.getSelectedNotesBoundaries(t);e=Math.max(e,n.infDeltaMidiNote),e=Math.min(e,n.supDeltaMidiNote),_.chain(t).forEach(function(t){t.midiNote+=e}).value(),s.previewSoloNote(t[0]),s.updateRegions()}}function p(){if(!u.track.soundbank)return!0;var e=d.getPropertyValue(u.track.soundbank,"instrumentSlug");return"drum-pads"!==e&&"drum-kit"!==e}e.state=i,e.midiEditorState=u,e.copyNotes=s.copyNotes,e.cutNotes=s.cutNotes,e.deleteNotes=s.deleteNotes,e.getNoteColor=s.getNoteColor,e.getNotePositionY=s.getNotePositionY,e.pasteNotes=s.pasteNotes,e.quantizeNotes=s.quantizeNotes,e.selectNotesOfSamePitch=s.selectNotesOfSamePitch,e.transposeNotes=s.transposeNotes,e.copyNotesToNewTrack=function(e){n.pushUndo(o.current);var t=r.duplicateTrack(u.track);s.copyNotesToTrack(u.track,t,e),r.setSelected(t)},e.$on(l.keyDown.copyNotes,s.copyNotes),e.$on(l.keyDown.cutNotes,s.cutNotes),e.$on(l.keyDown.deleteNotes,s.deleteNotes),e.$on(l.keyDown.pasteNotes,s.pasteNotes),e.$on(l.keyDown.quantizeNotes,s.quantizeNotes),e.$on(l.keyDown.selectAllNotes,s.selectAllNotes),e.$on(l.keyDown.moveDown,a.bind(null,-1)),e.$on(l.keyDown.moveUp,a.bind(null,1)),_.some(u.track.regions,function(e){return o.selectedRegions.has(e)})||s.scrollToNotes(),u.isPianoRoll=p(),e.$watch(function(){return u.isVisible?o.selectedTrack:{}},function(e){e.soundbank&&e.type!==c?(u.addedNotesByRegion={},u.notesByRegion={},u.removedNotesByRegion={},u.selectedNotesByRegion={},u.track=e,u.isPianoRoll=p()):t.hidePanel()})}]}}]),angular.module("bandlab.editor").directive("midiEditorAreaSelection",["EditorScrollState","editorSettings","MidiEditor","midiEditorEvents","MidiEditorState","SharedMidiSynth",function(e,t,n,o,a,i){return{replace:!0,restrict:"A",link:function(r,s){var c=document.body.querySelector(".mix-editor-panel-track");function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.left,o=void 0===n?0:n,a=t.top,i=void 0===a?0:a,r=t.width,s=void 0===r?0:r,c=t.height,l=void 0===c?0:c;requestAnimationFrame(function(){e.style.left="".concat(o,"px"),e.style.top="".concat(i,"px"),e.style.width="".concat(s,"px"),e.style.height="".concat(l,"px")})}s.on("mousedown",function(u){if(u.preventDefault(),!(a.isDrawing||a.isDrawingWithShortcut||u.target!==s[0]&&!u.target.classList.contains("midi-editor-region")||3===u.which)){var d=_.toPlainObject(c.getBoundingClientRect());d.top+=t.RULER_HEIGHT,d.height-=t.RULER_HEIGHT;var p={x:u.x,xMax:u.x+e.notesLeft,xMin:u.x-(a.containerWidth-(e.notesLeft+d.width)),y:u.y,yMax:u.y+e.notesTop,yMin:u.y-(e.notesEl.scrollHeight-(e.notesTop+d.height))};n.unselectNotes(),i.stopNotes();var m=document.createElement("div");m.classList.add("midi-editor-area-selection"),l(m),s[0].appendChild(m),r.$broadcast(o.selectNotes,{}),window.addEventListener("mouseup",function e(){m.remove(),window.removeEventListener("mouseup",e),document.removeEventListener("mousemove",f)}),document.addEventListener("mousemove",f)}function f(i){i.preventDefault(),n.autoscroll({x:i.clientX,y:i.clientY},d,p);var s=function(n,o,i){var r=n.y<o.y?e.notesEl.scrollHeight-(n.y+e.notesTop-i.top):n.y+e.notesTop-i.top,s=n.x<o.x?a.containerWidth-(n.x+e.notesLeft-t.TRACK_HEADER_WIDTH):n.x+e.notesLeft-t.TRACK_HEADER_WIDTH;return{left:Math.max(Math.min(n.x,o.x)+e.notesLeft-t.TRACK_HEADER_WIDTH,0),top:Math.max(Math.min(n.y,o.y)+e.notesTop-i.top,0),width:Math.min(Math.abs(o.x-n.x),s),height:Math.min(Math.abs(o.y-n.y),r)}}(p,i,d);l(m,s),r.$broadcast(o.selectNotes,s)}})}}}]),angular.module("bandlab.editor").directive("midiEditorFocus",["MidiEditorState",function(e){return{restrict:"A",link:function(t,n){function o(){e.hasFocus||(e.hasFocus=!0,document.addEventListener("mousedown",a))}function a(t){t.target.closest("[midi-editor-focus]")||t.target.closest(".mix-editor-ruler")||t.target.closest(".dropdown")||(e.hasFocus=!1,document.removeEventListener("mousedown",a))}n.on("mousedown",o),t.$on("$destroy",function(){e.hasFocus=!1,n.off("mousedown",o),document.removeEventListener("mousedown",a)})}}}]),angular.module("bandlab.editor").directive("midiEditorGrid",["AnimationFrame","EditorGrid","MidiEditorState",function(e,t,n){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/midi/partials/_midi-editor-grid-2f545e3f.html",link:function(o){var a=document.getElementById("midi-editor-grid-pattern");function i(){t.updateRulerGrid({pattern:a,state:n})}o.$watchGroup(["state.snapSetting","state.isTimeRuler"],i),e.add("scale:notesTimeline",i)}}}]),angular.module("bandlab.editor").directive("midiEditorHeader",["MidiEditor","MidiEditorState","MidiKeyMapping",function(e,t,n){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/midi/partials/_midi-editor-header-013c9426.html",compile:function(o){var a=_.reduce(new Array(e.getHighestNoteInRoll()),function(n,o,a){var i=_.includes([10,8,5,3,1],a%12)?"black":"white",r=e.getHighestNoteInRoll()-(a+1)+t.MIDI_NOTE_UI_OFFSET;return"".concat(n,'<div class="midi-editor-keys-').concat(i,'" data-midi-code="').concat(r,'" ng-class="{ active: isActive(').concat(r,"), 'not-mapped': !isMapped(").concat(r,') }">').concat(a%12==11?"C".concat(t.OCTAVES-Math.floor(a/12)):"","</div>")},""),i=_.map(n.getStandardDrumMap(),function(e){return'<span class="midi-editor-drums-label" title="'.concat(e.name,'" data-midi-code="').concat(e.midi,'" ng-class="{ active: isActive(').concat(e.midi,"), mapped: isMapped(").concat(e.midi,') }"><i class="icon-drum-').concat(e.slug,'"></i></span>')}).reverse().join("");o[0].querySelector(".midi-editor-keys").innerHTML=a,o[0].querySelector(".midi-editor-drums").innerHTML=i},controller:["$scope","editorEvents","EditorHistory","EditorRevision","MidiEditor","SharedMidiSynth","SoundbankSamples",function(e,n,o,a,i,r,s){e.humanizeNotes=i.humanizeNotes,e.press=i.previewNote,e.quantizeNotes=i.quantizeNotes,e.release=i.stopPreviewNote,e.setLegato=i.setLegato,e.setRandomVelocity=i.setRandomVelocity,e.transposeNotes=i.transposeNotes,e.$on("MidiMessage:noteEvent",function(){e.$digest()}),e.$on(n.keyDown.toggleVelocity,function(){e.toggleVelocity(),e.$apply()}),e.isActive=function(e){return!!r.current[e]},e.isMapped=function(e){return t.track&&s[t.track.soundbank]&&!!s[t.track.soundbank][e]},e.toggleMoving=function(){t.isDrawing=!1,t.isVelocity=!1},e.toggleDrawing=function(){t.isDrawing=!0,t.isDrawingWithShortcut=!1,t.isVelocity=!1},e.toggleVelocity=function(){t.isVelocity=!0,t.isDrawing=!1,t.isDrawingWithShortcut=!1},e.setVelocity=function(e){var n=_.chain(t.selectedNotesByRegion).values().flatten().value(),o=_.chain(n).map("velocity").max().value(),a=_.chain(n).map("velocity").min().value(),i=e-a;o+i>1&&(i=1-o),a+i<.01&&(i=.01-a),_.forEach(n,function(e){e.velocity+=i})},e.getVelocity=function(){var e=_.chain(t.track.regions).map(function(e){return t.selectedNotesByRegion[e.id]}).flatten().compact().sortBy("velocity").value();return e.length?e[0].velocity:0},e.updateVelocity=function(){_.chain(t.track.regions).map(function(e){return t.selectedNotesByRegion[e.id]}).flatten().value().length&&(o.pushUndo(a.current),i.updateRegions(),e.$applyAsync())},e.selectQuantizeValue=function(t){e.quantizationValue=t}}]}}]),angular.module("bandlab.editor").directive("midiEditorTrackGrid",["AnimationFrame","EditorGrid","MidiEditorState",function(e,t,n){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/midi/partials/_midi-editor-track-grid-6f458d98.html",link:function(o){var a=document.getElementById("midi-editor-track-grid-pattern");function i(){t.updateTrackGrid({pattern:a,state:n})}o.$watchGroup(["state.snapSetting","state.isTimeRuler"],i),e.add("scale:notesTimeline",i)}}}]),angular.module("bandlab.editor").directive("midiEditorKeyEvents",["$rootScope","EditorState","midiEditorEvents","MidiEditorState",function(e,t,n,o){return{restrict:"A",link:function(a){function i(i){if(o.hasFocus&&t.canCollaborate){var r=i.ctrlKey||i.metaKey;if(r||i.shiftKey){if(r&&!i.shiftKey)switch(i.key){case"a":a.$broadcast(n.keyDown.selectAllNotes),i.preventDefault();break;case"c":a.$broadcast(n.keyDown.copyNotes);break;case"x":a.$broadcast(n.keyDown.cutNotes);break;case"v":a.$broadcast(n.keyDown.pasteNotes)}}else{switch(i.code){case"ArrowUp":a.$broadcast(n.keyDown.moveUp);break;case"ArrowDown":a.$broadcast(n.keyDown.moveDown);break;case"Backspace":case"Delete":a.$broadcast(n.keyDown.deleteNotes)}switch(i.key){case"q":a.$broadcast(n.keyDown.quantizeNotes)}}e.$applyAsync()}}document.addEventListener("keydown",i),a.$on("$destroy",function(){document.removeEventListener("keydown",i)})}}}]),angular.module("bandlab.editor").directive("midiEditorNoteLeft",["EditorHelper","EditorState","MidiEditor","MidiEditorState",function(e,t,n,o){return{restrict:"A",link:function(a,i){var r;function s(n){n.preventDefault();var i=function(a,i){var s=(n.x-r.x)/o.scalePx,c=a.startPosition-a.sampleOffset+r.time+s;return s+=e.snapToGrid(c,t.snapDuration,{padding:5/o.scalePx})-c,s=Math.max(s,r.minDeltaTime),Math.min(s,r.maxDeltaTime)}(a.region);_.chain(o.selectedNotesByRegion).values().flatten().forEach(function(e,t){e.duration=r.notes[t].duration-i,e.time=r.notes[t].time+i,o.noteDuration[o.track.id]=e.duration}).value(),a.$apply()}function c(){window.removeEventListener("mouseup",c),document.body.removeEventListener("mousemove",s),document.body.classList.remove("is-resizing"),n.updateRegions(),o.isResizing=!1,a.$apply()}i.on("mousedown",function(e){if(e.preventDefault(),n.selectNoteOnMousedown(a,e)){var t=n.getSelectedNotes(),i=_.sortBy(t,function(e){return e.time+e.duration}),l=_.sortBy(t,"duration"),u=_.head(l),d=_.head(i);r={x:e.x,notes:_.cloneDeep(t),time:a.note.time,duration:a.note.duration,maxDeltaTime:u.duration-o.MIDI_NOTE_DURATION_MIN,minDeltaTime:-d.time},window.addEventListener("mouseup",c),document.body.addEventListener("mousemove",s),document.body.classList.add("is-resizing"),o.isResizing=!0,a.$apply()}})}}}]),angular.module("bandlab.editor").directive("midiEditorNoteMove",["EditorAllowActions","EditorHelper","EditorScrollState","editorSettings","EditorState","MidiEditor","MidiEditorState",function(e,t,n,o,a,i,r){return{restrict:"A",link:function(s,c){var l=document.body.querySelector(".mix-editor-panel-track");c[0].draggable=!1,c.on("mousedown",function(c){if(c.preventDefault(),i.selectNoteOnMousedown(s,c)&&e.isAllowed("editRegion")){var u=i.getSelectedNotes(),d=_.minBy(u,"time"),p=0,m=_.toPlainObject(l.getBoundingClientRect());m.top+=o.RULER_HEIGHT,m.height-=o.RULER_HEIGHT;var f=Hn({dragged:!1,infDeltaTime:-d.time,infDeltaVelocity:-_.minBy(u,"velocity").velocity,noteIndex:r.selectedNotesByRegion[s.region.id].indexOf(s.note),notes:_.cloneDeep(u),supDeltaTime:i.getShortestNoteToRegionEndDuration(),supDeltaVelocity:1-_.maxBy(u,"velocity").velocity,time:-s.note.time,x:c.x,xMax:c.x+n.notesLeft,xMin:c.x-(r.containerWidth-(n.notesLeft+r.containerWidth)),y:c.y,yMax:c.y+n.notesTop,yMin:c.y-(n.notesEl.scrollHeight-(n.notesTop+m.height))},i.getSelectedNotesBoundaries(u));window.addEventListener("mouseup",function e(){window.removeEventListener("mouseup",e),document.body.removeEventListener("mousemove",h),document.body.removeEventListener("mousemove",g),document.body.classList.remove("is-moving"),document.body.classList.remove("is-velocitying"),f.dragged&&(i.updateRegions(),s.$applyAsync())}),r.isVelocity?(document.body.addEventListener("mousemove",h),document.body.classList.add("is-velocitying")):(document.body.addEventListener("mousemove",g),document.body.classList.add("is-moving"))}function h(e){e.preventDefault();var t=Math.max(Math.min(f.supDeltaVelocity,(f.y-e.y)/100),f.infDeltaVelocity);_.chain(r.selectedNotesByRegion).values().flatten().forEach(function(e,n){e.velocity=f.notes[n].velocity+t}).value(),s.$applyAsync(),f.dragged=!0}function g(e){e.preventDefault();var n,o,c=function(n){var o=(e.x-f.x)/r.scalePx,i=s.region.startPosition-f.time+o;return o+=t.snapToGrid(i,a.snapDuration,{padding:a.snapDuration/2})-i,o=Math.min(o,f.supDeltaTime),Math.max(o,f.infDeltaTime)}(),l=(n=e.y-f.y,o=-Math.floor(n/i.getNoteHeight()),o=Math.max(o,f.infDeltaMidiNote),o=Math.min(o,f.supDeltaMidiNote));!f.dragged&&e.altKey&&(r.addedNotesByRegion=_.cloneDeep(r.selectedNotesByRegion),_.chain(r.addedNotesByRegion).values().flatten().forEach(function(e){e.id=k()}).value(),r.selectedNotesByRegion=Hn({},r.addedNotesByRegion),_.transform(r.addedNotesByRegion,function(e,t,n){return Array.prototype.push.apply(e[n],t),e},r.notesByRegion)),_.chain(r.selectedNotesByRegion).values().flatten().forEach(function(e,t){e.time=f.notes[t].time+c,e.midiNote=f.notes[t].midiNote+l}).value(),p!==l&&(i.previewSoloNote(r.selectedNotesByRegion[s.region.id][f.noteIndex]||s.note),p=l),i.autoscroll({x:e.clientX,y:e.clientY},m,f),s.$applyAsync(),f.dragged=!0}})}}}]),angular.module("bandlab.editor").directive("midiEditorNoteRight",["EditorHelper","EditorState","MidiEditor","MidiEditorState",function(e,t,n,o){return{restrict:"A",link:function(a,i){var r;function s(n){n.preventDefault();var i=function(i,s){var c=(n.x-r.x)/o.scalePx,l=i+c;return c+=e.snapToGrid(a.note.time+l,t.snapDuration,{padding:5/o.scalePx})-a.note.time-l,c=Math.max(c,r.minDeltaDuration),Math.min(c,r.maxDeltaDuration)}(r.duration);_.chain(o.selectedNotesByRegion).values().flatten().forEach(function(e,t){e.duration=r.notes[t].duration+i,o.noteDuration[o.track.id]=e.duration}).value(),a.$apply()}function c(){window.removeEventListener("mouseup",c),document.body.removeEventListener("mousemove",s),document.body.classList.remove("is-resizing"),n.updateRegions(),o.isResizing=!1,a.$apply()}i.on("mousedown",function(e){if(e.preventDefault(),n.selectNoteOnMousedown(a,e)){var t=n.getSelectedNotes(),i=_.sortBy(t,"duration"),l=_.head(i);r={x:e.x,notes:_.cloneDeep(t),duration:a.note.duration,maxDeltaDuration:n.getShortestNoteToRegionEndDuration(),minDeltaDuration:-l.duration+o.MIDI_NOTE_DURATION_MIN},window.addEventListener("mouseup",c),document.body.addEventListener("mousemove",s),document.body.classList.add("is-resizing"),o.isResizing=!0,a.$apply()}})}}}]),angular.module("bandlab.editor").directive("midiEditorPencil",["editorEvents","EditorHelper","EditorHistory","EditorMidiSamples","EditorRevision","EditorScrollState","EditorState","EditorTimeline","MetronomeState","MidiEditor","MidiEditorState",function(e,t,n,o,a,i,r,s,c,l,u){return{replace:!0,restrict:"A",link:function(d,p){var m,f,h;function g(e){return r.canCollaborate&&u.track&&!e.target.classList.contains("midi-editor-note")&&3!==e.which&&(e.target===p[0]||e.target.classList.contains("midi-editor-region"))}function v(e){var n=u.noteDuration[u.track.id]||r.snapDuration,a=p[0].parentElement.getBoundingClientRect(),d=t.getMeasureDuration(c.settings);if((f={id:k(),midiNote:l.getHighestNoteInRoll()-1-Math.floor((e.y-a.top+i.notesTop)/l.getNoteHeight())+u.MIDI_NOTE_UI_OFFSET,duration:n,velocity:u.VELOCITY_DEFAULT}).time=(e.x-a.left-12)/u.scalePx,f.time=Math.max(f.time,0),l.previewSoloNote(f),m=_.find(u.track.regions,function(e){return o.has(e.sampleId)&&e.startPosition<=f.time&&e.startPosition+t.getFirstLoopDuration(e)>f.time}))h=w(m,f,e);else{if(m=_.chain(u.track.regions).filter(function(e){var t=2*d;return o.has(e.sampleId)&&!e.loopLength&&e.startPosition<=f.time&&e.endPosition+t>f.time}).minBy(function(e){return f.time-e.endPosition}).value()){var g=Math.min(Math.ceil(f.time/d)*d,S(f.time));return m.endPosition=g,void(h=w(m,f,e))}if(m=_.find(u.track.regions,function(e){return o.has(e.sampleId)&&e.loopLength&&e.startPosition+t.getFirstLoopDuration(e)<f.time&&e.startPosition+e.loopLength+t.getExtraLoopDuration(e)>f.time})){var v=m.startPosition+m.loopLength*Math.floor((f.time-m.startPosition)/m.loopLength);return m=s.createEmptyRegion(u.track,{startPosition:v,endPosition:Math.min(v+m.loopLength,m.endPosition,S(f.time)),sampleId:m.sampleId}),void(h=w(m,f,e))}var b=Math.floor(f.time/d)*d;m=s.createEmptyRegion(u.track,{startPosition:b,endPosition:Math.min(b+d,S(f.time))}),h=w(m,f,e)}}function b(e){e.preventDefault(),u.selectedNotesByRegion[m.id][0].duration=h.duration+(e.x-h.x)/u.scalePx,u.noteDuration[u.track.id]=u.selectedNotesByRegion[m.id][0].duration,d.$apply()}function y(){document.removeEventListener("mouseup",y),document.removeEventListener("mousemove",b),document.body.classList.remove("is-moving"),u.selectedNotesByRegion[m.id][0].duration!==h.duration&&l.updateRegions()}function w(e,o,i){return n.pushUndo(a.current),o.time=t.snapToGrid(o.time-r.snapDuration/2,r.snapDuration,{padding:r.snapDuration/2}),o.time=Math.min(o.time,m.endPosition-o.duration),o.time=Math.max(o.time,m.startPosition),o.time-=e.startPosition,l.unselectNotes(),u.selectedNotesByRegion[e.id]=[o],u.addedNotesByRegion[e.id]=[o],u.notesByRegion[e.id]=u.notesByRegion[e.id]||[],u.notesByRegion[e.id].push(o),l.updateRegions(),{duration:o.duration,x:i.x}}function S(e){return _.chain(u.track.regions).map("startPosition").sort().find(function(t){return t>e}).value()||1/0}d.$on(e.keyDown.snapEnable,function(){u.isDrawingWithShortcut=!1,d.$apply()}),d.$on(e.keyDown.snapDisable,function(){u.isDrawingWithShortcut=!0,d.$apply()}),d.$watch(function(){return u.isDrawing||u.isDrawingWithShortcut},function(e){var t;e?((t=document.createElement("canvas").getContext("2d")).canvas.height=18,t.canvas.width=18,t.fillStyle="#000",t.font="20px bandlab",t.lineWidth=.5,t.strokeStyle="#fff",t.textAlign="center",t.textBaseline="middle",t.translate(t.canvas.width/2,t.canvas.height/2),t.scale(1,-1),t.fillText("",0,0),t.strokeText("",0,0),p[0].style.cursor="url(".concat(t.canvas.toDataURL("image/png"),") 4 0, auto"),p[0].classList.add("is-drawing")):(p[0].classList.remove("is-drawing"),p[0].style.cursor="")}),p.on("dblclick",function(e){e.preventDefault(),g(e)&&v(e)}),p.on("mousedown",function(e){e.preventDefault(),g(e)&&(u.isDrawing||u.isDrawingWithShortcut)&&(v(e),document.addEventListener("mouseup",y),document.addEventListener("mousemove",b),document.body.classList.add("is-moving"))})}}}]),angular.module("bandlab.editor").directive("midiEditorPlayhead",["AnimationFrame","EditorScroll","editorSettings","EditorState","MidiEditorState",function(e,t,n,o,a){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/midi/partials/_midi-editor-playhead-3ec5352b.html",link:function(i,r){var s,c=new IntersectionObserver(function(e){0!==e[0].intersectionRatio||!o.isPlaying||!o.isFollowingPlayhead||o.crTime<0||t.scrollNotesToX({direction:"right",offset:0})});function l(){var e=Math.round(o.crTime*a.scalePx-n.PLAYHEAD_HALF_WIDTH);s!==e&&(r[0].style.transform="translateX(".concat(e,"px)")),s=e}c.observe(r[0]),e.add("playing",l),i.$on("$destroy",function(){e.remove("playing",l),c&&c.disconnect()})}}}]),angular.module("bandlab.editor").directive("midiEditorRegion",["EditorHelper","EditorState","MidiEditor","midiEditorEvents","MidiEditorState",function(e,t,n,o,a){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/midi/partials/_midi-editor-region-e928a292.html",link:function(i){i.$on(o.selectNotes,function(e,t){var o=function(e,t){var o=n.getNoteHeight(),r=n.getHighestNoteInRoll(),s=e.left/a.scalePx,c=(e.left+e.width)/a.scalePx,l=r-1-Math.floor(e.top/o)+a.MIDI_NOTE_UI_OFFSET,u=r-1-Math.floor((e.top+e.height)/o)+a.MIDI_NOTE_UI_OFFSET;return _.filter(t,function(e){var t=i.region.startPosition+e.time+e.duration>s&&i.region.startPosition+e.time<c&&(!i.region.loopLength||i.region.loopLength&&e.time<i.region.loopLength),n=e.midiNote<=l&&e.midiNote>=u;return t&&n})}(t,i.notes),r=_.differenceBy(o,a.selectedNotesByRegion[i.region.id],"id");r.length>0&&n.previewSoloNote(r[0]),a.selectedNotesByRegion[i.region.id]=o,i.$applyAsync()}),i.getRegionStyle=function(){return{"box-shadow":"inset ".concat(Math.round(e.getFirstLoopWidth(i.region)/t.scalePx*a.scalePx),"px 0px 0px 0px rgba(255, 255, 255, .08), inset -").concat(Math.round(e.getExtraLoopWidth(i.region)/t.scalePx*a.scalePx),"px 0px 0px 0px rgba(255, 255, 255, .04)"),left:"".concat(i.region.startPosition*a.scalePx,"px"),width:"".concat((i.region.endPosition-i.region.startPosition)*a.scalePx,"px")}}},controller:["$scope","EditorHelper","EditorMidiSamples","EditorRevision","EditorScrollState",function(e,t,o,i,r){var s=e.$watch("region.sampleId",function(){o.has(e.region.sampleId)&&(s(),c(),i.selectedRegions.has(e.region)&&n.scrollToNotes(e.region),s=e.$watchGroup(["region.sampleId","region.loopLength",function(){return t.getTotalDuration(e.region)},function(){return a.track.soundbank}],c))});function c(){e.notes=n.renderRegionNotes(e.region),a.notesByRegion[e.region.id]=e.notes,a.selectedNotesByRegion[e.region.id]=_.chain(a.selectedNotesByRegion[e.region.id]).map(function(t){return _.find(e.notes,{id:t.id})}).compact().value(),setTimeout(function(){r.notesTop=Math.min(r.notesTop,r.notesEl.scrollHeight-r.notesEl.clientHeight)})}}]}}]),angular.module("bandlab.editor").directive("midiEditorRegionNote",["MidiEditor","MidiEditorState",function(e,t){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/midi/partials/_midi-editor-region-note-d485c9e6.html",link:function(n,o){var a;a=_.debounce(function(){e.previewSoloNote(n.note)},250,{leading:!0,trailing:!1}),o.on("dblclick",function(t){t.preventDefault(),e.deleteNotes(),n.$digest()}),o.on("mousedown",function(o){o.preventDefault(),t.isDrawing||t.isDrawingWithShortcut?a():e.previewSoloNote(n.note)})},controller:["$scope",function(e){e.isSelected=function(){return t.selectedNotesByRegion[e.region.id]=t.selectedNotesByRegion[e.region.id]||[],t.selectedNotesByRegion[e.region.id].indexOf(e.note)>-1}}]}}]),angular.module("bandlab.editor").directive("midiEditorRuler",["AnimationFrame","AudioState","EditorAutomation","EditorGrid","EditorHelper","EditorPlayer","editorSettings","EditorState","Metronome","MidiEditorState",function(e,t,n,o,a,i,r,s,c,l){return{replace:!0,restrict:"E",templateUrl:"https://www.bandlab.com/web-app/midi/partials/_midi-editor-ruler-cc4b796b.html",link:function(t,n){var a=n[0].querySelector(".midi-editor-ruler-graduation");function i(){o.updateGridLabel({element:a,state:l}),n[0].style.width="".concat(l.containerWidth,"px")}t.$watch("state.isTimeRuler",i),e.add("scale:notesTimeline",i)},controller:["$scope",function(e){e.setCurrentTime=function(e,o){o=Math.max(0,o-12),o=s.isTimeRuler?o:a.snapToGrid(o,s.snapDuration*l.scalePx,{}),o=Math.min(o/l.scalePx,r.SONG_DURATION_MAX),i.setPlaybackPosition(o),t.isMetronomeEnabled&&c.sync(s.crTime),n.syncVolume()}}]}}]),angular.module("bandlab.editor").directive("midiEditorRulerRegion",["EditorHelper","EditorRevision","EditorTimeline","MidiEditorState",function(e,n,o,a){return{restrict:"A",controller:["$scope",function(i){var r={};i.selectRegion=function(){n.selectedRegions=new Set([i.region]),r={duration:i.region.endPosition-i.region.startPosition,endPosition:i.region.endPosition,firstPosition:i.region.startPosition,firstTrack:a.track,lastPosition:i.region.startPosition,loopLength:i.region.loopLength,sampleOffset:i.region.sampleOffset,scalePx:a.scalePx,startPosition:i.region.startPosition,startPositions:t({},i.region.id,i.region.startPosition)},i.$applyAsync()},i.moveRegion=function(e){o.moveRegion(i.region,0,zn({},r,{delta:-e,firstRegionSnapped:0})),i.$apply()},i.moveRegionLeft=function(e){o.resizeRegionLeft(i.region,zn({},r,{delta:e})),i.$apply()},i.resizingRight=function(e){o.resizeRegionRight(i.region,zn({},r,{delta:e})),i.$apply()},i.expandLoop=function(e){o.expandRegionLoop(i.region,zn({},r,{delta:e})),i.$apply()},i.updateTrack=function(){o.moveRegions(r.firstTrack)},i.getFirstLoopDuration=function(){return e.getFirstLoopDuration(i.region)}}]}}]),angular.module("bandlab.editor").directive("midiEditorScrollbarHorizontal",["AnimationFrame","EditorScroll","EditorScrollState",function(e,t,n){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/midi/partials/_midi-editor-scrollbar-horizontal-801a2925.html",link:function(o,a){var i=a[0].querySelector(".midi-editor-scrollbar-horizontal");function r(){var e=n.notesTimelineEl,t=e.clientWidth,o=e.scrollWidth,a=e.scrollLeft,r=Math.round(t/o*t),s=Math.round(a/(o-t)*(t-r));i.style.width="".concat(r,"px"),i.style.transform="translateX(".concat(s,"px)")}new ResizeObserver(r).observe(a[0]),e.add("scale:notesTimeline",r),e.add("scroll:notesLeft",r),setTimeout(function(){r()}),a.on("mousedown",function(e){var n=i.getBoundingClientRect(),o=e.clientX;o<n.left?t.scrollNotesToX({direction:"left"}):o>n.right&&t.scrollNotesToX({direction:"right"})}),o.$on("$destroy",function(){e.remove("scale:notesTimeline",r),e.remove("scroll:notesLeft",r)})},controller:["EditorScroll","$scope",function(e,t){var o,a;t.backupPositionX=function(e){o=e,a=n.notesLeft},t.scrollX=function(t){e.scrollNotesToX({clickPosition:o,offsetPosition:a,percent:t})}}]}}]),angular.module("bandlab.editor").directive("midiEditorScrollbarVertical",["AnimationFrame","EditorScroll","EditorScrollState",function(e,t,n){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/midi/partials/_midi-editor-scrollbar-vertical-8be6cdc6.html",link:function(o,a){var i=a[0].querySelector(".midi-editor-scrollbar-vertical"),r=new ResizeObserver(s);function s(){var e=n.notesEl,t=e.clientHeight,o=e.scrollHeight,r=e.scrollTop,s=Math.round(t/o*t),c=Math.round(r/(o-t)*(t-s));i.style.height="".concat(s,"px"),i.style.transform="translateY(".concat(c,"px)"),a[0].classList.toggle("hidden",t>=o)}r.observe(a[0]),e.add("scroll:notesTop",s),a.on("mousedown",function(e){var n=i.getBoundingClientRect(),o=e.clientY;o<n.top?t.scrollNotesToY({direction:"up"}):o>n.bottom&&t.scrollNotesToY({direction:"down"})}),o.$on("$destroy",function(){r.disconnect(),e.remove("scroll:notesTop",s)})},controller:["EditorScroll","$scope",function(e,t){var o,a;t.backupPositionY=function(e){o=1-e,a=n.notesTop},t.scrollY=function(t){e.scrollNotesToY({clickPosition:o,offsetPosition:a,percent:1-t})}}]}}]),angular.module("bandlab.editor").value("DrumMachineState",{nextDivision:0,nextDivisionTime:0,kit:[],matrix:{},patterns:[],selectedPattern:{}}).factory("DrumMachine",["$q","$rootScope","AudioCtx","DrumMachineState","EditorDB","editorEvents","EditorMidiSamples","EditorMidiScore","EditorState","MetronomeState","MidiKeyMapping","SharedMidiSynth",function(e,t,n,o,a,i,r,s,c,l,u,d){var p,m=u.getDrumsMidi(),f=u.getMidiDrums(),h=u.getStandardDrumMap(),g=16,v=[];return{clearPattern:function(){o.matrix=b(),y()},createDefaultPatterns:function(e){var t=[C({matrix:{hhClosed:[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],hhOpen:[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],kick:[1,0,0,0,0,0,0,1,1,0,1,0,0,0,1,0],snare:[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]}}),C({matrix:{hhClosed:[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],kick:[1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1],snare:[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],tomFloor:[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],tomMid:[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0]}}),C({matrix:{}}),C({matrix:{}}),C({matrix:{}}),C({matrix:{}}),C({matrix:{}}),C({matrix:{}})];return _.map(t,function(t,n){return t.trackId=e,{sampleId:t.id,notes:[m.crash,m.hhOpen,m.hhClosed,0===n?m.clap:m.tomHigh,0===n?m.snareStick:m.tomMid,m.snare,m.tomFloor,m.kick]}})},exportScore:C,fillMissingPatterns:function(e){var t=[C({matrix:{}}),C({matrix:{}}),C({matrix:{}}),C({matrix:{}}),C({matrix:{}}),C({matrix:{}}),C({matrix:{}}),C({matrix:{}})],n=_.map(t,function(t,n){return t.trackId=e.id,{sampleId:t.id,notes:[m.crash,m.hhOpen,m.hhClosed,0===n?m.clap:m.tomHigh,0===n?m.snareStick:m.tomMid,m.snare,m.tomFloor,m.kick]}});return[].concat(He(e.patterns),He(n)).slice(0,8)},getAvailableKit:function(e){return _.filter(h,function(t){return!_.includes(o.kit,t)||t===e})},getCurrentKit:function(){return o.kit},getCurrentPreset:function(){return o.selectedPattern},getCurrentPresetIndex:function(){return o.patterns.indexOf(o.selectedPattern)},isActive:M,previewNote:E,scheduleNote:P,selectPattern:function(e){var t,n,a;o.selectedPattern=e,o.matrix=(t=e.sampleId,n=r.get(t),a=b(),_.forEach(n.notes,function(e){var t,n,o=f[e.midiNote].slug;a[o][Math.round((t=e.time,n=l.settings,4*s.ticksToSeconds(parseInt(t),n.bpm)*n.bpm/60))]=!0}),a),o.kit=_.chain(e.notes).map(function(e){return f[e]}).concat(h).uniqBy("slug").take(8).value()},set:function(e,t,n){if(o.matrix[e.slug]&&n!==o.matrix[e.slug][t])return o.matrix[e.slug][t]=n,n&&!p&&E(e),y(),o.matrix},start:w,stop:T,stopPreviewNote:function(e){d.noteOff(e.midi,1,0)},swapDrum:function(e,t){var n=o.matrix[e],a=_.findIndex(o.kit,{slug:t}),i=_.find(h,{slug:e});o.matrix[e]=o.matrix[t],o.matrix[t]=n,o.kit.splice(a,1,i),o.selectedPattern.notes[a]=i.midi,y()},toggle:function(){return M()?(T(),!1):(w(),!0)}};function b(){return _.transform(h,function(e,t){e[t.slug]=_.fill(new Array(g),!1)},{})}function y(){var e=C();o.selectedPattern.sampleId=e.id,t.$broadcast("DrumMachine:update",e)}function w(){p=!0,o.nextDivision=0,o.nextDivisionTime=n.get().currentTime,S(),e.resolve(l.worker).then(function(e){e.addEventListener("message",S)}),c.isPlaying&&t.$broadcast(i.keyDown.play)}function S(){for(;o.nextDivisionTime<n.get().currentTime+l.SCHEDULE_AHEAD;)P(o.nextDivision,o.nextDivisionTime),o.nextDivisionTime+=60/l.settings.bpm/4,o.nextDivision++,o.nextDivision>=g&&(o.nextDivision=0)}function P(e,a){_.forEach(o.kit,function(t){o.matrix[t.slug][e]&&d.noteOn(t.midi,1,a)}),v.push(setTimeout(function(){t.$broadcast("DrumMachine:beat",e)},1e3*(a-n.get().currentTime)))}function E(e){d.noteOn(e.midi,1,0)}function T(){M()&&(e.resolve(l.worker).then(function(e){p=!1,e.removeEventListener("message",S),_.forEach(v,function(e){clearTimeout(e)}),v=[],t.$broadcast("DrumMachine:beat",-1)}),_.forEach(o.kit,function(e){d.noteOff(e.midi,1,0)}))}function M(){return p}function $(e){var t=l.settings,n=e/4/t.bpm*60;return s.secondsToTicks(n,t.bpm)}function C(e){var t=r.get(o.selectedPattern.sampleId),n=_.chain(e?e.matrix:o.matrix).reduce(function(e,t,n){var o=_.take(t,g);return o=_.map(o,function(e,t){if(e)return{duration:"1i",id:n+$(t),midiNote:m[n],time:"".concat($(t),"i"),velocity:.8}}),e.concat(o)},[]).compact().value(),i={id:k(),name:"Drum Machine",notes:n,parentId:!(e||!t)&&t.id,trackId:!(e||!t)&&t.trackId};return a.updateFile({blob:i,sampleId:i.id}),r.set(i.id,i),i}}]),angular.module("bandlab.editor").factory("MidiDevice",["$rootScope","audioSettings","AudioState","EditorAutomation","EditorHelper","EditorPlayer","EditorRevision","InputDevice","SharedMidiSynth",function(e,t,o,a,i,r,s,c,l){var u,d=127;return c.getMidiDevices().then(function(e){return f(n(e,1)[0])}),{onMidiMessage:p,plug:f,unplug:m};function p(o){var c=240&o.data[0],u=o.data[2]?o.data[2]/d:null;switch(c===MidiConvert.EVENT.NOTE_ON&&0===o.data[2]&&(c=MidiConvert.EVENT.NOTE_OFF),c){case MidiConvert.EVENT.NOTE_ON:l.noteOn(o.data[1],u);break;case MidiConvert.EVENT.NOTE_OFF:l.noteOff(o.data[1],u,null,null,l.isSustaining());break;case MidiConvert.EVENT.CONTROL_CHANGE:!function(o){switch(o.data[1]){case MidiConvert.EVENT.CONTROLLER.DAMPER_PEDAL:case MidiConvert.EVENT.CONTROLLER.EXPRESSION_PEDAL:!l.isSustaining()&&o.data[2]>=64?l.sustainOn():l.isSustaining()&&o.data[2]<64&&l.sustainOff();break;case MidiConvert.EVENT.CONTROLLER.PAN:c=o.data,u=n(c,3)[2],d=void 0===u?64:u,(p=s.selectedTrack).id&&(p.pan=(d-63)/64,r.current.setTrackParameter(p.id,"pan",p.pan),a.syncVolume()),e.$applyAsync();break;case MidiConvert.EVENT.CONTROLLER.VOLUME:!function(e){var o=n(e,3)[2],c=void 0===o?64:o,l=s.selectedTrack;if(l.id){var u=t.AUDIO_PARAMETERS.volume.range,d=parseFloat(i.scaleLogToLin(c/127*u,u).toFixed(4));d=Math.min(2,Math.max(d,0)),l.volume=d,r.current.setTrackParameter(l.id,"volume",d),a.syncVolume()}}(o.data),e.$applyAsync()}var c,u,d,p}(o)}switch(o.data[0]){case MidiConvert.EVENT.PITCH_BEND:return void l.setPitchBend(o.data)}e.$broadcast("MidiMessage:noteEvent")}function m(){u&&u.onmidimessage&&(u.onmidimessage=null),u=null,o.isMidiActive=!1}function f(e){u&&m(),(u=e)&&(u.onmidimessage=p,o.isMidiActive=!0)}}]),angular.module("bandlab.editor").value("MidiEditorState",{addedNotesByRegion:{},clipboard:null,hasFocus:!1,height:338,isDrawing:!1,isDrawingWithShortcut:!1,isPianoRoll:!0,isResizing:!1,isVelocity:!1,isVisible:!1,notesByRegion:{},noteDuration:{},originalHeight:338,previewNote:!0,removedNotesByRegion:{},selectedNotesByRegion:{},track:{},MIDI_NOTE_DURATION_MIN:.001,MIDI_NOTE_UI_HEIGHT:10,MIDI_NOTE_UI_HEIGHT_LARGE:32,MIDI_NOTE_UI_OFFSET:21,OCTAVES:8,TIME_APPROXIMATION:.03,VELOCITY_DEFAULT:100/127}).factory("MidiEditor",["$q","$rootScope","$timeout","AnimationFrame","EditorData","EditorHelper","EditorHistory","EditorMidiSamples","EditorMidiScore","EditorPlayer","EditorRevision","EditorScrollState","EditorState","MidiEditorState","MidiKeyMapping","SharedMidiSynth","Soundbank",function(e,n,o,a,i,r,s,c,l,u,d,p,m,f,g,v,b){return{autoscroll:function(e,t,n){var o=p.SCROLL_STEP;switch(!0){case e.x>t.right:n.x=Math.max(n.x-o,n.xMin),p.notesLeft+=o;break;case e.x<t.left:n.x=Math.min(n.x+o,n.xMax),p.notesLeft-=o;break;case e.y<t.top:n.y=Math.min(n.y+o,n.yMax),p.notesTop-=o;break;case e.y>t.bottom:n.y=Math.max(n.y-o,n.yMin),p.notesTop+=o}},copyNotes:$,copyNotesToTrack:function(e,t,n){var o;o=e.regions.map(function(e){var t,n;return t=c.get(e.sampleId),!!(n=_.filter(t.notes,function(t){return _.find(f.selectedNotesByRegion[e.id],{id:t.id})})).length&&l.editScore(t,n)}),t.regions=_.filter(t.regions,function(e,t){return!!o[t]&&(e.sampleId=o[t].id,!0)}),d.selectedRegions=new Set(t.regions),n&&e.regions.forEach(function(e){var t,n,o;if(n=c.get(e.sampleId),(o=_.filter(n.notes,function(t){return!_.find(f.selectedNotesByRegion[e.id],{id:t.id})})).length===n.notes.length)return!1;t=l.editScore(n,o),e.sampleId=t.id})},cutNotes:function(){$(),A()},deleteNotes:A,getHighestNoteInRoll:T,getNoteColor:function(e){var t=100*(1+55*e/-126);return"hsl(".concat(167,", ").concat(63,"%, ").concat(t,"%)")},getNoteHeight:function(){return f.isPianoRoll?f.MIDI_NOTE_UI_HEIGHT:f.MIDI_NOTE_UI_HEIGHT_LARGE},getNotePositionY:function(e){return f.isPianoRoll?"".concat((e-f.MIDI_NOTE_UI_OFFSET)*f.MIDI_NOTE_UI_HEIGHT,"px"):"".concat((e-f.MIDI_NOTE_UI_OFFSET)*f.MIDI_NOTE_UI_HEIGHT_LARGE,"px")},getSelectedNotes:y,getSelectedNotesBoundaries:function(e){var t=_.sortBy(e,"midiNote"),n=_.last(t);return{infDeltaMidiNote:-_.head(t).midiNote+f.MIDI_NOTE_UI_OFFSET,supDeltaMidiNote:T()-1-n.midiNote+f.MIDI_NOTE_UI_OFFSET}},getShortestNote:function(){return _.chain(f.selectedNotesByRegion).values().flatten().map("duration").min().value()},getShortestNoteToRegionEndDuration:function(){return _.chain(f.selectedNotesByRegion).map(function(e,t){if(e.length){var n=_.chain(e).sortBy(function(e){return e.time+e.duration}).last().value(),o=_.find(f.track.regions,{id:t});return o&&r.getFirstLoopDuration(o)-(n.time+n.duration)}}).min().value()},hasSelectedNotes:function(){return m.canCollaborate&&_.chain(f.selectedNotesByRegion).values().flatten().value().length>0},humanizeNotes:function(){s.pushUndo(d.current),_.chain(f.track.regions).filter(function(e){return f.selectedNotesByRegion[e.id].length>0}).forEach(function(e){_.forEach(f.selectedNotesByRegion[e.id],function(t){t.time=.02*Math.random()+(t.time-.01),t.time=Math.min(e.endPosition-e.startPosition,t.time),t.time=Math.max(0,t.time)})}).value(),x()},mapIndexWithDrumMidiCode:M,pasteNotes:function(){if(f.clipboard.length){var e,t,n,o,a=m.crTime,i=_.find(f.track.regions,function(e){return e.startPosition<=a&&e.startPosition+r.getFirstLoopDuration(e)>a});i&&(s.pushUndo(d.current),o=c.get(i.sampleId),e=a-(i.startPosition-i.sampleOffset),t=_.map(f.clipboard,function(t){return _.merge({},t,{id:k(),duration:"".concat(l.secondsToTicks(t.duration,d.current.metronome.bpm),"i"),time:"".concat(l.secondsToTicks(t.time+e,d.current.metronome.bpm),"i")})}),n=_.chain(f.clipboard).map(function(e){return e.duration+e.time}).max().value(),o=l.editScore(o,o.notes.concat(t)),i.sampleId=o.id,f.selectedNotesByRegion[i.id]=t,u.setPlaybackPosition(Math.min(i.endPosition,a+n)),u.current.reinitMidiRegion(i),m.hasRevisionChanges=!0)}},previewNote:R,previewSoloNote:function(e){var t=f.isPianoRoll?e.midiNote:M(e.midiNote);v.stopNotes(),R(t,e.velocity),o(function(){I(t,10)},Math.min(1e3*e.duration,2e3*r.getMeasureDuration(d.current.metronome)))},quantizeNotes:function(e){Number.isInteger(e)||(e=1/m.snapSetting.value);var t=e!==1/0?r.getNoteDuration(d.current.metronome)*d.current.metronome.signature.notesCount/e:m.snapDuration;s.pushUndo(d.current),_.chain(f.track.regions).filter(function(e){return f.selectedNotesByRegion[e.id].length>0}).forEach(function(e){var n=c.get(e.sampleId),o=_.map(n.notes,function(n){var o,a,i=_.find(f.selectedNotesByRegion[e.id],{id:n.id});return i?(o=e.startPosition+i.time-e.sampleOffset,a=r.snapToGrid(o+e.sampleOffset,t,{force:!0,padding:t/2}),i.time+=a-o,_.merge({},n,{time:"".concat(l.secondsToTicks(i.time,d.current.metronome.bpm),"i")})):n});n=l.editScore(n,o),e.sampleId=n.id,u.current.reinitMidiRegion(e)}).value()},quantizeNotesInRegion:function(e,t){_.isInteger(e)||(e=1/m.snapSetting.value);var n=e!==1/0?r.getNoteDuration(d.current.metronome)*d.current.metronome.signature.notesCount/e:m.snapDuration;s.pushUndo(d.current),_.chain(t).forEach(function(e){var t=D(e),o=c.get(e.sampleId),a=_.map(o.notes,function(o){var a,i,s=_.find(t,{id:o.id});return a=e.startPosition+s.time-e.sampleOffset,i=r.snapToGrid(a+e.sampleOffset,n,{force:!0,padding:n/2}),s.time+=i-a,_.merge({},o,{time:"".concat(l.secondsToTicks(s.time,d.current.metronome.bpm),"i")})});o=l.editScore(o,a),e.sampleId=o.id,u.current.reinitMidiRegion(e)}).value()},refreshRollLayout:function(){setTimeout(function(){p.notesTop=p.notesEl.scrollTop,p.tracksTop=p.tracksEl.scrollTop})},renderRegionNotes:D,resizeRollHeight:function(e,t){f.height=f.originalHeight+t,f.height=Math.max(f.height,0),f.height=Math.min(f.height,window.innerHeight-192)},scrollToNotes:function(e){var t,n=e?D(e):[],o=_.chain(n).minBy("midiNote").get("midiNote").value();if(f.isPianoRoll){var i=o?12*Math.floor(o/12):b.getPropertyValue(f.track.soundbank,"defaultOctave");t=(T()+f.MIDI_NOTE_UI_OFFSET-i)*f.MIDI_NOTE_UI_HEIGHT-p.notesEl.clientHeight}else t=o?(T()+f.MIDI_NOTE_UI_OFFSET-o)*f.MIDI_NOTE_UI_HEIGHT_LARGE-p.notesEl.clientHeight:0;var r=e?e.startPosition*f.scalePx:p.notesLeft;(r<p.notesLeft||r>p.notesLeft+p.notesTimelineEl.clientWidth)&&(p.notesLeft=r),p.notesTop=t,setTimeout(function(){p.notesTop=t,a.start("scroll:notesTop",!1,t),a.start("scroll:notesLeft",!1,p.notesLeft)})},selectAllNotes:function(){f.selectedNotesByRegion=_.reduce(f.track.regions,function(e,t){return e[t.id]=_.filter(f.notesByRegion[t.id],{inLoop:0}),e},{})},selectNoteOnMousedown:function(e,t){var n=f.selectedNotesByRegion[e.region.id];if(n.indexOf(e.note)<0&&!t.shiftKey)C(),f.selectedNotesByRegion[e.region.id]=[e.note],e.$apply();else if(n.indexOf(e.note)<0&&t.shiftKey)n.push(e.note),e.$digest();else if(n.indexOf(e.note)>0&&t.shiftKey&&3!==t.which)return f.selectedNotesByRegion[e.region.id]=_.filter(n,function(t){return t!==e.note}),e.$digest(),!1;return 3!==t.which},selectNotesOfSamePitch:function(){var e=_.chain(f.selectedNotesByRegion).values().flatten().map("midiNote").uniq().value();f.track.regions.forEach(function(t){if(f.selectedNotesByRegion[t.id].length){var n=[];f.notesByRegion[t.id].forEach(function(t){-1!==e.indexOf(t.midiNote)&&0===t.inLoop&&n.push(t)}),f.selectedNotesByRegion[t.id]=n}})},setLegato:function(){s.pushUndo(d.current),_.chain(f.track.regions).filter(function(e){return f.selectedNotesByRegion[e.id].length>0}).forEach(function(e){_.forEach(f.selectedNotesByRegion[e.id],function(t,n){var o,a=f.selectedNotesByRegion[e.id][n+1],i=a?a.time:(o=_.find(f.notesByRegion[e.id],function(e){return e.time>t.time+t.duration}))?o.time:e.endPosition-e.startPosition;t.duration=i-t.time})}).value(),x()},setRandomVelocity:function(){s.pushUndo(d.current),_.forEach(y(),function(e){e.velocity=Math.random()*(.95-.5)+.5}),x()},stopPreviewNote:I,storeRollHeight:function(){f.originalHeight=f.height},transposeKeys:w,transposeNotes:function(e){s.pushUndo(d.current),_.chain(f.track.regions).filter(function(e){return f.selectedNotesByRegion[e.id].length>0}).forEach(function(t){var n=c.get(t.sampleId),o=_.map(n.notes,function(n){var o,a=_.find(f.selectedNotesByRegion[t.id],{id:n.id});return a?(o=a.midiNote+e,o=Math.min(f.MIDI_NOTE_UI_OFFSET+T()-1,o),o=Math.max(f.MIDI_NOTE_UI_OFFSET,o),12===Math.abs(e)&&o!==a.midiNote+e?n:_.merge({},n,{midiNote:o})):n});n=l.editScore(n,o),t.sampleId=n.id,u.current.reinitMidiRegion(t)}).value()},transposeRegions:function(t,n,o){_.reduce(t.tracks,function(t,a){return e.resolve(t).then(function(){return _.chain(a.regions).filter(function(e){return c.has(e.sampleId)&&o.has(e)}).groupBy("sampleId").reduce(function(t,o,i){return e.resolve(t).then(function(){return E(i,n,a.soundbank,{limitToSoundbankRange:!1})}).then(function(e){_.forEach(o,function(t){t.sampleId=e.id,t.pitchShift=0,u.current.reinitMidiRegion(t)})})},{}).value()})},{})},transposeRevision:function(t,n){var o=w(t.key,n);_.reduce(t.tracks,function(t,n){return e.resolve(t).then(function(){return _.chain(n.regions).filter(function(e){return c.has(e.sampleId)}).groupBy("sampleId").reduce(function(t,a,i){return e.resolve(t).then(function(){var e=c.get(i),t=(e.pitchShift+o+12)%12;return t>6&&(t-=12),E(i,-e.pitchShift+t,n.soundbank,{scorePitchShift:t})}).then(function(e){_.forEach(a,function(t){t.sampleId=e.id,u.current.reinitMidiRegion(t)})})},{}).value()})},{})},transposeScoreKey:function(e,t,n,o){return E(e,w(t,n),o,{limitToSoundbankRange:!0})},unselectNotes:C,updateRegions:x};function y(){return _.chain(f.selectedNotesByRegion).values().flatten().value()}function w(e,t){var n={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},o=S(e),a=S(t),i=P(e),r=n[P(t)]-n[i];return r=(r+12)%12,o&&!a?r+=3:!o&&a&&(r-=3),r>6&&(r-=12),r}function S(e){return/(maj|M)*[^m]$/.test(e)&&e.indexOf("minor")<0}function P(e){return(e=(e=(e=(e=(e=(e=(e=e.replace("major","")).replace("maj","")).replace("M","")).replace("minor","")).replace("m","")).replace("♭","b")).replace("♯","#")).replace(/\s/g,"")}function E(t,n,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=a.limitToSoundbankRange,r=void 0===i||i,s=a.scorePitchShift,u=c.get(t);return function(t,n,o,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=i.limitToSoundbankRange,s=void 0===r||r,c=i.scorePitchShift,u=o>0?-1:1;return"kit"===b.getPropertyValue(a,"category")?e.resolve(t):b.getJSON({slug:a}).then(function(e){for(var o=b.getSamplesRange(e.samples),a=o.min,i=o.max;s&&!_.every(n,d)&&_.every(n,r);)n=_.map(n,function(e){return Object.assign({},e,{midiNote:e.midiNote+12*u})});return _.every(n,r)?l.editScore(t,n,{pitchShift:c}):t;function r(e){return e.midiNote>=f.MIDI_NOTE_UI_OFFSET&&e.midiNote<12*f.OCTAVES+3+f.MIDI_NOTE_UI_OFFSET}function d(e){return e.midiNote>=a&&e.midiNote<=i}})}(u,_.map(u.notes,function(e){return Object.assign({},e,{midiNote:e.midiNote+n})}),n,o,{limitToSoundbankRange:r,scorePitchShift:s})}function T(){return f.isPianoRoll?12*f.OCTAVES+3:g.getStandardDrumMap().length}function M(e){return g.getStandardDrumMap()[e-=f.MIDI_NOTE_UI_OFFSET].midi}function $(){var e;f.clipboard=_.chain(f.selectedNotesByRegion).values().flatten().map(function(e){var t=_.clone(e);return t.id=null,f.isPianoRoll||(t.midiNote=M(e.midiNote)),t}).sortBy("time").value(),f.clipboard.length&&(e=_.head(f.clipboard).time,f.clipboard=_.map(f.clipboard,function(t){return t.time-=e,t}))}function C(){_.forOwn(f.selectedNotesByRegion,function(e,t){f.selectedNotesByRegion[t]=[]})}function A(){s.pushUndo(d.current),f.removedNotesByRegion=function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?Wn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Wn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},f.selectedNotesByRegion),x(),C()}function R(e,t){if(f.previewNote)return f.track===d.selectedTrack?(v.noteOn(e,t||1,0),void n.$broadcast("MidiMessage:noteEvent")):void b.getList().then(function(){return b.getBank({slug:f.track.soundbank||h})}).then(function(n){v.setSoundbank(n),v.noteOn(e,t||1,0)})}function I(e,t){v.noteOff(e,t),n.$broadcast("MidiMessage:noteEvent")}function O(e,t){return{id:t.id,duration:"".concat(l.secondsToTicks(t.duration,d.current.metronome.bpm),"i"),time:"".concat(l.secondsToTicks(t.time+e.sampleOffset,d.current.metronome.bpm),"i"),midiNote:f.isPianoRoll?t.midiNote:M(t.midiNote),velocity:t.velocity}}function x(){_.chain(f.track.regions).filter(function(e){var t=f.selectedNotesByRegion[e.id];return t&&t.length>0}).forEach(function(e){var t=function(e,t,n,o){var a,i=c.get(e.sampleId);return s.pushUndo(d.current),a=_.map(i.notes,function(n){var o=_.find(t,{id:n.id});return o?O(e,o):n}),n&&(a=a.concat(_.map(n,function(t){return O(e,t)}))),o&&(a=_.reject(a,function(e){return _.find(o,{id:e.id})})),l.editScore(i,a)}(e,f.selectedNotesByRegion[e.id],f.addedNotesByRegion[e.id],f.removedNotesByRegion[e.id]);f.addedNotesByRegion[e.id]=[],f.removedNotesByRegion[e.id]=[],e.sampleId=t.id,u.current.reinitMidiRegion(e)}).value(),m.hasRevisionChanges=!0,i.updateSongDuration()}function D(e){return _.chain(l.flattenNotes(l.getNotesTime(e.sampleId,d.current.metronome.bpm),e)).filter(function(e){return angular.isDefined(e.midiNote)&&(f.isPianoRoll||_.some(g.getStandardDrumMap(),{midi:e.midiNote}))}).map(function(e){var t=0;return f.isPianoRoll||(t=_.findIndex(g.getStandardDrumMap(),{midi:e.midiNote}),e.midiNote=t+f.MIDI_NOTE_UI_OFFSET),e}).value()}}]),angular.module("bandlab.editor").constant("midiEditorEvents",{keyDown:{copyNotes:"MidiEditor:copyNotes",cutNotes:"MidiEditor:cutNotes",deleteNotes:"MidiEditor:deleteNotes",moveDown:"MidiEditor:moveDown",moveUp:"MidiEditor:moveUp",pasteNotes:"MidiEditor:pasteNotes",quantizeNotes:"MidiEditor:quantizeNotes",selectAllNotes:"MidiEditor:selectAllNotes"},selectNotes:"MidiEditor:selectNotes"}),angular.module("bandlab.editor").factory("MidiKeyboardHandler",["$document","$rootScope","InputsCollection","MidiEditorState","MidiKeyMapping","SharedMidiSynth",function(e,t,n,o,a,i){var r,s=n.getCurrent(),c=12,l=[],u=[];return{changeKeymap:function(e){e!==r&&(r=e,s.octave=2,l=a.getKeymap(e,s.octave))},disable:v,enable:function(){v(),e.on("keydown",h),e.on("keyup",g)},octaveDown:p,octaveUp:d,press:m,release:f};function d(){s.octave<6&&(s.octave++,i.stopNotes())}function p(){s.octave>1&&(s.octave--,i.stopNotes())}function m(e){if(!u[e]){if(u[e]=!0,_.includes(["creators-kit","drums","pads"],r))i.noteOn(e,o.VELOCITY_DEFAULT);else switch(e){case"sustain":i.sustainOn();break;case 100:p();break;case 200:d();break;default:i.noteOn(e+(s.octave-1)*c,o.VELOCITY_DEFAULT)}t.$broadcast("MidiMessage:noteEvent")}}function f(e){"piano"===r?i.noteOff(e+(s.octave-1)*c,10,null,null,i.isSustaining()):i.noteOff(e,null),"sustain"===e&&i.sustainOff(),u[e]=!1,t.$broadcast("MidiMessage:noteEvent")}function h(e){e.ctrlKey||e.metaKey||-1!==["INPUT","TEXTAREA"].indexOf(e.target.nodeName)||l[e.code]&&(e.preventDefault(),m(l[e.code]))}function g(e){l[e.code]&&f(l[e.code])}function v(){e.off("keydown",h),e.off("keyup",g),u=[],i.stopNotes()}}]),angular.module("bandlab.editor").factory("MidiKeyMapping",function(){var e,t={Plus:200,Equal:200,Minus:100},n={};return e=[{slug:"kick",name:"Kick",shortcut:"S",code:"KeyS",midi:36},{slug:"snareStick",name:"Snare Edge",shortcut:"G",code:"KeyG",midi:37},{slug:"snare",name:"Snare",shortcut:"F",code:"KeyF",midi:38},{slug:"clap",name:"Clap",shortcut:"C",code:"KeyC",midi:39},{slug:"electricSnare",name:"Electric Snare",shortcut:"V",code:"KeyV",midi:40},{slug:"tomFloor",name:"Floor Tom",shortcut:"U",code:"KeyU",midi:41},{slug:"tomFloor",name:"Floor Tom",shortcut:null,code:null,midi:43},{slug:"tomMid",name:"Mid Tom",shortcut:"Y",code:"KeyY",midi:45},{slug:"tomMid",name:"Mid Tom",shortcut:null,code:null,midi:47},{slug:"tomHigh",name:"High Tom",shortcut:"T",code:"KeyT",midi:48},{slug:"tomHigh",name:"High Tom",shortcut:null,code:null,midi:50},{slug:"hhClosed",name:"Closed Hi-Hat",shortcut:"O",code:"KeyO",midi:42},{slug:"hhSemi",name:"Pedal Hi-Hat",shortcut:"I",code:"KeyI",midi:44},{slug:"hhOpen",name:"Open Hi-Hat",shortcut:"9",code:"Digit9",midi:46},{slug:"crash",name:"Crash Cymbal",shortcut:"6",code:"Digit6",midi:49},{slug:"rideCymbal",name:"Ride Cymbal",shortcut:"P",code:"KeyP",midi:51},{slug:"rideBell",name:"Ride Bell",shortcut:"0",code:"Digit0",midi:53},{slug:"cowbell",name:"Cowbell",shortcut:"B",code:"KeyB",midi:56}],e=_.map(e,function(e){return e.key=e.code,e}),n.drums=_.transform(e,function(e,t){return e[t.slug]=t.code?t:e[t.slug],e},{}),n.piano=["KeyZ","KeyS","KeyX","KeyD","KeyC","KeyV","KeyG","KeyB","KeyH","KeyN","KeyJ","KeyM","Comma","KeyL","Period","Digit1","KeyQ","KeyW","Digit3","KeyE","Digit4","KeyR","Digit5","KeyT","KeyY","Digit7","KeyU","Digit8","KeyI","KeyO","Digit0","KeyP"],{beautifyEventCode:i,getcreatorsKitMapping:function(){return[{midi:48,shortcut:"4",code:"Digit4"},{midi:49,shortcut:"5",code:"Digit5"},{midi:50,shortcut:"6",code:"Digit6"},{midi:51,shortcut:"7",code:"Digit7"},{midi:44,shortcut:"R",code:"KeyR"},{midi:45,shortcut:"T",code:"KeyT"},{midi:46,shortcut:"Y",code:"KeyY"},{midi:47,shortcut:"U",code:"KeyU"},{midi:40,shortcut:"F",code:"KeyF"},{midi:41,shortcut:"G",code:"KeyG"},{midi:42,shortcut:"H",code:"KeyH"},{midi:43,shortcut:"J",code:"KeyJ"},{midi:36,shortcut:"V",code:"KeyV"},{midi:37,shortcut:"B",code:"KeyB"},{midi:38,shortcut:"N",code:"KeyN"},{midi:39,shortcut:"M",code:"KeyM"}]},getDrumsMidi:function(){return _.transform(e,function(e,t){return e[t.slug]=t.midi,e},{})},getKeymap:function(e,o){switch(e){case"creators-kit":return _.reduce([{midi:48,shortcut:"4",code:"Digit4"},{midi:49,shortcut:"5",code:"Digit5"},{midi:50,shortcut:"6",code:"Digit6"},{midi:51,shortcut:"7",code:"Digit7"},{midi:44,shortcut:"R",code:"KeyR"},{midi:45,shortcut:"T",code:"KeyT"},{midi:46,shortcut:"Y",code:"KeyY"},{midi:47,shortcut:"U",code:"KeyU"},{midi:40,shortcut:"F",code:"KeyF"},{midi:41,shortcut:"G",code:"KeyG"},{midi:42,shortcut:"H",code:"KeyH"},{midi:43,shortcut:"J",code:"KeyJ"},{midi:36,shortcut:"V",code:"KeyV"},{midi:37,shortcut:"B",code:"KeyB"},{midi:38,shortcut:"N",code:"KeyN"},{midi:39,shortcut:"M",code:"KeyM"}],function(e,t){return e[t.code]=t.midi,e},{});case"drums":case"pads":return a();case"piano":return function(e){var o=12*e,a=n.piano.reduce(function(e,t){return e[t]=o++,e},{});return angular.extend(a,t,{ShiftRight:"sustain",ShiftLeft:"sustain",SemiColon:a.Digit1,Slash:a.KeyQ})}(o);default:return a()}},getMappingFromSlugs:o,getMidiDrums:function(){return _.transform(e,function(e,t){return e[t.midi]=t,e},{})},getPadsMapping:function(){return o(["kick","snareStick","snare","clap","electricSnare","tomFloor","tomMid","tomHigh","hhClosed","hhOpen","crash","cowbell"])},getShortcutKeys:function(e){return n[e]},getShortcutMap:function(e,t){switch(e){case"piano":var o=12+12*t;return n.piano.reduce(function(e,t){return e[o++]=i(t),e},{})}},getStandardDrumMap:function(){return e}};function o(t){return _.map(t,function(t){return _.find(e,{slug:t})})}function a(){return _.transform(e,function(e,t){return e[t.code]=t.midi,e},{})}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{Comma:",",Period:".",Semicolon:";",Slash:"/"}[e]||e.replace(/Key|Digit/,"")}}),angular.module("bandlab.editor").factory("MidiScore",["AudioCtx","EditorMidiScore","editorSettings","EditorState","MidiSynth","Soundbank",function(e,n,o,a,i,r){var s=window.OfflineAudioContext||window.webkitOfflineAudioContext;return function(l){var u,d,p=l.bpm,m=void 0===p?120:p,f=l.midiSynth,g=l.regionId,v=l.sampleId,b=l.soundbank,y=void 0===b?h:b,w=l.trackId,k=angular.noop,S=[];return{play:function(l,p,h){return l=l||e.get(),h=Object.assign({delay:0},h),p=p||l.destination,l instanceof s||angular.isDefined(h.loop)?r.getBank({slug:y}).then(g):g(_.find(r.getBanks(),{slug:y}));function g(e){var r="kit"===e.category?null:10;return f||(f=new i(l)).outputNode.connect(p),Promise.resolve(f.setSoundbank(e)).then(function(){return h.loop?function e(t){var o=n.getRoundedDuration(v,h.signature,m);return S=S.concat(g(n.getNotesTime(v,m),t)),u=setTimeout(function(){e(t+o)},1e3*o-1e3),P}(l.currentTime+h.delay):angular.isDefined(h.playbackPosition)?function(e){var t=_.partition(n.flattenNotes(n.getNotesTime(v,m),e),function(e){return angular.isDefined(e.midiNote)}),o=t[0],i=_.filter(t[1],function(e){return e.eventName.toLowerCase().includes("sustain")}),r=_.filter(t[1],function(e){return e.eventName.toLowerCase().includes("pitchbend")});l instanceof s?g(o,l.currentTime+e.startPosition-e.playbackPosition,i,r):function(t,n,o,i){var r=5;function s(){var t=_.remove(d,function(t){return t.time+e.startPosition<=a.crTime+r+1});S=S.filter(function(t){return t.time+t.duration+e.startPosition>a.crTime}).concat(g(t,n,o,i)),d.length||clearTimeout(k)}d=t,S=[],s(),function e(){k=setTimeout(function(){s(),e()},1e3*r)}()}(o,l.currentTime+e.startPosition-e.playbackPosition,i,r)}(h):void 0});function g(e,n,a,i){return _.chain(e).filter(function(e){return e.time+n>=l.currentTime}).map(function(e){var s,l,u=f.noteOn(e.midiNote,e.velocity,e.time+n,(s=i,l=n,_.map(s,function(e){return function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?Kn(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Kn(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},e,{time:e.time+l})})));return u.duration=e.duration,u.id=e.id,u.midiNote=e.midiNote,u.time=e.time,f.noteOff(e.midiNote,r,n+e.time+e.duration,n+h.endPosition-h.startPosition+o.TAIL_DURATION_MIN,!!c(a,e.time+e.duration)&&n+c(a,e.time+e.duration)),u}).value()}}},regionId:g,stop:P,trackId:w,updateNotes:function(e,t){d=n.flattenNotes(n.getNotesTime(e.sampleId,t),e).filter(function(e){return e.midiNote}),S.forEach(function(e){d.find(function(t){return e.id===t.id&&e.midiNote===t.midiNote&&e.time===t.time})||e.cancel()})}};function P(){clearTimeout(u),clearTimeout(k),_.forEach(S,function(e){e.cancel()})}};function c(e,t){var n=_.find(e,function(e){return t>=e.time&&t<e.time+e.duration});return n&&n.time+n.duration}}]),angular.module("bandlab.editor").factory("MidiSound",["MidiSoundSource",function(e){return function(t,n,o,a,i,r){var s,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],u=Math.max(i||r.currentTime,0),d=e.isSoundFromSample(t,n),p=r.createBufferSource(),m=r.createGain(),f=Math.pow(o,2);return d?(p.buffer=d.buffer,p.playbackRate.value=d.playbackRate*Math.pow(2,c/12),m.connect(a),m.gain.value=f,s=Math.max(0,u+p.buffer.duration-.1),m.gain.setValueAtTime(f,s),m.gain.linearRampToValueAtTime(0,s+.1),p.connect(m),(d.loopStart||d.loopEnd)&&(p.loopStart=d.loopStart,p.loopEnd=d.loopEnd,m.gain.cancelScheduledValues(u),p.loop=!0),l.forEach(function(e){var t=e.time,n=(e.value-8192)/8192*2;t<u&&(p.playbackRate.value=d.playbackRate*Math.pow(2,n/12)),p.playbackRate.setValueAtTime(d.playbackRate*Math.pow(2,n/12),t)}),p.start(u),{sample:d,source:p,cancel:function(){try{m.gain.cancelScheduledValues(i),m.gain.linearRampToValueAtTime(0,p.context.currentTime+.01),p.stop(p.context.currentTime+.01)}catch(e){}},stop:function(e,t,n,o,a){var i=t||n.currentTime;if(o=o||i+p.buffer.duration,m.gain.cancelScheduledValues(i),a||null===e){if(null===e){var r=Math.ceil((i-u)/p.buffer.duration)*p.buffer.duration;p.stop(u+r),m.gain.setTargetAtTime(0,u+r-.1,0)}}else m.gain.setTargetAtTime(1e-5,i,Math.max(e,1e-5)),p.stop(i+1);angular.isNumber(a)&&(m.gain.cancelScheduledValues(i),m.gain.setTargetAtTime(1e-5,a,Math.max(e,1e-5)),p.stop(a+1)),s=i}}):{cancel:angular.noop,stop:angular.noop}}}]).factory("MidiSynthSound",function(){return function(t,n,o,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5?arguments[5]:void 0,s=e(r),c=i+s-r.currentTime;return t.onMIDIEvent([144,n,Math.round(127*o)],c),{cancel:function(){a.gain.cancelScheduledValues(i),a.gain.linearRampToValueAtTime(0,r.currentTime+.01),t.onMIDIEvent([128,n,0],r.currentTime+.01)},stop:function(o){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>4?arguments[4]:void 0;if(!r){var c=e(i);t.onMIDIEvent([128,n,0],a+c-i.currentTime)}angular.isNumber(r)&&t.onMIDIEvent([128,n,0],r+s-i.currentTime)}}};function e(e){return e instanceof OfflineAudioContext?0:.001*(performance.now()-e.getOutputTimestamp().performanceTime)}}),angular.module("bandlab.editor").factory("MidiSoundSource",["SoundbankSamples",function(e){return{isSoundFromSample:function(t,n){var o=e[t.slug];return!!o&&o[n]}}}]),angular.module("bandlab.editor").factory("MidiSynth",["AudioCtx","EditorMidiScore","Katnip","MidiSound","MidiSoundSource","MidiSynthSound",function(e,t,o,a,i,r){var s=.1;return function(){var c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.get();if(c){var l,u,d=c.createGain(),p={},m={},f=[],h=!1,g={},v=0;return Object.freeze({getEvents:function(){return f},getStartRecordingTime:function(){return l},isNoteMapped:function(e){return u||!!i.isSoundFromSample(g,e)},isSustaining:function(){return h},noteOff:function(e,t,n,o,a){var i=null;m[e]&&(g.release?i=g.release:o=null,g.release&&t&&(i+=1/t/1e3),p[e]=m[e],m[e].stop(i,n,c,o,a),m[e]=null),l&&f.push({name:"NoteOff",midiNote:e,velocity:t,time:performance.now()})},noteOn:function(e,t,n,o){if(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_.chain(g.mutexSets).find(function(t){return _.includes(t,e)}).forEach(function(e){y(e,t)}).value()}(e,n),m[e]&&(m[e].stop(g.release,n,c),m[e]=null),p[e]){try{p[e].stop(g.release,n,c)}catch(e){}p[e]=null}var i=u?r:a;return m[e]=new i(u||g,e,t,d,n,c,v,o),l&&f.push({name:"NoteOn",midiNote:e,velocity:t,time:performance.now()}),m[e]},releaseSustain:b,setSoundbank:function(e){g=e,u&&(u.disable(),u.disconnect(),u=null),"VASynth"===g.synth&&((u=new o.VaSynth(c)).connect(d),u.loadPresetJSON(JSON.stringify({VASynthParam:e.VASynthParam})))},setPitchBend:function(e){var t=n(e,3),o=t[1],a=(t[2]<<7)+o;v=(a-8192)/8192*2,l&&f.push({eventName:"pitchBend",name:"PitchBend",time:performance.now(),value:a}),_.chain(m).keys().concat(_.keys(p)).forEach(function(e){var t=p[e]||m[e];t&&(t.source.playbackRate.value=t.sample.playbackRate*Math.pow(2,v/12))}).value()},startRecordEvents:function(){f=[],l=performance.now()},stopNotes:function(){_.chain(m).keys().concat(_.keys(p)).forEach(y).value()},stopRecordEvents:function(e){l&&t.storeRecordAsScore(l,performance.now(),f,e),l=null},sustainOff:function(){h=!1,b(),l&&f.push({name:"SustainOff",time:performance.now()})},sustainOn:function(){h=!0,l&&f.push({name:"SustainOn",time:performance.now()})},current:m,outputNode:d,schedule:{}})}function b(){_.forOwn(p,function(e,t){e&&(e.stop(s,0,c),m[t]=null)})}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=p[e]||m[e];n&&(n.stop(.01,t,c,t),m[e]=null,p[e]=null)}}}]),angular.module("bandlab.editor").factory("SharedMidiSynth",["MidiSynth",function(e){return new e}]),angular.module("bandlab.notification",[]).config(["$stateProvider",function(e){e.state("notifications",{url:"/notifications",redirectTo:"notifications.activities",templateUrl:"https://www.bandlab.com/web-app/notification/views/notifications-layout-97d4c7f5.html",controller:["$scope","Me",function(e,t){e.me=t}]}).state("notifications.activities",{url:"/activities",templateUrl:"https://www.bandlab.com/web-app/notification/views/notifications-activities-69f334d0.html",controller:"NotificationsActivitiesCtrl"}).state("notifications.following",{url:"/following",templateUrl:"https://www.bandlab.com/web-app/notification/views/notifications-activities-69f334d0.html",controller:"NotificationsActivitiesCtrl"}).state("notifications.invites",{url:"/invites?id",reloadOnSearch:!1,templateUrl:"https://www.bandlab.com/web-app/notification/views/notifications-invites-e3e855b8.html",controller:"NotificationsInvitesCtrl"})}]),angular.module("bandlab.notification").controller("InviteCtrl",["$rootScope","$timeout","AppNotifications","authService","Invite",function(e,t,n,o,a){this.acceptInvite=function(i){return a.update({id:i.id}).$promise.then(function(){return i.accepted=!0,t(function(){e.$broadcast("$invite:changed",{invite:i}),o.refreshMe()},1e3),i}).catch(function(e){var t;switch(e.data.errorCode){case 57:t=i18n(to());break;case 75:t=i18n(eo());break;case 51:t=i18n(Zn());break;case 63:t=i18n(Qn());break;case 62:t=i18n(Jn());break;case 64:t=i18n(Xn())}return n.addNotification({title:i18n(Yn()),content:t,classList:"alert",autoclose:5e3}),i})},this.declineInvite=function(e){a.remove({id:e.id}).$promise.then(function(){e.declined=!0,t(o.refreshMe,1e3)})}}]),angular.module("bandlab.notification").controller("NotificationsActivitiesCtrl",["$q","$scope","$state","Me","Notification",function(e,n,o,a,i){var r,s=20,c=null,l=!1,u=o.includes("notifications.following")?"following":"me";function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return l?e.resolve(t):r=i[u]({after:c,limit:s}).$promise.then(function(e){var n=[].concat(He(t),He(e.data));return l=e.paging.itemsCount<s,c=_.get(e,"paging.cursors.after",0),n.length<s&&e.data.length!==e.paging.itemsCount?d(n):n})}n.loadMore=function(){return n.infiniteScrollEnded?e.reject("No more results"):r=r.then(function(e){return n.infiniteScrollEnded=l,n.activities=n.activities||[],n.activities=n.activities.concat(e),d()})},d().then(n.loadMore).then(function(){new i({unread:!1,lastReadOn:(new Date).toISOString()}).$dismiss().then(function(){a.counters=function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?no(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):no(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},a.counters,{unreadYouNotifications:0})})})}]),angular.module("bandlab.notification").controller("NotificationsDropdownCtrl",["$scope","Me","Notification","Page",function(e,n,o,a){(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.data,a=void 0===n?[]:n,i=t.after,r=void 0===i?null:i;return o.me({limit:10,after:r}).$promise.then(function(t){var n=[].concat(He(a),He(t.data));return n.length<10&&t.data.length!==t.paging.itemsCount?e({data:n,after:t.paging.cursors.after}):{data:n}})})().then(function(t){var n=t.data;return e.activities=n,new o({unread:!1,lastReadOn:(new Date).toISOString()}).$dismiss()}).then(function(){n.counters=function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?oo(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):oo(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},n.counters,{unreadYouNotifications:0}),a.update()})}]),angular.module("bandlab.notification").controller("NotificationsInvitesCtrl",["$q","$scope","$state","$stateParams","Invite","Me","Notification",function(e,n,o,a,i,r,s){var c,l=20,u=0,d=!1;function p(){return d?e.resolve([]):((c=i.query({id:r.id,entity:"users",types:"band;community;song",offset:u,limit:l}).$promise).then(function(e){d=0===e.length||e.length<l,u+=e.length}),c)}n.loadMore=function(){return n.infiniteScrollEnded?e.reject("No more results"):c=c.then(function(e){return n.infiniteScrollEnded=d,n.invites=n.invites||[],n.invites=n.invites.concat(e),p()})},p().then(n.loadMore).then(function(){o.includes("notifications")&&a.id&&i.get({id:a.id}).$promise.then(function(e){return i.update({id:e.id}),e}).then(function(e){var t=_.find(n.invites,{id:e.id});t?t.accepted=!0:n.invites.unshift(e),o.go(".",{},{inherit:!1})}).catch(function(){o.go(".",{},{inherit:!1})})}).then(function(){new s({type:"invites",lastReadOn:(new Date).toISOString()}).$dismiss().then(function(){r.counters=function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?ao(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ao(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},r.counters,{unreadInviteNotifications:0,bandInvites:0})})})}]),angular.module("bandlab.notification").component("notificationActivityTile",{bindings:{activity:"<"},templateUrl:"https://www.bandlab.com/web-app/notification/partials/_notification-activity-tile-05d40574.html",controller:["$location","Me",function(e,t){this.openObject=function(t,n){t.target.closest("a")||e.path(n.url)},this.me=t}],controllerAs:"vm"}),angular.module("bandlab.notification").component("notificationInviteTile",{bindings:{invite:"<"},templateUrl:"https://www.bandlab.com/web-app/notification/partials/_notification-invite-tile-f51b5906.html",controller:"InviteCtrl",controllerAs:"vm"}),angular.module("bandlab.notification").factory("Notification",["$http","$resource","$state","Me",function(e,t,n,o){var a="https://www.bandlab.com/api/v1.3/users/".concat(o.id,"/notifications");function i(e,t,a){var i;return i={AcceptBand:"members",AddRevision:"flow-line",CommentPost:"comments",CommentRevision:"comments",CreateRevision:"flow-line",CreateSong:"headphones",FollowUser:"user",JoinBand:"members",JoinSong:"headphones",LikeCollection:"heart",LikePost:"heart",LikeRevision:"heart",MentionRevision:"comments",PublishRevision:"earth"},200===a&&e.data.forEach(function(e){e.url=function(e){switch(e.object.type){case"Collection":return n.href("collectionId",{id:e.object.id});case"Community":return n.href("communityId",{id:e.object.id});case"Band":return n.href("bandId",{id:e.object.id});case"Post":return n.href("post",{id:e.object.id});case"Song":return n.href("songId",{id:e.object.id});case"Revision":return n.href("revisionId",{id:e.object.id});case"User":return e.object.id===o.id?n.href("userId",{id:e.from.id}):n.href("userId",{id:e.object.id});default:return n.href("userId",{id:e.from.id})}}(e),e.message="".concat(e.message.replace(/<from>(.*)<\/from>/,'<a href="'.concat(n.href("user.feed",{username:e.from.username}),'"><span>$1</span></a>')).replace(/<object>(.*)<\/object>/,'<a href="'.concat(e.url,'"><span>$1</span></a>')),"."),e.icon=i[e.action+e.object.type]}),e}return t(a,{},{me:{method:"GET",cache:!1,params:{limit:10},preservePagination:!0,url:a,transformResponse:[].concat(He(e.defaults.transformResponse),[i])},following:{method:"GET",cache:!1,params:{limit:10},preservePagination:!0,url:"".concat(a,"/following"),transformResponse:[].concat(He(e.defaults.transformResponse),[i])},dismiss:{method:"PATCH",params:{type:"@type"},url:"".concat(a,"/:type")}})}]),angular.module("bandlab.payment",[]),angular.module("bandlab.payment").controller("TipJarEditCtrl",["$scope","paymentDetails","TipJar","tipJarSettings",function(e,t,n,o){e.stripeAccount=t.stripeAccount,e.tipJarSettings=o,e.editThanksMessage=function(){return n.updateSettings({thankYouMessage:e.tipJarSettings.thankYouMessage}).finally(function(){e.tipJarForm.$setPristine()})},e.toggleTipJar=function(){return e.tipJarForm.$setSubmitted(),n[e.tipJarSettings.isEnabled?"disable":"enable"]().then(function(){e.tipJarSettings.isEnabled=!e.tipJarSettings.isEnabled}).finally(function(){e.tipJarForm.$setPristine()})}}]),angular.module("bandlab.payment").component("stripeAccount",{bindings:{account:"="},templateUrl:"https://www.bandlab.com/web-app/payment/partials/_stripe-account-820973b9.html",controller:["Me","Payment",function(e,t){var n=this;n.isRequestActive=!1,n.disconnectStripe=function(){return n.isRequestActive=!0,t.removeStripeAccount(e.id).then(function(){n.account=null}).finally(function(){n.isRequestActive=!1})}}],controllerAs:"vm"}),angular.module("bandlab.payment").component("stripeCard",{bindings:{card:"="},templateUrl:"https://www.bandlab.com/web-app/payment/partials/_stripe-card-7515ce02.html",controller:["AppNotifications","Me","Payment","Stripe",function(e,t,n,o){var a=this;a.me=t,a.isRequestActive=!1,a.displayAddCardModal=function(t){a.isRequestActive=!0,o.displayCardModal(t).then(function(e){a.card.last4=e}).catch(function(t){t&&e.addNotification({title:i18n(ro()),classList:"alert"})}).finally(function(){a.isRequestActive=!1})},a.removeCard=function(){return a.isRequestActive=!0,n.removeStripeCard(t.id).then(function(){a.card.last4=null}).finally(function(){a.isRequestActive=!1})}}],controllerAs:"vm"}),angular.module("bandlab.payment").component("stripeCardForm",{bindings:{onSuccess:"&",onCancel:"&"},templateUrl:"https://www.bandlab.com/web-app/payment/partials/_stripe-card-form-8c135113.html",controller:["$timeout","Stripe",function(e,t){var n=this;n.$onDestroy=function(){t.reset()},n.$onInit=function(){var o;o=function(){t.appendFormTo("card-element",function(t){var o=t.error;e(function(){n.cardForm.$setDirty(),n.errorMessage=o?o.message:null})})},setTimeout(function(){setTimeout(function(){setTimeout(function(){e(o)},0)},0)},0)},n.submitForm=function(e){t.createToken(e).then(function(e){n.onSuccess({token:e})}).catch(function(e){n.errorMessage=e.message,n.cardForm.$setPristine()})},n.cancelForm=function(){n.onCancel()}}],controllerAs:"vm"}),angular.module("bandlab.payment").component("tipUserForm",{bindings:{thankYouMessage:"@",user:"="},templateUrl:"https://www.bandlab.com/web-app/payment/partials/_tip-user-form-56121056.html",controller:["appActions","ConfirmModal","Stripe","TipJar",function(e,t,n,o){var a=this;function i(){var e=100*a.tipValue;return o.createTip(e,{id:a.user.id,name:a.user.name}).then(function(e){a.thankYouMessage=e.thankYouMessage})}a.getTotalAmount=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=parseFloat(e);a.totalAmount=0,t<1||o.calculateTipFees(100*t).then(function(n){var o=n.charges;e===a.tipValue&&(a.totalAmount=(Math.round(100*t+o)/100).toFixed(2))})},a.submitSendTip=function(){if(e.checkAllowed("tip"))return n.requireCard().then(function(){return parseFloat(a.tipValue)>100?new t({confirmLabel:"Confirm",contentScope:{title:i18n(co()),message:"<p>".concat(i18n(so(),a.tipValue),"</p>")},onConfirm:function(){return i()},onCancel:function(){return a.tipForm.$setPristine()}}).show():i()}).finally(function(){a.tipForm.$setPristine()})}}],controllerAs:"vm"}),angular.module("bandlab.payment.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("userTip",{url:"/{username:[a-z0-9][a-z0-9_]{3,19}}/tip",caseInsensitiveMatch:!0,templateUrl:"https://www.bandlab.com/web-app/payment/views/payment-layout-8f5820d6.html",resolve:{theUser:["$q","$stateParams","Me","User",function(e,t,n,o){return n.username===t.username?e.reject({status:403}):o.get({id:t.username}).$promise.then(function(t){return t.isTippable?t:e.reject({status:404})})}]},onEnter:["Page","theUser",function(e,t){e.setMetadata({title:t.name,description:t.about?t.about:"".concat(t.name," is on BandLab | Explore songs and collaborate with bands and artists across the globe."),image:t.picture.s,imageHeight:"360",imageWidth:"360",objectPath:"/users/".concat(t.id)})}],onExit:["Page",function(e){e.clearMetadata()}],controller:["$scope","Me","theUser",function(e,t,n){e.isOwnProfile=n.id===t.id,e.user=n,e.$on("$user:relationChanged",function(t,n){e.user.id===n.user.id&&_.assignIn(e.user,n.user)})}]}).state("updateStripeAccount",{url:"/stripe/callback?code&error",redirectTo:function(e){if(e.params().error||!e.params().code)return e.injector().get("AppNotifications").addNotification({title:i18n(uo()),content:i18n(lo()),classList:"alert"}),{state:"settings.tipJar"};var t=e.injector().get("Identity"),n=e.injector().get("Payment");return t.info().$promise.then(function(t){return n.updateStripeAccount(t.id,e.params().code)}).then(function(){return{state:"settings.tipJar"}})}})}]),angular.module("bandlab.payment").factory("Payment",["GraphQL",function(e){return{removeStripeAccount:function(t){return e.mutate({mutation:"\n          mutation RemoveStripeAccount($input: RemoveStripeAccountInput!) {\n            removeStripeAccount(input: $input) {\n              id\n            }\n          }\n        ",variables:{input:{userId:t}}}).then(function(e){return e.removeStripeAccount.id})},removeStripeCard:function(t){return e.mutate({mutation:"\n          mutation RemoveStripeCard($input: RemoveStripeCardInput!) {\n            removeStripeCard(input: $input) {\n              id\n            }\n          }\n        ",variables:{input:{userId:t}}}).then(function(e){return e.removeStripeCard.id})},getTransactions:function(){return e.query({query:"\n          query Transactions {\n            viewer {\n              id\n              sentTransactions {\n                ...transactionFields\n              },\n              receivedTransactions {\n                ...transactionFields\n              }\n            }\n          }\n          ".concat("\n      fragment transactionFields on Transaction {\n        id,\n        timestamp,\n        amount,\n        sender {\n          id,\n          name\n        },\n        recipient{\n          id,\n          name\n        },\n        status\n      }\n    ",",\n        ")}).then(function(e){return e.viewer})},getUserDetails:function(){return e.query({query:"\n          query UserDetails {\n            viewer {\n              id\n              stripeAccount {\n                email\n              }\n              stripeCard {\n                last4\n              }\n            }\n          }\n        "}).then(function(e){return e.viewer})},updateStripeCard:function(t){var n=t.email,o=t.userId,a=t.token;return e.mutate({mutation:"\n          mutation UpdateStripeCard($input: UpdateStripeCardInput!) {\n            updateStripeCard(input: $input) {\n              last4\n            }\n          }\n        ",variables:{input:{email:n,userId:o,token:a}}}).then(function(e){return e.updateStripeCard.last4})},updateStripeAccount:function(t,n){return e.mutate({mutation:"\n          mutation UpdateStripeAccount($input: UpdateStripeAccountInput!) {\n            updateStripeAccount(input: $input) {\n              email\n            }\n          }\n        ",variables:{input:{userId:t,code:n}}}).then(function(e){return e.updateStripeAccount.email})}}}]),angular.module("bandlab.payment").factory("Stripe",["$q","AppNotifications","Me","Modal","Payment",function(e,t,n,o,a){var i,r=O("https://js.stripe.com/v3/").then(function(){return Stripe("pk_live_FUPnxtAVDTjin9loX7kYIJRW")});return{appendFormTo:function(e,t){if(!document.getElementById(e))throw new Error("Element ".concat(e," does not exists."));r.then(function(n){(i=function(e){return e.elements().create("card",{hidePostalCode:!0,style:{base:{color:"#282c32",fontFamily:'"Source Sans Pro", "Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"16px",lineHeight:"19px"}}})}(n)).mount("#".concat(e)),t&&i.addEventListener("change",t)})},createToken:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.then(function(n){return i?n.createToken(i,t):e.reject("Stripe element is missing")}).then(function(t){return t.error?e.reject(t.error):t.token})},displayCardModal:s,requireCard:function(){return a.getUserDetails().then(function(e){return null!==e.stripeCard.last4||s("Add Card")}).catch(function(n){return n?(t.addNotification({title:i18n(po()),classList:"alert"}),e.reject(n)):e.reject()})},reset:function(){i&&i.unmount()}};function s(t){return e(function(e,i){var r=new o({template:'\n            <div>\n              <header class="modal-header">\n                <h2>{{ ::title }}</h2>\n              </header>\n              <div class="modal-content modal-content-small">\n                <stripe-card-form on-success="onSuccess(token)" on-cancel="onCancel()"></stripe-card-form>\n              </div>\n              <div class="modal-footer">\n                <a href="https://stripe.com/" target="_blank" rel="noopener">\n                  <img src="https://stripe.com/img/about/logos/badge/outline-dark.svg" alt="Powered By Stripe badge" width="119" height="26">\n                </a>\n              </div>\n            </div>\n          ',contentScope:{title:t,onSuccess:function(t){return a.updateStripeCard({email:n.email,userId:n.id,token:t.id}).then(function(t){e(t)}).catch(function(e){i(e)}).finally(function(){r.destroy()})},onCancel:function(){r.destroy()}},onDestroy:i});r.show()})}}]),angular.module("bandlab.payment").factory("TipJar",["$q","$window","AppNotifications","GraphQL","Me",function(e,t,n,o,a){return{calculateTipFees:_.memoize(function(e){return o.mutate({mutation:"\n          mutation CalculateTipFees($in: CalculateTipFeesInput!) {\n            calculateTipFees(input: $in) {\n              charges\n            }\n          }\n        ",variables:{in:{amount:Math.round(e)}},cache:!0}).then(function(e){return e.calculateTipFees})}),createTip:function(i,r){return o.mutate({mutation:"\n          mutation CreateTip($input: CreateTipInput!) {\n            createTip(input: $input) {\n              id,\n              thankYouMessage\n            }\n          }\n        ",variables:{input:{amount:Math.round(i),recipientId:r.id,recipientName:r.name,senderId:a.id,senderName:a.name}}}).then(function(e){return e.createTip}).catch(function(o){var a={name:o.name||i18n(mo()),message:_.get(o,"[0].message",o.message)};return t.Raven.captureException(a.name,{extra:{err:o,message:o.message,name:o.name,stack:o.stack}}),n.addNotification({title:a.name,content:a.message,classList:"alert"}),e.reject(a)})},disable:function(){return o.mutate({mutation:"\n          mutation DisableTipJar($input: DisableTipJarInput!) {\n            disableTipJar(input: $input) {\n              isEnabled\n            }\n          }\n        ",variables:{input:{userId:a.id}}}).then(function(e){return e.disableTipJar})},enable:function(){return o.mutate({mutation:"\n          mutation EnableTipJar($input: EnableTipJarInput!) {\n            enableTipJar(input: $input) {\n              isEnabled\n            }\n          }\n        ",variables:{input:{userId:a.id}}}).then(function(e){return e.enableTipJar})},getSettings:function(){return o.query({query:"\n          query TipJarSettings {\n            viewer {\n              tipJar {\n                isEnabled,\n                thankYouMessage\n              }\n            }\n          }\n        "}).then(function(e){return e.viewer.tipJar})},updateSettings:function(e){return o.mutate({mutation:"\n          mutation UpdateTipJarSettings($input: UpdateTipJarSettingsInput!) {\n            updateTipJarSettings(input: $input) {\n              thankYouMessage\n            }\n          }\n        ",variables:{input:Object.assign({userId:a.id},e)}}).then(function(e){return e})}}}]),angular.module("bandlab.player",[]),angular.module("bandlab.player").controller("PlayerQueueCtrl",["$scope","Player","PlayerHistory",function(e,t,n){e.playNext=function(e){n.playNext(e),t.getCurrentSong().id||t.next()}}]),angular.module("bandlab.player").directive("globalPlayer",["Player","playerEvents","PlayerHistory",function(e,t,n){return{restrict:"E",replace:!0,scope:{},templateUrl:"https://www.bandlab.com/web-app/player/partials/_global-player-8a8dc34f.html",link:function(t,n){angular.element(document.body).on("keydown",function(o){if((-1===["INPUT","TEXTAREA"].indexOf(o.target.nodeName)||"file"===o.target.type)&&n.hasClass("visible"))switch(o.which){case 32:o.preventDefault(),t.togglePlay();break;case 37:o.preventDefault(),e.fastBackward();break;case 39:o.preventDefault(),e.fastForward()}})},controller:["$scope","$transitions","$analytics","ClientDevice","Me",function(o,a,i,r,s){var c=e.getAudio();function l(e){switch(e.name){case t.PAUSED:return void(o.status="loaded");case t.ERROR:return void(o.status="error");case t.REQUESTING:case t.LOADING:return void(o.status="loading");case t.PROGRESS:return o.status="loaded",o.currentTime=c.currentTime,o.duration=c.duration||1,void(o.progress=c.currentTime/o.duration*100);case t.ENDED:return void(o.currentTime=c.duration||1)}}o.me=s,o.clientDevice=r,o.LOOP_STATES={DONT_REPEAT:"dont-repeat",REPEAT_ONE:"repeat-one",REPEAT_ALL:"repeat-all"},o.playerHistory=n,o.revision=e.getCurrentSong(),o.status="",o.loop=o.LOOP_STATES.DONT_REPEAT,o.$on(t.PAUSED,l),o.$on(t.ERROR,l),o.$on(t.REQUESTING,l),o.$on(t.LOADING,l),o.$on(t.PROGRESS,l),o.$on(t.ENDED,l),o.$on("$revision:changed",function(t,a){var i=e.getCurrentSong();a.revision.id===i.id&&_.assign(i,a.revision),"master"===a.action&&(n.removeRevision(a.revision.id),a.revision.id===i.id&&(e.pause(),i.id="",o.hideQueue()))}),o.playPrevious=function(){e.prev(),i.eventTrack("Play Previous",{category:"Player",label:"global_player"})},o.playNext=function(){e.next(),i.eventTrack("Play Next",{category:"Player",label:"global_player"})},o.isPlaying=function(){return!c.paused},o.toggleLoop=function(){switch(o.loop){case o.LOOP_STATES.DONT_REPEAT:default:o.loop=o.LOOP_STATES.REPEAT_ALL,e.setOneTrackLoop(!1),n.repeat=!0;break;case o.LOOP_STATES.REPEAT_ALL:o.loop=o.LOOP_STATES.REPEAT_ONE,e.setOneTrackLoop(!0),n.repeat=!1;break;case o.LOOP_STATES.REPEAT_ONE:o.loop=o.LOOP_STATES.DONT_REPEAT,e.setOneTrackLoop(!1),n.repeat=!1}},o.toggleQueue=function(){o.queue=!o.queue,o.queue&&i.eventTrack("Open Queue",{category:"Player",label:"global_player"})},o.hideQueue=function(){o.queue=!1},o.togglePlay=function(){c.paused?(e.play(null,{navigatingHistory:!0}),i.eventTrack("Play",{category:"Player",label:"global_player"})):(e.pause(),i.eventTrack("Pause",{category:"Player",label:"global_player"}))},a.onSuccess({},function(){var n;s.isAnonymous()&&r.isMobile?e.pause():""!==e.getCurrentSong().id?document.body.classList.add("player-visible"):(document.body.classList.remove("player-visible"),n=o.$on(t.PLAY,function(){document.body.classList.add("player-visible"),n()}))})}]}}]),angular.module("bandlab.player").directive("globalPlayerProgress",["$filter","Player",function(e,t){return{restrict:"E",replace:!0,link:function(t,n){var o=angular.element(n[0].querySelector(".global-player-progress-go"));function a(a){var i,r,s=Math.max(0,a.offsetX||(r=((i=(i=a)||window.event).target||i.srcElement).getBoundingClientRect(),i.clientX-r.left));o.css("left","".concat(s,"px")),o.text(e("duration")(s/n[0].getBoundingClientRect().width*(t.duration||1)))}n.on("mouseenter",function(){n.on("mousemove",a)}),n.on("mouseleave",function(){n.off("mousemove",a)})},controller:["$scope",function(e){e.pausePlaying=function(){t.pause()},e.resumePlaying=function(e){t.goToPercent(e),t.play()},e.setProgressTime=function(e){t.goToPercent(e)}}],templateUrl:"https://www.bandlab.com/web-app/player/partials/_global-player-progress-deaf034b.html"}}]),angular.module("bandlab.player").directive("globalPlayerQueue",["$transitions",function(e){return{restrict:"E",replace:!0,scope:{hideQueue:"&"},link:function(t){function n(e){e.target.closest(".global-player")||e.target.closest(".modal-overlay")||(o(),document.body.removeEventListener("mousedown",n))}function o(){t.hideQueue(),t.$applyAsync()}setTimeout(function(){document.body.addEventListener("mousedown",n)}),e.onSuccess({},function(){o()}),t.$on("$destroy",function(){document.body.removeEventListener("mousedown",n)})},controller:["$scope","PlayerHistory",function(e,t){e.playerHistory=t}],templateUrl:"https://www.bandlab.com/web-app/player/partials/_global-player-queue-71c475a9.html"}}]),angular.module("bandlab.player").directive("globalPlayerVolume",["Player",function(e){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/player/partials/_global-player-volume-11808788.html",controller:["$scope",function(t){var n;t.volume=e.getVolume(),t.storeVolume=function(e){n=t.volume,t.setVolume(e),localStorage.setItem("globalPlayerVolume",t.volume)},t.setVolume=function(n){t.volume=e.setVolume(n),t.isMuted=0===t.volume},t.mute=function(){t.isMuted?(t.volume=e.setVolume(n),t.isMuted=!1):(n=t.volume,t.volume=e.setVolume(0),t.isMuted=!0)}}]}}]),angular.module("bandlab.player").directive("playCounter",["$filter","playerEvents",function(e,t){return{restrict:"E",require:"ngModel",link:function(n,o,a,i){var r=!1,s=0;n.counter="0",i&&!angular.isUndefined(a.id)&&(i.$render=function(){s=i.$viewValue||0,n.counter=e("bigNumber")(s)},n.$on(t.PLAY_COUNTER,function(t,o){o.id===a.id&&(r||(s++,n.counter=e("bigNumber")(s),r=!0))}))}}}]),angular.module("bandlab.player").directive("playerAudio",["$analytics","Player","playerEvents","PlayerHelper",function(e,t,n,o){return{restrict:"A",priority:50,link:function(a,i,r){var s,c=a.$eval(r.playerAudio),l=a.$eval(r.collection),u=a.$eval(r.navigatingHistory),d=angular.noop,p=angular.noop,m=angular.noop,f=angular.noop;function h(){d(),m(),p(),f()}function g(e,t){switch(e.name){case n.LOADING:return void(t.id===c.id?a.playStatus="loading":(a.playStatus="stopped",h()));case n.PROGRESS:return void(t.id===c.id&&(t.isPaused||(a.playStatus="playing"),a.currentTime=t.timePassed));case n.PAUSED:return void(c&&t.id===c.id?a.playStatus="paused":(a.currentTime=0,a.playStatus="stopped",h()));case n.ENDED:return void(t.id===c.id&&(a.currentTime=0,a.playStatus="stopped",h()));case n.REQUESTING:return void(c&&t.id===c.id?a.playStatus="loading":a.playStatus="stopped");case n.PLAY:return void(c&&t.id===c.id&&v())}}function v(){d=a.$on(n.LOADING,g),m=a.$on(n.PROGRESS,g),p=a.$on(n.PAUSED,g),f=a.$on(n.ENDED,g)}a.playStatus="stopped",a.currentTime=0,a.$on(n.REQUESTING,g),a.$on(n.PLAY,g),c||(i.remove(),h(),a.isPlaying=function(){return!1}),a.isPlaying=function(){return t.isPlayingSong(c.id)},a.isPlaying()&&v(),(s=i[0].querySelector("[player-audio-button-toggle]")?angular.element(i[0].querySelector("[player-audio-button-toggle]")):i).on("click",function(){a.$apply(function(){var n;n={collection:l,navigatingHistory:u},c&&(t.isPlayingSong(c.id)?(t.pause(),e.eventTrack("Pause",{category:"Revision".type,label:r.eventLabel?r.eventLabel:""})):(t.pause(),t.play(c,n),e.eventTrack("Play",{category:"Revision",label:r.eventLabel?r.eventLabel:""})))})}),i.on("click",function(e){e.target.hasAttribute("player-audio-button-play")&&c.id!==t.getCurrentSong().id&&s[0].click()}),s.on("mouseover",function e(){o.getSource(c),s.off("mouseover",e)})}}}]),angular.module("bandlab.player").directive("playerAudioCollectionToggle",["Player",function(e){return{restrict:"A",priority:50,link:function(t,n,o){var a=t.$eval(o.playerAudioCollectionToggle);t.getCollectionStatus=function(){return e.getCollectionStatus(a.id)},n.on("click",function(){"playing"!==t.getCollectionStatus()?e.playCollection(a):e.pause()})}}}]),angular.module("bandlab.common").directive("waveformBars",["$http","Player","playerEvents",function(e,t,n){return{restrict:"E",replace:!0,scope:{revisionId:"@",waveformUrl:"@"},template:'<canvas class="waveform-bars" progress progress-on-start="setProgressTime" progress-on-move="setProgressTime"></canvas>',link:function(o,a){var i,r=a,s=r[0].getContext("2d"),c={progress:angular.noop,request:angular.noop},l=0,u=0,d=[],p=!1;function m(){return o.$on(n.PROGRESS,function(e,t){t.id===o.revisionId&&(u=t.timePassed/t.duration,Ye(s,d,u,l))})}function f(e){var t=e.offsetX||e.pageX-(r[0].getBoundingClientRect().left+document.body.scrollLeft);l=Ke(t)/e.target.width,Ye(s,d,u,l)}function h(){Ye(s,d,u,l=null)}function g(){var e,t=a.parent();r.attr("width",Ke(Math.round(t[0].getBoundingClientRect().width))),r.attr("height",Ke(Math.round(t[0].getBoundingClientRect().height))),(e=Math.floor(s.canvas.width/3/Ke(1)))>1&&(d=function(e,t){var n=Math.floor(e.values.length/t),o=_.chain(e.values).chunk(n).map(_.mean).value(),a=o.length-t;if(a>0)for(var i=Math.floor(o.length/a),r=0;r<o.length;r+=i){var s=(o[r]+o[r+1])/2;o.splice(r,2,s)}var c=e.maxValue;return _.map(o,function(e){return Math.round(e/c*100)})}(i,e),Ye(s,d,u,0))}function v(){return b(o.waveformUrl).then(function(e){i=e,g()})}function b(t){return e({url:t,cache:!0,ignoreLoadingBar:!0}).then(function(e){return e.data})}return o.$on(n.PLAY,function(e,t){t.id===o.revisionId?(c={progress:m(),request:o.$on(n.REQUESTING,function(){u=0,Ye(s,d,0,0)})},a.on("mousemove",f),a.on("mouseleave",h),p=!0):p&&(c.progress(),c.request(),u=0,a.off("mousemove",f),a.off("mouseleave",h),Ye(s,d,0,0),p=!1)}),b(o.waveformUrl).catch(function(){return b("https://static.bandlab.com/defaults/waveform.json")}).then(function(e){i=e,g();var n=_.debounce(g,300);window.addEventListener("resize",n),o.$on("$mixdown:changed",v),o.$on("$destroy",function(){window.removeEventListener("resize",n)}),o.revisionId===t.getCurrentSong().id&&(c.progress=m(),a.on("mousemove",f),a.on("mouseleave",h))}).catch(function(){a.remove(),o.$destroy()})},controller:["$scope",function(e){e.setProgressTime=function(o){t.getCurrentSong().id===e.revisionId?t.goToPercent(o):function(o){var a=e.$on(n.PROGRESS,function(){t.getCurrentSong().id===e.revisionId&&(a(),t.goToPercent(o))})}(o)}}]}}]),angular.module("bandlab.player").factory("Player",["$analytics","$interval","$q","$rootScope","ClientDevice","Collection","Me","playerEvents","PlayerHelper","PlayerHistory","Revision","VideoTile",function(e,t,n,o,a,i,r,s,c,l,u,d){var p,m=function(){try{var e=new Audio;return e.addEventListener("error",M),e.addEventListener("ended",T),"IE"!==a.ua.browser.name&&window.addEventListener("storage",function(e){"playing"===e.key&&S()}),e.volume=Number(localStorage.getItem("globalPlayerVolume"))||1,e}catch(e){return{}}}(),f={id:"",title:""},h={},g=n.resolve(),v=n.resolve(!0);return{fastBackward:function(){return m.readyState>=4&&(m.currentTime=m.currentTime-5,E(),!0)},fastForward:function(){return m.readyState>=4&&(m.currentTime=m.currentTime+5,E(),!0)},getAudio:function(){return m},getCollectionStatus:function(e){if(h.id===e){if(0===g.$$state.status||-1===g.$$state.status)return"loading";if(!m.paused)return"playing"}return"paused"},getCurrentSong:function(){return f},getCurrentTime:function(){return m.readyState>=4?m.currentTime:null},getVolume:function(){return m.volume},goToPercent:function(e){if(m.readyState>=4)b(e*m.duration);else var t=o.$on(s.PLAY,function(){t(),b(e*m.duration)})},goToTime:b,goToTimeAndPlay:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;b(arguments.length>1?arguments[1]:void 0),w(e,{navigatingHistory:!0})},isPlaying:function(){return!m.paused},isPlayingSong:function(e){return!m.paused&&f.id===e},isCurrentSong:function(e){return f.id===e},me:r,next:k,pause:S,pauseOtherTabs:$,play:w,playCollection:function(t){h.id&&h.id===t.id?y():(h=t,g=(t.posts?n.resolve(t):i.get({id:t.id}).$promise).then(function(t){return l.setState(),l.forcePushQueueSongs(t.posts),e.eventTrack("Collection",{category:"Play"}),k()}))},prev:function(){var e=l.previous();return P(),e&&w(e.revision,{navigatingHistory:!0})},setOneTrackLoop:function(e){m.loop=e},setVolume:function(e){return m.volume=Math.max(Math.min(1,e),0),m.volume},stop:P};function b(e){if(m.readyState>=4)return m.currentTime=Math.min(e,m.duration-.1),E(),!0;var t=o.$on(s.PLAY,function(){t(),m.currentTime=Math.min(e,m.duration-.1),E()});return!0}function y(){p&&t.cancel(p),d.current&&d.current.pause(),v=v.then(function(){return m.play()}).then(function(){E(),p=t(E,250),o.$broadcast(s.PLAY,{id:f.id})}).catch(function(){})}function w(e,t){var a=t.collection,i=void 0!==a&&a,r=t.navigatingHistory,d=void 0!==r&&r,p=n.resolve();return e&&f.id!==e.id?(f.id!==e.id&&(_.assignIn(f,e),e.creator||u.get({id:e.id}).$promise.then(function(e){o.$applyAsync(function(){_.assignIn(f,e)})})),e.src||(v=v.then(function(){return m.src="/dummy-url",m.play()}).catch(function(){})),o.$broadcast(s.REQUESTING,{id:e.id}),p=c.getSource(e).then(function(t){m.src!==t&&(e.src=t,m.src=t),y()}),e.isPublic&&c.incrementCounter(e)):y(),i?(h=i,g=p,l.setState(),l.forcePushQueueSongs(i.posts)):d||(h={},l.forcePushQueueSongs()),e&&l.setRevision(e),$(),p}function k(){var e=l.next();return P(),e&&w(e.revision,{navigatingHistory:!0})}function S(){""!==m.src&&(m.pause(),t.cancel(p),o.$broadcast(s.PAUSED,{id:f.id}),o.$applyAsync())}function P(){m.paused||(m.pause(),m.currentTime=0,t.cancel(p))}function E(){m.readyState<1?o.$broadcast(s.LOADING,{id:f.id}):o.$broadcast(s.PROGRESS,{id:f.id,timePassed:m.currentTime,duration:m.duration,isPaused:m.paused})}function T(){o.$broadcast(s.PROGRESS,{id:f.id,timePassed:m.currentTime,duration:m.duration}),e.eventTrack("Played",{category:f.type,label:f.id}),o.$broadcast(s.ENDED,{id:f.id}),t.cancel(p),P(),l.hasNext()&&k(),o.$applyAsync()}function M(e){P(),m.src="",o.$broadcast(s.ERROR,{error:e})}function $(){Modernizr.localstorage&&(localStorage.playing=Date.now())}}]),angular.module("bandlab.player").constant("playerEvents",{ENDED:"$playerEnded",ERROR:"$playerError",LOADING:"$playerLoading",PAUSED:"$playerPausePlay",PLAY:"$playerStartPlay",PLAY_COUNTER:"$playerPlayCounter",PROGRESS:"$playerUpdateTime",REQUESTING:"$playerRequestingSource"}),angular.module("bandlab.player").factory("PlayerHelper",["$http","$q","$rootScope","playerEvents","Sample",function(e,t,n,o,a){var i={};return{incrementCounter:function(t){return e.post("https://www.bandlab.com/api/v1.3/revisions/".concat(t.id,"/plays"),null,{ignoreLoadingBar:!0}).then(function(e){return 202===e.status&&(n.$broadcast(o.PLAY_COUNTER,{id:t.id}),!0)}).catch(function(){return!1})},getSource:function(e){var n=e.mixdown.id,o=i[n];return o&&new Date(o.expiryDate)>new Date?t.resolve(o.value):o&&!o.expiryDate?t.resolve(o.value):(i[n]={},i[n].value=a.getJSON("revisions/".concat(n,"?format=m4a")).then(function(e){return i[n]=e,e.value}),i[n].value)}}}]),angular.module("bandlab.player").factory("PlayerHistory",function(){var e=-1,n={},o={},a={},i=[],r=[],s=!1,c={repeat:!1,setState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o=e},forcePushQueueSongs:function(l){if(l||a[o.url]){s=!1,n=o,_.differenceBy(l,r,"id").length&&(e=-1);var u=i[e];l&&(a[o.url]=l.slice()),a=t({},o.url,a[o.url]),r=a[o.url],i=r.slice(),c.setRevision(u)}},pushQueueSongs:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1?arguments[1]:void 0,l=i[e],u=t.filter(function(e){return"Ready"===_.get(e,"revision.mixdown.status")});if(a[o]=u,n.url===o){var d=_.differenceBy(u,i,"id");s&&(d=_.shuffle(d)),r=u,i=i.concat(d),c.setRevision(l)}},getStack:function(){return i.slice(e)},getPlaylistDuration:function(){return _.chain(i).slice(e).map("revision.mixdown.duration").reduce(function(e,t){return e+t},0).value()},playNext:function(t){var n=t.revision?t:{creator:t.creator,type:"Revision",id:t.postId,revision:t};(i=i.filter(function(e){return n.id!==e.id})).splice(e+1,0,n),(r=r.filter(function(e){return n.id!==e.id})).splice(e+1,0,n)},setRevision:function(t){if(t){var o=t.revision?t.revision.id:t.id;e=_.findIndex(i,function(e){return o===e.revision.id}),n.loader&&e>=i.length-2&&n.loader()}else e=-1},isShuffled:function(){return s},toggleShuffle:function(){var t;(s=!s)?(t=i[e],i=i.slice(0,e+1).concat(_.shuffle(i.slice(e+1))),c.setRevision(t),s=!0):function(){var t=i[e];i=r.slice(),c.setRevision(t),s=!1}()},removeRevision:function(t){var n=i[e],o={revision:{id:t}};_.remove(i,o),_.remove(r,o),c.setRevision(n)},removeSong:function(t){var n=i[e],o={revision:{song:{id:t}}};_.remove(i,o),_.remove(r,o),c.setRevision(n)},previous:function(){return e=0===e&&c.repeat?i.length-1:e-1,i[e]},hasPrevious:function(){return c.repeat||!!i[e-1]},next:function(){return e=e===i.length-1&&c.repeat?0:e+1,i[e]},hasNext:function(){return c.repeat||!!i[e+1]}};return c}),angular.module("bandlab.post",[]),angular.module("bandlab.post").controller("PostCtrl",["Me",function(e){var t=this;t.$onInit=function(){t.post.revision&&(t.post.revision.postId=t.post.id,t.post.revision.isExplicit=t.post.isExplicit)},t.me=e}]),angular.module("bandlab.post").controller("PostEditCtrl",["$analytics","$rootScope","$scope","AppNotifications","ChatHelper","ConfirmModal","Post",function(e,o,a,i,r,s,c){function l(e){var t=(e.band?"bands":e.community&&"communities")||"users";return{type:t,id:"bands"===t&&e.band.id||"communities"===t&&e.community.id||e.creator.id}}a.post=new c(a.post),r.resetMessageAttachmentsCache(),a.editPost=function(){c.update({id:a.post.id,caption:a.post.caption,link:a.post.link}).$promise.then(function(t){e.eventTrack("Edit Post",{category:"Post",label:_.startCase(t.type)}),a.$parent.post.caption=t.caption,a.$parent.post.link=t.link,o.$broadcast("editPostModal","close")}).catch(function(){a.postForm.$setPristine()})},a.pinPost=function(){return c.get({id:a.post.id}).$promise.then(function(e){var r,u=l(e),d=u.type,p=u.id;return c[{bands:"fromBand",communities:"fromCommunity"}[d]||"fromUser"]((r={},t(r,{bands:"bandId",communities:"communityId"}[d]||"userId",p),t(r,"limit",1),r)).$promise.then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,r=n(t=void 0===t?[{}]:t,1),l=r[0].isPinned;return l?new s({confirmLabel:"Pin",contentScope:{title:"Pin to Top",message:"<p>".concat("This will replace any previously pinned post.","</p>")},onConfirm:u}).show():u();function u(){return c.pinPost({entityType:d,entityId:p,id:a.post.id}).$promise.then(function(){o.$broadcast("$post:pin",{post:a.post}),i.addNotification({content:"Post pinned",classList:"light",autoclose:5e3})}).catch(function(){i.addNotification({content:"Something went wrong. Please try again later.",classList:"alert",autoclose:5e3})})}})})},a.unpinPost=function(){return c.get({id:a.post.id}).$promise.then(function(e){var t=l(e),n=t.type,r=t.id;return c.unpinPost({entityType:n,entityId:r,id:a.post.id}).$promise.then(function(){o.$broadcast("$post:unpin",{post:a.post}),i.addNotification({content:"Post unpinned",classList:"light",autoclose:5e3})})}).catch(function(){i.addNotification({content:"Something went wrong. Please try again later.",classList:"alert",autoclose:5e3})})},a.deletePost=function(t){return new s({confirmLabel:"Delete",contentScope:{title:"Delete this post?",message:"<p>".concat("You won’t be able to undo this action.","</p>")},onConfirm:function(){return c.delete({id:t.id}).$promise.then(function(){e.eventTrack("Delete Post",{category:"Post",label:_.startCase(t.type)}),o.$broadcast("$post:delete",{post:t})})}}).show()}}]),angular.module("bandlab.post").directive("draggablePostTile",["Collection","Me",function(e,t){var n=null,o=null,a=null;return{link:function(i,r){var s,c=i.vm.collection,l=i.vm.post;if(c.creator.id===t.id){var u=r[0].closest("revision-list-item");r[0].draggable=!0,r[0].addEventListener("dragstart",function(e){e.stopPropagation(),n=l,e.dataTransfer.setData("text/plain",""),e.dataTransfer.setDragImage&&((s=this.parentElement.cloneNode(!0)).querySelector(".post-tile-action").remove(),s.querySelector(".player-audio-controls").remove(),s.style.borderRadius="2px",s.style.padding="4px",s.style.transform="translateX(-500px)",s.style.width="400px",document.body.appendChild(s),e.dataTransfer.setDragImage(s,0,0)),u.addEventListener("dragover",d)}),r[0].addEventListener("dragend",function(){s&&document.body.removeChild(s);var t=c.posts.indexOf(n);t!==a&&(c.posts.splice(t,1),c.posts.splice(a,0,n),e.updatePostOrder({id:c.id,postId:n.id,order:a})),o=null,n=null,a=null,i.isDroppedAbove=!1,i.isDroppedBelow=!1,u.removeEventListener("dragover",d),i.$applyAsync()}),u.addEventListener("dragover",function(e){if(!e.target.contains(this)&&null!==n&&n!==l){var t,r,s=(t=e,(r=u.getBoundingClientRect()).top+r.height-t.y>r.height/2),d=c.posts.indexOf(n)<c.posts.indexOf(l),p=c.posts.indexOf(l);o=l,a=s||d?s&&d?p-1:p:p+1,i.isDroppedAbove=function(e,t){return o===l&&(a<e||!t&&a===e)}(p,d),i.isDroppedBelow=function(e,t){return o===l&&(a>e||t&&a===e)}(p,d),i.$applyAsync()}}),u.addEventListener("dragleave",function(){i.isDroppedAbove=!1,i.isDroppedBelow=!1,i.$applyAsync()})}function d(e){e.preventDefault()}}}}]),angular.module("bandlab.post").component("openGraphCard",{bindings:{link:"<"},templateUrl:"https://www.bandlab.com/web-app/post/partials/_open-graph-card-277b81f6.html",controllerAs:"vm"}),angular.module("bandlab.post").component("postAttachment",{bindings:{canRemoveLink:"<",post:"<"},templateUrl:"https://www.bandlab.com/web-app/post/partials/_post-attachment-f2232af4.html",controller:["$scope","ChatHelper",function(e,t){var o=this;e.displayCustomAttachment=function(e){var t=e.type;return(!o.canRemoveLink||o.post.link)&&t===_.get(o,"post.attachment.type")},e.removeLink=function(){o.post.link=null,o.post.pending=null};var a=_.debounce(function(){t.getMessageAttachments("".concat(_.get(o,"post.link.url","")," ").concat(o.post.caption)).then(function(e){var t=n(e,1)[0];"Revision"===_.get(t,"object.type")?o.post.attachment={object:ho({postId:t.object.id},t.object.revision),type:"Revision"}:o.post.attachment=t})},1e3,{leading:!0});o.$onInit=function(){"Text"!==o.post.type&&"Link"!==o.post.type||(a(),o.post.canEdit&&e.$watch("vm.post.caption",function(e,t){e!==t&&a()}))}}],controllerAs:"vm"}),angular.module("bandlab.post").component("postCard",{bindings:{collection:"<",post:"="},templateUrl:"https://www.bandlab.com/web-app/post/partials/_post-card-7463bd21.html",controller:["$state","ClientDevice","Me",function(e,t,n){var o=this;o.mobileCard=n.isBetaUser&&t.isMobile&&(e.is("feed")||e.is("user.feed")||e.is("band.feed")||e.is("community.feed")),o.$onInit=function(){o.post.revision&&(o.post.revision.postId=o.post.id,o.post.revision.isExplicit=o.post.isExplicit)},o.me=n}],controllerAs:"vm"}),angular.module("bandlab.post").directive("postCardDropzone",["$injector","$templateRequest",function(e,t){return{restrict:"A",scope:{revision:"=postCardDropzone"},link:function(n,o){function a(e){if(e.dataTransfer.types)for(var t=0;t<e.dataTransfer.types.length;t++)if("Files"===e.dataTransfer.types[t])return!0;return!1}n.revision&&n.revision.canEdit&&(o.on("drop",function(t){var i;t.preventDefault(),t.stopPropagation(),o.removeClass("dropping"),a(t)&&(i=t.dataTransfer.files[0],e.get("RevisionImporter").createRevisionFromFile(i,{bandId:n.revision.bandId,parentRevision:n.revision}))}),o.on("dragover",function(e){e.preventDefault(),e.stopPropagation(),a(e)&&o.addClass("dropping")}),o.on("dragenter",function(e){e.preventDefault(),e.stopPropagation(),a(e)&&o.addClass("dropping")}),o.on("dragleave",function(){o.removeClass("dropping")}),t("https://www.bandlab.com/web-app/post/partials/_post-card-dropzone-f61cc65b.html").then(function(e){o.append(e)}))}}}]),angular.module("bandlab.post").component("postCardSmall",{bindings:{post:"<"},templateUrl:"https://www.bandlab.com/web-app/post/partials/_post-card-small-54c840b6.html",controller:"PostCtrl",controllerAs:"vm"}),angular.module("bandlab.post").component("postTile",{bindings:{collection:"=",post:"=",navigatingHistory:"<"},transclude:{actions:"?postTileActions"},templateUrl:"https://www.bandlab.com/web-app/post/partials/_post-tile-1e6ca42e.html",controller:"PostCtrl",controllerAs:"vm"}),angular.module("bandlab.post").component("postTileSocial",{bindings:{post:"="},templateUrl:"https://www.bandlab.com/web-app/post/partials/_post-tile-social-84c6795a.html",controller:["Me","User",function(e,t){var n=this;n.me=e,n.getLikers=function(e){return _.assign(e,{entity:"posts",entityId:n.post.id}),t.likers(e).$promise}}],controllerAs:"vm"}),angular.module("bandlab.post").directive("textPostInput",["ChatHelper",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,a,i){var r=new WeakSet;i.$viewChangeListeners.push(_.debounce(function(){var o=i.$viewValue;t.post.link||(t.post.pending=!0,e.getLinkPreview(o).then(function(e){var a=n(e,1)[0];o===t.post.caption&&(t.post.link=a&&!r.has(a)&&a.object||null,a&&r.add(a))}).finally(function(){delete t.post.pending}))},1e3,{leading:!0}))}}}]),angular.module("bandlab.post.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("post",{url:"/post/{id:[a-zA-Z0-9-_]+}",params:{rewriteTracking:function(){return function(){return"/post"}}},templateUrl:"https://www.bandlab.com/web-app/post/views/post-layout-c20be632.html",redirectTo:function(e){return e.injector().getAsync("thePost").then(function(e){if(e.revision)return{state:"Band"===e.revision.song.author.type?"bandSong":"userSong",params:{username:e.revision.song.author.username,slug:e.revision.song.slug,revId:e.revision.id}}})},resolve:{thePost:["$q","$stateParams","Post",function(e,t,n){return n.get({id:t.id}).$promise}]},onEnter:["$stateParams","Page","Share","thePost",function(e,t,n,o){var a,i;t.setMetadata((i={image:(a=o).creator.picture.s,imageHeight:"360",imageWidth:"360",title:"A post by ".concat(a.creator.name," | BandLab"),description:"".concat(a.caption?"".concat(a.caption," | "):"","Listen to music from ").concat(a.creator.name," and follow their creative process on BandLab."),objectPath:"/posts/".concat(e.id)},a.revision&&(i.description="".concat(a.revision.description?"".concat(a.revision.description," | "):"","Listen to music from ").concat(a.revision.song.author.name," and follow their creative process on BandLab."),i.title="".concat(a.revision.song.name," by ").concat(a.creator.name," | BandLab"),i.image=a.revision.song.picture.l,i.imageHeight=i.imageWidth="1024",i.player=n.getEmbedRevisionUrl(a.revision)),i))}],onExit:["Page",function(e){e.clearMetadata()}],controller:["$scope","$state","thePost","Me",function(e,t,n,o){e.post=n,e.$on("$post:delete",function(e,a){n.id===a.post.id&&t.go("user.feed",{username:o.username})})}]})}]),angular.module("bandlab.post").factory("Post",["$http","$resource",function(e,t){var n="https://www.bandlab.com/api/v1.3/posts";return t(n,{},{delete:{method:"DELETE",params:{id:"@id"},url:"".concat(n,"/:id")},explore:{method:"GET",preservePagination:!0},exploreGenre:{method:"GET",preservePagination:!0,url:"https://www.bandlab.com/api/v1.3/genres/:genres/posts"},fromBand:{method:"GET",params:{bandId:"@bandId",types:"revision;image;video;text;link"},preservePagination:!0,url:"https://www.bandlab.com/api/v1.3/".concat("bands","/:bandId/posts")},fromCommunity:{method:"GET",params:{communityId:"@communityId",types:"revision;image;video;text;link"},preservePagination:!0,url:"https://www.bandlab.com/api/v1.3/communities/:communityId/posts"},fromContest:{method:"GET",preservePagination:!0,url:"https://www.bandlab.com/api/v1.3/contests/:contestId/posts",transformResponse:[].concat(He(e.defaults.transformResponse),[function(e,t,n){return 200===n&&e.data.forEach(o),e}])},fromFollowees:{method:"GET",params:{userId:"@userId",types:"revision;image;video;text;link"},preservePagination:!0,url:"https://www.bandlab.com/api/v1.3/users/:userId/following/posts"},fromRevisionForks:{method:"GET",isArray:!0,params:{limit:10,offset:0,revisionId:"@revisionId",types:"revision"},url:"https://www.bandlab.com/api/v1.3/revisions/:revisionId/forks/posts"},fromSong:{method:"GET",params:{songId:"@songId",limit:50},preservePagination:!0,url:"https://www.bandlab.com/api/v1.3/songs/:songId/posts"},fromUser:{method:"GET",params:{userId:"@userId",types:"revision;image;video;text;link",excludePinned:"@excludePinned"},preservePagination:!0,url:"https://www.bandlab.com/api/v1.3/users/:userId/posts"},get:{method:"GET",params:{id:"@id"},url:"".concat(n,"/:id")},liked:{method:"GET",params:{id:"@userId",limit:5,types:"revision;image;video;text"},preservePagination:!0,url:"https://www.bandlab.com/api/v1.3/users/:userId/likes/posts"},update:{method:"PATCH",params:{id:"@id"},url:"".concat(n,"/:id")},createPost:{method:"POST",params:{id:"@id",entity:"@entity"},url:"https://www.bandlab.com/api/v1.3/:entity/:id/posts"},pinPost:{method:"POST",params:{id:"@id",entityType:"@entityType",entityId:"@entityId"},url:"https://www.bandlab.com/api/v1.3/:entityType/:entityId/pins/posts/:id"},unpinPost:{method:"DELETE",params:{id:"@id",entityType:"@entityType",entityId:"@entityId"},url:"https://www.bandlab.com/api/v1.3/:entityType/:entityId/pins/posts/:id"},getNewPrivateLink:{method:"POST",params:{id:"@id"},url:"".concat(n,"/:id/sharings")},getPrivateLink:{method:"GET",params:{id:"@id"},url:"".concat(n,"/:id/sharings")}});function o(e){e.revision&&(e.revision.postId=e.id)}}]),angular.module("bandlab.product.routes",["ui.router","duScroll"]).config(["$stateProvider",function(e){e.state("products",{url:"/products",redirectTo:"products.cakewalk"}).state("redirectAssistant",{url:"/assistant",redirectTo:"products.assistant"}).state("products.assistant",{url:"/desktop/assistant",templateUrl:"https://www.bandlab.com/web-app/product/views/assistant-layout-fbad75e9.html",onEnter:x,controller:["$scope","$http","$state",function(e,t,n){e.$on("duScrollspy:becameActive",function(e,t,n){n.addClass("became-active")}),t.get("https://www.bandlab.com/web-app/common/static/packs-d999d98bdf.json").then(function(t){var n=t.data;e.packs=n}),e.goToInstructions=function(){n.go("products.assistantInstructions")}}]}).state("products.assistantInstructions",{url:"/desktop/assistant/instructions",templateUrl:"https://www.bandlab.com/web-app/product/views/assistant-instructions-layout-0c218164.html"}).state("products.cakewalk",{url:"/cakewalk",templateUrl:"https://www.bandlab.com/web-app/product/views/cakewalk-layout-56fcb032.html",onEnter:x,controller:["$scope","$state",function(e,t){e.goToInstructions=function(){t.go("products.cakewalkInstructions")}}]}).state("products.cakewalkInstructions",{url:"/cakewalk/instructions",templateUrl:"https://www.bandlab.com/web-app/product/views/cakewalk-instructions-layout-33759ec7.html"}).state("products.cakewalkWhatsNew",{url:"/cakewalk/whats-new",templateUrl:"https://www.bandlab.com/web-app/product/views/cakewalk-whatsnew-layout-8a30dd92.html",resolve:{theChangelog:["$http",function(e){return e.get("https://bandlab.github.io/cakewalk-changelog/changelog.json").then(function(e){return e.data})}]},controller:["$scope","theChangelog",function(e,t){e.changelog=t}]}).state("products.cakewalkPledge",{url:"/cakewalk/rewards?value",params:{value:{dynamic:!0}},templateUrl:"https://www.bandlab.com/web-app/product/views/pledge-layout-263a3a6e.html",resolve:{theCakewalkUser:["User",function(e){return e.get({id:"bca65cb6-412e-e811-80c3-00155d60d108"}).$promise}]},controller:["$analytics","$filter","$q","$scope","$state","$stateParams","$timeout","appActions","ConfirmModal","Contact","Me","Modal","Share","Stripe","theCakewalkUser","TipJar",function(e,t,n,o,a,i,r,s,c,l,u,d,p,m,f,h){var g=t("fromCountryCode");function v(){return n(function(e,t){return new c({confirmLabel:"Pay via PayPal",contentScope:{title:i18n(go()),message:'\n                  <div class="text-left">\n                    <p>We\'re about to redirect you to PayPal. Important note ☝️</p>\n                    <p>Please make sure to <strong>include the email address associated with your BandLab account via "Add a note"</strong> and <strong>set your shipping address</strong> accordingly on the PayPal form.</p>\n                  </div>\n                '},onCancel:t,onConfirm:function(){window.open("https://www.paypal.me/bandlab/".concat(o.customPledge.toFixed(2),"USD"),"_blank")}}).show()})}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=parseFloat(e);o.totalAmount=0,t<1||h.calculateTipFees(100*t).then(function(n){var a=n.charges;e===o.customPledge&&(o.totalAmount=(Math.round(100*t+a)/100).toFixed(2))})}function y(){return a.href("products.cakewalkPledge",null,{absolute:!0})}o.isTipping=!1,o.pledge=i.value,o.suggestedAmount=5,o.payment="creditCard",o.customPledge={1:49,2:99,3:199,4:999}[i.value]||o.suggestedAmount,o.user=f,o.me=u,o.showPaypalConfirmation=v,o.getTotalAmount=b,o.proceedToPayment=function(t){if(s.checkAllowed("tip",{toParams:{value:t}}))return"paypal"===o.payment?(e.eventTrack("Open PayPal.me",{category:"Cakewalk",label:t}),v()):(e.eventTrack("Open shipping",{category:"Cakewalk",label:t}),void a.go(".",{value:t}))},o.submitSendTip=function(){if(s.checkAllowed("tip")&&!o.isTipping)return o.isTipping=!0,m.requireCard().then(function(){return e=100*parseFloat(o.customPledge),h.createTip(e,{id:f.id,name:f.name}).then(function(e){return new d({id:"tipSetModal",template:'\n                    <div class="modal-content modal-content-medium">\n                      <div>\n                        <tip-user-form user="user" thank-you-message="'.concat(e.thankYouMessage,'"></tip-user-form>\n                      </div>\n                      <div class="cakewalk-pledge-share">\n                        <p>Want to share your support?</p>\n                        <div class="cakewalk-pledge-share-sns">\n                          <button type="button" class="sns xl long facebook single" ng-click="shareWithFacebook()">\n                            <span class="icon-facebook"></span>Share on Facebook\n                          </button>\n                          <button type="button" class="sns xl long twitter single" ng-click="shareWithTwitter()">\n                            <span class="icon-twitter"></span>Share on Twitter\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n                    '),contentScope:{user:f,shareWithFacebook:function(){return p.withFacebook(y())},shareWithTwitter:function(){return p.withTwitter(y())}},onDestroy:function(){return a.go("user.feed",{username:f.username})}}).show()});var e}).then(function(){if(e.eventTrack("Submit pledge",{category:"Cakewalk",value:parseFloat(o.customPledge)}),"0"!==o.pledge)return new l({description:"#cakewalkdonate\n\nUsername\n".concat(u.username,"\n\nUserId\n").concat(u.id,"\n\nReward\n").concat(o.pledge,"\n\nTip Amount\n").concat(o.customPledge,"\n\nEmail\n").concat(u.email,"\n\nName\n").concat(u.name,"\n\nAddress\n").concat(u.address,"\n\nCity\n").concat(u.city,"\n\nState\n").concat(u.state,"\n\nCountry\n").concat(g(u.location.country),"\n\nZip Code\n").concat(u.zipcode)}).$save()}).finally(function(){o.shippingForm.$setPristine(),r(function(){o.isTipping=!1},5e3)})},b(o.customPledge)}]}).state("redirectCakewalk",{url:"/cakewalk",redirectTo:"products.cakewalk"}).state("product",{url:"/machines",resolve:{redirectToStore:function(){window.location.replace("https://store.bandlab.com")}}}).state("product.linkAnalog",{url:"/link-analog"})}]),angular.module("bandlab.project",[]),angular.module("bandlab.project").controller("ProjectsCtrl",["$q","$scope","$stateParams","$timeout","Song","theBand","theUser",function(e,t,n,o,a,i,r){var s,c=30,l=0,u=!1;function d(){if(u)return e.resolve([]);var n={limit:c,offset:l};return(s="recent"===t.category?a.fromUser(_.assignIn(n,{id:r.id})).$promise:"my-projects"===t.category?a.fromUser(_.assignIn(n,{id:r.id,authorId:r.id})).$promise:"collaborations"===t.category?a.fromUser(_.assignIn(n,{id:r.id,collaboration:!0})).$promise:"bands"===t.category?a.fromUser(_.assignIn(n,{id:r.id,author:"band"})).$promise:a.fromBand(_.assignIn(n,{id:t.band.id})).$promise).then(function(e){u=0===e.length||e.length<c,l+=e.length}),s}function p(e){_.find(t.projects,{id:e.id})||("recent"===t.category||"my-projects"===t.category||"band"===t.category&&e.author.id===t.band.id)&&o(function(){return a.get({id:e.id}).$promise},1e3).then(function(e){t.projects.unshift(e),l++})}i?(t.band=i,t.category="band"):t.category=n.category,t.loadMore=function(){return t.infiniteScrollEnded?e.reject("No more results"):s=s.then(function(e){return t.infiniteScrollEnded=u,t.projects=t.projects||[],t.projects=t.projects.concat(e),d()})},d().then(t.loadMore),t.$on("$song:changed",function(e,n){if(_.includes(["mark-deleted","unmark-deleted"],n.action)){var a=_.find(t.projects,{id:n.song.id});a&&(a.isDeleting="mark-deleted"===n.action||null)}else{if("move"===n.action&&"recent"===t.category){var i=_.findIndex(t.projects,{id:n.song.id});return _.remove(t.projects,{id:n.song.id}),void o(function(){t.projects.splice(i,0,n.song)},500)}if("delete"===n.action||"leave"===n.action||"move"===n.action)return _.remove(t.projects,{id:n.song.id}),l--,void(t.projects.length<c&&t.loadMore());if("update"!==n.action)"create"===n.action&&p(n.song);else{var r=_.find(t.projects,{id:n.song.id});r&&_.assignIn(r,n.song)}}}),t.$on("$revision:changed",function(e,t){"create"===t.action&&p(t.revision.song)})}]),angular.module("bandlab.project").component("projectAuthor",{bindings:{revision:"<",song:"<"},template:'\n      <span ng-if="(vm.song.author.type === \'Band\')">\n        <a ui-sref="user.feed({ username: vm.revision.creator.username })"\n          profile-popover\n          profile-popover-type="User"\n          profile-popover-id="{{ vm.revision.creator.id }}">{{ vm.revision.creator.name }}</a>\n        <span ng-if="vm.revision.creator.name"> in </span>\n        <a ui-sref="band.feed({ username: vm.song.author.username })"\n          profile-popover\n          profile-popover-type="Band"\n          profile-popover-id="{{ vm.song.author.id }}">{{ vm.song.author.name }}</a>\n      </span>\n      <span ng-if="(vm.song.author.type === \'User\')"\n            profile-popover\n            profile-popover-type="User"\n            profile-popover-id="{{ vm.revision.creator.id || vm.song.author.id }}">\n        <a ui-sref="user.feed({ username: vm.revision.creator.username || vm.song.author.username })">{{ vm.revision.creator.name || vm.song.author.name }}</a>\n      </span>\n      <a ng-if="(vm.song.counters.collaborators > 0 && vm.song.author.type === \'User\')"\n         class="tooltip-opener"\n         users-modal\n         users-modal-list="vm.getCollaborators"\n         users-modal-title="'.concat("Collaborators",'"\n         title="{{ vm.song.counters.collaborators }} ').concat("Collaborators","\">\n        +\n        <ng-pluralize\n          count=\"vm.song.counters.collaborators\"\n          when=\"{'one': '{} other', 'other': '{} others'}\">\n        </ng-pluralize>\n      </a>\n    "),controller:["User",function(e){var t=this;t.getCollaborators=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Promise.all([e.getCollaborators(_.assign({songId:t.song.id},o)).$promise,e.get({id:t.song.author.id}).$promise]).then(function(e){var t=n(e,2),o=t[0];return[t[1]].concat(He(o))})}}],controllerAs:"vm"}),angular.module("bandlab.project").component("projectCard",{bindings:{revision:"<",song:"<"},templateUrl:"https://www.bandlab.com/web-app/project/partials/_project-card-a7093c49.html",controller:["Band","Post","Revision","User",function(e,t,n,o){var a=this,i=[];function r(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).after;return t.fromSong({songId:a.song.id,after:e}).$promise}a.$onInit=function(){a.revision=a.revision||a.song.revision,function e(t){return t().then(function(t){var n=t.data,o=t.paging;if(i=i.concat(n),!(o.itemsCount<o.limit))return e(function(){return r(o.cursors)});a.revisionsTreeView=_.map(i,function(e){return e.revision}).reverse()})}(r),a.song.isFork&&n.get({id:a.song.original.revisionId}).$promise.then(function(e){a.originalRevision=e}),"User"===a.song.author.type?o.get({id:a.song.author.id}).$promise.then(function(e){a.projectAuthor=e}):e.get({id:a.song.author.id}).$promise.then(function(e){a.projectAuthor=e})},a.getCollaborators=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.limit,n=e.offset;return o.getCollaborators({songId:a.song.id,accepted:!0,limit:t,offset:n}).$promise},a.revisionsTreeView=[]}],controllerAs:"vm"}),angular.module("bandlab.project").component("projectProfilePopover",{bindings:{song:"<"},template:'\n      <div class="popover-content">\n        <project-tile song="vm.song" class="collapse"></project-tile>\n      </div>\n    ',controllerAs:"vm"}),angular.module("bandlab.project").component("projectsCard",{templateUrl:"https://www.bandlab.com/web-app/project/partials/_projects-card-bbf368dc.html",controller:["$element","$scope","$timeout","Me","Song",function(e,t,n,o,a){var i=this;a.fromUser({id:o.id,limit:3,sort:"recent"}).$promise.then(function(t){t.length||e.remove(),i.songs=t}),t.$on("$song:changed",function(e,t){if(_.includes(["mark-deleted","unmark-deleted"],t.action)){var r=_.find(i.songs,{id:t.song.id});r&&(r.isDeleting="mark-deleted"===t.action||null)}else{if("move"===t.action){var s=_.findIndex(i.songs,{id:t.song.id});return _.remove(i.songs,{id:t.song.id}),void n(function(){i.songs.splice(s,0,t.song)},500)}"delete"!==t.action&&"leave"!==t.action||n(function(){a.fromUser({id:o.id,limit:3,sort:"recent"}).$promise.then(function(e){i.songs=e})},1500)}})}],controllerAs:"vm"}),angular.module("bandlab.project").directive("projectsDropzone",["$q","$stateParams","$window","AppNotifications","editorSettings","RevisionImporter",function(e,t,o,a,i,r){return{restrict:"A",replace:!0,link:function(s,c){function l(e){_.chain(e).get("dataTransfer.items",[]).some(function(e){return e.type.includes("audio")}).value()&&(s.isDragging=!0,s.$applyAsync())}function u(){s.isDragging=!1,s.$applyAsync()}function d(o){return e.all(Array.from(o).map(p)).then(function(e){var o=_.partition(e,function(e){return n(e,2)[1]}),c=n(o,2),l=c[0],u=c[1];u.length&&a.addNotification({title:"Unable to import file due to corrupted file or missing metadata.",content:"\n                    ".concat(u.map(function(e){return n(e,1)[0].name}).join("<br>"),"\n                    <br>\n                    <br><i>").concat("Supported file formats: ".concat(i.IMPORT_FILE_ACCEPTED_TYPES.readable),"</i>\n                    <br><i>").concat(i18n(vo(),i.IMPORT_FILE_SIZE_MAX),"</i>\n                  "),classList:"alert"}),_.map(l,function(e){var o=n(e,2);return function(e,n){var o=_.find(s.bands,{username:t.category});return r.createRevisionFromUploadQueue(e,{bandId:o?o.id:null,duration:n})}(o[0],o[1])})})}function p(e){return r.isAudioFileValid(e,{loader:!1}).then(function(e){var t=n(e,2);return[t[0],t[1]]}).catch(function(){return[e,null]})}(o=angular.element(o)).on("dragover",l),o.on("dragleave",u),c.on("drop",function(t){var n;t.preventDefault(),t.stopPropagation(),t.dataTransfer.items?(n=t.dataTransfer.items,n?e.all(_.map(n,function(t){var n=t.webkitGetAsEntry();if(n)return function t(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return n.isFile?e(function(e){n.file(e)}):n.isDirectory?e(function(a){n.createReader().readEntries(function(i){a(e.all(_.map(i,function(e){return t(e,"".concat(o).concat(n.name,"/"))})))})}):void 0}(n)})):e.resolve()).then(function(e){return d(_.chain(e).flattenDeep().compact().value())}):t.dataTransfer.files&&d(t.dataTransfer.files),s.isDragging=!1,s.$applyAsync()}),c.on("dragover",function(e){e.preventDefault(),e.stopPropagation(),s.isDragging=!0,e.dataTransfer.dropEffect="copy",s.$applyAsync()}),c.on("dragleave",function(){s.isDragging=!1,s.$applyAsync()}),s.$on("$destroy",function(){o.off("dragover",l),o.off("dragleave",u)})}}}]),angular.module("bandlab.project").component("projectTile",{bindings:{song:"<"},templateUrl:"https://www.bandlab.com/web-app/project/partials/_project-tile-fc0a4700.html",controller:["$element","$timeout","Song","User",function(e,t,n,o){var a=this;a.getCollaborators=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o.getCollaborators(_.assign({songId:a.song.id},e)).$promise}}],controllerAs:"vm"}),angular.module("bandlab.project").directive("projectTileLink",function(){return{replace:!0,transclude:!0,scope:{song:"="},template:'<a ng-href="{{ createUrl() }}" ng-transclude></a>',controller:["$scope","$state",function(e,t){e.createUrl=function(){return"Deleted"===e.song.status?null:(t.current.name,t.href("Band"===e.song.author.type?"bandSong":"userSong",{username:e.song.author.username,slug:e.song.slug},{inherit:!1}))}}]}}),angular.module("bandlab.project").value("ProjectUploader",{queue:[],isMinimized:!1,isVisible:!1}).directive("projectUploader",["$window","ConfirmModal","ProjectUploader",function(e,t,n){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/project/partials/_project-uploader-581e8d77.html",link:function(o){var a;e.addEventListener("beforeunload",function(e){"0.00"!==o.getRemainingBytes()&&(e.returnValue=!0)}),o.projectUploader=n,o.getRemainingBytes=function(){return(_.chain(n.queue).filter(function(e){return!e.failed}).reduce(function(e,t){return e+t.file.size-t.loaded},0).value()/1024/1024).toFixed(2)},o.closeProjectUploader=function(){if(!a){if("0.00"===o.getRemainingBytes())return e();(a=new t({confirmLabel:"Cancel",cancelLabel:"Continue",contentScope:{title:i18n(yo()),message:"<p>".concat(i18n(bo()),"</p>")},onConfirm:e,onDestroy:function(){a=null}})).show()}function e(){_.chain(n.queue).filter(function(e){return!e.failed&&e.loaded!==e.total}).map(function(e){e.cancel()}).value(),n.queue=[],n.isVisible=!1}},o.$watch("projectUploader.queue.length",function(e){e&&(n.isVisible=!0,n.isMinimized=!1)})}}}]),angular.module("bandlab.report.routes",["ui.router"]).config(["$stateProvider",function(e){function t(e,t,n,o){var a=e.params(),i=a.type,r=a.id,s=a.creatorId;return(s?function(){return o.get({id:s}).$promise}:{posts:function(){return n.get({id:r}).$promise.then(function(e){return e.creator})},users:function(){return o.get({id:r}).$promise}}[i]||function(){return t.resolve(null)})().then(function(e){return{creator:e,objectId:r,objectType:c(i)}});function c(e){return{bands:"Band",collections:"Collection",comments:"Comment",communities:"Community",posts:"Post",projects:"Project",revisions:"Revision",songs:"Song",users:"User"}[e]||e}}t.$inject=["$transition$","$q","Post","User"],e.state("reportEntity",{url:"/report/:type/:id?step&reason&creatorId",params:{step:{dynamic:!0}},templateUrl:"https://www.bandlab.com/web-app/report/views/report-layout-1f26ece2.html",controller:["$scope","$stateParams","theEntity",function(e,t,n){e.toReport=n}],resolve:{theEntity:t}}).state("reportGeneral",{url:"/report/:type?step&reason",params:{step:{dynamic:!0}},templateUrl:"https://www.bandlab.com/web-app/report/views/report-layout-1f26ece2.html",controller:["$scope","theEntity",function(e,t){e.toReport=t}],resolve:{theEntity:t}}).state("report",{url:"/report?step&reason",templateUrl:"https://www.bandlab.com/web-app/report/views/report-layout-1f26ece2.html",controller:["$scope","theEntity",function(e,t){e.toReport=t}],resolve:{theEntity:t}})}]),angular.module("bandlab.search",[]),angular.module("bandlab.search").controller("SearchCtrl",["$filter","$scope","$state","$stateParams","$transitions","Search","SearchHistory",function(e,t,n,o,a,i,r){var s,c=!1,l=a.onSuccess({},function(){t.search=o.q,l(),d(t.search)});function u(){return{"0history":e("limitTo")(r.get(),10),"1users":[]}}function d(n){angular.isUndefined(n)||0===n.length?t.suggestions=u():c||function n(o){var a;a=e("filter")(r.get(),function(e){return!(!e.name||!e.username||-1===e.name.indexOf(o)&&-1===e.username.indexOf(o))}),t.suggestions["0history"]=e("limitTo")(a,10),s=o,c=!0,i.users({query:o}).then(function(n){var o=n.data;t.suggestions["0history"]=e("limitTo")(t.suggestions["0history"],10),t.suggestions["1users"]=e("limitTo")(o,10-t.suggestions["0history"].length)}).finally(function(){c=!1,t.search&&t.search!==s&&n(t.search)})}(n)}t.suggestions=u(),t.goToResults=function(e){n.go("search.results",{q:e})},t.$watch("search",d)}]),angular.module("bandlab.search").controller("SearchResultsCtrl",["$analytics","$location","$q","$scope","$stateParams","PlayerHistory","Search",function(e,t,n,o,a,i,r){var s,c=a.q,l=12,u=null,d=!1,p=t.url();if(o.loadMore=f,o.$parent.query=a.q,o.filter=a.filter,!c||0===c.length)return o.results=[],void(o.infiniteScrollEnded=!0);if(e.eventTrack("Search in ".concat(o.filter),{category:"Search",label:c}),"top"===o.filter)return i.setState({loader:null,url:p}),void n.all([r.users({limit:3,query:c}).then(function(e){var t=e.data;o.users=t}),r.bands({limit:3,query:c}).then(function(e){var t=e.data;o.bands=t}),r.projects({limit:3,query:c}).then(function(e){var t=e.data;o.projects=t}),r.collections({limit:3,query:c}).then(function(e){var t=e.data;o.collections=t}),r.posts({limit:10,tag:c.replace("#","")}).then(function(e){var t=e.data;o.posts=t,i.pushQueueSongs(o.posts,p)})]).then(function(){o.infiniteScrollEnded=!0,o.results={length:o.users.length+o.bands.length+o.projects.length+o.collections.length+o.posts.length}});function m(){return d?n.resolve({data:[]}):((s=r[o.filter]({after:u,limit:l,query:"posts"!==o.filter?c:null,tag:"posts"===o.filter?c.replace("#",""):null})).then(function(e){d=e.paging.itemsCount<l,u=e.paging.cursors.after}),s)}function f(){return o.infiniteScrollEnded?n.reject("No more results"):s=s.then(function(e){var t=e.data;return o.infiniteScrollEnded=d,o.results=o.results||[],o.results=_.uniqBy(o.results.concat(t),"id"),i.pushQueueSongs(o.results,p),m()})}"posts"===o.filter&&i.setState({loader:f,url:p}),m().then(o.loadMore),o.$on("$song:changed",function(e,t){"delete"===t.action&&(_.remove(o.results,{id:t.song.id}),o.results.length<l&&o.loadMore())})}]),angular.module("bandlab.search").directive("blSuggestions",["$animate","$compile","$templateRequest","$transitions","SearchHistory",function(e,t,n,o,a){return{restrict:"A",scope:{chooseSuggestionCallback:"&blChooseSuggestionCallback",blurOnSelect:"=blBlurOnSelect",history:"=blHistory",search:"=ngModel",suggestions:"=blSuggestions"},link:function(i,r,s){var c,l,u,d,p=angular.isDefined(s.blChooseSuggestionCallback),m="parent"===s.blSuggestionsContainer&&r[0].parentElement||r[0].closest("main")||r[0].closest(".view-overlay")||r[0].closest(".modal-overlay")||document.body,f=!!r[0].closest(".view-overlay"),h=r[0].closest(".view-overlay")?null:"down";function g(){u(),window.removeEventListener("mousedown",b),window.removeEventListener("resize",v),window.removeEventListener("wheel",v),c&&e.leave(c).then(function(){l=null,c=null})}function v(){var e=r[0].getBoundingClientRect();h||(h=e.bottom>window.innerHeight-200?"up":"down"),"parent"===s.blSuggestionsContainer?(c[0].style.left=0,c[0].style.top="100%"):(c[0].style.left="".concat(e.left,"px"),"down"===h?c[0].style.top="".concat(e.bottom+window.scrollY,"px"):c[0].style.bottom="".concat(window.innerHeight-e.top+window.scrollY,"px"))}function b(e){c[0].contains(e.target)||r[0].contains(e.target)||g()}function y(){i.active=null,d=null,_.forEach(i.suggestions,function(e,t){i.suggestions[t]=[]}),g()}i.isActive=function(e){return i.active===e},i.setActive=function(e,t){i.active=e,d=t},i.chooseSuggestion=function(e,t){i.blurOnSelect?r[0].blur():r[0].focus(),i.history&&a.push(e),p&&(t.preventDefault(),t.stopPropagation(),i.chooseSuggestionCallback({suggestion:e}),i.active=null)},i.clearHistory=function(e){e.stopPropagation(),a.clear(),i.suggestions["0history"]=[]},i.$watchCollection("suggestions",function(e){e&&e[d]&&(i.active=e[d][0],c&&(c[0].scrollTop=0))}),i.i18n={history:"History",users:"Users"},r.on("keydown mousedown",function(a){var h,w;(l=l||n(s.blTemplate).then(function(n){c=t('<div class="bl-suggestions-positioner">'.concat(n,"</div>"))(i),v(),e.enter(c,m,m.lastChild),window.addEventListener("mousedown",b),window.addEventListener("resize",v),u=o.onStart({},g),i.$on("$destroy",g),f&&window.addEventListener("wheel",v)})).then(v),_.chain(i.suggestions).some(function(e){return!_.isEmpty(e)}).value()&&document.activeElement===r[0]&&(d||(d=_.keys(i.suggestions).sort()[0]),40===a.which||38===a.which?(a.preventDefault(),h=_.indexOf(i.suggestions[d],i.active),h=40===a.which?h+1:h-1,i.active=i.suggestions[d][h],angular.isUndefined(i.active)&&(d=function e(t,n){var o=t.charAt(0),a=_.keys(i.suggestions).sort(),r=n?a[+o-1]:a[+o+1];return r=r||(n?a[a.length-1]:a[0]),i.suggestions[r].length>0?r:e(r,n)}(d,38===a.which),w=40===a.which?0:i.suggestions[d].length-1,i.active=i.suggestions[d][w]),function(e,t){var n=c[0].firstElementChild,o=n.querySelector(".mentions-suggestion.active"),a=i.suggestions[d].length-1;o&&(40===e.which&&t>4+n.scrollTop/32&&t<=a?n.scrollTop=n.scrollTop+o.offsetHeight:40===e.which&&t>=a&&(i.active=i.suggestions[d][a]),t>=0&&t+1<=n.scrollTop/32&&38===e.which?n.scrollTop=n.scrollTop-o.offsetHeight:t<0&&38===e.which&&(i.active=i.suggestions[d][0]))}(a,h)):13===a.which||9===a.which?(i.active&&(p||c[0].querySelector(".search-suggestion-item-active a").click(),i.chooseSuggestion(i.active,a),i.$apply()),y()):27===a.which?(y(),a.preventDefault()):i.active=null,i.$digest())})}}}]).filter("highlight",["$sce",function(e){return function(t,n){if(t){var o=n?t.replace(new RegExp(n.replace(/[^\w\s]/gi,""),"gi"),"<mark>$&</mark>"):t;return e.trustAsHtml(o)}}}]),angular.module("bandlab.search").directive("miniSearch",["$state",function(e){return{restrict:"A",require:"?ngModel",controller:["$scope",function(t){t.goToResults=function(t){angular.isDefined(t)&&""!==t&&e.go("search.results",{q:t})}}],link:function(e,t){angular.element(t[0].querySelector('button[type="submit"]')).on("click",function(e){t.hasClass("active")?(t.removeClass("active"),setTimeout(function(){document.querySelector(".tab-bar-title").style.display="block"},300)):(e.preventDefault(),document.querySelector(".tab-bar-title").style.display="none",t.addClass("active"),t[0].querySelector('input[type="search"]').focus())})}}}]),angular.module("bandlab.search").directive("searchSuggestions",["$rootScope","Search",function(e,t){return{restrict:"A",require:"ngModel",link:function(e,n,o,a){var i,r,s,c=!1;function l(){e.suggestions={"0users":[],"1tags":[]}}function u(n,o){c=!0,("users"===o?t.suggestedUsers({query:n,limit:15}):t.tags({query:n,limit:15})).then(function(t){var n=t.data;s||(e.suggestions="users"===o?{"0users":n,"1tags":[]}:{"0users":[],"1tags":n})}).finally(function(){c=!1,""===r||r===n||s||u(r,o)})}a.$formatters.push(function(e){return""===e&&l(),e}),a.$viewChangeListeners.push(function(){if(i=(i=a.$viewValue.substring(0,n[0].selectionStart)).replace(/\n/g," "),/\s$/.test(i))return l();i=(i=i.split(" "))[i.length-1],r=i.substring(1),"@"===i.charAt(0)&&r.length&&!s?c||u(r,"users"):"#"===i.charAt(0)&&r.length&&!s?c||u(r,"tags"):l(),s=!1}),e.completeMention=function(e){var t,o=e.username?e.username:e.name,i=a.$viewValue,c=i.substring(0,n[0].selectionStart-r.length),u=i.substring(n[0].selectionStart,i.length);l(),s=!0,a.$setViewValue("".concat(c+o," ").concat(u)),a.$render(),t=c.length+o.length+1,n[0].setSelectionRange(t,t)}}}}]),angular.module("bandlab.search.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("search",{url:"/search",redirectTo:"search.results",templateUrl:"https://www.bandlab.com/web-app/search/views/search-layout-e31c9d01.html"}).state("search.results",{url:"/:filter?q",params:{filter:"top",q:"bandlab",rewriteTracking:["$stateParams",function(e){return function(){return"/search/".concat(e.filter)}}]},templateUrl:"https://www.bandlab.com/web-app/search/views/search-results-79f42685.html",controller:"SearchResultsCtrl",resolve:{checkQuery:["$q","$transition$",function(e,t){var n;return-1===["bands","collections","communities","posts","projects","top","users"].indexOf(t.params().filter)?(n=0===t.params().q.indexOf("#")?"posts":0===t.params().q.indexOf("@")?"users":"top",e.reject({status:301,location:{name:"search.results",params:{filter:n,q:t.params().q}}})):e.resolve(!0)}]}})}]),angular.module("bandlab.search").factory("Search",["$http","$q",function(e,t){var n="https://www.bandlab.com/api/v1.3/search",o={limit:10};return{all:function(e){return a(n,e)},bands:function(e){return a("".concat(n,"/bands"),e)},collaborators:function(e){return a("".concat(n,"/collaborators"),e)},collections:function(e){return a("".concat(n,"/collections"),e)},communities:function(e){return a("".concat(n,"/communities"),e)},posts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.types,n=void 0===t?"image;link;revision;text;video":t,o=nn(e,["types"]);return a("https://www.bandlab.com/api/v1.3/posts",ko({types:n},o)).then(function(e){return e.data.forEach(function(e){e.revision&&(e.revision.postId=e.id)}),e})},projects:function(e){return a("".concat(n,"/songs"),e)},suggestedUsers:function(e){return a("https://www.bandlab.com/api/v1.3/mentions/suggestions",e)},tags:function(e){return a("".concat(n,"/tags"),e)},users:function(e){return a("".concat(n,"/users"),e)}};function a(t,n){return e({url:t,params:ko({},o,{},n),cache:!0,preservePagination:!0}).then(function(e){return e.data})}}]),angular.module("bandlab.search").factory("SearchHistory",function(){var e;try{e=JSON.parse(localStorage.history)}catch(t){e=[]}return{clear:function(){localStorage.removeItem("history"),e=[]},get:function(){return e},push:function(t){var n=_.find(e,function(e){return e.id===t.id});angular.isDefined(n)||(e.unshift(t),Modernizr.localstorage&&(localStorage.history=angular.fromJson(e)))}}}),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/service-worker.js?v=fc6cb5fbde"),navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage("window-load")}),angular.module("bandlab.shout",[]),angular.module("bandlab.shout").directive("backgroundCaptionTile",function(){return{restrict:"E",replace:!0,scope:{post:"="},templateUrl:"https://www.bandlab.com/web-app/shout/partials/_background-caption-tile-b5466fa8.html"}}),angular.module("bandlab.shout").directive("imageTile",function(){return{restrict:"E",replace:!0,scope:{image:"="},templateUrl:"https://www.bandlab.com/web-app/shout/partials/_image-tile-4b47ca53.html"}}),angular.module("bandlab.shout").directive("shoutCaption",["$q",function(e){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/shout/partials/_shout-caption-04274b84.html",link:function(t,n){var o,a=n[0].querySelector(".shout-caption-text"),i=a.querySelector("textarea");function r(e){var n=e.getCoordinates();e.preventDefault(),t.caption.left=o.div.left+(n.x-o.click.x),t.caption.bottom=o.div.bottom-(n.y-o.click.y),t.$digest(),o.dragged=!0}function s(e){e.preventDefault(),a.classList.remove("is-moving"),document.body.removeEventListener("mousemove",r),document.body.removeEventListener("mouseup",s),o.dragged||(t.editCaption(),t.$digest())}t.caption={color:"#fff",editable:!0,fontSize:50,left:0,text:"",bottom:190,visible:!1},t.toggleCaption=function(){t.caption.visible?t.caption.visible=!1:(t.caption.visible=!0,t.$broadcast("elastic:adjust"),t.editCaption())},t.changeSize=function(e){t.caption.fontSize=Math.max(8,Math.min(parseInt(100*e),100)),i.style.fontSize="".concat(t.caption.fontSize,"px"),i.style.lineHeight="".concat(1.4*t.caption.fontSize,"px"),t.$broadcast("elastic:adjust")},t.editCaption=function(){t.caption.editable=!0,setTimeout(function(){i.focus(),i.select()},100)},t.resetCaption=function(){t.caption={color:"#fff",editable:!0,fontSize:50,left:0,text:"",bottom:190,visible:!1}},t.rasterizeCaption=function(o){return function(o,a){if(!t.caption.text.length)return a;var i,r,s=e.defer(),c=o.querySelector("textarea"),l=new FileReader,u=c.getBoundingClientRect().top-n[0].getBoundingClientRect().top;return c.style.color=t.caption.color,c.innerHTML=t.caption.text,Array.prototype.forEach.call(o.children,function(e){"TEXTAREA"!==e.tagName&&e.remove()}),c.style.position="static",i='\n            <svg xmlns="http://www.w3.org/2000/svg" width="'.concat(a.canvas.width,'" height="').concat(a.canvas.height,'" viewBox="0 0 400 400">\n              <foreignObject width="100%" height="').concat(c.clientHeight,'" x="').concat(parseInt(t.caption.left),'" y="').concat(u,'">\n                <div xmlns="http://www.w3.org/1999/xhtml">').concat(o.outerHTML,"</div>\n              </foreignObject>\n            </svg>\n          "),r=new Blob([i],{type:"image/svg+xml;charset=utf-8"}),l.onload=function(){var e=new Image;e.onload=function(){a.drawImage(e,0,0,a.canvas.width,a.canvas.height),s.resolve(a)},e.src=l.result},l.onerror=function(e){s.reject(e)},l.readAsDataURL(r),s.promise}(a,o)},t.changeColor=function(){t.caption.color="#fff"===t.caption.color?"#282c32":"#fff",i.style.color=t.caption.color},t.$watch("caption.editable",function(){i.style.pointerEvents=t.caption.editable?"all":"none"}),t.$watch("caption.text",function(){t.caption.text=t.caption.text.replace(/(\r\n|\n|\r)/gm,"")}),a.addEventListener("keydown",function(e){13===e.which&&e.preventDefault()}),a.addEventListener("mousedown",function(e){t.caption.editable||(e.stopPropagation(),o={click:e.getCoordinates(),div:{bottom:t.caption.bottom,left:t.caption.left}},a.classList.add("is-moving"),document.body.addEventListener("mousemove",r),document.body.addEventListener("mouseup",s))}),a.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault()}),t.changeSize(t.caption.fontSize/100)}}}]),angular.module("bandlab.shout").component("shoutUploadStatus",{bindings:{onShoutUploaded:"="},controller:["$compile","$element","$scope","$state","$timeout","Me",function(e,t,n,o,a,i){var r=this;n.$on("Shout:uploading",function(s,c){if(function(e){return!e.band&&!e.community&&(o.is("feed")||o.is("user.feed",{username:i.username}))}(c)||function(e){return e.band&&o.is("band.feed",{username:e.band.username})}(c)||function(e){return e.community&&o.is("community.feed",{username:e.community.username})}(c))var l,u,d,p=(l=c,u=angular.element('<shout-progress upload="upload"></shout-progress>'),(d=n.$new()).upload=l,e(u)(d),t.prepend(u),u),m=n.$on("Shout:uploaded",function(e,t){var n="photo"===t.type?{image:{id:t.id}}:{video:{id:t.id}};angular.isFunction(r.onShoutUploaded)&&r.onShoutUploaded(n,p),m(),f()}),f=n.$on("Shout:uploadFailed",function(){a(function(){p.remove()},4e3),m(),f()})})}]}),angular.module("bandlab.shout").directive("shoutProgress",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/shout/partials/_shout-progress-56506507.html",scope:{upload:"="}}}),angular.module("bandlab.shout").factory("VideoTile",function(){var e={current:null};return window.addEventListener("storage",function(t){"playing"===t.key&&e.current&&e.current.pause()}),e}).directive("videoTile",["$analytics","$sce","Player","Video","VideoTile",function(e,t,n,o,a){return{restrict:"E",replace:!0,scope:{file:"=?",video:"=?"},templateUrl:"https://www.bandlab.com/web-app/shout/partials/_video-tile-f5c3ce99.html",link:function(i,r){var s=r[0].querySelector("video"),c=i.file?function(){s.src=URL.createObjectURL(i.file),i.video={status:"Ready"}}:_.once(function(){return o.getSource(i.video.id).then(function(e){s.src=t.trustAsResourceUrl(e)})});s.autoplay=i.video&&i.video.autoplay,i.isPlaying=s.autoplay,s.addEventListener("play",function(){i.isPlaying=!0,i.$digest(),n.pauseOtherTabs()}),s.addEventListener("pause",function(){i.isPlaying=!1,i.$digest()}),c(),i.togglePlay=function(){i.isPlaying?(s.pause(),i.isPlaying=!1,e.eventTrack("Pause",{category:"Video"})):(a.current&&a.current.pause(),s.play(),a.current=s,n.pause(),e.eventTrack("Play",{category:"Video"}),i.isPlaying=!0)}}}}]),angular.module("bandlab.shout").factory("Shout",["$analytics","$q","$rootScope","$state","AppNotifications","ClientDevice","FileHelper","Modal",function(e,n,o,a,i,r,s,c){return{createPhotoBoothModal:l,createShoutPost:function(e){var t=e.type,n=nn(e,["type"]),o=n.band||n.community;o&&o.$get?o.$get({id:o.id}).then(function(){o.isMember?u(t,n):i.addNotification({title:'You are not a member of "'.concat(o.name,'" anymore'),autoclose:5e3})}):u(t,n)},post:d};function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"photo";if(r.isMobile||r.isTablet)return a.go("unavailable",{notSupported:!0}),!1;var n=new c({id:"photoBoothModal",templateUrl:"https://www.bandlab.com/web-app/shout/partials/_photo-booth-modal-c674a03c.html",overlayClose:!1,contentScope:{capture:{type:t,isSquare:!0},submitCapture:e,stopCapture:function(){n.destroy()}}});return n}function u(n,o){var r=l(function(n){return r.destroy(),d(function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?Po(o,!0).forEach(function(n){t(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Po(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},n,{},o)).then(function(){e.eventTrack("Create Post",{category:"Post",label:"".concat(_.startCase(n.type)," from ").concat(n.import?" import":"camera")})}).catch(function(e){var t=_.get(e,"data.errorCode"),n=403===t?i18n(So()):_.get(e,"data.message");i.addNotification({title:"Unable to create post. Check your internet connection and try again.",content:n,classList:"alert",autoclose:5e3}),403===t&&a.go(".",a.params,{reload:!0})})},n);r&&r.show()}function d(e){var t="photo"===e.type?"images":"videos",a={autopost:!0,bandId:e.band&&e.band.id,caption:e.caption,communityId:e.community&&e.community.id};return"video"===e.type&&(a.clip={startPosition:e.start,duration:e.end-e.start},e.file=[e.file,e.previewFile]),o.$broadcast("Shout:uploading",e),s.upload(e.file,"https://storage.bandlab.com/v1.3/".concat(t),{},a).then(function(t){e.id=t.data.id,e.success=!0,o.$broadcast("Shout:uploaded",e)}).catch(function(t){return o.$broadcast("Shout:uploadFailed"),e.error=t,n.reject(t)})}}]),angular.module("bandlab.shout").factory("Video",["$http",function(e){return{getSource:function(t){return e.get("https://storage.bandlab.com/v1.3/videos/"+t).then(function(e){return e.data.url})}}}]),angular.module("bandlab.show.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("show",{url:"/{username}/shows/{slug}",templateUrl:"https://www.bandlab.com/web-app/show/views/show-page-8507a3f5.html",controller:["$cookies","$scope","$state","$transition$","$window","authService","Me","Show",function(e,t,n,o,a,i,r,s){var c=o.params(),l=c.slug,u=c.username;s.head({slug:l,username:u}).$promise.then(function(){O("https://cdn.jsdelivr.net/npm/hls.js@latest").then(function(){return O("https://www.bandlab.com/web-app/scripts/show-script-1a1ef9bcf8.js")}).then(function(){a.renderShowPage({sessionKey:e.get("sessionKey"),slug:l,username:u,viewer:r,showUnauthorizedModal:i.displayAuthModal,confirmEmail:i.displayConfirmationEmailError})}),t.$on("$destroy",function(){a.unmountShowPage()})}).catch(function(e){404===e.status&&n.go("404",{},{location:"replace"})})}]})}]),angular.module("bandlab.web").controller("ShowCreateCtrl",["$analytics","$rootScope","$scope","$state","$timeout","AppNotifications","ChatHelper","Me","Post","Show",function(e,t,o,a,i,r,s,c,l,u){var d=c;function p(e){i(function(){o.isLoading=!1,a.go("show",{slug:e.slug,username:e.creator.username})},1e3)}function m(){return o.show.$save({id:d.id}).then(function(n){return t.$broadcast("createShowModal","close"),t.$broadcast("$show:changed",{action:"create",show:n}),e.eventTrack("Create Show",{category:"Show"}),o.show.notify||p(n),n}).catch(function(e){return o.isLoading=!1,o.showForm.$setPristine(),o.errorMessage=e.data.message,403===e.status&&(o.error="suspended"),Promise.reject(e)})}o.show=new u({name:"".concat(d.name,"'s Show"),state:"Starting"}),o.createShow=function(){return delete o.errorMessage,o.isLoading=!0,o.show.notify?m().then(function(t){return function(t){var i={caption:"Streaming at: https://www.bandlab.com/".concat(d.username,"/shows/").concat(t.slug,"  🎬  #liveonbandlab")};s.getLinkPreview("https://www.bandlab.com/".concat(d.username,"/shows/").concat(t.slug)).then(function(s){var c=n(s,1)[0];return i.link=c.object,l.createPost({caption:i.caption,id:d.id,entity:"users",link:i.link,backgroundId:null}).$promise.then(function(){e.eventTrack("Create Post",{category:"Post",label:"Show Link"}),a.includes("feed")||(r.addNotification({autoclose:5e3,content:"Shout published",title:"Upload complete"}),o.show.notify&&p(t))}).catch(function(){a.includes("feed")||r.addNotification({autoclose:5e3,content:"Unable to publish shout",classList:"alert",title:"Unable to upload. Check your internet connection and try again."})})})}(t)}):m()}}]),angular.module("bandlab.web").factory("Show",["$resource",function(e){var t="https://www.bandlab.com/api/v1.3/shows";return e(t,{},{save:{method:"POST",params:{id:"@id"},url:"https://www.bandlab.com/api/v1.3/users/:id/shows"},delete:{method:"DELETE",params:{id:"@id"},url:"".concat(t,"/:id")},head:{method:"HEAD",params:{slug:"@slug",username:"@username"},url:"https://www.bandlab.com/api/v1.3/users/:username/shows/:slug"}})}]),angular.module("bandlab.song",[]),angular.module("bandlab.song").controller("ProjectCollaboratorsCtrl",["$scope","ConfirmModal","Invite","Me","User",function(e,t,n,o,a){function i(){a.getCollaborators({songId:e.song.id,accepted:!0,limit:50}).$promise.then(function(t){e.collaborators=_.reject(t,function(e){return e.id===o.id})})}function r(){n.query({id:e.song.id,entity:"songs",accepted:!1,limit:50}).$promise.then(function(t){e.pendingInvitedUser=[],e.pendingInvitedExternalUser=[],t.forEach(function(t){var n;t.user?((n=new a(t.user)).invite=t,e.pendingInvitedUser.push(n)):((n=new a({email:t.email})).invite=t,e.pendingInvitedExternalUser.push(n))})})}e.removeCollaborator=function(n){new t({confirmLabel:"Remove",contentScope:{title:"Remove this collaborator?",message:"<p>".concat("".concat(n.name," will lose access to the existing project."),"</p>")},onConfirm:function(){e.song.$leave({id:e.song.id,userId:n.id}).then(function(){i()})}}).show()},e.$on("$invite:changed",function(){i(),r()}),i(),r()}]),angular.module("bandlab.song").controller("ProjectEditCtrl",["$analytics","$rootScope","$scope","$state","AppNotifications","Band","ConfirmModal","Me","Modal","PlayerHistory","Song",function(e,t,n,o,a,i,r,s,c,l,u){function d(){return t.$broadcast("$song:changed",{action:"mark-deleted",song:n.song}),new u(n.song).$delete().then(function(){l.removeSong(n.song.id),t.$broadcast("$song:changed",{action:"delete",song:n.song}),e.eventTrack("Delete Song",{category:"Song"}),o.current.name.match(/(song\.edit|userSong|bandSong)/)&&o.go("user.feed",{username:s.username})}).catch(function(e){t.$broadcast("$song:changed",{action:"unmark-deleted",song:n.song}),a.addNotification({title:"Cannot delete project",content:_.get(e,"data.message")||_.get(e,"message","Unknown error"),autoclose:5e3,classList:"alert"})})}n.songBackup=n.song,n.song=_.assignIn({},n.song),n.changeSuccess=!1,n.changeError=!1,n.getBands=function(){n.bands=i.fromUser({userId:s.id,limit:50})},n.createBandFirst=function(){var e=n.$on("$band:changed",function(e,t){"create"===t.action&&n.bands.unshift(t.band)});return new c({id:"createBandModal",templateUrl:"https://www.bandlab.com/web-app/band/partials/_band-new-39b910b2.html",onConfirm:function(){return e()}}).show()},n.moveProject=function(){var a={id:n.song.id,bandId:n.songForm.bandId.$modelValue},i=new r({confirmLabel:"Move",contentScope:{title:"Move This Project?",message:"<p>".concat("You won’t be able to undo this action.","</p>")},onConfirm:function(){n.moveError=!1,n.movePending=!0,n.moveSuccess=!1,u.update(a).$promise.then(function(a){n.movePending=!1,_.assignIn(n.song,a),e.eventTrack("Move Song",{category:"Song"}),t.$broadcast("$song:changed",{action:"move",song:n.song}),"library.projects.songs"!==o.current.name?(n.moveSuccess=!0,o.go("library.projects.songs",{category:a.author.username})):(t.$broadcast("moveProjectModal","close"),i.destroy())}).catch(function(){n.songForm.$setPristine(),n.moveError=!0,n.movePending=!1})},onDestroy:function(){n.songForm.$setPristine()}});i.show()},n.updateSong=function(){var o={description:n.song.description||"",id:n.song.id,isForkable:n.song.isForkable,name:n.song.name,slug:n.song.slug};u.update(o).$promise.then(function(o){_.assignIn(n.songBackup,o),n.song=o,n.changeSuccess=!0,t.$broadcast("$song:changed",{action:"update",id:n.song.id,song:n.song}),t.$broadcast("renameProjectModal","close"),e.eventTrack("Update Song",{category:"Song"})}).catch(function(){n.changeError=!0})},n.confirmDeleteProject=function(){n.beforeDelete=!0,new r({confirmLabel:"Delete",contentScope:{title:"Delete this project?",message:"<p>".concat("You can restore your project within the next 30 days from the Settings page.","</p>")},onConfirm:d,onDestroy:function(){n.beforeDelete=!1}}).show()},n.confirmLeaveProject=function(){new r({confirmLabel:"Leave",contentScope:{title:"Leave Collaboration",message:"<p>".concat(i18n(Eo()),"</p>")},onConfirm:function(){n.song.$leave({id:n.song.id,userId:s.id}).then(function(){t.$broadcast("$song:changed",{action:"leave",song:n.song}),e.eventTrack("Leave Song",{category:"Song"})})}}).show()},n.restoreProject=function(e){return t.$broadcast("$song:changed",{action:"mark-deleted",song:e}),u.update({id:e.id,status:"Active"}).$promise.then(function(e){t.$broadcast("$song:changed",{action:"restore",song:e}),a.addNotification({title:"Project restored",content:"Your project has been restored to your Library.",image:e.picture.xs,action:'\n              <div ng-click="hide()">\n                <a href="'.concat(o.href("".concat(e.author.type.toLowerCase(),"Song"),{username:e.author.username,slug:e.slug}),'">').concat("View","</a>\n              </div>\n            "),classList:"project",autoclose:5e3})}).catch(function(n){t.$broadcast("$song:changed",{action:"unmark-deleted",song:e}),a.addNotification({title:"Cannot restore project",content:_.get(n,"data.message")||_.get(n,"message","Unknown error"),autoclose:5e3,classList:"alert"})})}}]),angular.module("bandlab.song").controller("RevisionDownloadCtrl",["$analytics","$q","$sce","$scope","EditorLoader","FileHelper","Modal","Revision","Sample",function(e,t,n,o,a,i,r,s,c){o.openDownloadModal=function(e){new r({templateUrl:"https://www.bandlab.com/web-app/song/partials/_download-mixdown-modal-e6c80f37.html",contentScope:{revision:e}}).show()},o.openDownloadStemsModal=function(o){function a(e){return c.getJSON("tracks/".concat(e.mixdown.id,"?format=m4a")).then(function(t){e.mixdown.src=n.trustAsResourceUrl(t.value)})}t.resolve(o.tracks?o:s.get({id:o.id}).$promise).then(function(e){_.chain(e.tracks).filter("mixdown").map(a).value(),new r({templateUrl:"https://www.bandlab.com/web-app/song/partials/_download-stems-modal-69849167.html",contentScope:{revision:e}}).show()}),e.eventTrack("Download Stems",{category:"Revision"})},o.downloadMixdown=function(t,n){var r="original"===n.version?_.get(t,"mastering.drySampleId",t.mixdown.id):t.mixdown.id,s=a.pushTask("downloadRevision");return c.getDownloadUrl({type:"revision",sampleId:r,format:n.extension,res:n.res}).then(i.download).then(function(i){var r="".concat(t.song.author.name," - ").concat(t.song.name," (").concat(n.version,")");r=r.replace(/[.\/?<>\\:*|":]/g,"_").substring(0,255),saveAs(i,r),e.eventTrack("Download Mixdown",{category:"Revision"}),a.finishTask(s),setTimeout(function(){o.confirm()},500)}).catch(function(){a.flushQueue()})}}]),angular.module("bandlab.song").controller("RevisionEditCtrl",["$analytics","$rootScope","$scope","Me","Post","Revision",function(e,t,n,o,a,i){var r=n.$parent.revision;n.me=o,n.revision=new i({description:r.description,genres:r.genres,id:r.id,isPublic:r.isPublic,mastering:r.mastering,mixdown:r.mixdown,place:r.place}),a.get({id:r.postId}).$promise.then(function(e){n.revision.isExplicit=e.isExplicit,n.revision.availabilitySetting=e.state,"Private"===n.revision.availabilitySetting&&!1===n.canBePrivate&&(n.revision.availabilitySetting="Public")}),n.place=r.place,n.editRevision=function(o){var s=n.revision.isExplicit,c=n.revision.availabilitySetting;return n.place?n.revision.placeId=n.place.id:n.revision.placeId=null,delete n.errorMessage,a.update({id:r.postId,isExplicit:s,state:c}).$promise.then(function(e){return n.revision.post=e,i.update({description:n.revision.description,genres:n.revision.genres,id:n.revision.id,mastering:n.revision.mastering,mixdown:n.revision.mixdown,placeId:n.revision.place&&n.revision.place.id}).$promise.then(function(t){return _.assign(t.post,e),t})}).then(function(n){return _.assignIn(r,n),t.$broadcast("$revision:changed",{action:"edit",revision:r}),t.$broadcast("editRevisionModal","close"),e.eventTrack("Update Revision",{category:"Revision"}),n}).catch(function(e){n.errorMessage=_.get(e,"data.message","Please try again"),o.$setPristine()})}}]),angular.module("bandlab.song").controller("RevisionForksCtrl",["$q","$scope","Post",function(e,t,n){var o,a=10,i=0,r=!1;if(0===t.revision.counters.forks)return t.infiniteScrollEnded=!0,void(t.posts=[]);function s(){return r?e.resolve([]):((o=n.fromRevisionForks({revisionId:t.revision.id,offset:i,limit:a}).$promise).then(function(e){r=0===e.length||e.length<a,i+=e.length}),o)}t.loadMore=function(){return t.infiniteScrollEnded?e.reject("No more results"):o=o.then(function(e){return t.infiniteScrollEnded=r,t.posts=t.posts||[],t.posts=t.posts.concat(e),s()})},s().then(t.loadMore)}]),angular.module("bandlab.song").controller("RevisionMasterCtrl",["$q","$scope","Modal","RevisionImporter",function(e,t,n,o){function a(t){new n({templateUrl:"https://www.bandlab.com/web-app/contact/partials/mastering-contact-professional-b42ca3c0.html",contentScope:{revision:t},onConfirm:function(){return e.resolve()}}).show()}t.masterRevision=o.masterRevision,t.showMasteringModal=function(t){new n({id:"masteringModal",templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-mastering-89a12eae.html",contentScope:{revision:t,masterRevision:o.masterRevision,showContactProfessionalsModal:a,activeOption:2},onConfirm:function(){return e.resolve()}}).show()}}]),angular.module("bandlab.song").controller("RevisionMetadataFormCtrl",["$scope","Me",function(e,t){if(e.me=t,!e.revision||!e.revision.song)throw new Error("Revision and Song must be provided");if(!e.resolve)throw new Error("A resolve callback function must be provided");e.revision.availabilitySetting=e.canBePrivate?"Private":"Public",e.$watch("revision.song.isForkable",function(t){t&&(e.displayAdvancedSettings=!0,e.revision.availabilitySetting="Public")}),e.$on("$file:uploadSuccess",function(t,n){e.displayPictureUpload=!1,e.revision.song.pictureId=n.id,e.revision.song.picture=n,e.revisionForm.$setDirty()}),e.displayPictureUpload=!1,e.$on("$ngFile:fileChanged",function(){e.displayPictureUpload=!0}),e.setRevisionData=function(){e.place?e.revision.placeId=e.place.id:e.revision.placeId=null,e.revision.isExplicit&&(e.revision.post={isExplicit:!0}),e.resolve(e.revision),e.revisionForm.$setPristine()}}]),angular.module("bandlab.song").controller("RevisionPageCtrl",["$location","$scope","$state","Me","Modal","PlayerHistory","RevisionSocket","Song","theRevision","User",function(e,t,n,o,a,i,r,s,c,l){var u=e.url();t.me=o,t.revision=c,t.getLikers=function(e){return _.assign(e,{entity:"posts",entityId:t.revision.postId}),l.likers(e).$promise},i.setState({loader:null,url:u}),i.pushQueueSongs([{creator:c.creator,type:"Revision",id:c.postId,revision:c}],u),t.revision.isFork&&t.revision.song.originalSongId&&s.get({id:t.revision.song.originalSongId}).$promise.then(function(e){t.originalSong=e}),"Ready"!==c.mixdown.status&&(r.join({mixdownId:c.mixdown.id}),t.$on("$destroy",r.disconnect)),n.params.download&&"Ready"===c.mixdown.status&&c.canEdit&&new a({templateUrl:"https://www.bandlab.com/web-app/song/partials/_download-mixdown-modal-e6c80f37.html",contentScope:{revision:c}}).show(),t.$on("$mixdown:changed",function(e,n){t.revision.mixdown=n.mixdown}),t.$on("$song:changed",function(e,t){"delete"===t.action?n.go("library.projects.songs",{category:"recent"}):"leave"===t.action&&n.go(".",{},{reload:!0})}),t.$on("$revision:changed",function(e,n){t.revision=n.revision,"master"===n.action&&(r.disconnect(),r.join({mixdownId:t.revision.mixdown.id}))})}]),angular.module("bandlab.song").controller("RevisionSharePrivateCtrl",["$analytics","$scope","$state","Modal","Post",function(e,t,n,o,a){t.displayPrivateLink=function(t){a.getPrivateLink({id:t.postId}).$promise.then(function(i){e.eventTrack("Get Private Link",{category:"Revision"});var r={shareUrl:n.href("revisionSharedKey",{id:i.sharedKey},{absolute:!0})};return new o({contentScope:{modalData:r,renewLink:function(){a.getNewPrivateLink({id:t.postId}).$promise.then(function(t){e.eventTrack("Get New Private Link",{category:"Revision"}),r.shareUrl=n.href("revisionSharedKey",{id:t.sharedKey},{absolute:!0})})}},template:'\n              <div>\n                <header class="modal-header">\n                  <h2>'.concat("Share Private Link",'</h2>\n                </header>\n                <div class="modal-content modal-content-medium">\n                  <p style="font-size: 40px;">&#128584;</p>\n                  <p>').concat("Just copy and paste the following link:",'</p>\n                  <div class="form-field">\n                    <div class="share-copy-link-container">\n                      <input class="share-copy-link" type="text" readonly ng-model="modalData.shareUrl">\n                      <button type="button" class="scs lg single right" clipboard text="modalData.shareUrl" ng-click="isShareUrlCopied = true">').concat("Copy",'</button>\n                    </div>\n                    <div ng-show="isShareUrlCopied" class="field-info">').concat("Copied to clipboard",'</div>\n                  </div>\n                  <div class="form-field">\n                    <div class="field-label">\n                      <label><a ng-click="renewLink()">').concat("Get New Link",'</a></label>\n                      <div class="field-info">').concat("Note: Anyone with the old link will not be able to access this revision.",'</div>\n                    </div>\n                  </div>\n                  <button class="ctrd single" zf-close>').concat("Close","</button>\n                </div>\n              </div>\n            ")}).show()})}}]),angular.module("bandlab.song").controller("RevisionUnpublishCtrl",["$analytics","$rootScope","$scope","ConfirmModal","Post",function(e,t,n,o,a){n.unpublishRevision=function(n){new o({confirmLabel:"Make Private",contentScope:{title:"Make Revision Private",message:"<p>".concat("Making your revision private will prevent this post from appearing on public feeds.","</p>")},onConfirm:function(){return a.update({id:n.postId,state:"Private"}).$promise.then(function(o){n.isPublic=!1,n.post=o,t.$broadcast("$revision:changed",{action:"unpublish",revision:n}),e.eventTrack("Update Revision",{category:"Revision",label:"Unpublish"})})}}).show()}}]),angular.module("bandlab.song").component("fork",{bindings:{revision:"<",song:"<"},transclude:!0,template:'<div ng-click="vm.displayForkModal()" ng-transclude></div>',controller:["$rootScope","appActions","MessageModal","Modal","Song",function(e,t,n,o,a){var i=this;function r(t){var n=(new Date).getTime();a.fork({revisionId:t}).$promise.then(function(t){i.forkedSong=t,i.forkResult="success",ga("send","timing","Revision","Fork",(new Date).getTime()-n),e.$broadcast("$song:changed",{action:"create",song:t})}).catch(function(e){i.forkResult="error",60===e.code?i.errorStatus="notFound":140===e.code?i.errorStatus="notAllowed":403===e.code&&(i.errorStatus="notPermitted")})}i.displayForkModal=function(){if(t.checkAllowed("fork")){var e=_.get(i,"revision.id")||_.get(i,"song.revision.id");e?r(e):i.song?a.get({id:i.song.id}).$promise.then(function(e){return r(e.revision.id)}).catch(function(){i.forkResult="error"}):i.forkResult="error",new o({id:"songForkModal",templateUrl:"https://www.bandlab.com/web-app/song/partials/_song-fork-208c35ad.html",contentScope:{vm:i}}).show()}}}],controllerAs:"vm"}),angular.module("bandlab.song").component("forkDetails",{bindings:{forkedRevision:"=",song:"="},templateUrl:"https://www.bandlab.com/web-app/song/partials/_fork-details-c05851f0.html",controller:["Revision",function(e){var t=this;t.$onInit=function(){e.get({id:t.song.original.revisionId}).$promise.then(function(e){t.originalRevision=e}).catch(function(){t.originalRevision=null})}}],controllerAs:"vm"}),angular.module("bandlab.song").component("revisionCreatorPopover",{bindings:{revision:"<"},templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-creator-popover-1d0e682e.html",controllerAs:"vm"}),angular.module("bandlab.song").directive("projectFormName",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/song/partials/_project-form-name-20743ab1.html"}}).directive("revisionFormAvailability",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-form-availability-f53939d4.html"}}).directive("revisionFormDescription",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-form-description-0574a325.html"}}).directive("revisionFormFork",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-form-fork-5a60ac12.html"}}).directive("revisionFormExplicit",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-form-explicit-49d15104.html"}}).directive("revisionFormGenre",function(){return{restrict:"E",replace:!0,scope:{revision:"="},templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-form-genre-4de4407f.html",controller:["$scope","Tag",function(e,t){e.revision.genres=e.revision.genres||[],e.revision.genres[0]||(e.revision.genres[0]={id:"other",name:"Other"}),e.genre=e.revision.genres[0],t.getGenres().then(function(t){e.genres=t})}]}}).directive("revisionFormListing",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-form-listing-1af586a9.html"}}).directive("revisionFormLocation",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-form-location-57803559.html"}}).directive("revisionFormMasteringExisting",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-form-mastering-existing-ff2130d8.html",scope:{revision:"="},controller:["$scope",function(e){function t(e){return e?{"cd-master":"auto",cdMaster:"auto","bass-boost":"manual",bassBoostMastering:"manual",custom:"manual","enhance-clarity":"manual",enhanceClarity:"manual"}[e.preset]:"off"}e.originalMastering=e.revision.mastering,e.masteringSetting=t(e.originalMastering),e.$on("$revision:changed",function(n,o){var a=o.revision;e.masteringSetting=t(a.mastering),e.revision.mastering=a.mastering,e.originalMastering=a.mastering})}]}}).directive("revisionFormMasteringNew",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-form-mastering-new-d5a59896.html"}}).directive("revisionFormKey",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-form-key-b434730a.html",controller:["$scope",function(e){e.revision.key=e.revision.key||null,e.keys=[null].concat(He(m),He(f)).map(function(e){return{value:e,label:e||"-"}})}]}}).directive("revisionFormBpm",function(){return{restrict:"E",replace:!0,templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-form-bpm-d61408db.html",controller:["$scope",function(e){e.revision.metronome.bpm=e.revision.metronome.bpm||120}]}}),angular.module("bandlab.song").component("revisionImporter",{bindings:{bandId:"<",parentRevision:"<",redirectTo:"@"},transclude:!0,template:'\n      <div ng-click="vm.selectFile($event);" title="Upload File">\n        <div ng-transclude></div>\n        <input\n            type="file"\n            class="revision-importer-file-input visually-hidden"\n            accept="audio/*"\n            ng-file="soundFile"\n            onclick="event.stopImmediatePropagation();">\n      </div>\n    ',controller:["$analytics","$injector","$rootScope","$state","$timeout",function(e,t,n,o,a){var i,r=this;r.$onDestroy=function(){i&&i()},r.selectFile=function(s){s.stopImmediatePropagation(),i&&i(),i=n.$on("$ngFile:fileChanged",function(s,c){i(),function(i){n.$broadcast("$dropdownMenu:close");var s=t.get("RevisionImporter");e.eventTrack("Upload New Revision",{category:"Revision"}),s.createRevisionFromFile(i,{bandId:r.bandId,parentRevision:r.parentRevision}).then(function(e){return a(function(){return"userSong"===r.redirectTo?o.go("userSong",{username:e.creator.username,slug:e.song.slug,revId:e.id}):o.go("songId",{id:e.song.id})},1e3)}).finally(function(){n.$broadcast("$dropdownMenu:close")})}(c[0])}),setTimeout(function(){document.querySelector(".revision-importer-file-input").click()},0)}}],controllerAs:"vm"}),angular.module("bandlab.song").component("revisionMobilePromoCard",{bindings:{revision:"<"},templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-mobile-promo-card-d7879266.html",controllerAs:"vm",controller:["Me",function(e){this.me=e}]}),angular.module("bandlab.song").component("revisionPlayerAudio",{bindings:{currentTime:"<",revision:"<"},templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-player-audio-32bc3150.html",controllerAs:"vm",controller:["$analytics","Revision",function(e,t){this.$onInit=function(){this.revision.isRecentlyUpdated=(new Date-new Date(this.revision.modifiedOn))/1e3/60/10<1},this.reprocessMixdown=function(n){var o=this;return e.eventTrack("Reprocess Mixdown",{category:"Revision"}),t.reprocessMixdown({revisionId:n}).$promise.then(function(){o.revision.isRecentlyUpdated=!0})}}]}).component("revisionCoverPlayerAudio",{bindings:{currentTime:"<",revision:"<"},templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-cover-player-audio-493e3512.html",controllerAs:"vm",controller:["$analytics","Revision",function(e,t){this.$onInit=function(){this.revision.isRecentlyUpdated=(new Date-new Date(this.revision.modifiedOn))/1e3/60/10<1},this.reprocessMixdown=function(n){var o=this;return e.eventTrack("Reprocess Mixdown",{category:"Revision"}),t.reprocessMixdown({revisionId:n}).$promise.then(function(){o.revision.isRecentlyUpdated=!0})}}]}),angular.module("bandlab.song").directive("revisionPlayerSmall",function(){return{restrict:"E",replace:!0,scope:{revision:"=revision"},transclude:!0,templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-player-small-bff70e12.html",controller:["$scope",function(e){"User"===e.revision.song.author.type?e.user=e.revision.song.author:e.band=e.revision.song.author}]}}),angular.module("bandlab.song").component("revisionProfilePopover",{bindings:{revision:"<"},templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-profile-popover-e94f661b.html",controller:["Me","User",function(e,t){var n=this;n.me=e,n.getLikers=function(e){return _.assign(e,{entity:"posts",entityId:n.revision.postId}),t.likers(e).$promise}}],controllerAs:"vm"}),angular.module("bandlab.song").component("revisionTile",{bindings:{blur:"<",collection:"<",currentTime:"<",post:"<",revision:"<"},templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-tile-fbac81cd.html",controller:["Me",function(e){var t=this;t.$onInit=function(){t.revision.post=t.post},t.me=e}],controllerAs:"vm"}).component("revisionTileDescription",{bindings:{revision:"="},templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-tile-description-9da82a7c.html",controller:["Me",function(e){this.me=e}],controllerAs:"vm"}).component("revisionTileSocial",{bindings:{post:"=",revision:"="},templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-tile-social-0bda2332.html",controller:["Me","User",function(e,t){var n=this;n.me=e,n.getLikers=function(e){return _.assign(e,{entity:"posts",entityId:n.revision.postId}),t.likers(e).$promise}}],controllerAs:"vm"}).component("revisionCover",{bindings:{blur:"<",collection:"<",currentTime:"<",post:"<",revision:"<"},templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-cover-ab335285.html",controller:["Me","Player",function(e,t){var n=this;n.$onInit=function(){n.revision.post=n.post},n.isPlaying=function(){var e=t.getCurrentSong();return n.revision.id===e.id},n.me=e}],controllerAs:"vm"}),angular.module("bandlab.song").directive("revisionTileSmall",function(){return{restrict:"E",replace:!0,scope:{revision:"="},templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-tile-small-b02e54a0.html"}}),angular.module("bandlab.song").component("songLink",{bindings:{dynamic:"<",song:"<",revision:"<",revisionId:"<"},transclude:!0,template:'<a ng-href="{{ vm.url }}" ng-transclude></a>',controller:["$element","$state",function(e,t){var n=this;function o(){n.url=a(),e[0].querySelector("a").href=n.url}function a(){return t.href("".concat(n.song.author.type.toLowerCase(),"Song"),{username:n.song.author.username,slug:n.song.slug,revId:n.revisionId?n.revisionId:n.revision?n.revision.id:null})}n.$onInit=function(){n.url="Deleted"!==n.song.status?a():null,n.$onChanges=n.dynamic?o:angular.noop}}],controllerAs:"vm"}),angular.module("bandlab.song").component("songMastering",{bindings:{revision:"<"},transclude:!0,template:'\n      <div ng-click="vm.selectFile($event);" title="Upload File">\n        <div ng-transclude></div>\n        <input\n            type="file"\n            class="song-mastering-file-input visually-hidden"\n            accept="audio/*"\n            ng-file="soundFile"\n            onclick="event.stopImmediatePropagation();">\n      </div>\n    ',controller:["$rootScope","$state","AppNotifications","EditorLoader","Revision","Sample",function(e,t,n,o,a,i){var r,s=this;s.$onDestroy=function(){r&&r()},s.selectFile=function(c){c.stopImmediatePropagation(),r&&r(),r=e.$on("$ngFile:fileChanged",function(c,l){var u,d;r(),u=l[0],d=o.pushTask("uploadMixdown"),a.update({id:s.revision.id,mastering:{preset:"custom"}}).$promise.then(function(t){return e.$broadcast("$revision:changed",{action:"master",revision:t}),i.upload({blob:u,sampleId:t.mixdown.id,sampleType:"revisions"})}).then(function(){o.finishTask(d),e.$broadcast("masteringModal","close"),setTimeout(function(){t.go(".",t.params,{reload:!0})},1e3)}).catch(function(e){o.flushQueue(),n.addNotification({title:"Cannot master track",content:e.message,autoclose:5e3})})}),setTimeout(function(){document.querySelector(".song-mastering-file-input").click()},0)}}],controllerAs:"vm"}),angular.module("bandlab.song").directive("songRevisionsFeed",["$rootScope",function(e){return{restrict:"C",link:function(t,n){var o,a,i=!1;function r(e){return!(!e||e.classList.contains("selected")||(a&&a.classList.remove("selected"),e.classList.add("selected"),a=e,0))}t.$on("TreeView:revisionSelected",function(e,t){var o,a=n[0].querySelector('[data-rev-id="'.concat(t.revId,'"]'));r(a)&&(i=!0,(o=a)===n[0].querySelector("[data-rev-id]")?n[0].scrollTop=0:n[0].scrollTop=o.offsetTop-Math.max((n[0].clientHeight-o.clientHeight)/2,0),setTimeout(function(){i=!1},1200))}),n[0].addEventListener("scroll",function(){o||i||(o=!0,requestAnimationFrame(function(){var t,a,i,s=(i=(t=n[0]).getBoundingClientRect(),t.scrollTop<150?t.querySelector("[data-rev-id]:first-child"):Math.abs(t.scrollHeight-t.clientHeight-t.scrollTop)<80?t.querySelector("[data-rev-id]:last-child"):(a={x:i.left+i.width/2,y:i.top+i.height/2},document.elementFromPoint(a.x,a.y).closest("[data-rev-id]")));r(s)&&e.$broadcast("SongRevisionsFeed:revisionSelected",{revId:s.dataset.revId}),o=!1}))}),n[0].addEventListener("mousedown",function(t){var n=t.target.closest("[data-rev-id]");n&&requestAnimationFrame(function(){r(n),e.$broadcast("SongRevisionsFeed:revisionSelected",{revId:n.dataset.revId})})},!0)}}}]).controller("SongRevisionsFeedCtrl",["$location","$scope","$timeout","PlayerHistory","Post","theSong",function(e,t,n,o,a,i){var r,s,c=[],l=e.url();function u(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).after;return a.fromSong({songId:t.song.id,after:e}).$promise}o.setState({loader:u,url:l}),t.song=i,t.revisionsTreeView=[],r=t.$on("TreeView:revisionSelected",function(e,t){s=t.revId}),function e(i){return i().then(function(i){var d=i.paging,p=i.data;if(c=c.concat(p),o.pushQueueSongs(c,l),!(d.itemsCount<d.limit))return e(function(){return u(d.cursors)});t.revisionsTreeView=_.map(c,function(e){return e.revision}).reverse(),c.length&&c[c.length-1].revision.isFork&&(t.forkedRevision=c.pop().revision),t.revisionsFeed=c,t.$on("$revision:changed",function(e,o){"create"===o.action&&a.get({id:o.revision.postId}).$promise.then(function(e){t.revisionsFeed.unshift(e),n(function(){t.$emit("TreeView:revisionSelected",{revId:o.revision.id})},100)})}),n(function(){r(),t.$emit("TreeView:revisionSelected",{revId:s})},500)})}(u)}]),angular.module("bandlab.song").component("timeMarkers",{bindings:{revision:"<"},templateUrl:"https://www.bandlab.com/web-app/song/partials/_time-markers-135e76f2.html",controllerAs:"vm",controller:["$analytics","$element","$scope","Player",function(e,t,n,o){var a=this,i=t[0].closest("revision-player-audio"),r=t[0].parentNode.querySelector("canvas");a.tempComment=null,a.comments=[],a.markers=[],a.goToTimeAndPlay=function(t){o.goToTimeAndPlay(a.revision,t.time),e.eventTrack("Time Marker Click",{category:"Revision",label:"Waveform Marker"})};var s=_.debounce(function(){a.markers=_.chain(a.comments).concat(a.tempComment).compact().map(function(e){return function(e){var t=e.timestamp,n=void 0===t?0:t,o=e.comment,i=a.revision.mixdown.duration,s=n>=i?0:n,c=s/i;if(s)return{comment:Mo({},o,{truncate:!1}),revision:a.revision,time:s,left:9*Math.floor(c*(r.clientWidth-8)/9)}}({timestamp:e.timestamp,comment:e})}).compact().sortBy("left").uniqBy("left").value(),a.markers.length?i.classList.add("has-time-markers"):i.classList.remove("has-time-markers"),n.$applyAsync()},100);n.$on("$comments:loaded",function(e,t){var n=t.revision,o=t.comments;n.id===a.revision.id&&(a.comments=o,s())}),n.$on("$timeMarker:addTempTimeMarker",function(e,t){var n=t.revisionId,o=t.comment;a.revision.id===n&&(a.tempComment=o,s())}),n.$on("$timeMarker:removeTempTimeMarkers",function(){a.tempComment&&(a.tempComment=null,s())}),window.addEventListener("resize",s),n.$on("$destroy",function(){window.removeEventListener("resize",s)})}]}),angular.module("bandlab.song").directive("treeView",["$rootScope",function(e){return{restrict:"E",replace:!0,scope:{revisions:"=",revision:"=",song:"="},templateUrl:"https://www.bandlab.com/web-app/song/partials/_tree-view-9cc5874c.html",link:function(t,n,o){var a,i=angular.element(n[0].querySelector(".tree-view-revision-info")),r="false"!==o.domListeners;function s(e){if(-1===["INPUT","TEXTAREA"].indexOf(e.target.nodeName)){t.hoveredRevision=null;var n=t.revisions.indexOf(t.selectedRevision);switch(e.keyCode){case 40:case 37:e.preventDefault(),c(n-1);break;case 38:case 39:e.preventDefault(),c(n+1)}}}function c(e){t.revisions[e]&&(t.selectNode(t.revisions[e]),t.$digest())}var l=_.debounce(function(){t.selectedRevision&&(a={x:n[0].clientWidth/2-t.selectedRevision.x,y:n[0].clientHeight/2-t.selectedRevision.y},angular.element(n[0].querySelector(".tree-view-graph")).css({left:"".concat(a.x-16,"px"),top:"".concat(a.y-16,"px")}))},300,{leading:!0});t.selectNode=function(n){t.hoveredRevision=null,t.selectedRevision=n,l(),e.$broadcast("TreeView:revisionSelected",{revId:t.selectedRevision.id})},t.initUI=function(){l(),r&&setTimeout(function(){Array.prototype.forEach.call(n[0].querySelectorAll(".tree-view-node"),function(e){e.addEventListener("mouseenter",function(e){var o,r,s,c;o=e.target.dataset.id,s=n[0].getBoundingClientRect(),(c=_.find(t.revisions,{id:o})).isPrivateRoot||(t.hoveredRevision=c,r={top:t.hoveredRevision.isPublic?30:36,left:t.hoveredRevision.isPublic?31:24},i.css({left:"".concat(t.hoveredRevision.x+a.x+s.left+r.left,"px"),top:"".concat(t.hoveredRevision.y+a.y+s.top-r.top,"px")})),t.$digest()}),e.addEventListener("mouseleave",function(){t.hoveredRevision=null,t.$digest()})}),e.$broadcast("TreeView:revisionSelected",{revId:t.selectedRevision.id})},0)},r&&(t.$on("SongRevisionsFeed:revisionSelected",function(e,n){var o=_.find(t.revisions,{id:n.revId});o&&(t.selectedRevision=o,l(),t.hoveredRevision=null,t.$digest())}),document.addEventListener("keydown",s)),window.addEventListener("resize",l),t.$on("$destroy",function(){document.removeEventListener("keydown",s),window.removeEventListener("resize",l)})},controller:["$scope","Me",function(e,t){var n=[],o=e.$watchCollection("revisions",function(t){t.length&&(o(),a(t),e.waitingForRevisions=!1)});function a(t){var n,o;o=angular.copy(t),n=_.assign({},e.song,{parentsIds:[],isPrivateRoot:!0,isPublic:!1}),_.chain(o).filter(function(e){return!e.parentId}).forEach(function(e){e.parentId=n.id}).value().length>1&&o.unshift(n),function(e){var t=e.reduce(function(e,t){return e[t.id]=t,e},{});e.forEach(function(n,o){n.x=0,n.y=50*-o,n.children=e.filter(function(e){return e.parentId===n.id}),n.parent=t[n.parentId]}),function e(t,n){if(!t.children.length)return 0;for(var o=n,a=0;a<t.children.length;a++)t.children[a].x=o,o=o+e(t.children[a],o)+60;return o-n-60}(e[0],0)}(o),e.selectedRevision=e.revision?_.find(o,{id:e.revision.id}):o[o.length-1],e.boundaries={minX:_.minBy(o,"x").x,maxX:_.maxBy(o,"x").x,minY:_.maxBy(o,"y").y,maxY:_.minBy(o,"y").y},e.revisions=o,e.initUI()}e.me=t,e.revisions=[],e.waitingForRevisions=!0,e.$on("$revision:changed",function(t,o){if("edit"===o.action||"unpublish"===o.action){var i=_.find(e.revisions,{id:o.revision.id});i&&(i.description=o.revision.description,i.isPublic=o.revision.isPublic)}else"create"===o.action&&(n.push(o.revision),e.revisions=[],a(n))})}]}}]),angular.module("bandlab.song").factory("Revision",["$resource",function(e){var t="https://www.bandlab.com/api/v1.3/revisions";return e(t,{},{get:{method:"GET",params:{id:"@id",edit:!1},url:"".concat(t,"/:id")},master:{method:"POST",params:{id:"@id"},url:"".concat(t,"/:id/mastering"),transformRequest:[angular.noop,angular.toJson]},save:{method:"POST",transformRequest:[function(e){var t=_.pick(angular.copy(e.revision),["auxChannels","description","genres","key","lyrics","mastering","metronome","placeId","post","sampleId","song","tracks","volume"]);return t.parentId=e.revision.id,t.auxChannels.forEach(function(e){delete e.effects}),t.tracks.forEach(function(e){delete e.color,delete e.sampleId,e.regions.forEach(function(e){delete e.sampleStartPosition,e.sampleOffset=Math.max(e.sampleOffset,0),e.startPosition=Math.max(e.startPosition,0)})}),t},angular.toJson]},update:{method:"PATCH",params:{id:"@id"},url:"".concat(t,"/:id")},reprocessMixdown:{method:"POST",url:"https://www.bandlab.com/api/v1.3/revisions/:revisionId/mixdown/reprocess",params:{revisionId:"@revisionId"}}})}]),angular.module("bandlab.song").factory("RevisionImporter",["$analytics","$filter","$http","$q","$rootScope","$timeout","$transitions","AppNotifications","EditorLoader","EditorModel","editorSettings","FileHelper","Modal","ProjectUploader","Revision","Sample","Song",function(e,t,o,a,i,r,s,c,l,u,d,p,m,f,h,g,v){var b=5e3,y=!1;return{createRevisionFromFile:function(o){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="auto",s="Public";return y?a.reject("Saving is unavailable."):E(o).then(function(o){var c,u,d,p=n(o,2),f=p[0],b=p[1],E=k();return y=!0,function(e){return a(function(t,n){var o;(o=new m({templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-new-9c344f39.html",overlayClose:!1,contentScope:{canBePrivate:!0,revision:e,resolve:function(e){t(e),o.destroy()}},onCancel:function(){n({message:D})}})).show()})}(P({name:t("limitTo")(f.name.replace(/\.[^\/.]+$/,""),100),duration:b,sampleId:E,bandId:i.bandId,parentRevision:i.parentRevision})).then(function(t){return r=t.masteringSetting,s=t.availabilitySetting,c=l.pushTask("uploadMeta"),"manual"===r&&(u=l.pushTask("masterTrack"),d=l.pushTask("loadMasterPreview")),g.upload({blob:f,sampleId:E,sampleType:"samples"}).then(function(){return e.eventTrack("Upload Sample",{category:"Projects",label:f.type,value:parseInt(b)}),t})}).then(function(e){return"auto"===r&&(e.mastering={preset:"cdMaster"}),e.post=e.post||{},e.post.state=s,e}).then(function(t){return t.song.id&&t.song.canEdit?v.update({id:t.song.id,name:t.song.name,isForkable:t.song.isForkable}).$promise.then(function(){return e.eventTrack("Create Song",{category:"Projects"}),h.save({revision:t}).$promise}):h.save({revision:t}).$promise}).then(function(e){return w(e,{masteringSetting:_.startCase(r)})}).then(function(e){return l.finishTask(c),"manual"===r?S(e).then(function(){return C(e,u,d)}):e}).finally(function(){y=!1})}).catch(function(t){return l.flushQueue(),t.message===D?a.reject(D):(c.addNotification({title:j,content:t.message,classList:"alert",autoclose:8e3}),e.eventTrack("Import File",{category:"Revision Importer",label:"error:".concat(o.type),value:Math.round(o.size/1024/1024)}),a.reject(j))})},createRevisionFromMastering:function(e){var n,o,a;return e.name=t("limitTo")(e.name.replace(/\.[^\/.]+$/,""),100),e.sampleId=k(),a=u.createTrack({name:"Imported Track"}),n=u.createRegion({endPosition:e.selectedPreset.audio.duration,name:e.name,sampleId:e.sampleId,trackId:a.id}),a.regions=[n],o=u.createRevision({mastering:e.selectedPreset.sampleId===_.find(e.presets,{slug:"dry"}).sampleId?null:{preset:e.selectedPreset.newSlug||e.selectedPreset.slug},sampleId:e.sampleId,song:new v({bandId:"",isForkable:!1,name:e.name}),tracks:[a]}),g.upload({blob:e.file,sampleId:e.sampleId,sampleType:"samples"}).then(function(){return h.save({revision:o}).$promise}).then(function(e){return t=e.id,function e(){return r(function(){return h.get({id:t}).$promise},b).then(function(t){return"Ready"===_.get(t,"mixdown.status")?t:e()})}();var t}).then(function(t){return w(t,{masteringSetting:_.startCase(e.selectedPreset.name)})})},createRevisionFromUploadQueue:function(n,o){var a=o.duration,i=o.bandId,r=k(),s=P({name:t("limitTo")(n.name.replace(/\.[^\/.]+$/,""),100),duration:a,sampleId:r,bandId:i}),c={createdAt:performance.now(),name:n.name,file:n,progress:0,loaded:0,cancel:function(){_.remove(f.queue,c),c.upload.cancel()},upload:l(),retry:function(){c.upload=l(),c.failed=!1}};function l(){var t=g.upload({blob:n,sampleId:r,sampleType:"samples"},1,u);return t.then(function(){return e.eventTrack("Upload Sample",{category:"Projects",label:n.type,value:parseInt(a)}),h.save({revision:s}).$promise}).then(w).then(function(e){c.revision=e}).catch(function(){c.failed=!0}),t}function u(e){c.total=e.total,c.loaded=e.loaded,c.progress=e.loaded/e.total}f.queue.push(c)},displayMultipleFilesWarning:function(){c.addNotification({content:"You can upload only one file at a time.",autoclose:5e3})},isAudioFileValid:E,loadPreview:$,masterRevision:C,pollMixdown:S,requestPreviewsForFile:function(e){var t=l.pushTask("uploadTrack"),o=l.pushTask("masterTrack"),r=l.pushTask("loadMasterPreview"),s=k(),u=a.defer(),d=i.$on("Mastering:cancel",function(){u.reject()});return E(e).then(function(e){var t=n(e,1)[0];return a.race([g.upload({blob:t,sampleId:s,sampleType:"mastered"}),u.promise])}).then(function(){return l.finishTask(t),a.race([g.master({id:s,type:"mastered"}),u.promise])}).then(function(e){return a.race([M(e,u),u.promise])}).then(function(e){return l.finishTask(o),a.race([$(e),u.promise])}).then(function(e){return l.finishTask(r),e}).catch(function(e){return l.flushQueue(),c.addNotification({title:i18n($o()),content:e.message,classList:"alert"}),a.reject(e)}).finally(function(){d()})}};function w(t){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).masteringSetting,o=void 0===n?"Auto":n;return e.eventTrack("Create Revision",{category:"Projects",label:"".concat(o," mastering")}),i.$broadcast("$revision:changed",{action:"create",revision:t}),t}function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.defer(),n=i.$on("Mastering:cancel",function(){t.reject()});return a.race([r(function a(){return o({method:"GET",url:"https://www.bandlab.com/api/v2.0/uploads/revisions/".concat(e.mixdown.id)}).then(function(){return e}).catch(function(){if(0===t.promise.$$state.status)return r(a,b)}).finally(n)},2e4),t.promise])}function P(e){var t,n,o;return o=u.createTrack({name:"Imported Track"}),t=u.createRegion({endPosition:e.duration,name:e.name,sampleId:e.sampleId,trackId:o.id}),o.regions=[t],n=e.parentRevision?e.parentRevision.song:new v({bandId:e.bandId||"",canEdit:!0,isForkable:!1,name:e.name}),u.createRevision({id:e.parentRevision?e.parentRevision.id:null,masteringSetting:"auto",post:{state:"Private"},song:n,tracks:[o]})}function E(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).loader,n=(void 0===t||t)&&l.pushTask("loadSample");return p.checkType(e,d.IMPORT_FILE_ACCEPTED_TYPES).then(function(e){return p.checkSize(e,d.IMPORT_FILE_SIZE_MAX)}).then(function(e){return _.get(e,"type","").startsWith("video/")?g.extractAudio(e):e}).then(function(e){var t=a.defer(),n=new Audio(URL.createObjectURL(e));return n.onloadedmetadata=function(){return n.duration>600?t.reject({message:i18n(Co())}):t.resolve([e,n.duration])},n.onerror=function(e){return t.reject(e)},t.promise}).finally(function(){return r(function(){l.finishTask(n)},1e3)})}function T(e){var t=e.previewId,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.defer(),c=i.$on("Mastering:cancel",function(){s.reject()}),l=!1;s.promise.finally(function(){l=!0});var u=r(angular.noop,2e4).then(function(){return m("cdMaster")}),d=u.then(function(){return m("bassBoostMastering")}),p=d.then(function(){return m("enhanceClarity")});return a.race([a.all([u,d,p]),s.promise]).then(function(e){var t=n(e,3);return[{preset:"cdMaster",url:t[0]},{preset:"bassBoostMastering",url:t[1]},{preset:"enhanceClarity",url:t[2]}]});function m(e){var n="https://static.bandlab.com/mastered-formatted/".concat(t,"/").concat(e,"/").concat(t,".mp3");return o({method:"HEAD",url:n}).then(function(){return n}).catch(function(){return l?s.promise:r(function(){return m(e)},b)}).finally(c)}}function M(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.defer(),n=i.$on("Mastering:cancel",function(){t.reject()}),s=!1;return t.promise.finally(function(){s=!0}),a.race([function i(){return o({method:"GET",url:"https://www.bandlab.com/api/v2.0/mastering/".concat(e.previewId,"?t=").concat(+new Date)}).then(function(){return e.presets}).catch(function(n){return 303===n.status?s?t.promise:r(i,b):304===n.status?e.presets:a.reject(n)}).finally(n)}(),t.promise])}function $(e){return a.all([t(0),t(1),t(2),t(3)]);function t(n){var o=e[n];return p.download(o.url).then(function(e){var t=new Audio(URL.createObjectURL(e));return o.audio=t,o}).catch(function(){return t(n)})}}function C(t,n,o){var r,c=_.get(t,"mastering.drySampleId")||_.get(t,"mixdown.id"),u=angular.noop,d=angular.noop,p=a.defer();return c?(n=n||l.pushTask("masterTrack"),o=o||l.pushTask("loadMasterPreview"),d=s.onStart({},function(){p.reject()}),u=i.$on("Mastering:cancel",function(){p.reject()}),r=h.master({id:t.id}).$promise.then(function(e){return a.race([T(e),p.promise])}).then(function(e){l.finishTask(n);var t={preset:"dry",url:"https://static.bandlab.com/revisions-formatted/".concat(c,"/").concat(c,".mp3"),sampleId:c};return a.race([$(e.concat(t)),p.promise])}).then(function(n){var r=a.defer(),s=t.mastering||{};return l.finishTask(o),new m({templateUrl:"https://www.bandlab.com/web-app/song/partials/_revision-mastering-preview-af8a936b.html",overlayClose:!1,contentScope:{state:{defaultPreset:_.find(n,{preset:s.preset})||_.find(n,{preset:"dry"}),presets:n},setPreset:function(e){t.mastering="dry"===e.preset?null:{preset:e.preset}}},onCancel:function(){t.mastering=s,r.reject(D)},onConfirm:function(){var n,o=l.pushTask("uploadMixdown");return t.mastering?(e.eventTrack("Update Mastering",{category:"Revision",label:"".concat(_.startCase(t.mastering.preset)," mastering")}),n=h.update({id:t.id,mastering:t.mastering}).$promise):(e.eventTrack("Update Mastering",{category:"Revision",label:"No mastering"}),n=h.update({id:t.id,mastering:null}).$promise),a.race([n,p.promise]).then(function(e){t.mastering=e.mastering,t.mixdown=e.mixdown,t.isRecentlyUpdated=!0,e.isRecentlyUpdated=!0,i.$broadcast("$revision:changed",{action:"master",revision:e})}).finally(function(){l.finishTask(o),r.resolve(t)})}}).show(),r.promise}).finally(function(){l.finishTask(n),l.finishTask(o),d(),u()}),a.race([r,p.promise])):a.reject("Revision cannot be mastered: dry sample id is missing.")}}]),angular.module("bandlab.web").factory("RevisionSocket",["$cookies","$rootScope","Me",function(e,t,n){var o={emit:angular.noop,disconnect:angular.noop,disconnected:!0};return{disconnect:function(){o.disconnect()},join:function(a){var i=a.mixdownId;o.disconnected&&(n.isAnonymous()||(o=io("https://realtime.bandlab.com/revisions?userId=".concat(n.id),{reconnectionAttempts:3,transportOptions:{polling:{extraHeaders:{Authorization:"Bearer ".concat(e.get("sessionKey")),"X-Client-Id":"BandLab-Web","X-Client-Version":"8.0.86"}}}})).on("message",function(e){var n=e.body;n.status&&(n.status=_.capitalize(n.status),n.id=n.sampleId,t.$broadcast("$mixdown:changed",{mixdown:n}))})),o.emit("join","".concat(i,"/public"))}}}]),angular.module("bandlab.song").factory("Song",["$resource",function(e){var t="https://www.bandlab.com/api/v1.3/songs";return e(t,{},{delete:{method:"DELETE",params:{id:"@id"},url:"".concat(t,"/:id")},fork:{method:"POST",url:"".concat(t,"/forks")},forkToBand:{method:"POST",params:{revisionId:"@revisionId",bandId:"@bandId"},url:"https://www.bandlab.com/api/v1.3/revisions/:revisionId/forks/".concat("bands","/:bandId")},fromBand:{method:"GET",isArray:!0,params:{id:"@id",limit:50,offset:0},url:"https://www.bandlab.com/api/v1.3/".concat("bands","/:id/songs")},fromUser:{method:"GET",isArray:!0,params:{id:"@id",authorId:"@authorId",limit:50,offset:0,status:null},url:"https://www.bandlab.com/api/v1.3/users/:id/songs"},getBySlug:{method:"GET",params:{entity:"@entity",username:"@username",slug:"@slug"},url:"https://www.bandlab.com/api/v1.3/:entity/:username/songs/:slug"},get:{method:"GET",params:{id:"@id"},url:"".concat(t,"/:id")},getByRevision:{method:"GET",params:{revId:"@revId"},url:"".concat(t,"?revisionId=:revId")},query:{method:"GET",isArray:!0,params:{limit:50,offset:0},url:t},leave:{method:"DELETE",params:{id:"@id",userId:"@userId"},url:"".concat(t,"/:id/collaborators/:userId")},update:{method:"PATCH",params:{id:"@id"},url:"".concat(t,"/:id")}})}]),angular.module("bandlab.song.routes",["ui.router"]).config(["$stateProvider",function(e){function t(e,t,o,a,i,r){var s=o.params(),c=[],l=s.revId,u=s.id;if(u){var d=i.get({id:u}).$promise,p=d.then(function(e){return e.song});c.push(d),c.push(p)}else if(l)c.push(i.get({id:l}).$promise),c.push(r.getByRevision({revId:l}).$promise);else{var m=r.getBySlug({entity:"bandSong"===t.name?"bands":"users",username:s.username,slug:s.slug}).$promise;c.push(m.then(function(e){return i.get({id:e.revision.id}).$promise})),c.push(m)}return e.all(c).then(function(t){var o=n(t,2),i=o[0],r=o[1];return s.username&&r.author.username!==s.username.toLowerCase()?e.reject({status:404}):(i.song=r,i.post=a.get({id:i.postId,sharedKey:u}),i)})}function o(e,t,n,o){var a=n.params();return o.getBySlug({entity:t.name.indexOf("bandSong")>=0?"bands":"users",username:a.username,slug:a.slug}).$promise.then(function(t){return t.author.username!==a.username.toLowerCase()?e.reject({status:404}):t})}function a(e,t,n,o){t.setMetadata({title:"".concat(o.song.name," by ").concat(o.song.author.name," | BandLab"),description:"".concat(o.description?"".concat(o.description," | "):"","Listen to music from ").concat(o.song.author.name," and follow their creative process on BandLab."),image:o.song.picture.s,imageHeight:"360",imageWidth:"360",objectPath:"/revisions/".concat(e.params().id?e.params().id:o.id),player:n.getEmbedRevisionUrl(o)})}function i(e,t,n,o){t.setMetadata({title:"".concat(o.name," by ").concat(o.author.name," | BandLab"),description:"".concat(o.description?"".concat(o.description," | "):"","Listen to music from ").concat(o.author.name," and follow their creative process on BandLab."),image:o.picture.s,imageHeight:"360",imageWidth:"360",objectPath:"/songs/".concat(e.params().id?e.params().id:o.id),player:n.getEmbedRevisionUrl(o.revision)})}function r(e){e.clearMetadata()}i.$inject=["$transition$","Page","Share","theSong"],o.$inject=["$q","$state$","$transition$","Song"],t.$inject=["$q","$state$","$transition$","Post","Revision","Song"],r.$inject=["Page"],a.$inject=["$transition$","Page","Share","theRevision"],e.state("revisionSharedKey",{url:"/revisions/open?id",params:{rewriteTracking:function(){return function(){return"/revisions/shared"}}},resolve:{theRevision:["$q","$state$","$transition$","Post","Revision","Song",function(e,n,o,a,i,r){return t(e,n,o,a,i,r).then(function(t){return t.isPublic||t.canEdit?e.reject({status:301,location:{name:"Band"===t.song.author.type?"bandSong":"userSong",params:{username:t.song.author.username,slug:t.song.slug,revId:t.id}}}):t})}]},onEnter:a,onExit:r,controller:"RevisionPageCtrl",templateUrl:"https://www.bandlab.com/web-app/song/views/revision-preview-layout-ff2b37c4.html"}).state("userSong",{url:"/{username:[a-z0-9][a-z0-9_]{3,19}}/{slug:[a-z0-9-]{1,128}}?revId&download",params:{rewriteTrackingAsync:["$stateParams","ClientDevice","Me","Song",function(e,t,n,o){return function(){return o.getBySlug({entity:"users",username:e.username,slug:e.slug}).$promise.then(function(o){var a=o.author.id===n.id?"-owner":o.isCollaborator?"-collaborator":"",i=n.isAnonymous()&&t.isMobile;return"/project".concat(a).concat(e.revId?"/revision":"").concat(i?"/promo":"")})}}]},resolve:{theRevision:t},onEnter:a,onExit:r,controller:"RevisionPageCtrl",templateProvider:["$templateRequest","ClientDevice","Me",function(e,t,n){return e(n.isAnonymous()&&t.isMobile?"https://www.bandlab.com/web-app/song/views/revision-mobile-promo-layout-343f1c9c.html":"https://www.bandlab.com/web-app/song/views/revision-layout-1454b85e.html")}]}).state("bandSong",{url:"/band/{username:[a-z][0-9a-z_]{1,19}}/{slug:[a-z0-9-]{1,128}}?revId&download",params:{rewriteTrackingAsync:["$stateParams","ClientDevice","Me","Song",function(e,t,n,o){return function(){return o.getBySlug({entity:"bands",username:e.username,slug:e.slug}).$promise.then(function(o){var a=o.canEdit?"-member":o.isCollaborator?"-collaborator":"",i=n.isAnonymous()&&t.isMobile;return"/project-band".concat(a).concat(e.revId?"/revision":"").concat(i?"/promo":"")})}}]},resolve:{theRevision:t},onEnter:a,onExit:r,controller:"RevisionPageCtrl",templateProvider:["$templateRequest","ClientDevice","Me",function(e,t,n){return e(n.isAnonymous()&&t.isMobile?"https://www.bandlab.com/web-app/song/views/revision-mobile-promo-layout-343f1c9c.html":"https://www.bandlab.com/web-app/song/views/revision-layout-1454b85e.html")}]}).state("userSong.tree",{url:"/tree",params:{rewriteTrackingAsync:["$stateParams","Me","Song",function(e,t,n){return function(){return n.getBySlug({entity:"users",username:e.username,slug:e.slug}).$promise.then(function(n){var o=n.author.id===t.id?"-owner":n.isCollaborator?"-collaborator":"";return"/project".concat(o).concat(e.revId?"/revision":"","/tree")})}}]},reloadOnSearch:!1,resolve:{theSong:o},onEnter:bt,onExit:vt,views:{"overlay@":{templateUrl:"https://www.bandlab.com/web-app/song/views/song-tree-view-7288b339.html",controller:"SongRevisionsFeedCtrl"}}}).state("bandSong.tree",{url:"/tree",params:{rewriteTrackingAsync:["$stateParams","Song",function(e,t){return function(){return t.getBySlug({entity:"bands",username:e.username,slug:e.slug}).$promise.then(function(t){var n=t.canEdit?"-member":t.isCollaborator?"-collaborator":"";return"/project-band".concat(n).concat(e.revId?"/revision":"","/tree")})}}]},reloadOnSearch:!1,resolve:{theSong:o},onEnter:bt,onExit:vt,views:{"overlay@":{templateUrl:"https://www.bandlab.com/web-app/song/views/song-tree-view-7288b339.html",controller:"SongRevisionsFeedCtrl"}}}).state("song",{url:"/song/{songId:[a-zA-Z0-9-_]+}",params:{rewriteTracking:function(){return function(e){return e.replace(/^\/song\/[a-fA-F0-9-]*(($|\/).*)/g,"/project$1")}}},redirectTo:function(e){return{state:"song.edit.profile",params:{songId:e.params().songId}}},templateUrl:"https://www.bandlab.com/web-app/song/views/song-layout-99322895.html",resolve:{theSong:["$transition$","Song",function(e,t){return t.get({id:e.params().songId}).$promise}]},onEnter:i,onExit:r,controller:["$scope","theSong",function(e,t){e.song=t,e.$on("$song:changed",function(t,n){"update"===n.action&&e.song.$get({id:e.song.id})}),e.$on("$revision:changed",function(){e.song.$get({id:e.song.id})})}]}).state("song.edit",{url:"/edit",redirectTo:function(e){return{state:"song.edit.profile",params:{songId:e.params().songId}}},resolve:{canEdit:["$q","theSong",function(e,t){return e(function(e,n){t.canEdit?e(!0):n({status:403})})}]},views:{header:{templateUrl:"https://www.bandlab.com/web-app/song/views/song-edit-header-691c653e.html"},content:{templateUrl:"https://www.bandlab.com/web-app/song/views/song-edit-layout-dc54db38.html"}}}).state("song.edit.profile",{url:"?focus",templateUrl:"https://www.bandlab.com/web-app/song/views/song-edit-profile-c020d728.html",controller:"ProjectEditCtrl"}).state("song.edit.picture",{url:"/edit-picture?changed",templateUrl:"https://www.bandlab.com/web-app/song/views/song-edit-picture-593f2016.html",controller:"PictureEditCtrl"}).state("song.edit.collaborators",{url:"/collaborators",templateUrl:"https://www.bandlab.com/web-app/song/views/song-edit-collaborators-5f2920b9.html",controller:"ProjectCollaboratorsCtrl"}).state("oldRevisionId",{url:"/revision/{id:[a-zA-Z0-9-_]+}",resolve:{redirect:["$stateParams","$q","Revision",function(e,t,n){return n.get({id:e.id}).$promise.then(function(e){return t.reject({status:301,location:{name:"Band"===e.song.author.type?"bandSong":"userSong",params:{username:e.song.author.username,slug:e.song.slug,revId:e.id}}})})}]}}).state("oldSong",{url:"/song/{songId:[a-zA-Z0-9-_]+}/tree-view",resolve:{redirect:["$stateParams","$q",function(e,t){return t.reject({status:301,location:{name:"song",params:{songId:e.songId}}})}]}}).state("oldRevision",{url:"/song/{songId:[a-zA-Z0-9-_]+}/tree-view/{revId:[a-zA-Z0-9-_]+}",resolve:{redirect:["$stateParams","$q",function(e,t){return t.reject({status:301,location:{name:"revisionId",params:{id:e.revId}}})}]}})}]);var _o,Ao=1.396*Math.PI,Ro=1.603*Math.PI,Io=Ke(420),Oo=Ke(5)+Io,xo=Ke(1),Do=Ke(3),Lo=Ke(62),No=Ke(5),Uo=Lo+No,jo={green:"rgb(41, 217, 120)",yellow:"rgb(255, 195, 14)",red:"rgb(255, 83, 56)",gray:"rgb(205, 205, 205)"};function Bo(e){var t=e.ctxDisplay,n=e.detuneStatusCallback,o=e.timeLag,a=e.detune,i=e.previousDetune,r=(new Date).getTime();_o=t.canvas.width/2,i?function e(t,n,o,a,i,r){var s;setTimeout(function(){var c=(new Date).getTime()-o;a-c>0?(s=r+(i-r)*(1-(a-c)/a),e(t,n,o,a,i,r)):s=i,Fo(t,n,s)},1e3/60)}(t,n,r,o,a,i):Fo(t,n,a,!0)}function Fo(e,t,n,o){var a,i,r,s=1.5*Math.PI,c=(Ro-Ao)/100,l=jo.gray;function u(e,t){return{dx:_o+(Io-t)*Math.sin(e),dy:Oo-(Io-t)*Math.cos(e)}}o?(l=jo.gray,t()):Math.abs(n)<10?(l=jo.green,t("good")):Math.abs(n)<30?(l=jo.yellow,t("bad")):(l=jo.red,t("terrible")),r=(i=(a=c*n)<0)?-c:c,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath(),e.arc(_o,Oo,Io,Ao,Ro,!1),e.lineWidth=Do,e.strokeStyle=jo.gray,e.stroke(),e.beginPath(),e.arc(_o,Oo,Io,s,s+a+r,i),e.lineWidth=Do,e.strokeStyle=l,e.stroke(),e.save(),e.globalAlpha=.4,e.beginPath(),e.lineWidth=Lo,e.arc(_o,Oo,Io-Lo/2-No,s,s+a+r,i),e.strokeStyle=l,e.stroke(),e.restore(),e.save(),e.lineWidth=3,e.translate(u(a,Uo).dx,u(a,Uo).dy+1),e.rotate(a),e.fillStyle="rgb(247,247,247)",e.beginPath(),e.moveTo(-5*xo,1),e.lineTo(-3*xo,-1*Uo-Do),e.lineTo(3*xo,-1*Uo-Do),e.lineTo(5*xo,1),e.closePath(),e.fill(),e.fillStyle=l,e.beginPath(),e.moveTo(-2*xo,0),e.lineTo(-1*xo,-1*Uo-Do),e.lineTo(xo,-1*Uo-Do),e.lineTo(2*xo,0),e.closePath(),e.fill(),e.restore()}function qo(){this.SEMITONES_PER_OCTAVE=12,this.A4_MIDI=69,this.A440_FREQ=440,this.NO_PITCH=-1,this.STATE_SEARCHING=1,this.STATE_CONFIRMING=2,this.STATE_TRACKING=3,this.dBStart=-50,this.QStart=.9,this.dBStop=-80,this.QStop=.6,this.sr=0,this.minPitchMidi=0,this.maxPitchMidi=0,this.N=0,this.fft=null,this.buf=null,this.specRe=null,this.specIm=null,this.sq=null,this.nac=null,this.alpha=0,this.Q=0,this.absMaxSample=0,this.lastMidi=0,this.dBLevel=0,this.smoothPitchMidi=0,this.state=0,this.searchMin=0,this.searchMax=0}qo.prototype.init=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:21,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:108;this.sr=e,this.minPitchMidi=t,this.maxPitchMidi=n;for(var o=Math.ceil(e/this.midiToPitch(t)),a=1;1<<a<2*o;)a++;this.N=1<<a,this.fft=new En,this.fft.init(a+1),this.buf=new Float64Array(2*this.N),this.specRe=new Float64Array(this.N+1),this.specIm=new Float64Array(this.N+1),this.sq=new Float64Array(2*this.N),this.nac=new Float64Array(this.N);var i=.5;return this.alpha=Math.exp(-this.N/(i*this.sr)),this.clear(),this.N},qo.prototype.clear=function(){this.Q=0,this.absMaxSample=0,this.dBLevel=-200,this.lastMidi=-1,this.smoothPitchMidi=-1,this.state=this.STATE_SEARCHING},qo.prototype.process=function(e){var t;return this.state===this.STATE_SEARCHING?(t=this.estimatePitch(e,this.minPitchMidi,this.maxPitchMidi))>=0&&this.Q>this.QStart&&this.dBLevel>this.dBStart&&(this.state=this.STATE_CONFIRMING):this.state===this.STATE_CONFIRMING?(t=this.estimatePitch(e,this.minPitchMidi,this.maxPitchMidi))>=0&&this.Q>this.QStart&&this.dBLevel>this.dBStart&&Math.abs(t-this.lastMidi)<1?(this.state=this.STATE_TRACKING,this.smoothPitchMidi=t):this.state=this.STATE_SEARCHING:(t=this.estimatePitch(e,this.lastMidi-1,this.lastMidi+1))<0||this.Q<this.QStop||this.dBLevel<this.dBStop?(this.state=this.STATE_SEARCHING,this.smoothPitchMidi=this.NO_PITCH):this.smoothPitchMidi=this.alpha*this.smoothPitchMidi+(1-this.alpha)*t,this.lastMidi=t,this.smoothPitchMidi},qo.prototype.estimatePitch=function(e,t,n){var o=Math.floor(this.sr/this.midiToPitch(n+1)),a=Math.ceil(this.sr/this.midiToPitch(t-1));this.Q=0,this.absMaxSample=0;for(var i=0;i<this.N;i++)this.absMaxSample=Math.max(this.absMaxSample,Math.abs(e[i]));if(this.dBLevel=20*Math.log10(this.absMaxSample+Number.MIN_VALUE),0===this.absMaxSample||this.dBLevel<this.dBStop)return 0;this.computeNAC(e,this.nac);for(var r=0;r<a&&this.nac[r]>0;)r++;var s=0,c=0;for(r=Math.max(r,o);r<=a;r++)this.nac[r]>c&&this.nac[r]>this.nac[r-1]&&this.nac[r]>this.nac[r+1]&&(s=r,c=this.nac[r]);if(0===s)return 0;this.Q=c;for(var l=this.nac[s],u=this.nac[s-1],d=this.nac[s+1],p=.5*(u-d)/(u-2*l+d),m=s+p,f=!1,h=Math.floor(s/o);h>=1&&!1===f;h--){for(var g=m/h,v=!0,b=1;b<=h&&v;b++){var y=b*g,w=Math.round(y);l=this.nac[w],u=this.nac[w-1],d=this.nac[w+1];var k=l;l>u&&l>d&&(k-=.25*(u-d)*(p=y-w)),k<.95*c&&(v=!1)}v&&(f=!0,m=g)}return m>0?this.pitchToMidi(this.sr/m):-1},qo.prototype.computeNAC=function(e){var t;for(t=0;t<this.N;t++)this.buf[t]=e[t];for(t=this.N;t<2*this.N;t++)this.buf[t]=0;for(this.fft.forwardReal(this.buf,this.specRe,this.specIm),t=0;t<=this.N;t++){var n=this.specRe[t],o=this.specIm[t];this.specRe[t]=n*n+o*o,this.specIm[t]=0}this.fft.inverseReal(this.specRe,this.specIm,this.buf);var a=0;for(t=0;t<this.N;t++)this.sq[t]=e[t]*e[t],a+=this.sq[t];var i=a,r=a;for(t=0;t<this.N;t++)this.nac[t]=this.buf[t]/Math.sqrt(Math.max(i*r,Number.MIN_VALUE)),i-=this.sq[t],r-=this.sq[this.N-1-t]},qo.prototype.runSelfTest=function(){for(var e=new Float32Array(this.N),t=0;t<this.N;t++){var n=2*Math.PI*t*this.A440_FREQ/this.sr;e[t]=1*Math.sin(n)}this.estimatePitch(e,this.minPitchMidi,this.maxPitchMidi),this.A4_MIDI},qo.prototype.midiToPitch=function(e){var t=-1;if(e>0){var n=(e-this.A4_MIDI)/this.SEMITONES_PER_OCTAVE;t=this.A440_FREQ*Math.pow(2,n)}return t},qo.prototype.pitchToMidi=function(e){var t=-1;return e>0&&(t=this.A4_MIDI+this.SEMITONES_PER_OCTAVE*Math.log2(e/this.A440_FREQ)),t};var Vo,Ho,Go=new qo,zo=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];angular.module("bandlab.editor").directive("audioTuner",["$timeout","AudioCtx","InputDevice",function(e,t,n){return{replace:!0,restrict:"E",scope:{},templateUrl:"https://www.bandlab.com/web-app/tuner/partials/_audio-tuner-6f854646.html",link:function(o,a){var i,r={detune:0},s=10,c=1/s*1e3,l=a[0].querySelector("#tuner-display"),u=l.getContext("2d");function d(e){o.detuneStatus=e}function p(){i=e(function(){var e,t,n,a=(n=function(e,t){return Math.floor(1200*Math.log(e/function(e){return 440*Math.pow(2,(e-69)/12)}(t))/Math.log(2))}(e=Go.midiToPitch(Vo),t=Math.round(Vo)),{pitch:e,note:t,noteStrings:zo[t%12]||"",detune:n});a&&a.note>0?(o.tunerFrequency=Math.round(10*a.pitch)/10,o.noteString=a.noteStrings[0]||"",o.noteStringSharp=a.noteStrings[1]||"",o.tunerDetune=a.detune,Bo({ctxDisplay:u,detuneStatusCallback:d,timeLag:c,detune:a.detune,previousDetune:r.detune}),r=a):Bo({ctxDisplay:u,detuneStatusCallback:d,timeLag:c,detune:r.detune}),p()},1e3/s)}return o.$on("$destroy",function(){e.cancel(i),Ho&&(Ho.disconnect(),Ho=null)}),setTimeout(function(){var e,o;l.width=Ke(l.width),l.height=Ke(l.height),e=t.get(),o=n,Ho||(function(e){var t=Go.init(e.sampleRate);(Ho=e.createScriptProcessor(t,1,1)).componentName="Tuner",Ho.onaudioprocess=function(e){Vo=Go.process(e.inputBuffer.getChannelData(0))},Ho.connect(e.destination)}(e),o.connect(Ho)),Bo({ctxDisplay:u,detuneStatusCallback:d,timeLag:c,detune:0}),p()},0)}}}]),angular.module("bandlab.user").controller("BlockUserCtrl",["$rootScope","$scope","appActions","ConfirmModal","Me","User",function(e,t,n,o,a,i){function r(t,n){("block"===n?i.block({meId:a.id,userId:t.id}).$promise:i.unblock({meId:a.id,userId:t.id}).$promise).then(function(){t.isBlocked=!0,t.isFollower=!1,setTimeout(function(){i.get({id:t.id}).$promise.then(function(o){_.assignIn(t,o),e.$broadcast("$user:relationChanged",{type:n,user:t})})},1e3)})}t.blockUser=function(e){n.checkAllowed("blockUser")&&new o({confirmLabel:"Block",contentScope:{title:"Block",message:"\n            <p>".concat("Are you sure you want to block ".concat("<strong>".concat(e.name,"</strong>"),"?"),"</p>\n            <p>").concat("Blocked users will no longer be able to find your profile, message and comment on your posts.","</p>\n          ")},onConfirm:function(){return r(e,"block")}}).show()},t.unblockUser=function(e){return r(e,"unblock")}}]),angular.module("bandlab.user").controller("FollowUserCtrl",["$scope","UserHelper",function(e,t){var n;e.toggleFollowUser=function(e){n||(n=!0,t.toggleFollowUser(e).then(function(){n=!1}).catch(function(){n=!1}))}}]),angular.module("bandlab.user").controller("InviteRequestsCtrl",["$rootScope","$scope","AppNotifications","Invite",function(e,t,n,o){function a(){e.$broadcast("$invite:changed")}function i(e){e&&e.data&&e.data.message&&n.addNotification({title:"Invite error",content:e.data.message,classList:"alert",autoclose:5e3}),a()}t.acceptInvite=function(e,t){e.preventDefault(),o.update({id:t}).$promise.then(function(){a()}).catch(i)},t.revokeInvite=function(e,t){e.preventDefault(),o.remove({id:t}).$promise.then(function(){a()}).catch(i)}}]),angular.module("bandlab.user").controller("InviteUserCtrl",["$analytics","$injector","$q","$rootScope","$scope","AppNotifications","Invite","User",function(e,t,n,o,a,i,r,s){var c,l,u={};if(a.band)c="bands",l=a.band.id;else if(a.school)c="schools",l=a.school.id;else if(a.song)c="songs",l=a.song.id;else{if(!a.community)throw new Error("Entity missing for invite user");c="communities",l=a.community.id}function d(){r.query({id:l,entity:c,accepted:!1,limit:50}).$promise.then(function(e){a.pendingInvitedUser=[],a.pendingInvitedExternalUser=[],e.forEach(function(e){if(e.user){var t=new s(e.user);t.invite=e,a.pendingInvitedUser.push(t)}else a.pendingInvitedExternalUser.push(e)})})}function p(e){if(e){var t=document.createElement("input");t.type="email";var o=e.filter(function(e){return"email"===e.type}).reduce(function(e,n){return t.value=n.email,n.hasValidEmail=t.checkValidity(),e&&n.hasValidEmail},!0);a.formInviteUser.inviteUser.$setValidity("validEmail",o);var i=e.filter(function(e){return"user"===e.type&&!e.id&&!1!==e.isValid}).reduce(function(e,t){a.formInviteUser.inviteUser.$setValidity("validUser",!1);var n=new s({id:t.username});return t.isValid=null,n.$get().then(function(){return t.isValid=!0,_.assign(t,n),e&&!0}).catch(function(){return t.isValid=!1,!1})},!0);n.resolve(i).then(function(e){a.formInviteUser.inviteUser.$setValidity("validUser",e)})}}a.sendInvite=function(){var e=[],t=[];delete a.inviteSent,a.users.forEach(function(n){"email"!==n.type||_.find(a.pendingInvitedExternalUser,{email:n.email})?"user"!==n.type||_.find(a.pendingInvitedUser,{id:n.id})||e.push(n.id):t.push(n.email)});var n=new r({id:l,emails:t,userIds:e,message:a.inviteMessage});n.$save({rel:c}).then(function(){a.inviteSent=!0,a.inviteMessage="",o.$broadcast("$invite:changed",{invite:n})}).catch(function(e){a.inviteSent=!1,a.errorMessage=e.data.message}).finally(function(){a.users=[],a.formInviteUser.$setPristine(),d()})},a.$on("$invite:changed",d),a.$watch("users",p,!0),a.googleClassrooms={connect:function(){u.connect().then(function(){a.googleClassrooms.isConnected=!0,u.getCourses().then(function(e){a.googleClassrooms.classrooms=e}).catch(function(){a.googleClassrooms.isConnected=!1})}).catch(function(){i.addNotification({content:"Something went wrong. Please try again later.",classList:"alert",autoclose:5e3}),a.googleClassrooms.isConnected=!1})},classrooms:[],isConnected:u.isConnected,isPulling:!1,isImporting:!1,getStudents:function(){a.googleClassrooms.classroomId&&(a.googleClassrooms.isPulling=!0,u.getStudents(a.googleClassrooms.classroomId).then(function(e){var t=e.map(function(e){return{email:e.profile.emailAddress,type:"email"}});a.users=t,a.formInviteUser.$setDirty(),p(a.users),a.googleClassrooms.isPulling=!1}).catch(function(){a.googleClassrooms.isPulling=!1,a.googleClassrooms.isConnected=!1}))},classroomId:""},d()}]),angular.module("bandlab.user").controller("UserBandsCtrl",["$q","$scope","$stateParams","Band","Me","theUser",function(e,t,n,o,a,i){var r,s=20,c=0,l=!1;function u(){return l?e.resolve([]):((r=o.fromUser({userId:i.id,offset:c,limit:s,role:n.role}).$promise).then(function(e){l=0===e.length||e.length<s,c+=e.length}),r)}t.loadMore=function(){return t.infiniteScrollEnded?e.reject("No more results"):r=r.then(function(e){return t.infiniteScrollEnded=l,t.bands=t.bands||[],t.bands=t.bands.concat(e),u()})},u().then(t.loadMore),t.$on("$band:changed",function(e,n){if(_.includes(["mark-deleted","unmark-deleted"],n.action)){var o=_.find(t.bands,{id:n.band.id});o&&(o.isDeleting="mark-deleted"===n.action||null)}else{if("delete"===n.action)return _.remove(t.bands,{id:n.band.id}),void(t.bands.length<s&&t.loadMore());"create"===n.action&&t.bands.unshift(n.band)}}),t.$on("$band:left",function(e,n){a.id===i.id?_.remove(t.bands,n.band):(n.band.isMember=!1,_.remove(n.band.members,{id:a.id}))})}]),angular.module("bandlab.user").controller("UserCollectionsCtrl",["$q","$scope","$state","$stateParams","Collection","theUser",function(e,t,n,o,a,i){var r,s=20,c=0,l=!1;function u(){if(l)return e.resolve([]);var t={userId:i.id,offset:c,limit:s,includePrivate:"user.collections"!==n.current.name};return(r=o.likes?a.liked(t).$promise:a.fromUser(t).$promise).then(function(e){l=0===e.length||e.length<s,c+=e.length}),r}t.loadMore=function(){return t.infiniteScrollEnded?e.reject("No more results"):r=r.then(function(e){return t.infiniteScrollEnded=l,t.collections=t.collections||[],t.collections=t.collections.concat(e),u()})},u().then(t.loadMore),t.$on("$collection:changed",function(e,n){if(_.includes(["mark-deleted","unmark-deleted"],n.action)){var o=_.find(t.collections,{id:n.collection.id});o&&(o.isDeleting="mark-deleted"===n.action||null)}else{if("delete"===n.action)return _.remove(t.collections,{id:n.collection.id}),void(t.collections.length<s&&t.loadMore());"create"===n.action&&t.collections.unshift(n.collection)}})}]),angular.module("bandlab.user").controller("UserCommunitiesCtrl",["$q","$scope","$stateParams","Community","Me","theUser",function(e,t,n,o,a,i){var r,s=20,c=0,l=!1;function u(){return l?e.resolve([]):((r=o.fromUser({userId:i.id,offset:c,limit:s,role:n.role}).$promise).then(function(e){l=0===e.length||e.length<s,c+=e.length}),r)}t.loadMore=function(){return t.infiniteScrollEnded?e.reject("No more results"):r=r.then(function(e){return t.infiniteScrollEnded=l,t.communities=t.communities||[],t.communities=t.communities.concat(e),u()})},u().then(t.loadMore),t.$on("$community:changed",function(e,n){if(_.includes(["mark-deleted","unmark-deleted"],n.action)){var o=_.find(t.communities,{id:n.community.id});o&&(o.isDeleting="mark-deleted"===n.action||null)}else{if("delete"===n.action)return _.remove(t.communities,{id:n.community.id}),void(t.communities.length<s&&t.loadMore());"create"===n.action&&t.communities.unshift(n.community)}}),t.$on("$community:left",function(e,n){a.id===i.id?_.remove(t.communities,n.community):(n.community.isMember=!1,_.remove(n.community.members,{id:a.id}))})}]),angular.module("bandlab.user").controller("UserCtrl",["$rootScope","appActions","Me","Modal",function(e,t,n,o){var a=this;a.$onInit=function(){a.isOwnProfile=n.id===a.user.id},a.$onDestroy=function(){i()},a.displaySendTip=function(){if(t.checkAllowed("tip"))return new o({id:"tipSetModal",template:'\n            <div>\n              <div class="modal-content modal-content-medium">\n                <tip-user-form user="user"></tip-user-form>\n              </div>\n            </div>\n          ',contentScope:{user:a.user}}).show()},a.me=n;var i=e.$on("$user:relationChanged",function(e,t){a.user.id===t.user.id&&_.assignIn(a.user,t.user)})}]),angular.module("bandlab.user").component("followersCard",{bindings:{user:"<"},templateUrl:"https://www.bandlab.com/web-app/user/partials/_followers-card-cacf00e0.html",controller:["$rootScope","Me","User",function(e,t,n){var o=this;function a(){n.relation({id:o.user.id,rel:"followers",limit:10}).$promise.then(function(e){o.users=e})}o.$onInit=a,o.me=t,e.$on("$user:relationChanged",a)}],controllerAs:"vm"}),angular.module("bandlab.user").component("followingCard",{bindings:{user:"<"},templateUrl:"https://www.bandlab.com/web-app/user/partials/_following-card-af8b1984.html",controller:["$rootScope","Me","User",function(e,t,n){var o=this;function a(){n.relation({id:o.user.id,rel:"following",limit:10}).$promise.then(function(e){o.users=e})}o.$onInit=a,o.me=t,e.$on("$user:relationChanged",a)}],controllerAs:"vm"}),angular.module("bandlab.user").directive("likers",["User",function(e){return{restrict:"A",link:function(t,n,o){var a,i;function r(){i[0].getBoundingClientRect().top<80?i.removeClass("above").addClass("below"):i.addClass("above").removeClass("below")}function s(e){if(e.length){var t="",n=parseInt(o.likersCount);i.empty(),e.forEach(function(e){t+='<span class="tooltip-text">'.concat(e.name,"</span>")}),n>10&&(t+='<span class="tooltip-text tooltip-info">'.concat("+".concat(n-10," More"),"</span>")),i.append(t),r()}else i.remove()}n.on("mouseenter",function(){o.likersCount&&0!==parseInt(o.likersCount)&&o.likersEntityType&&o.likersEntityId&&(i||(n.css("position","relative"),i=angular.element('<div class="tooltip tooltip-users"><span class="tooltip-text">'.concat("Loading…","</span></div>")),n.append(i)),i.addClass("active"),r(),a||(a=e.likers({entity:o.likersEntityType,entityId:o.likersEntityId,limit:10}).$promise.then(s).catch(function(){i.remove()})))}),n.on("mouseleave",function(){i&&i.removeClass("active")}),t.$on("like",function(e,t){t.id===o.likersEntityId&&(i=a=null)})}}}]),angular.module("bandlab.song").component("recentProjectsMobilePromoCard",{bindings:{user:"<"},templateUrl:"https://www.bandlab.com/web-app/user/partials/_recent-projects-mobile-promo-card-fb0b2c87.html",controllerAs:"vm",controller:["$scope","Song",function(e,t){var n=this;n.$onInit=function(){t.fromUser({id:n.user.id,limit:5,sort:"recent",authorId:n.user.id}).$promise.then(function(t){e.recentProjects=t})}}]}),angular.module("bandlab.song").component("trendingNowMobilePromoCard",{bindings:{revision:"<"},templateUrl:"https://www.bandlab.com/web-app/user/partials/_trending-now-mobile-promo-card-318ecbf5.html",controllerAs:"vm",controller:["$scope","Post",function(e,t){var n=this;n.$onInit=function(){return t.exploreGenre({genres:_.get(n.revision,"genres[0].id",null),limit:5,sort:"trending",timeRange:"week",types:"revision"}).$promise.then(function(t){var n=t.data;n.forEach(function(e){e.revision.song.isPublic=!0}),e.trendingPosts=n})}}]}),angular.module("bandlab.user").directive("selectMultipleUsers",["$q","Search",function(e,n){return{restrict:"E",templateUrl:"https://www.bandlab.com/web-app/user/partials/_select-multiple-users-c7ea0adb.html",scope:{users:"=",placeholder:"@",suggestedUsers:"<",allowEmails:"<",allowUsers:"<",pendingExternalUsers:"<",pendingUsers:"<",excludeBand:"<",excludeCommunity:"<",excludeSong:"<"},link:function(o,a){var i,r,s=a[0].querySelector(".select-multiple-users-textarea");function c(){if(o.allowEmails){var e=_.chain(o.inviteUser).split(/[;,]/).map(function(e){return e.trim()}).filter(Boolean).uniq().value();if(/[;,]$/.test(o.inviteUser)||!(e.length<2)){var t=_.chain(e).map(function(e){return e.indexOf("@")>0?{type:"email",email:e}:o.allowUsers?{type:"user",username:e.replace("@","")}:null}).filter(function(e){return!!e}).filter(function(e){return e.email?!(o.users.find(function(t){return t.email===e.email})||o.pendingExternalUsers.find(function(t){return t.email===e.email})):!(o.users.find(function(t){return t.username===e.username})||o.pendingUsers.find(function(t){return t.username===e.username}))}).value();o.users=o.users.concat(t),o.inviteUser=""}}else o.inviteUser=o.inviteUser.replace(/[,]+$/,",").replace(/[;]+$/,";")}o.allowEmails=!1!==o.allowEmails,o.allowUsers=!1!==o.allowUsers,o.placeholder=o.placeholder||o.allowEmails&&o.allowUsers&&"Username or Email"||o.allowEmails&&"Email"||o.allowUsers&&"Username"||"",o.inviteUser="",o.suggestions={"0users":[]},o.users=o.users||[],o.pendingExternalUsers=o.pendingExternalUsers||[],o.pendingUsers=o.pendingUsers||[],a[0].closest(".modal").addEventListener("click",function(e){!e.target.closest(".select-multiple-users")&&o.inviteUser&&(o.inviteUser+=";",c(),o.$applyAsync())}),o.setUser=function(e){e.type="user",o.users.push(e),o.inviteUser=""},o.handleKeys=function(e){8!==e.which||o.inviteUser?(9===e.which&&o.inviteUser||13===e.which)&&(e.preventDefault(),setTimeout(function(){o.inviteUser&&(o.inviteUser+=";",c())})):o.users.pop()},o.removeUser=function(e){_.remove(o.users,e),s.focus()},o.clearSuggestions=function(){o.suggestions={"0users":[]}},o.$watch("inviteUser",function(){o.users.length>=10?o.inviteUser="":(r=o.inviteUser,c(),i&&0===_.get(i,"$$state.status")||function a(s){if(angular.isUndefined(s)||0===s.length)o.suggestions["0users"]=[];else{if(o.suggestedUsers){var c=s.trim().replace(/\s+/," ").toLowerCase();i=e.resolve(o.suggestedUsers.filter(function(e){return _.includes(e.name.toLowerCase(),c)||_.includes(e.username.toLowerCase(),c)}))}else{var l;i=n.users((l={excludeBand:_.get(o,"excludeBand.id"),excludeCommunity:_.get(o,"excludeCommunity.id"),excludeSong:_.get(o,"excludeSong.id")},t(l,"query",s),t(l,"limit",15),l)).then(function(e){return e.data})}i.then(function(e){if(r!==s&&s)return a(r);o.suggestions["0users"]=e.filter(function(e){return!(o.users.find(function(t){return t.id===e.id})||o.pendingUsers.find(function(t){return t.id===e.id}))})})}}(r))})}}}]),angular.module("bandlab.user").component("suggestedUsersCard",{templateUrl:"https://www.bandlab.com/web-app/user/partials/_suggested-users-card-182d9ce1.html",controllerAs:"vm",controller:["$q","$scope","User",function(e,t,n){var o=this,a=3,i=e.resolve();function r(){return s().then(function(e){o.users=e})}function s(){return 0===i.$$state.status?e.reject("Request already pending."):i=n.suggested({limit:a}).$promise.then(function(e){return e.length?e:n.getRecommendations({limit:a}).$promise})}o.$onInit=r,o.refreshWhoToFollow=r,t.$on("$user:relationChanged",function(e,t){"follow"===t.type&&s().then(function(e){!function(e,t){if(o.users=_.reject(o.users,function(t){return t.id===e}),!(o.users.length>=a)){var n=t.find(function(e){return!_.find(o.users,{id:e.id})});n&&o.users.push(n)}}(t.user.id,e)})})}]}),angular.module("bandlab.user").component("userCard",{bindings:{user:"="},templateUrl:"https://www.bandlab.com/web-app/user/partials/_user-card-326d00db.html",controller:"UserCtrl",controllerAs:"vm"}),angular.module("bandlab.user").directive("userFollow",["Me","UserHelper",function(e,t){return{restrict:"A",scope:{followingClass:"@",user:"=userFollow"},link:function(n,o,a){var i=!1;n.user&&n.user.id!==e.id?(n.$watch("user.isFollower",function(){o.toggleClass(n.followingClass||"hollow",!n.user.isFollower),o[0].classList.contains("follow-text")?o[0].innerHTML=n.user.isFollower?"Following":"Follow":o[0].classList.contains("follow-icon")&&(o[0].innerHTML='<i class="icon-person-'.concat(n.user.isFollower?"checkmark":"plus",'"></i>'))}),o.on("click",function(){i||(i=!0,t.toggleFollowUser(n.user,a.eventLabel).then(function(){i=!1}).catch(function(){i=!1}))})):o.remove()}}}]),angular.module("bandlab.user").component("inviteFriendsCard",{templateUrl:"https://www.bandlab.com/web-app/user/partials/_invite-friends-card-1aaf85f1.html",controller:["$analytics","ClientDevice","Facebook","Me",function(e,t,n,o){this.inviteFacebookFriends=function(){var a="https://www.bandlab.com/invitation?referral=".concat(o.username,"&utm_source=facebook&utm_medium=message&utm_term=").concat(o.id,"&utm_content=homepage&utm_campaign=send-dialog");t.isMobile||t.isTablet?(window.open("https://www.facebook.com/dialog/send?app_id=260753417459194&display=popup&link=".concat(encodeURIComponent(a),"&redirect_uri=").concat(document.URL)),e.eventTrack("Message Friends",{category:"Social",label:"Facebook"})):n.ui({method:"send",link:a}).then(function(){e.eventTrack("Message Friends",{category:"Social",label:"Facebook"})})}}],controllerAs:"vm"}),angular.module("bandlab.user").component("userMobilePromoCard",{bindings:{user:"="},templateUrl:"https://www.bandlab.com/web-app/user/partials/_user-mobile-promo-card-762b0d80.html",controller:"UserCtrl",controllerAs:"vm"}),angular.module("bandlab.user").component("userNavCard",{bindings:{user:"<"},templateUrl:"https://www.bandlab.com/web-app/user/partials/_user-nav-card-903c7cb0.html",controller:["Me",function(e){var t=this;t.$onInit=function(){t.user||(t.user=e)}}],controllerAs:"vm"}),angular.module("bandlab.user").component("userProfilePopover",{bindings:{user:"<"},template:'\n      <div class="popover-content">\n        <user-tile user="vm.user" class="collapse">\n          <user-tile-actions></user-tile-actions>\n        </user-tile>\n      </div>\n    ',controllerAs:"vm"}),angular.module("bandlab.user").directive("usersModal",["$q","Modal",function(e,t){return{restrict:"A",scope:{usersFn:"=usersModalList",title:"@usersModalTitle"},link:function(n,o){var a,i,r,s;function c(){return s?e.resolve([]):((r=n.usersFn({offset:i,limit:a})).then(function(e){s=0===e.length||e.length<a,i+=e.length}),r)}function l(){return n.status.infiniteScrollEnded?e.reject("No more results"):r=r.then(function(e){return n.status.infiniteScrollEnded=s,n.users.push.apply(n.users,e),c()})}o.on("click",function(){a=15,i=0,r=null,s=!1,n.users=[],n.loadMore=l,n.status={infiniteScrollEnded:null},new t({id:"usersModal",templateUrl:"https://www.bandlab.com/web-app/user/partials/_users-modal-029f76f3.html",contentScope:{title:n.title,users:n.users,loadMore:n.loadMore,status:n.status}}).show(),c().then(l)})}}}]),angular.module("bandlab.user").component("userTile",{bindings:{user:"="},transclude:{actions:"?userTileActions"},templateUrl:"https://www.bandlab.com/web-app/user/partials/_user-tile-6c6fce6b.html",controller:"UserCtrl",controllerAs:"vm"}),angular.module("bandlab.user").component("userTileSmall",{bindings:{user:"="},transclude:{actions:"?userTileSmallActions"},templateUrl:"https://www.bandlab.com/web-app/user/partials/_user-tile-small-7961db35.html",controllerAs:"vm"}),angular.module("bandlab.user").factory("Invite",["$resource",function(e){var t="https://www.bandlab.com/api/v1.3/invites";return e(t,{},{query:{method:"GET",isArray:!0,params:{id:"@id",entity:"users"},url:"https://www.bandlab.com/api/v1.3/:entity/:id/invites"},get:{method:"GET",params:{id:"@id"},url:"".concat(t,"/:id")},remove:{method:"DELETE",params:{id:"@id"},url:"".concat(t,"/:id")},save:{method:"POST",params:{id:"@id"},url:"https://www.bandlab.com/api/v1.3/:rel/:id/invites"},update:{method:"PUT",params:{id:"@id"},url:"".concat(t,"/:id")}})}]),angular.module("bandlab.user").factory("Role",["$http",function(e){return{getUserRole:function(n){var o=n.userId,a=nn(n,["userId"]);return e({url:"https://www.bandlab.com/api/v1.3/".concat(t(a),"/members/").concat(o),method:"GET"}).then(function(e){return e.data})},removeUserRole:function(n){var o=n.userId,a=nn(n,["userId"]);return e({url:"https://www.bandlab.com/api/v1.3/".concat(t(a),"/members/").concat(o),method:"DELETE"}).then(function(e){return e.data})},setNotifications:function(n){var o=n.userId,a=n.settings,i=void 0===a?{}:a,r=nn(n,["userId","settings"]);return e({url:"https://www.bandlab.com/api/v1.3/".concat(t(r),"/members/").concat(o),method:"PATCH",data:i}).then(function(e){return e.data})},setUserRole:function(n){var o=n.role,a=n.userId,i=nn(n,["role","userId"]);return e({url:"https://www.bandlab.com/api/v1.3/".concat(t(i),"/members/").concat(a),method:"PATCH",data:{role:o}}).then(function(e){return e.data})}};function t(e){var t=e.bandId,n=e.communityId,o=e.schoolId;return t?"".concat("bands","/").concat(t):n?"communities/".concat(n):o?"schools/".concat(o):void 0}}]),angular.module("bandlab.user").factory("User",["$http","$resource",function(e,t){var n="https://www.bandlab.com/api/v1.3/users";return t(n,{},{block:{method:"POST",params:{meId:"@meId",userId:"@userId"},url:"".concat(n,"/:meId/blocks/users/:userId"),ignoreLoadingBar:!0},blocked:{method:"GET",isArray:!0,params:{id:"@id"},url:"".concat(n,"/:id/blocks/users"),transformResponse:e.defaults.transformResponse.concat(function(e,t,n){return 200===n&&e.data.forEach(function(e){e.isBlocked=!0}),e})},follow:{method:"POST",params:{id:"@id"},url:"".concat(n,"/:id/followers"),ignoreLoadingBar:!0},fromBand:{method:"GET",isArray:!0,params:{bandId:"",limit:10,offset:0},url:"https://www.bandlab.com/api/v1.3/".concat("bands","/:bandId/members")},fromCommunity:{method:"GET",isArray:!0,params:{communityId:"",limit:10,offset:0},url:"https://www.bandlab.com/api/v1.3/communities/:communityId/members"},get:{method:"GET",params:{id:"@id"},url:"".concat(n,"/:id")},getCollaborators:{method:"GET",isArray:!0,params:{songId:"",limit:10,offset:0},url:"https://www.bandlab.com/api/v1.3/songs/:songId/collaborators"},getRecommendations:{method:"GET",isArray:!0,params:{limit:20,skills:"all",sort:"random"},url:"https://www.bandlab.com/api/v1.3/recommendations/users"},likers:{method:"GET",isArray:!0,params:{entityId:"",entity:"revisions",limit:10,offset:0},url:"https://www.bandlab.com/api/v1.3/:entity/:entityId/likes/users",ignoreLoadingBar:!0},query:{method:"GET",isArray:!0,params:{limit:10,offset:0}},relation:{method:"GET",isArray:!0,params:{id:"@id",limit:10,offset:0},url:"".concat(n,"/:id/:rel")},relationAnonymous:{method:"GET",isArray:!0,params:{limit:10,offset:0},url:"".concat(n,"/:rel")},suggested:{method:"GET",isArray:!0,params:{limit:20,offset:0},url:"".concat(n,"/suggested")},unblock:{method:"DELETE",params:{meId:"@meId",userId:"@userId"},url:"".concat(n,"/:meId/blocks/users/:userId"),ignoreLoadingBar:!0},unfollow:{method:"DELETE",params:{id:"@id"},url:"".concat(n,"/:id/followers"),ignoreLoadingBar:!0},update:{method:"PATCH",params:{id:"@id"},url:"".concat(n,"/:id")}})}]),angular.module("bandlab.user").factory("UserHelper",["$analytics","$q","$rootScope","$timeout","appActions","authService","User",function(e,t,n,o,a,i,r){return{toggleFollowUser:function(n){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!a.checkAllowed("follow"))return t.reject("Cannot follow user");var u=n.isFollower?"unfollow":"follow";return s(n),r[u]({id:n.id}).$promise.then(function(){return o(function(){i.refreshMe()},1500),e.eventTrack("follow"===u?"Follow":"Unfollow",{category:"User",label:l}),c(n,u),n}).catch(function(e){return s(n),c(n,u),t.reject(e)})}};function s(e){e.isFollower=!e.isFollower,e.counters&&(e.counters.followers+=e.isFollower?1:-1)}function c(e,t){setTimeout(function(){r.get({id:e.id}).$promise.then(function(o){_.assignIn(e,o),n.$broadcast("$user:relationChanged",{type:t,user:e})})},1e3)}}]),angular.module("bandlab.user.routes",["ui.router"]).config(["$stateProvider",function(e){e.state("user",{url:"/{username:[a-z0-9][a-z0-9_]{3,19}}",abstract:!0,params:{rewriteTracking:["$stateParams","ClientDevice","Me",function(e,t,n){return function(o){var a=n.isAnonymous()&&t.isMobile;return o.replace(/^\/[a-z0-9][a-z0-9_]{3,19}(($|\/).*)/g,"/".concat(e.username===n.username?"me":"user").concat(a?"/promo":"","$1"))}}]},templateProvider:["$templateRequest","ClientDevice","Me",function(e,t,n){return e(n.isAnonymous()&&t.isMobile?"https://www.bandlab.com/web-app/user/views/user-mobile-promo-layout-fcb9ea8e.html":"https://www.bandlab.com/web-app/user/views/user-layout-141fb248.html")}],resolve:{theUser:["$stateParams","User",function(e,t){var n=(new Date).getTime();return t.get({id:e.username}).$promise.then(function(e){return ga("send","timing","User","Get User",(new Date).getTime()-n),e})}]},onEnter:["Page","theUser",function(e,t){e.setMetadata({title:"".concat(t.name," | BandLab"),description:"".concat(t.about?"".concat(t.about," | "):"","Listen to music from ").concat(t.name," and follow their creative process on BandLab."),image:t.picture.s,imageHeight:"360",imageWidth:"360",objectPath:"/users/".concat(t.id)})}],onExit:["Page",function(e){e.clearMetadata()}],controller:["$scope","Me","theUser",function(e,t,n){e.isOwnProfile=n.id===t.id,e.user=n,e.$on("$user:relationChanged",function(t,n){e.user.id===n.user.id&&_.assignIn(e.user,n.user)}),e.$on("$band:changed",function(){e.user.$get({id:e.user.id})})}]}).state("user.feed",{url:"",views:{content:{templateUrl:"https://www.bandlab.com/web-app/user/views/user-feed-4b7d55d3.html",controller:["$location","$q","$scope","$state","$timeout","$window","Me","PlayerHistory","Post","Shout",function(e,t,o,a,i,r,s,c,l,u){var d,p,m=5,f=null,h=!1,g=e.url();function v(){return h?t.resolve([]):d=l.fromUser({userId:o.user.id,after:f,limit:m}).$promise.then(function(e){return h=e.data.length<m,f=_.get(e,"paging.cursors.after",0),e.data})}function b(){return o.infiniteScrollEnded?t.reject("No more results"):d=d.then(function(e){return o.infiniteScrollEnded=h,o.posts=o.posts||[],o.posts=o.posts.concat(e.filter(function(e){return!e.isPinned})),o.pinned=o.pinned||e.filter(function(e){return e.isPinned}),c.pushQueueSongs(o.posts,g),v()})}o.loadMore=b,o.me=s,o.createShoutPost=function(){return u.createShoutPost({type:"photo",user:s})},o.onPostCreate=function(e){o.posts.unshift(e)},o.onShoutUploaded=function e(a,r){var s=l.fromUser({userId:o.user.id,offset:0,limit:10,excludePinned:!0}).$promise;return i.cancel(p),p=i(angular.noop,2e3),t.all([s,p]).then(function(t){var s=n(t,1)[0].data,c=_.find(s,a);c?(r.remove(),o.posts.unshift(c),i.cancel(p)):e(a,r)})},c.setState({loader:b,url:g}),v().then(o.loadMore),o.$on("$revision:changed",function(e,t){"unpublish"===t.action?(_.remove(o.posts,function(e){return e.revision&&e.revision.id===t.revision.id}),o.pinned.length&&(_.remove(o.pinned,function(e){return e.revision&&e.revision.id===t.revision.id}),(document.scrollingElement||document.body).scrollTop=0)):"create"===t.action&&t.revision.isPublic&&l.get({id:t.revision.postId}).$promise.then(function(e){o.posts.unshift(e)})}),o.$on("$post:pin",function(e,t){var n=t.post;_.find(o.posts,{id:n.id})&&i(function(){return a.reload("user.feed")},1e3)}),o.$on("$post:unpin",function(e,t){var n=t.post;_.find(o.pinned,{id:n.id})&&i(function(){return a.reload("user.feed")},1e3)}),o.$on("$post:delete",function(e,t){_.remove(o.posts,function(e){return e.id===t.post.id}),o.pinned.length&&(_.remove(o.pinned,function(e){return e.id===t.post.id}),(document.scrollingElement||document.body).scrollTop=0)}),o.$on("$destroy",function(){angular.isFunction(r.unmountVideo)&&r.unmountVideo()})}]}}}).state("user.posts",{url:"/posts/{postId:[a-zA-Z0-9-_]+}",resolve:{post:["$stateParams","Post",function(e,t){return t.get({id:e.postId}).$promise}]},views:{content:{templateUrl:"https://www.bandlab.com/web-app/user/views/user-feed-4b7d55d3.html",controller:["$scope","post",function(e,t){e.posts=[t]}]}}}).state("user.bands",{url:"/bands",views:{content:{templateUrl:"https://www.bandlab.com/web-app/user/views/user-bands-d85c36e3.html",controller:"UserBandsCtrl"}}}).state("user.collections",{url:"/collections",views:{content:{templateUrl:"https://www.bandlab.com/web-app/user/views/user-collections-4bc1f37f.html",controller:"UserCollectionsCtrl"}}}).state("user.followers",{url:"/followers",views:{content:{templateUrl:"https://www.bandlab.com/web-app/user/views/user-followers-a64b47d4.html",controller:["$q","$scope","User",function(e,t,n){var o,a=20,i=0,r=!1;function s(){return r?e.resolve([]):((o=n.relation({id:t.user.id,rel:"followers",offset:i,limit:a}).$promise).then(function(e){r=0===e.length||e.length<a,i+=e.length}),o)}t.loadMore=function(){return t.infiniteScrollEnded?e.reject("No more results"):o=o.then(function(e){return t.infiniteScrollEnded=r,t.users=t.users||[],t.users=t.users.concat(e),s()})},s().then(t.loadMore)}]}}}).state("user.following",{url:"/following",views:{content:{templateUrl:"https://www.bandlab.com/web-app/user/views/user-following-b93db8d6.html",controller:["$q","$scope","User",function(e,t,n){var o,a=20,i=0,r=!1;function s(){return r?e.resolve([]):((o=n.relation({id:t.user.id,rel:"following",offset:i,limit:a}).$promise).then(function(e){r=0===e.length||e.length<a,i+=e.length}),o)}t.loadMore=function(){return t.infiniteScrollEnded?e.reject("No more results"):o=o.then(function(e){return t.infiniteScrollEnded=r,t.users=t.users||[],t.users=t.users.concat(e),s()})},s().then(t.loadMore)}]}}}).state("user.likedPosts",{url:"/likes/posts",resolve:{canAccess:["$q","Me","theUser",function(e,t,n){return e(function(e,o){t.id===n.id?e(!0):o({status:403})})}]},views:{content:{templateUrl:"https://www.bandlab.com/web-app/user/views/user-likes-posts-d597bd01.html",controller:["$location","$q","$scope","PlayerHistory","Post",function(e,t,n,o,a){var i,r=5,s=null,c=!1,l=e.url();function u(){return c?t.resolve([]):i=a.liked({userId:n.user.id,after:s,limit:r}).$promise.then(function(e){return c=e.data.length<r,s=_.get(e,"paging.cursors.after",0),e.data})}function d(){return n.infiniteScrollEnded?t.reject("No more results"):i=i.then(function(e){return n.infiniteScrollEnded=c,n.posts=n.posts||[],n.posts=n.posts.concat(e),o.pushQueueSongs(n.posts,l),u()})}n.loadMore=d,o.setState({loader:d,url:l}),u().then(n.loadMore)}]}}}).state("user.likedCollections",{url:"/likes/collections",resolve:{canAccess:["$q","Me","theUser",function(e,t,n){return e(function(e,o){t.id===n.id?e(!0):o({status:403})})}]},views:{content:{templateUrl:"https://www.bandlab.com/web-app/user/views/user-likes-collections-66dd0b0d.html",controller:["$q","$scope","Collection",function(e,t,n){var o,a=20,i=0,r=!1;function s(){return r?e.resolve([]):((o=n.liked({userId:t.user.id,offset:i,limit:a}).$promise).then(function(e){r=0===e.length||e.length<a,i+=e.length}),o)}t.loadMore=function(){return t.infiniteScrollEnded?e.reject("No more results"):o=o.then(function(e){return t.infiniteScrollEnded=r,t.collections=t.collections||[],t.collections=t.collections.concat(e),s()})},s().then(t.loadMore)}]}}})}])}();
//# sourceMappingURL=https://www.bandlab.com/web-app/scripts/scripts-f0cb28aef4.js.map
